<!DOCTYPE html><html  lang="en" data-capo=""><head><meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="anonymous">
<link rel="stylesheet" href="https://stcdn.leadconnectorhq.com/forms/fonts/material/material-icons.css" crossorigin="anonymous">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i&display=swap" media="print" onload="this.media='all'">
<style type="text/css"> 

 :root{ --transparent: transparent;
--primary: #37ca37;
--secondary: #188bf6;
--white: #ffffff;
--gray: #cbd5e0;
--black: #000000;
--red: #e93d3d;
--orange: #f6ad55;
--yellow: #faf089;
--green: #9ae6b4;
--teal: #81e6d9;
--malibu: #63b3ed;
--indigo: #757BBD;
--purple: #d6bcfa;
--pink: #fbb6ce;
--cobalt: #155eef;
--smoke: #f5f5f5;
--overlay: rgba(0, 0, 0, 0.5);
--color-66c5b4f991201e717d357151: #0e2f64;
--color-66c5b4f991201e3958357152: #1493ff;
--color-691b5b42180071013c3d1950: #ff751f;
--color-691b5b421800714c673d1951: #fffef0;
--inter: 'Inter';
--space-grotesk: 'Space Grotesk';
--headlinefont: 'Inter';
--contentfont: 'Inter';
--text-color: #000000;
--link-color: #188bf6; } .bg-fixed{bottom:0;top:0;left:0;right:0;position:fixed;overflow:auto;background-color:var(--white)} 
            
            .drop-zone-draggable .hl_main_popup{box-shadow:none;padding:20px;margin-top:0;border-color:var(--gray);border-width:10px;border-style:solid;background-color:var(--white);width:720px}
            
          
#hl_main_popup.popup-body{position:absolute!important;left:50%!important;bottom:auto!important;transform:translate(-50%,0)!important;right:auto!important;box-shadow:none;padding:20px;margin-top:0;border-color:var(--gray);border-width:10px;border-style:solid;background-color:var(--white);width:720px}.--mobile #hl_main_popup.popup-body{width:380px!important}@media screen and (min-width:0px) and (max-width:480px){#hl_main_popup.popup-body{width:380px!important}} 
            
            .drop-zone-draggable .hl_main_popup-WiEb801Qgf{box-shadow:none;padding:20px;margin-top:0;border-color:var(--gray);border-width:10px;border-style:solid;background-color:var(--white);width:720px}
            
          
#hl_main_popup-WiEb801Qgf.popup-body{position:absolute!important;left:50%!important;bottom:auto!important;transform:translate(-50%,0)!important;right:auto!important;box-shadow:none;padding:20px;margin-top:0;border-color:var(--gray);border-width:10px;border-style:solid;background-color:var(--white);width:720px}.--mobile #hl_main_popup-WiEb801Qgf.popup-body{width:380px!important}@media screen and (min-width:0px) and (max-width:480px){#hl_main_popup-WiEb801Qgf.popup-body{width:380px!important}}  
 /* ---- Section styles ----- */ 
:root{--transparent:transparent;--black:#000000}.hl_page-preview--content .col-0KXXeTJt-F,.hl_page-preview--content .row-g7f2wkYs_s,.hl_page-preview--content .section-zwgfsNCznE{box-shadow:none;padding:20px 0;margin:0;background-color:var(--transparent);backdrop-filter:none;border-color:var(--black);border-width:2px;border-style:solid}.hl_page-preview--content .col-0KXXeTJt-F,.hl_page-preview--content .row-g7f2wkYs_s{margin:0 auto;padding:10px 5px;width:100%}.hl_page-preview--content .col-0KXXeTJt-F{margin:0}.hl_page-preview--content .custom-code-F7m1yuu79Z{margin:0;width:auto;height:auto}#section-zwgfsNCznE>.inner{max-width:1170px}#col-0KXXeTJt-F>.inner{flex-direction:column;justify-content:center;align-items:inherit;flex-wrap:nowrap}

</style>
<style>.flex{display:flex}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.flex-grow{flex-grow:9999}.align-center{align-items:center}.h-full{height:100%}.max-w-400{max-width:400px}.text-right{text-align:right}.d-grid{display:grid}.px-0{padding-left:0!important;padding-right:0!important}.gap-1{gap:.3rem}.items-end{align-items:flex-end}.relative{position:relative}.gap-2{gap:.625rem}.mt-20{margin-top:20px}.mt-8{margin-top:32px}.ml-3{margin-left:.75rem}.mr-10{margin-right:10px}.mt-4{margin-top:1rem}.mb-4{margin-bottom:1rem}.w-100{width:100%}.h-100{height:100%}.w-50{width:50%}.w-25{width:25%}.mw-100{max-width:100%}.noBorder{border:none!important}.iti__flag{background-image:url(https://stcdn.leadconnectorhq.com/intl-tel-input/17.0.12/img/flags.png)}.pointer{cursor:pointer}@media (-webkit-min-device-pixel-ratio:2),(min-resolution:192dpi){.iti__flag{background-image:url(https://stcdn.leadconnectorhq.com/intl-tel-input/17.0.12/img/flags@2x.png)}}.iti__country{display:flex;justify-content:space-between}@media (min-width:768px){.hl_wrapper.nav-shrink .hl_wrapper--inner.page-creator,body{padding-top:0}.hl_page-creator--menu{left:0;top:0;z-index:10}.hl_wrapper{padding-left:0}}@media (min-width:1200px){.hl_wrapper.nav-shrink{padding-left:0!important}}html body .hl_wrapper{height:100vh;overflow:hidden}body{margin:0;-webkit-font-smoothing:antialiased}img{border-style:none;vertical-align:middle}.bg-fixed{z-index:-1}.progress-outer{background-color:#f5f5f5;border-radius:inherit;box-shadow:inset 0 1px 2px rgba(0,0,0,.1);font-size:14px;height:35px;line-height:36px;overflow:hidden;padding-bottom:0;padding-top:0;width:100%}.progress-inner{box-shadow:inset 0 -1px 0 rgba(0,0,0,.15);color:#fff;float:left;font-size:14px;height:100%;padding-left:10px;padding-right:10px;transition:width .6s ease;width:0}.progress0{width:0}.progress10{width:10%}.progress20{width:20%}.progress30{width:30%}.progress40{width:40%}.progress50{width:50%}.progress60{width:60%}.progress70{width:70%}.progress80{width:80%}.progress90{width:90%}.progress100{width:100%}.progressbarOffsetWhite{background:#f5f5f5}.progressbarOffsetTransparentWhite{background-color:hsla(0,0%,100%,.5)}.progressbarOffsetBlack{background:#333}.progressbarOffsetTransparentBlack{background-color:hsla(0,0%,49%,.5)}.text-white{color:#fff}.text-bold{font-weight:700}.text-italic{font-style:italic}.text-bold-italic{font-style:italic;font-weight:700}.progressbarSmall{font-size:14px;height:35px;line-height:36px}.progressbarMedium{font-size:19px;height:45px;line-height:45px}.progressbarLarge{font-size:21px;height:65px;line-height:65px}.recaptcha-container{margin-bottom:1em}.recaptcha-container p{color:red;margin-top:1em}.button-recaptcha-container div:first-child{height:auto!important;width:100%!important}.card-el-error-msg{align-items:center;color:#e25950;display:flex;font-size:13px;justify-content:flex-start;padding:10px 0;text-align:center}.card-el-error-msg svg{color:#f87171;margin-right:2px}.hl-faq-child-heading{border:none;cursor:pointer;justify-content:space-between;outline:none;padding:15px;width:100%}.hl-faq-child-head,.hl-faq-child-heading{align-items:center;display:flex}.v-enter-active,.v-leave-active{transition:opacity .2s ease-out}.v-enter-from,.v-leave-to{opacity:0}.faq-separated-child{margin-bottom:10px}.hl-faq-child-panel img{border-radius:15px;cursor:pointer}.hl-faq-child-heading-icon.left{margin-right:1em}.expand-collapse-all-button{background-color:transparent;border:1px solid #d1d5db;border-radius:15px;color:#3b82f6;cursor:pointer;font-size:12px;font-weight:400;line-height:16px;margin:1em 0;padding:5px 15px}.hl-faq-child-panel{transition:padding .2s ease}.v-spinner .v-moon1{position:relative}.v-spinner .v-moon1,.v-spinner .v-moon2{animation:v-moonStretchDelay .6s linear 0s infinite;animation-fill-mode:forwards}.v-spinner .v-moon2{opacity:.8;position:absolute}.v-spinner .v-moon3{opacity:.1}@keyframes v-moonStretchDelay{to{transform:rotate(1turn)}}.generic-error-message{color:red;font-weight:500;margin-top:.5rem;text-align:center}#faq-overlay{background:var(--overlay);height:100vh;opacity:.8;width:100vw}#faq-overlay,#faq-popup{position:fixed;z-index:1000}#faq-popup{background:#fff;height:auto;left:50%;margin-left:-250px;margin-top:-250px;top:50%;width:500px}#popupclose{cursor:pointer;float:right;padding:10px}.popupcontent{height:auto!important;width:100%!important}#button{cursor:pointer}.dark{background-color:#000}.antialiased{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.spotlight{background:linear-gradient(45deg,#00dc82,#36e4da 50%,#0047e1);bottom:-30vh;filter:blur(20vh);height:40vh}.z-10{z-index:10}.right-0{right:0}.left-0{left:0}.fixed{position:fixed}.text-black{--tw-text-opacity:1;color:rgba(0,0,0,var(--tw-text-opacity))}.overflow-hidden{overflow:hidden}.min-h-screen{min-height:100vh}.font-sans{font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji}.place-content-center{place-content:center}.grid{display:grid}.z-20{z-index:20}.max-w-520px{max-width:520px}.mb-8{margin-bottom:2rem}.text-8xl{font-size:6rem;line-height:1}.font-medium{font-weight:500}.mb-16{margin-bottom:4rem}.leading-tight{line-height:1.25}.text-xl{font-size:1.25rem;line-height:1.75rem}.font-light{font-weight:300}@media (min-width:640px){.sm-text-10xl{font-size:10rem;line-height:1}.sm-text-4xl{font-size:2.25rem;line-height:2.5rem}.sm-px-0{padding-left:0;padding-right:0}}.full-center{background-position:50%!important;background-repeat:repeat!important;background-size:cover!important}.fill-width{background-size:100% auto!important}.fill-width,.fill-width-height{background-repeat:no-repeat!important}.fill-width-height{background-size:100% 100%!important}.no-repeat{background-repeat:no-repeat!important}.repeat-x{background-repeat:repeat-x!important}.repeat-y{background-repeat:repeat-y!important}.repeat-x-fix-top{background-position:top!important;background-repeat:repeat-x!important}.repeat-x-fix-bottom{background-position:bottom!important;background-repeat:repeat-x!important}#overlay{bottom:0;height:100%;left:0;opacity:0;overflow-y:scroll;position:fixed;right:0;top:0;transition:opacity .3s ease;width:100%;z-index:999;-webkit-overflow-scrolling:touch}#overlay.show{opacity:1}.popup-body{background-color:#fff;height:auto;left:50%;min-height:180px;position:absolute;top:10%;transition:transform .25s ease-in-out}.popup-body,.popup-body.show{transform:translate(-50%)}.closeLPModal{cursor:pointer;position:absolute;right:-10px;top:-10px;z-index:21}.settingsPModal{font-size:18px;left:40%;padding:10px;position:absolute;top:-40px;width:32px}.c-section>.inner{display:flex;flex-direction:column;justify-content:center;margin:auto;z-index:2}.c-row>.inner{display:flex;width:100%}.c-column>.inner{display:flex;flex-direction:column;height:100%;justify-content:inherit;width:100%!important}.c-wrapper{position:relative}.previewer{--vw:100vh/100;height:calc(100vh - 170px);margin:auto;overflow:scroll;overflow-x:hidden;overflow-y:scroll;width:100%}.c-element{position:relative}.c-column{flex:1}.c-column,.c-row{position:relative}p+p{margin-top:auto}.hl_page-creator--row.active{border-color:#188bf6}.flip-list-move{transition:transform .5s}.page-wrapper .sortable-ghost:before{background:#188bf6!important;border-radius:4px;content:"";height:4px;left:50%;position:absolute;top:50%;transform:translate(-50%,-50%);width:100%}.page-wrapper .sortable-ghost{border:none!important;position:relative}.active-drop-area:before{color:grey;content:"";font-size:12px;left:50%;pointer-events:none;position:absolute;top:50%;transform:translate(-50%,-50%)}.active-drop-area{border:1px dashed grey}.active-drop-area.is-empty{min-height:60px}.empty-component{align-items:center;border:1px dashed #d7dde9;display:flex;height:100%;justify-content:center;left:0;position:absolute;top:0;width:100%;z-index:2}.empty-component,.empty-component-min-height{min-height:100px;pointer-events:none}.dividerContainer{width:100%}.items-center{align-items:center}.font-semibold{font-weight:600}.text-2xl{font-size:1.5rem}.text-sm{font-size:.875rem}.w-full{width:100%}.mr-2{margin-right:.5rem}.mt-2{margin-top:.5rem}.justify-between{justify-content:space-between}.text-lg{font-size:1.125rem}.font-base{font-weight:400}.justify-end{justify-content:flex-end}.justify-center{justify-content:center!important}.text-center{text-align:center}.centered{align-items:center;display:flex;height:100%;justify-content:center;width:100%}.mx-auto{margin:0 auto}.default-cursor{cursor:default!important}</style>
<style>@media only screen and (max-width:767px){.c-row>.inner{flex-direction:column}.desktop-only{display:none}.c-column,.c-row{width:100%!important}.c-column,.c-column>.inner,.c-row>.inner,.c-section,.c-section>.inner{padding-left:0!important;padding-right:0!important}.c-column,.c-column>.inner,.c-row{margin-left:0!important;margin-right:0!important}.c-row{padding-left:10px!important;padding-right:10px!important}}@media only screen and (min-width:768px){.mobile-only{display:none}}.c-button button{outline:none;position:relative}.fa,.fab,.fal,.far,.fas{-webkit-font-smoothing:antialiased;display:inline-block;font-style:normal;font-variant:normal;line-height:1;text-rendering:auto}.c-column{flex:1 1 auto!important}.c-column>.inner.horizontal>div{flex:1}.c-row>.inner{display:flex;width:100%}.c-nested-column .c-row>.inner{width:100%!important}.c-nested-column .inner{border:none!important}.bgCover.bg-fixed:before{background-attachment:fixed!important;background-position:50%!important;background-repeat:repeat!important;background-size:cover!important;-webkit-background-size:cover!important}@supports (-webkit-touch-callout:inherit){.bgCover.bg-fixed:before{background-attachment:scroll!important}}.bgCover100.bg-fixed:before{background-size:100% auto!important;-webkit-background-size:100% auto!important}.bgCover100.bg-fixed:before,.bgNoRepeat.bg-fixed:before{background-repeat:no-repeat!important}.bgRepeatX.bg-fixed:before{background-repeat:repeat-x!important}.bgRepeatY.bg-fixed:before{background-repeat:repeat-y!important}.bgRepeatXTop.bg-fixed:before{background-position:top!important;background-repeat:repeat-x!important}.bgRepeatXBottom.bg-fixed:before{background-position:bottom!important;background-repeat:repeat-x!important}.bgCover{background-attachment:fixed!important;background-position:50%!important;background-repeat:repeat!important;background-size:cover!important;-webkit-background-size:cover!important}@supports (-webkit-touch-callout:inherit){.bgCover{background-attachment:scroll!important}}.bgCover100{background-size:100% auto!important;-webkit-background-size:100% auto!important}.bgCover100,.bgNoRepeat{background-repeat:no-repeat!important}.bgRepeatX{background-repeat:repeat-x!important}.bgRepeatY{background-repeat:repeat-y!important}.bgRepeatXTop{background-position:top!important}.bgRepeatXBottom,.bgRepeatXTop{background-repeat:repeat-x!important}.bgRepeatXBottom{background-position:bottom!important}.cornersTop{border-bottom-left-radius:0!important;border-bottom-right-radius:0!important}.cornersBottom{border-top-left-radius:0!important;border-top-right-radius:0!important}.radius0{border-radius:0}.radius1{border-radius:1px}.radius2{border-radius:2px}.radius3{border-radius:3px}.radius4{border-radius:4px}.radius5{border-radius:5px}.radius10{border-radius:10px}.radius15{border-radius:15px}.radius20{border-radius:20px}.radius25{border-radius:25px}.radius50{border-radius:50px}.radius75{border-radius:75px}.radius100{border-radius:100px}.radius125{border-radius:125px}.radius150{border-radius:150px}.borderTopBottom{border-bottom-color:rgba(0,0,0,.7);border-left:none!important;border-right:none!important;border-top-color:rgba(0,0,0,.7)}.borderTop{border-bottom:none!important;border-top-color:rgba(0,0,0,.7)}.borderBottom,.borderTop{border-left:none!important;border-right:none!important}.borderBottom{border-bottom-color:rgba(0,0,0,.7);border-top:none!important}.borderFull{border-color:rgba(0,0,0,.7)}@keyframes rocking{0%{transform:rotate(0deg)}25%{transform:rotate(0deg)}50%{transform:rotate(2deg)}75%{transform:rotate(-2deg)}to{transform:rotate(0deg)}}.buttonRocking{animation:rocking 2s infinite;animation-timing-function:ease-out;transition:.2s}.buttonPulseGlow{animation:pulseGlow 2s infinite;animation-timing-function:ease-in-out}@keyframes pulseGlow{0%{box-shadow:0 0 0 0 hsla(0,0%,100%,0)}25%{box-shadow:0 0 2.5px 1px hsla(0,0%,100%,.25)}50%{box-shadow:0 0 5px 2px hsla(0,0%,100%,.5)}85%{box-shadow:0 0 5px 5px hsla(0,0%,100%,0)}to{box-shadow:0 0 0 0 hsla(0,0%,100%,0)}}.buttonBounce{animation:bounce 1.5s infinite;animation-timing-function:ease-in;transition:.2s}@keyframes bounce{15%{box-shadow:0 0 0 0 transparent;transform:translateY(0)}35%{box-shadow:0 8px 5px -5px rgba(0,0,0,.25);transform:translateY(-35%)}45%{box-shadow:0 0 0 0 transparent;transform:translateY(0)}55%{box-shadow:0 5px 4px -4px rgba(0,0,0,.25);transform:translateY(-20%)}70%{box-shadow:0 0 0 0 transparent;transform:translateY(0)}80%{box-shadow:0 4px 3px -3px rgba(0,0,0,.25);transform:translateY(-10%)}90%{box-shadow:0 0 0 0 transparent;transform:translateY(0)}95%{box-shadow:0 2px 3px -3px rgba(0,0,0,.25);transform:translateY(-2%)}99%{box-shadow:0 0 0 0 transparent;transform:translateY(0)}to{box-shadow:0 0 0 0 transparent;transform:translateY(0)}}@keyframes elevate{0%{box-shadow:0 0 0 0 transparent;transform:translateY(0)}to{box-shadow:0 8px 5px -5px rgba(0,0,0,.25);transform:translateY(-10px)}}.buttonElevate:hover{animation:elevate .2s forwards}.buttonElevate{box-shadow:0 0 0 0 transparent;transition:.2s}.buttonWobble{transition:.3s}.buttonWobble:hover{animation:wobble .5s 1;animation-timing-function:ease-in-out}@keyframes wobble{0%{transform:skewX(0deg)}25%{transform:skewX(10deg)}50%{transform:skewX(0deg)}75%{transform:skewX(-10deg)}to{transform:skewX(0deg)}}.image-container img{max-width:100%;vertical-align:middle}.sub-text ::-moz-placeholder{color:#000;opacity:1}.sub-text ::placeholder{color:#000;opacity:1}.image-container{height:100%;width:100%}.shadow5inner{box-shadow:inset 0 1px 3px rgba(0,0,0,.05)}.shadow10inner{box-shadow:inset 0 1px 5px rgba(0,0,0,.1)}.shadow20inner{box-shadow:inset 0 1px 5px rgba(0,0,0,.2)}.shadow30inner{box-shadow:inset 0 2px 5px 2px rgba(0,0,0,.3)}.shadow40inner{box-shadow:inset 0 2px 5px 2px rgba(0,0,0,.4)}.shadow5{box-shadow:0 1px 3px rgba(0,0,0,.05)}.shadow10{box-shadow:0 1px 5px rgba(0,0,0,.1)}.shadow20{box-shadow:0 1px 5px rgba(0,0,0,.2)}.shadow30{box-shadow:0 2px 5px 2px rgba(0,0,0,.3)}.shadow40{box-shadow:0 2px 5px 2px rgba(0,0,0,.4)}.sub-heading-button{color:#fff;font-weight:400;line-height:normal;opacity:.8;text-align:center}.wideSection{max-width:1120px}.midWideSection,.wideSection{margin-left:auto!important;margin-right:auto!important}.midWideSection{max-width:960px}.midSection{margin-left:auto!important;margin-right:auto!important;max-width:720px}.c-section>.inner{margin-left:auto;margin-right:auto;max-width:1170px;width:100%}.c-column{padding-left:15px;padding-right:15px}.feature-img-circle img,.img-circle,.img-circle img{border-radius:50%!important}.feature-img-round-corners img,.img-round-corners,.img-round-corners img{border-radius:5px}.feature-image-dark-border img,.image-dark-border{border:3px solid rgba(0,0,0,.7)}.feature-image-white-border img,.image-white-border{border:3px solid #fff}.img-grey,.img-grey img{filter:grayscale(100%);filter:gray;-webkit-transition:all .6s ease}.button-shadow1{box-shadow:0 1px 5px rgba(0,0,0,.2)}.button-shadow2{box-shadow:0 1px 5px rgba(0,0,0,.4)}.button-shadow3{box-shadow:0 1px 5px rgba(0,0,0,.7)}.button-shadow4{box-shadow:0 8px 1px rgba(0,0,0,.1)}.button-shadow5{box-shadow:0 0 25px rgba(0,0,0,.2),0 0 15px rgba(0,0,0,.2),0 0 3px rgba(0,0,0,.4)}.button-shadow6{box-shadow:0 0 25px rgba(0,0,0,.4),0 0 15px hsla(0,0%,100%,.2),0 0 3px hsla(0,0%,100%,.4)}.button-shadow-sharp1{box-shadow:inset 0 1px 0 hsla(0,0%,100%,.2)}.button-shadow-sharp2{box-shadow:inset 0 0 0 1px hsla(0,0%,100%,.2)}.button-shadow-sharp3{box-shadow:inset 0 0 0 2px hsla(0,0%,100%,.2)}.button-shadow-highlight{box-shadow:none}.button-shadow-highlight:hover{box-shadow:inset 0 0 0 0 hsla(0,0%,100%,.22),inset 0 233px 233px 0 hsla(0,0%,100%,.12)}.button-flat-line{background-color:transparent!important;border-width:2px}.button-vp-5{padding-bottom:5px!important;padding-top:5px!important}.button-vp-10{padding-bottom:10px!important;padding-top:10px!important}.button-vp-15{padding-bottom:15px!important;padding-top:15px!important}.button-vp-20{padding-bottom:20px!important;padding-top:20px!important}.button-vp-25{padding-bottom:25px!important;padding-top:25px!important}.button-vp-30{padding-bottom:30px!important;padding-top:30px!important}.button-vp-40{padding-bottom:40px!important;padding-top:40px!important}.button-vp-0{padding-bottom:0!important;padding-top:0!important}.button-hp-5{padding-left:5px!important;padding-right:5px!important}.button-hp-10{padding-left:10px!important;padding-right:10px!important}.button-hp-15{padding-left:15px!important;padding-right:15px!important}.button-hp-20{padding-left:20px!important;padding-right:20px!important}.button-hp-25{padding-left:25px!important;padding-right:25px!important}.button-hp-30{padding-left:30px!important;padding-right:30px!important}.button-hp-40{padding-left:40px!important;padding-right:40px!important}.button-hp-0{padding-left:0!important;padding-right:0!important}.vs__dropdown-toggle{background:#f3f8fb!important;border:none!important;height:43px!important}.row-align-center{margin:0 auto}.row-align-left{margin:0 auto;margin-left:0!important}.row-align-right{margin:0 auto;margin-right:0!important}button,input,optgroup,select,textarea{border-radius:unset;font-family:unset;font-size:unset;line-height:unset;margin:unset;text-transform:unset}body{font-weight:unset!important;line-height:unset!important;-moz-osx-font-smoothing:grayscale;word-wrap:break-word}*,:after,:before{box-sizing:border-box}.main-heading-group>div{display:inline-block}.c-button span.main-heading-group,.c-button span.sub-heading-group{display:block}.time-grid-3{grid-template-columns:repeat(3,100px)}.time-grid-3,.time-grid-4{display:grid;text-align:center}.time-grid-4{grid-template-columns:repeat(4,100px)}@media screen and (max-width:767px){.time-grid-3{grid-template-columns:repeat(3,80px)}.time-grid-4{grid-template-columns:repeat(4,70px)}}.time-grid .timer-box{display:grid;font-size:15px;grid-template-columns:1fr;text-align:center}.timer-box .label{font-weight:300}.c-button button{cursor:pointer}.c-button>a{text-decoration:none}.c-button>a,.c-button>a span{display:inline-block}.nav-menu-wrapper{display:flex;justify-content:space-between}.nav-menu-wrapper.default{flex-direction:row}.nav-menu-wrapper.reverse{flex-direction:row-reverse}.nav-menu-wrapper .branding{align-items:center;display:flex}.nav-menu-wrapper.default .branding{flex-direction:row}.nav-menu-wrapper.reverse .branding{flex-direction:row-reverse}.nav-menu-wrapper.default .branding .logo,.nav-menu-wrapper.reverse .branding .title{margin-right:18px}.nav-menu-wrapper .branding .title{align-items:center;display:flex;min-height:50px;min-width:50px}.nav-menu{align-items:center;display:flex;flex-wrap:wrap;list-style:none;margin:0;padding:0}.nav-menu a{text-decoration:none}.dropdown{display:inline-block;position:relative}.dropdown .dropdown-menu{border:none;box-shadow:0 8px 16px 5px rgba(0,0,0,.1)}.dropdown-menu{background-clip:padding-box;border:1px solid rgba(0,0,0,.15);border-radius:.3125rem;color:#607179;display:none;float:left;font-size:1rem;left:0;list-style:none;margin:.125rem 0 0;min-width:10rem;padding:.5rem 0;position:absolute;text-align:left;top:100%;z-index:1000}.nav-menu .nav-menu-item.dropdown:hover>.dropdown-menu{display:block}.nav-menu .dropdown-menu{display:none;list-style:none;margin:0;padding:0}.nav-menu-mobile{display:none}.nav-menu-mobile i{cursor:pointer;font-size:24px}#nav-menu-popup{background:var(--overlay);bottom:0;display:none;height:100%;left:0;opacity:0;position:fixed;right:0;top:0;transition:opacity .3s ease;width:100%;z-index:100}#nav-menu-popup.show{opacity:1}#nav-menu-popup .nav-menu-body{background-color:#fff;height:100%;left:0;overflow:auto;padding:45px;position:absolute;top:0;width:100%}#nav-menu-popup .nav-menu-body .close-menu{cursor:pointer;position:absolute;right:20px;top:20px;z-index:100}#nav-menu-popup .nav-menu-body .close-menu:before{content:"\f00d"}#nav-menu-popup .nav-menu{align-items:center;display:flex;flex-direction:column;list-style:none;margin:0;padding:0}#nav-menu-popup .nav-menu .nav-menu-item{list-style:none;text-align:left;-webkit-user-select:none;-moz-user-select:none;user-select:none;width:100%}#nav-menu-popup .nav-menu .nav-menu-item .nav-menu-item-content{display:flex;position:relative}#nav-menu-popup .nav-menu-item .nav-menu-item-title{flex-grow:1;margin:0 1rem;max-width:calc(100% - 2rem)}#nav-menu-popup .nav-menu .nav-menu-item .nav-menu-item-content .nav-menu-item-toggle{cursor:pointer;font-size:24px;position:absolute;right:0;top:calc(50% - 12px)}#nav-menu-popup .nav-menu .nav-menu-item .nav-menu-item-content .nav-menu-item-toggle i{font-size:24px;transition:transform .2s ease}#nav-menu-popup .nav-menu .nav-menu-item .nav-menu-item-content .nav-menu-item-toggle i:before{content:"\f107"}#nav-menu-popup .nav-menu .nav-menu-item.active .nav-menu-item-content .nav-menu-item-toggle i{transform:rotate(-180deg)}#nav-menu-popup .nav-menu .nav-menu-item .nav-dropdown-menu{display:none;max-height:0;opacity:0;overflow:auto;padding:0;transition:all .3s ease-in-out;visibility:hidden}#nav-menu-popup .nav-menu .nav-menu-item.active .nav-dropdown-menu{display:block;max-height:600px;opacity:1;visibility:visible}.form-error{border:2px solid var(--red);border-radius:8px;cursor:pointer;font-size:20px;margin-bottom:10px;padding:6px 12px;text-align:center}.form-error,.form-error i{color:var(--red)}.c-bullet-list ul li{line-height:inherit}.c-bullet-list ul li.ql-indent-1{padding-left:4.5em}.c-bullet-list ul li.ql-indent-2{padding-left:7.5em}.c-bullet-list ul li.ql-indent-3{padding-left:10.5em}.c-bullet-list ul li.ql-indent-4{padding-left:13.5em}.c-bullet-list ul li.ql-indent-5{padding-left:16.5em}.c-bullet-list ul li.ql-indent-6{padding-left:19.5em}.c-bullet-list ul li.ql-indent-7{padding-left:22.5em}.c-bullet-list ul li.ql-indent-8{padding-left:25.5em}.c-rich-text .list-disc{list-style-type:disc}.c-rich-text .list-square{list-style-type:square}.c-rich-text .list-none{list-style-type:none}.c-rich-text .list-circle{list-style-type:circle}.c-rich-text .list-decimal{list-style-type:decimal}.c-rich-text .list-upper-alpha{list-style-type:upper-alpha}.c-rich-text .list-lower-alpha{list-style-type:lower-alpha}.c-rich-text .list-upper-roman{list-style-type:upper-roman}.c-rich-text .list-lower-roman{list-style-type:lower-roman}.text-output ul li{padding-left:1.5em}.text-output ul li:before{display:inline-block;font-weight:700;margin-left:-1.5em;margin-right:.3em;text-align:right;white-space:nowrap;width:1.2em}.svg-component svg{max-height:100%;max-width:100%}.border1{border-bottom:3px solid rgba(0,0,0,.2)!important}.border2{border:2px solid rgba(0,0,0,.55)}.border3{border:solid rgba(0,0,0,.15);border-width:1px 1px 2px;padding:5px}.border4{border:solid rgba(0,0,0,.35);border-width:1px 1px 2px;padding:1px!important}.shadow1{box-shadow:0 10px 6px -6px rgba(0,0,0,.15)}.shadow2{box-shadow:0 4px 3px rgba(0,0,0,.15),0 0 2px rgba(0,0,0,.15)}.shadow3{box-shadow:0 10px 6px -6px #999}.shadow4{box-shadow:3px 3px 15px #212121a8}.shadow6{box-shadow:0 10px 1px #ddd,0 10px 20px #ccc}.background{background-color:unset!important}@keyframes progress-bar-animation{to{background-position:0 -3000px}}@keyframes gradient{0%{background-position:0 50%}50%{background-position:100% 50%}to{background-position:0 50%}}h1,h2,h3,h4,h5,h6{font-weight:500;margin:unset}p{margin:unset}.c-bullet-list,.c-faq,.c-heading,.c-image-feature,.c-paragraph,.c-sub-heading{word-break:break-word}h1:empty:after,h2:empty:after,h3:empty:after,h4:empty:after,h5:empty:after,h6:empty:after,p:empty:after{content:"\00A0"}.w-3-4{width:75%}.w-1-2{width:50%}.tabs-container{display:flex}@media screen and (max-width:767px){.nav-menu{display:none}.nav-menu-mobile{align-items:center;display:flex}#faq-popup{left:5px!important;margin-left:0!important;width:98%!important}.video-container{width:100%!important}.autoplay .vjs-big-play-button{display:none!important}.autoplay:hover .vjs-control-bar{display:flex!important}}</style>
<style>@font-face{font-display:swap;font-family:Font Awesome\ 5 Free;font-style:normal;font-weight:400;src:url(https://stcdn.leadconnectorhq.com/funnel/fontawesome/webfonts/fa-regular-400.eot);src:url(https://stcdn.leadconnectorhq.com/funnel/fontawesome/webfonts/fa-regular-400.eot?#iefix) format("embedded-opentype"),url(https://stcdn.leadconnectorhq.com/funnel/fontawesome/webfonts/fa-regular-400.woff2) format("woff2"),url(https://stcdn.leadconnectorhq.com/funnel/fontawesome/webfonts/fa-regular-400.woff) format("woff"),url(https://stcdn.leadconnectorhq.com/funnel/fontawesome/webfonts/fa-regular-400.ttf) format("truetype"),url(https://stcdn.leadconnectorhq.com/funnel/fontawesome/webfonts/fa-regular-400.svg#fontawesome) format("svg")}.far{font-weight:400}@font-face{font-display:swap;font-family:Font Awesome\ 5 Free;font-style:normal;font-weight:900;src:url(https://stcdn.leadconnectorhq.com/funnel/fontawesome/webfonts/fa-solid-900.eot);src:url(https://stcdn.leadconnectorhq.com/funnel/fontawesome/webfonts/fa-solid-900.eot?#iefix) format("embedded-opentype"),url(https://stcdn.leadconnectorhq.com/funnel/fontawesome/webfonts/fa-solid-900.woff2) format("woff2"),url(https://stcdn.leadconnectorhq.com/funnel/fontawesome/webfonts/fa-solid-900.woff) format("woff"),url(https://stcdn.leadconnectorhq.com/funnel/fontawesome/webfonts/fa-solid-900.ttf) format("truetype"),url(https://stcdn.leadconnectorhq.com/funnel/fontawesome/webfonts/fa-solid-900.svg#fontawesome) format("svg")}.fa,.far,.fas{font-family:Font Awesome\ 5 Free}.fa,.fas{font-weight:900}@font-face{font-display:swap;font-family:Font Awesome\ 5 Brands;font-style:normal;font-weight:400;src:url(https://stcdn.leadconnectorhq.com/funnel/fontawesome/webfonts/fa-brands-400.eot);src:url(https://stcdn.leadconnectorhq.com/funnel/fontawesome/webfonts/fa-brands-400.eot?#iefix) format("embedded-opentype"),url(https://stcdn.leadconnectorhq.com/funnel/fontawesome/webfonts/fa-brands-400.woff2) format("woff2"),url(https://stcdn.leadconnectorhq.com/funnel/fontawesome/webfonts/fa-brands-400.woff) format("woff"),url(https://stcdn.leadconnectorhq.com/funnel/fontawesome/webfonts/fa-brands-400.ttf) format("truetype"),url(https://stcdn.leadconnectorhq.com/funnel/fontawesome/webfonts/fa-brands-400.svg#fontawesome) format("svg")}.fab{font-family:Font Awesome\ 5 Brands;font-weight:400}</style>
<style>:root{--animate-duration:1s;--animate-delay:1s;--animate-repeat:1}.animate__animated{animation-duration:1s;animation-duration:var(--animate-duration);animation-fill-mode:both}@media (prefers-reduced-motion:reduce),print{.animate__animated{animation-duration:1ms!important;animation-iteration-count:1!important;transition-duration:1ms!important}.animate__animated[class*=Out]{opacity:0}}@keyframes fadeIn{0%{opacity:0}to{opacity:1}}.animate__fadeIn{animation-name:fadeIn}@keyframes fadeInUp{0%{opacity:0;transform:translate3d(0,100%,0)}to{opacity:1;transform:translateZ(0)}}.animate__fadeInUp{animation-name:fadeInUp}@keyframes fadeInDown{0%{opacity:0;transform:translate3d(0,-100%,0)}to{opacity:1;transform:translateZ(0)}}.animate__fadeInDown{animation-name:fadeInDown}@keyframes fadeInLeft{0%{opacity:0;transform:translate3d(-100%,0,0)}to{opacity:1;transform:translateZ(0)}}.animate__fadeInLeft{animation-name:fadeInLeft}@keyframes fadeInRight{0%{opacity:0;transform:translate3d(100%,0,0)}to{opacity:1;transform:translateZ(0)}}.animate__fadeInRight{animation-name:fadeInRight}@keyframes slideInUp{0%{opacity:0;transform:translate3d(0,100%,0);visibility:visible}to{opacity:1;transform:translateZ(0)}}.animate__slideInUp{animation-name:slideInUp}@keyframes slideInDown{0%{opacity:0;transform:translate3d(0,-100%,0);visibility:visible}to{opacity:1;transform:translateZ(0)}}.animate__slideInDown{animation-name:slideInDown}@keyframes slideInLeft{0%{opacity:0;transform:translate3d(-100%,0,0);visibility:visible}to{opacity:1;transform:translateZ(0)}}.animate__slideInLeft{animation-name:slideInLeft}@keyframes slideInRight{0%{opacity:0;transform:translate3d(100%,0,0);visibility:visible}to{opacity:1;transform:translateZ(0)}}.animate__slideInRight{animation-name:slideInRight}@keyframes bounceIn{0%,20%,40%,60%,80%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:scale3d(.3,.3,.3)}20%{transform:scale3d(1.1,1.1,1.1)}40%{transform:scale3d(.9,.9,.9)}60%{opacity:1;transform:scale3d(1.03,1.03,1.03)}80%{transform:scale3d(.97,.97,.97)}to{opacity:1;transform:scaleX(1)}}.animate__bounceIn{animation-duration:.75s;animation-duration:calc(var(--animate-duration)*.75);animation-name:bounceIn}@keyframes bounceInUp{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(0,3000px,0) scaleY(5)}60%{opacity:1;transform:translate3d(0,-20px,0) scaleY(.9)}75%{transform:translate3d(0,10px,0) scaleY(.95)}90%{transform:translate3d(0,-5px,0) scaleY(.985)}to{transform:translateZ(0)}}.animate__bounceInUp{animation-name:bounceInUp}@keyframes bounceInDown{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(0,-3000px,0) scaleY(3)}60%{opacity:1;transform:translate3d(0,25px,0) scaleY(.9)}75%{transform:translate3d(0,-10px,0) scaleY(.95)}90%{transform:translate3d(0,5px,0) scaleY(.985)}to{transform:translateZ(0)}}.animate__bounceInDown{animation-name:bounceInDown}@keyframes bounceInLeft{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(-3000px,0,0) scaleX(3)}60%{opacity:1;transform:translate3d(25px,0,0) scaleX(1)}75%{transform:translate3d(-10px,0,0) scaleX(.98)}90%{transform:translate3d(5px,0,0) scaleX(.995)}to{transform:translateZ(0)}}.animate__bounceInLeft{animation-name:bounceInLeft}@keyframes bounceInRight{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(3000px,0,0) scaleX(3)}60%{opacity:1;transform:translate3d(-25px,0,0) scaleX(1)}75%{transform:translate3d(10px,0,0) scaleX(.98)}90%{transform:translate3d(-5px,0,0) scaleX(.995)}to{transform:translateZ(0)}}.animate__bounceInRight{animation-name:bounceInRight}@keyframes flip{0%{animation-timing-function:ease-out;opacity:0;transform:perspective(400px) scaleX(1) translateZ(0) rotateY(-1turn)}40%{animation-timing-function:ease-out;transform:perspective(400px) scaleX(1) translateZ(150px) rotateY(-190deg)}50%{animation-timing-function:ease-in;transform:perspective(400px) scaleX(1) translateZ(150px) rotateY(-170deg)}80%{animation-timing-function:ease-in;transform:perspective(400px) scale3d(.95,.95,.95) translateZ(0) rotateY(0deg)}to{animation-timing-function:ease-in;opacity:1;transform:perspective(400px) scaleX(1) translateZ(0) rotateY(0deg)}}.animate__animated.animate__flip{animation-name:flip;backface-visibility:visible}@keyframes flipInX{0%{animation-timing-function:ease-in;opacity:0;transform:perspective(400px) rotateX(90deg)}40%{animation-timing-function:ease-in;transform:perspective(400px) rotateX(-20deg)}60%{opacity:1;transform:perspective(400px) rotateX(10deg)}80%{transform:perspective(400px) rotateX(-5deg)}to{transform:perspective(400px)}}.animate__flipInX{animation-name:flipInX;backface-visibility:visible!important}@keyframes flipInY{0%{animation-timing-function:ease-in;opacity:0;transform:perspective(400px) rotateY(90deg)}40%{animation-timing-function:ease-in;transform:perspective(400px) rotateY(-20deg)}60%{opacity:1;transform:perspective(400px) rotateY(10deg)}80%{transform:perspective(400px) rotateY(-5deg)}to{transform:perspective(400px)}}.animate__flipInY{animation-name:flipInY;backface-visibility:visible!important}@keyframes rollIn{0%{opacity:0;transform:translate3d(-100%,0,0) rotate(-120deg)}to{opacity:1;transform:translateZ(0)}}.animate__rollIn{animation-name:rollIn}@keyframes zoomIn{0%{opacity:0;transform:scale3d(.3,.3,.3)}50%{opacity:1}}.animate__zoomIn{animation-name:zoomIn}@keyframes lightSpeedInLeft{0%{opacity:0;transform:translate3d(-100%,0,0) skewX(30deg)}60%{opacity:1;transform:skewX(-20deg)}80%{transform:skewX(5deg)}to{transform:translateZ(0)}}.animate__lightSpeedInLeft{animation-name:lightSpeedInLeft;animation-timing-function:ease-out}@keyframes lightSpeedInRight{0%{opacity:0;transform:translate3d(100%,0,0) skewX(-30deg)}60%{opacity:1;transform:skewX(20deg)}80%{transform:skewX(-5deg)}to{transform:translateZ(0)}}.animate__lightSpeedInRight{animation-name:lightSpeedInRight;animation-timing-function:ease-out}</style>
<link rel="preload" as="style" href="https://fonts.googleapis.com/css?family=Inter:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i&display=swap">
<link  as="script" crossorigin href="https://stcdn.leadconnectorhq.com/_preview/DjAGHEI2.js">
<link  as="script" crossorigin href="https://stcdn.leadconnectorhq.com/_preview/DY89eM7L.js">
<link  as="script" crossorigin href="https://stcdn.leadconnectorhq.com/_preview/CAHZA_RM.js">
<link  as="script" crossorigin href="https://stcdn.leadconnectorhq.com/_preview/CwJyVDkF.js">
<link  as="script" crossorigin href="https://stcdn.leadconnectorhq.com/_preview/mRMRrvZd.js">
<link  as="script" crossorigin href="https://stcdn.leadconnectorhq.com/_preview/BGvBHoNG.js">
<link  as="script" crossorigin href="https://stcdn.leadconnectorhq.com/_preview/B2v_Hb-q.js">
<link  as="script" crossorigin href="https://stcdn.leadconnectorhq.com/_preview/H9jC66bE.js">
<link  as="script" crossorigin href="https://stcdn.leadconnectorhq.com/_preview/CNU1t8dV.js">
<link  as="script" crossorigin href="https://stcdn.leadconnectorhq.com/_preview/BTStGGDt.js">
<link  as="script" crossorigin href="https://stcdn.leadconnectorhq.com/_preview/BRYJhn66.js">
<link  as="script" crossorigin href="https://stcdn.leadconnectorhq.com/_preview/Df1avfpI.js">
<link  as="script" crossorigin href="https://stcdn.leadconnectorhq.com/_preview/U_1p3W7T.js">
<link  as="script" crossorigin href="https://stcdn.leadconnectorhq.com/_preview/DqDnBcpw.js">
<link  as="script" crossorigin href="https://stcdn.leadconnectorhq.com/_preview/DkPjILLL.js">
<link  as="script" crossorigin href="https://stcdn.leadconnectorhq.com/_preview/DW-3PSLe.js">
<link  as="script" crossorigin href="https://stcdn.leadconnectorhq.com/_preview/DCrMsLAd.js">
<link  as="script" crossorigin href="https://stcdn.leadconnectorhq.com/_preview/DeH7b4MC.js">
<link rel="icon" href="https://stcdn.leadconnectorhq.com/funnel/icon/favicon.ico">
<meta property="og:type" content="website">
<meta property="twitter:type" content="website">
<script type="module" src="https://stcdn.leadconnectorhq.com/_preview/DjAGHEI2.js" crossorigin></script>
<script id="unhead:payload" type="application/json">{"title":""}</script></head><body><div id="__nuxt"><!--[--><!--[--><div class="bgCover bg-fixed"></div><!--[--><!--nuxt-delay-hydration-component--><!--[--><div><!--[--><div><!----><!----><div><div id="nav-menu-popup" style="display:none;" class="hide"><div class="nav-menu-body"><i class="close-menu fas fa-times"></i><ul class="nav-menu"><!--[--><!--]--></ul></div></div></div><!----><!--[--><!----><!--]--><!----><div id="preview-container" class="preview-container hl_page-preview--content"><div><!----><!--[--><!--[--><div class="fullSection noBorder radius0 none c-section c-wrapper section-zwgfsNCznE" style="" id="section-zwgfsNCznE"><!----><!----><div class="inner"><!----><!--[--><!--[--><div class="row-align-center noBorder radius0 none c-row c-wrapper row-g7f2wkYs_s" id="row-g7f2wkYs_s"><!----><!----><div class="inner"><!----><!--[--><!--[--><div class="noBorder radius0 none c-column c-wrapper col-0KXXeTJt-F" id="col-0KXXeTJt-F"><!----><!----><div class="vertical inner"><!----><!--[--><!--[--><div id="custom-code-F7m1yuu79Z" class="c-custom-code c-wrapper custom-code-F7m1yuu79Z"><!----><!----><!----><!----><!----><!----><!----><span></span><div id="custom-code-F7m1yuu79Z" class="custom-code-container ccustom-code-F7m1yuu79Z"><!DOCTYPE html>
<html lang="en" class="h2s-reviews-show-placeholders">
<head>
<meta charset="UTF-8">
<!-- CACHE BUSTER v1.0.8 REMOVE-DEFERRED-404 -->
<!-- Performance: Preconnect to critical origins -->
<link rel="preconnect" href="https://js.stripe.com">
<link rel="preconnect" href="https://connect.facebook.net">

<!-- EARLY ENDPOINT SHIM: must run before the large deferred bundles script executes. -->
<!-- Prevents /api/bundles-data 404s (alias drift) and avoids competing with LCP by forcing low priority. -->
<script>
(function () {
  try {
    // Versioned so a newer deploy can override an older cached shim.
    var SHIM_VERSION = 2;
    if (window.__H2S_EARLY_FETCH_SHIM_VERSION__ && window.__H2S_EARLY_FETCH_SHIM_VERSION__ >= SHIM_VERSION) return;
    window.__H2S_EARLY_FETCH_SHIM_VERSION__ = SHIM_VERSION;
    window.__H2S_EARLY_FETCH_SHIM__ = true;

    // IMPORTANT: the production alias can serve an app shell (HTML) for missing API routes.
    // Pin the critical API calls to the known-good deployment *before* the app code runs.
    var OLD_ORIGIN = 'https://h2s-backend.vercel.app';
    var SHOP_ORIGIN = 'https://h2s-backend-robgbyphx-tabari-ropers-projects-6f2e090b.vercel.app';
    var SCHED_ORIGIN = 'https://h2s-backend-robgbyphx-tabari-ropers-projects-6f2e090b.vercel.app';

    var originalFetch = window.fetch && window.fetch.bind(window);
    if (!originalFetch) return;

    function rewrite(input) {
      try {
        if (!input) return input;
        var raw = typeof input === 'string' ? input : (input && input.url) ? input.url : '';
        var url = new URL(raw, window.location.href);

        // Rewrite any request whose hostname is the broken production alias.
        // (Some browsers normalize URL strings slightly; hostname match is safest.)
        if (String(url.hostname || '') !== 'h2s-backend.vercel.app') return input;

        // Keep tracking on the alias (this route is live there).
        if (url.pathname && url.pathname.indexOf('/api/track') === 0) return input;

        // Compatibility: legacy success page uses /api/shop?action=orderpack. The live checkout deployment
        // exposes order details at /api/get-order-details instead (orderpack may not exist).
        try {
          if (url.pathname && url.pathname.indexOf('/api/shop') === 0) {
            var act = '';
            try { act = String(url.searchParams.get('action') || '').trim(); } catch (_) { act = ''; }
            if (act === 'orderpack') {
              var sid = '';
              try { sid = String(url.searchParams.get('session_id') || '').trim(); } catch (_) { sid = ''; }
              if (sid) {
                url.pathname = '/api/get-order-details';
                try { url.search = ''; } catch (_) {}
                try { url.searchParams.set('session_id', sid); } catch (_) { url.search = 'session_id=' + encodeURIComponent(sid); }
              }
            }
          }
        } catch (_) {}

        // Shop + reviews + order-details should be routed to the deployment that supports checkout + JSON.
        if (url.pathname && (
          url.pathname.indexOf('/api/shop') === 0 ||
          url.pathname.indexOf('/api/reviews') === 0 ||
          url.pathname.indexOf('/api/quote') === 0 ||
          url.pathname.indexOf('/api/promo_validate') === 0 ||
          url.pathname.indexOf('/api/get-order-details') === 0 ||
          url.pathname.indexOf('/api/get-order') === 0
        )) {
          url = new URL(url.toString());
          url.host = new URL(SHOP_ORIGIN).host;
          url.protocol = 'https:';
          return url.toString();
        }

        // Bundles-data + scheduling endpoints live on the scheduling deployment.
        if (url.pathname && (
          url.pathname.indexOf('/api/bundles-data') === 0 ||
          url.pathname.indexOf('/api/schedule-appointment') === 0 ||
          url.pathname.indexOf('/api/get-availability') === 0
        )) {
          url = new URL(url.toString());
          url.host = new URL(SCHED_ORIGIN).host;
          url.protocol = 'https:';
          return url.toString();
        }

        return input;
      } catch (_) {
        return input;
      }
    }

    window.fetch = function (input, init) {
      var rewritten = rewrite(input);

      // The live checkout deployment may not implement __action=mark_session; it's non-critical.
      // Avoid spamming the console with 400s and keep the success page clean.
      try {
        var method = (init && init.method) ? String(init.method).toUpperCase() : (input && input.method ? String(input.method).toUpperCase() : 'GET');
        if (method === 'POST') {
          var targetUrl = new URL(typeof rewritten === 'string' ? rewritten : (rewritten && rewritten.url) ? rewritten.url : '', window.location.href);
          if (targetUrl.hostname === new URL(SHOP_ORIGIN).hostname && targetUrl.pathname.indexOf('/api/shop') === 0) {
            var bodyText = '';
            try { bodyText = typeof init.body === 'string' ? init.body : ''; } catch (_) { bodyText = ''; }
            if (bodyText && bodyText.indexOf('mark_session') >= 0) {
              return Promise.resolve(new Response(JSON.stringify({ ok: true, skipped: true }), { status: 200, headers: { 'Content-Type': 'application/json' } }));
            }
          }
        }
      } catch (_) {}

      // Perf: never let bundles-data compete with LCP.
      try {
        // Ensure the URL is valid before processing
        if (!rewritten) return originalFetch(input, init);
        
        var u = new URL(typeof rewritten === 'string' ? rewritten : (rewritten && rewritten.url) || '', window.location.href);
        if (u.pathname && u.pathname.indexOf('/api/bundles-data') === 0) {
          if (init && typeof init === 'object') {
            init = Object.assign({}, init);
            if ('priority' in init) init.priority = 'low';
          } else {
            init = { priority: 'low' };
          }
        }
      } catch (_) {}

      try {
        if (input instanceof Request) {
          var baseReq = init ? new Request(input, init) : input;
          return originalFetch(new Request(rewritten, baseReq), undefined);
        }
      } catch (_) {}

      return originalFetch(rewritten, init);
    };
  } catch (_) {}
})();
</script>
<!-- H2S SAFE-START: prevent early clicks throwing before app loads -->
<script>
(function () {
  try {
    if (window.__H2S_EARLY_STUBS__) return;
    window.__H2S_EARLY_STUBS__ = true;

    var q = (window.__H2S_CALL_QUEUE__ = window.__H2S_CALL_QUEUE__ || []);
    function enqueue(name, args) {
      q.push({ name: name, args: Array.prototype.slice.call(args || []) });
    }

    function stub(name) {
      if (typeof window[name] === 'function') return;
      window[name] = function () {
        enqueue(name, arguments);
      };
    }

    // Only what the static HTML calls before app init.
    [
      'dismissUrgencyBanner',
      'navSet',
      'toggleMenu',
      'toggleCart',
      'scrollToSection',
      'selectPackage',
      'safeRequestQuote',
      'safeCloseQuoteModal',
      'submitQuoteRequest',
      'addPackageToCart',
      'closeModal',
      'openBooking'
    ].forEach(stub);
  } catch (_) {}
})();
</script>

<!-- H2S BASE GLOBALS: required by strict-mode app code -->
<script>
(function () {
  try {
    // Ensure these exist before the strict-mode monolith runs.
    if (typeof window.reviewIndex !== 'number' || !isFinite(window.reviewIndex)) window.reviewIndex = 0;
    if (typeof window.reviewInterval === 'undefined') window.reviewInterval = null;

    if (typeof window.H2S_lockScroll !== 'function') {
      window.H2S_lockScroll = function () {
        try {
          if (document.documentElement.classList.contains('modal-open') || document.body.classList.contains('modal-open')) return;
          var y = window.scrollY || document.documentElement.scrollTop || 0;
          document.documentElement.dataset.h2sScrollY = String(y);
          document.documentElement.classList.add('modal-open');
          document.body.classList.add('modal-open');
          document.body.style.top = '-' + y + 'px';
        } catch (_) {}
      };
    }

    if (typeof window.H2S_unlockScroll !== 'function') {
      window.H2S_unlockScroll = function () {
        try {
          if (!document.documentElement.classList.contains('modal-open') && !document.body.classList.contains('modal-open')) return;
          var y = parseInt(document.documentElement.dataset.h2sScrollY || '0', 10) || 0;
          document.documentElement.classList.remove('modal-open');
          document.body.classList.remove('modal-open');
          document.body.style.top = '';
          delete document.documentElement.dataset.h2sScrollY;
          window.scrollTo(0, y);
        } catch (_) {}
      };
    }
  } catch (_) {}
})();
</script>

<!-- Security -->
<meta http-equiv="X-Content-Type-Options" content="nosniff">
<meta name="referrer" content="strict-origin-when-cross-origin">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, user-scalable=yes, viewport-fit=cover">
<link rel="preconnect" href="https://h2s-backend.vercel.app" crossorigin>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preconnect" href="https://js.stripe.com" crossorigin>
<link rel="preconnect" href="https://api.stripe.com" crossorigin>
<link rel="dns-prefetch" href="https://connect.facebook.net">
<title>Smart Home Packages &bull; Home2Smart</title>
<meta name="description" content="TV mounting and security camera packages. Pick a package, we handle the rest. Done right, done once.">
<meta name="theme-color" content="#0a2a5a">

<!-- SEO: Open Graph -->
<meta property="og:title" content="Smart Home Installation Packages | Home2Smart">
<meta property="og:description" content="Professional TV mounting & security camera installation. Licensed, insured, instant booking within availability. 500+ homes served, 4.9&#9733; rating.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://home2smart.com/bundles">
<meta property="og:site_name" content="Home2Smart">

<!-- SEO: Twitter Card -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Smart Home Installation Packages | Home2Smart">
<meta name="twitter:description" content="Professional TV mounting & security camera installation. Licensed, insured, instant booking within availability.">

<!-- SEO: Canonical URL -->
<link rel="canonical" href="https://home2smart.com/bundles">

<!-- SEO: Robots -->
<meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">

<!-- Performance: Critical Resource Hints -->
<link rel="dns-prefetch" href="https://h2s-backend.vercel.app">
<link rel="preconnect" href="https://js.stripe.com" crossorigin>
<link rel="preconnect" href="https://api.stripe.com" crossorigin>
<link rel="dns-prefetch" href="https://storage.googleapis.com">
<!-- Add favicon to avoid 404 in local dev -->
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3E%3Ccircle cx='8' cy='8' r='8' fill='%230a2a5a'/%3E%3C/svg%3E">
<!-- Preload logo for faster LCP (highest priority resource) -->
<link rel="preload" href="https://storage.googleapis.com/msgsndr/7Drmpw623JAkrfDKPdjG/media/68da0ce6f00445991d64a63f.png" as="image" fetchpriority="high" imagesrcset="https://storage.googleapis.com/msgsndr/7Drmpw623JAkrfDKPdjG/media/68da0ce6f00445991d64a63f.png 1x" imagesizes="64px">
<!-- Font woff2 preload removed - version-specific URL (v18) causes 404 errors -->

<!-- H2S Tracking Diagnostics & Enforcement -->
<script>
(function() {
  function __h2sStartTracking() {
  const ls = window.localStorage;
  
  // RFC4122 v4 UUID fallback (for browsers without crypto.randomUUID)
  function uuidv4Fallback() {
    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
      const r = Math.random() * 16 | 0;
      const v = c === 'x' ? r : (r & 0x3 | 0x8);
      return v.toString(16);
    });
  }
  
  function getOrCreateVisitorId() {
    let vid = ls.getItem('h2s_visitor_id');
    if (!vid) {
      vid = (self.crypto && self.crypto.randomUUID) ? self.crypto.randomUUID() : uuidv4Fallback();
      ls.setItem('h2s_visitor_id', vid);
    }
    return vid;
  }
  
  function getOrCreateSessionId() {
    let sid = ls.getItem('h2s_session_id');
    if (!sid) {
      sid = (self.crypto && self.crypto.randomUUID) ? self.crypto.randomUUID() : uuidv4Fallback();
      ls.setItem('h2s_session_id', sid);
    }
    return sid;
  }
  async function sendBackend(event_type, params={}) {
    const visitor_id = getOrCreateVisitorId();
    const session_id = getOrCreateSessionId();
    
    // Validate UUIDs before sending
    const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;
    if (!uuidRegex.test(visitor_id)) {
      // Regenerate and try again
      ls.removeItem('h2s_visitor_id');
      return sendBackend(event_type, params);
    }
    if (!uuidRegex.test(session_id)) {
      ls.removeItem('h2s_session_id');
      return sendBackend(event_type, params);
    }
    
    // Extract UTM parameters from URL
    const urlParams = new URLSearchParams(window.location.search);
    const utm_source = urlParams.get('utm_source') || null;
    const utm_medium = urlParams.get('utm_medium') || null;
    const utm_campaign = urlParams.get('utm_campaign') || null;
    const utm_term = urlParams.get('utm_term') || null;
    const utm_content = urlParams.get('utm_content') || null;
    
    function normalizePathname(p) {
      const s = (p || '').toString().trim();
      if (!s) return '/';
      if (s === '/') return '/';
      // remove trailing slashes
      return s.replace(/\/+$/g, '');
    }

    const payload = {
      event_type,
      visitor_id,
      session_id,
      occurred_at: new Date().toISOString(),
      page_url: location.href,
      page_path: normalizePathname(location.pathname),
      referrer: document.referrer || '(direct)',
      user_agent: navigator.userAgent,
      // UTM parameters
      utm_source,
      utm_medium,
      utm_campaign,
      utm_term,
      utm_content,
      // Merge custom params
      ...params
    };
    
    const endpoint = 'https://h2s-backend.vercel.app/api/track';
    const body = JSON.stringify(payload);

    // IMPORTANT:
    // In local previews (127.0.0.1/localhost), browsers enforce CORS.
    // The backend currently responds in a way that trips credentialed-CORS rules.
    // To ensure events still reach the backend (and downstream Meta/CAPI), we send a
    // simple, non-preflighted request in `no-cors` mode when running locally.
    const isLocalPreview = (location.hostname === '127.0.0.1' || location.hostname === 'localhost');

    try {
      if (isLocalPreview) {
        // Fire-and-forget: avoid preflight and avoid CORS console failures.
        // Body will be sent as text/plain; backend can JSON.parse it.
        await fetch(endpoint, {
          method: 'POST',
          mode: 'no-cors',
          credentials: 'omit',
          body,
          cache: 'no-store',
          keepalive: true
        });
        return { ok: true, via: 'no-cors' };
      }

      const res = await fetch(endpoint, {
        method: 'POST',
        mode: 'cors',
        headers: { 'Content-Type': 'application/json' },
        body,
        credentials: 'omit',
        cache: 'no-store',
        keepalive: true
      });

      if (res.ok) return { ok: true };

      const txt = await res.text();
      let errorDetails = txt;
      try {
        const errorJson = JSON.parse(txt);
        errorDetails = errorJson.error || errorJson.details || txt;
        if (String(errorDetails).includes('invalid input syntax for type uuid')) {
          ls.removeItem('h2s_visitor_id');
          ls.removeItem('h2s_session_id');
        }
      } catch (e) {
        // txt is not JSON, use as-is
      }

      return { ok: false, error: errorDetails, status: res.status };
    } catch (err) {
      // In tracking, fail-open: do not break UX.
      return { ok: false, error: err && err.message ? err.message : String(err) };
    }
  }
  function onReady(fn){
    if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', fn);
    else fn();
  }
  // REMOVED: page_view auto-send (global header handles it to avoid duplication)
  // Global header tracking auto-sends page_view on page load
  onReady(() => {
    // PageView is handled by global header tracking
    // Only send custom events here if needed
  });
  
  // Expose globally with initialization flag
  window.h2sSendBackend = sendBackend;
  window.__H2S_TRACKING_READY__ = true;
  }
  if ('requestIdleCallback' in window) {
    requestIdleCallback(__h2sStartTracking, { timeout: 2500 });
  } else {
    setTimeout(__h2sStartTracking, 0);
  }
})();

(function(){
  // TBT guard: reduce Meta Pixel polling overhead (the 150ms fbq readiness loop).
  // We only touch intervals whose callback clearly references fbq + __H2S_FB_INIT__.
  if (window.__H2S_FB_POLL_PATCH__) return;
  window.__H2S_FB_POLL_PATCH__ = true;
  if (!window.setInterval) return;

  var originalSetInterval = window.setInterval.bind(window);
  window.setInterval = function(fn, ms){
    try {
      if (ms === 150 && typeof fn === 'function') {
        var src = Function.prototype.toString.call(fn);
        if (src && src.indexOf('window.__H2S_FB_INIT__') !== -1 && src.indexOf('fbq') !== -1) {
          var maxRuns = 8;
          var runs = 0;
          var id;
          var wrapped = function(){
            runs++;
            if (runs > maxRuns) {
              try { clearInterval(id); } catch (e) {}
              return;
            }
            return fn();
          };
          id = originalSetInterval(wrapped, 500);
          return id;
        }
      }
    } catch (e) {
      // Fail open
    }
    return originalSetInterval(fn, ms);
  };
})();
</script>

<!-- Critical Fonts -->
<!-- Fonts loaded async to avoid render-blocking -->
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Archivo:wght@400;600;800;900&display=swap" media="print" onload="this.media='all'" crossorigin>
<noscript><link href="https://fonts.googleapis.com/css2?family=Archivo:wght@400;600;800;900&display=swap" rel="stylesheet" crossorigin></noscript>

<style>
@font-face {
  font-family: 'Archivo-fallback';
  src: local('Arial');
  font-display: swap;
  size-adjust: 105%;
  ascent-override: 95%;
  descent-override: 25%;
}
body { font-family: Archivo, 'Archivo-fallback', system-ui, -apple-system, sans-serif; }
</style>


<!-- Page-only overrides: remove chat emoji/bubble on this page -->
<style>
  /* Hide decorative emoji/pseudo content used by chat launchers */
  [data-chat-widget]::before,
  [data-chat-widget]::after { content: '' !important; display: none !important; }
  /* Hide common chat launcher containers (LeadConnector/GHL variants) */
  [data-chat-widget],
  .chat-widget-container,
  #ghl-widget,
  .ghl-widget,
  .ghl-chat-widget,
  .hl-cw-widget,
  .leadconnector-chat-widget { display: none !important; }
  /* Safety: strip any inline emoji spans inside chat launchers */
  [data-chat-widget] .emoji, .chat-widget-container .emoji { display: none !important; }
</style>

<style>.package{content-visibility:visible!important}</style>



<!-- Load remaining font weights async (non-blocking, low priority) -->
<style>@keyframes hero-review-fade{0%{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}@keyframes spin{to{transform:rotate(360deg)}}html{-webkit-text-size-adjust:100%;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;text-rendering:optimizeLegibility;scroll-behavior:smooth;background:var(--cobalt);overscroll-behavior-y:none;overflow-x:clip}img,video{max-width:100%;height:auto}:where(.c-column),:where(.c-row),:where(.c-section),:where(.hl_page-preview--content),:where(.inner){padding:0!important;margin:0!important;border:0!important;background:0 0!important;max-width:none!important;width:100%!important;overflow:visible!important;transform:none!important;filter:none!important;perspective:none!important}#pageShell{width:100%;background:var(--bg);font-family:Archivo,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;font-size:16px;line-height:1.6;isolation:isolate;z-index:1}#modalRoot{position:relative;z-index:99999}:root{--cobalt:#0a2a5a;--azure:#1493ff;--ink:#0b1420;--bg:#ffffff;--border:#e1e6ed;--muted:#6b778c;--shadow-sm:0 2px 8px rgba(11,20,32,.06);--shadow-md:0 4px 16px rgba(11,20,32,.08);--shadow-lg:0 8px 24px rgba(11,20,32,.12)}*,body{margin:0;padding:0}*{box-sizing:border-box}body{font-family:Archivo,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Archivo-fallback",Arial,sans-serif;background:var(--bg);color:var(--ink);line-height:1.6;min-height:100vh}body.modal-open,html.modal-open{overflow:hidden!important;touch-action:none}body.modal-open{position:fixed;width:100%;height:100%}#pageShell{background:#fff;min-height:100vh;position:relative}.urgency-banner,.urgency-text{display:flex;align-items:center;justify-content:center}.urgency-banner{position:fixed;bottom:24px;top:auto;left:50%;right:auto;width:auto;min-width:300px;max-width:90%;transform:translateX(-50%) translateY(150%);z-index:1200;background:linear-gradient(135deg,#ff6b35 0,#f7931e 100%);color:#fff;padding:12px 24px;text-align:center;font-size:14px;font-weight:600;line-height:1.3;box-shadow:0 8px 24px rgba(247,147,30,.3);border-radius:50px;gap:8px;transition:transform .4s cubic-bezier(.4,0,.2,1);height:auto;border:1px solid rgba(255,255,255,.2)}.urgency-banner.visible{transform:translateX(-50%) translateY(0)}#security.section::before,#tv.section::before,.urgency-banner.dismissed{display:none}.urgency-text{gap:12px;flex-wrap:wrap}.urgency-text strong{font-weight:800}.urgency-separator{opacity:.6}.urgency-close{background:rgba(255,255,255,.2);border:0;color:#fff;width:24px;height:24px;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:16px;line-height:1;transition:background .2s ease;padding:0;margin-left:8px}.urgency-close:hover{background:rgba(255,255,255,.3)}@media (max-width:768px){.urgency-banner{bottom:16px;padding:10px 16px;font-size:13px;width:92%;border-radius:12px}.urgency-text{gap:8px}.form h2{font-size:24px}.inp{font-size:16px}.cal-day,.link-btn{align-items:center;justify-content:center}.link-btn{min-height:44px;display:inline-flex}.cal-day{padding:6px!important;font-size:13px!important;display:flex;min-height:32px;white-space:nowrap;word-break:normal;overflow-wrap:normal;line-height:1}.calendar-widget{padding:8px}.btn,.link-btn,a,button{touch-action:manipulation}.btn:active,.link-btn:active,button:active{transform:scale(.98);opacity:.9}.bundle-card:active,.cart-item:active{background:#f8f9fb}.cart-body,.modal-content,.outlet,body{-webkit-overflow-scrolling:touch;overscroll-behavior-y:contain}body,html{overscroll-behavior-x:none;overflow-x:hidden}input[type=email],input[type=number],input[type=search],input[type=tel],input[type=text],select,textarea{font-size:16px!important}.btn,a,button,input[type=button],input[type=submit]{min-height:44px;min-width:44px}a,button,input,select,textarea{-webkit-tap-highlight-color:transparent}.cart-drawer{-webkit-overflow-scrolling:touch;overscroll-behavior:contain}.form{padding:20px 16px!important;margin:20px auto 40px!important;max-width:100%!important}.details-grid>div{padding:10px 0!important}.schedule-container{padding:16px!important}#calendarWidget,#outlet{-webkit-overflow-scrolling:touch}#calendarWidget{overflow-x:auto}.calendar-grid{min-width:280px}#outlet{overscroll-behavior-y:contain}.cart-body,.cart-item{-webkit-user-select:none;user-select:none}input,textarea{-webkit-user-select:text;user-select:text}}.cal-day{padding:12px;white-space:nowrap;word-break:normal;overflow-wrap:normal;line-height:1}.schedule-container{padding:16px}.calendar-widget{padding:12px}.header{position:fixed;inset:0 0 auto 0;height:56px;z-index:200;background:var(--cobalt);border-bottom:1px solid rgba(255,255,255,.12);box-shadow:var(--shadow-md);width:100%;will-change:transform;transition:top .4s cubic-bezier(.4,0,.2,1);top:0}.header-inner,.logo{display:flex;align-items:center}.header-inner{justify-content:space-between;height:56px;padding:0 16px;max-width:1400px;margin:0 auto}.logo{gap:10px;text-decoration:none;color:#fff;font-weight:900;font-size:18px;letter-spacing:-.02em}.logo-img{width:36px;height:36px;display:block}.header-actions{display:flex;align-items:center;gap:12px}#accountBtn,.cart-btn,.menu-btn{appearance:none;border:0;background:0 0;color:#fff;cursor:pointer;padding:8px;border-radius:6px;transition:background .15s ease;position:relative}#accountBtn:hover,.cart-btn:hover,.menu-btn:hover{background:rgba(255,255,255,.1)}#accountBtn:focus-visible,.cart-btn:focus-visible,.menu-btn:focus-visible{outline:2px solid rgba(255,255,255,.4);outline-offset:2px}.icon{width:24px;height:24px;stroke:currentColor;stroke-width:2;fill:none;stroke-linecap:round;stroke-linejoin:round}.cart-badge{position:absolute;top:4px;right:4px;background:var(--azure);color:var(--cobalt);font-size:11px;font-weight:900;padding:2px 5px;border-radius:10px;line-height:1;min-width:18px;text-align:center}.hero{background-color:var(--cobalt);background-image:linear-gradient(160deg,var(--cobalt) 0%,#0b1420 100%);color:#fff;padding:72px 16px 56px;text-align:center;position:relative;width:100vw;margin-left:calc(50% - 50vw);margin-right:calc(50% - 50vw);box-sizing:border-box;transition:padding-top .4s cubic-bezier(.4,0,.2,1)}.hero-inner{max-width:640px;margin:0 auto}.hero h1{font-size:32px;font-weight:900;line-height:1.1;letter-spacing:-.03em;margin-bottom:12px}.hero p{font-size:17px;opacity:1;margin-bottom:28px;line-height:1.5}.hero-ctas{display:grid;grid-template-columns:1fr 1fr;gap:12px;max-width:480px;margin:0 auto 24px}.hero .btn-ghost{background:0 0;color:#fff;border:2px solid rgba(255,255,255,.5);font-weight:600}.hero .btn-ghost:hover{background:rgba(255,255,255,.15);border-color:#fff;color:#fff;box-shadow:0 2px 12px rgba(255,255,255,.2)}.hero .btn-ghost:active{background:rgba(255,255,255,.25)}.hero-reviews{max-width:500px;margin:0 auto;padding:16px 20px;background:rgba(255,255,255,.95);backdrop-filter:blur(12px);border-radius:12px;box-shadow:0 4px 20px rgba(10,42,90,.12);border:1px solid rgba(255,255,255,.6);position:relative;overflow:hidden;cursor:pointer;transition:all .2s ease;min-height:120px;display:flex;flex-direction:column;justify-content:center}.hero-reviews:hover{transform:translateY(-2px);box-shadow:0 6px 24px rgba(10,42,90,.18);border-color:rgba(20,147,255,.3)}.hero-review-slide{display:none;animation:hero-review-fade .5s ease}.hero-review-slide.active{display:block}.hero-review-stars{display:flex;gap:4px;justify-content:center;margin-bottom:8px;font-size:16px;color:#fbbf24}.hero-review-text{font-size:14px;line-height:1.5;color:var(--ink);text-align:center;margin-bottom:8px;font-style:italic;display:-webkit-box;-webkit-line-clamp:2;line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;min-height:42px;max-height:42px}.hero-review-text:empty{display:none}.hero-review-author{font-size:12px;font-weight:600;color:var(--muted);text-align:center}.hero-review-dots{display:flex;gap:6px;justify-content:center;margin-top:12px;padding-bottom:4px}.hero-review-dots::after{content:"";display:none}.hero-reviews:hover .hero-review-dots::after{opacity:.7}.hero-review-dot{width:6px;height:6px;border-radius:50%;background:var(--border);cursor:pointer;transition:all .3s ease}.hero-review-dot.active{background:var(--azure);width:20px;border-radius:3px}.btn{appearance:none;border:0;background:var(--azure);color:var(--cobalt);font-family:inherit;font-size:16px;font-weight:800;padding:14px 20px;border-radius:8px;cursor:pointer;transition:all .18s cubic-bezier(.4,0,.2,1);text-decoration:none;display:inline-flex;align-items:center;justify-content:center;gap:8px;line-height:1}.btn:hover{transform:translateY(-1px);box-shadow:0 6px 16px rgba(20,147,255,.25)}.btn:active{transform:translateY(0)}.btn:focus-visible{outline:3px solid rgba(20,147,255,.3);outline-offset:2px}.btn-ghost{background:0 0;color:var(--cobalt);border:2px solid var(--azure);font-weight:600}.btn-ghost:hover,.btn-primary{background:var(--azure);color:#fff}.btn-ghost:hover{border-color:var(--azure);box-shadow:0 2px 8px rgba(20,147,255,.2)}.btn-ghost:active{background:#0c7fd9}.btn-primary{font-weight:700;box-shadow:0 2px 8px rgba(20,147,255,.25);transition:all .2s ease}.btn-primary:hover{background:#0c7fd9;box-shadow:0 4px 12px rgba(20,147,255,.35);transform:translateY(-1px)}.btn-primary:active{transform:translateY(0);box-shadow:0 2px 6px rgba(20,147,255,.3)}.btn-secondary{background:var(--cobalt);color:#fff}.btn-subtle{background:0 0;color:var(--muted);border:1px solid var(--border);font-weight:700;font-size:14px;padding:10px 16px}.btn-subtle:hover{background:#f5f7fa;color:var(--cobalt);box-shadow:none}.spinner{display:inline-block;width:14px;height:14px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:spin .6s linear infinite;vertical-align:middle;margin-right:8px}.spinner-dark{border-color:rgba(10,42,90,.2);border-top-color:var(--cobalt)}.section{padding:64px 16px;max-width:1200px;margin:0 auto;background:#fff;position:relative;isolation:isolate}#security.section,#tv.section{overflow:visible}.section::before{content:"";position:absolute;top:0;left:0;right:0;height:32px;background:linear-gradient(180deg,#f8f9fb 0,transparent 100%);pointer-events:none;z-index:0}.section-header{text-align:center;margin-bottom:40px}.review-carousel-header h2,.section-header h2,.trust-item strong{font-size:28px;font-weight:900;color:var(--cobalt);margin-bottom:8px;letter-spacing:-.02em}.section-header p{font-size:16px;color:var(--muted);max-width:560px;margin:0 auto}.trust-bar{background-color:var(--cobalt);background-image:linear-gradient(135deg,var(--cobalt) 0%,#0d3568 100%);padding:24px 16px;position:relative;width:100vw;margin-left:calc(50% - 50vw);margin-right:calc(50% - 50vw);box-sizing:border-box;content-visibility:auto;contain-intrinsic-size:0 100px}.trust-bar::after,.trust-bar::before{content:"";position:absolute;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent 0,rgba(20,147,255,.3) 50%,transparent 100%)}.trust-bar::before{top:0}.trust-bar::after{bottom:0}.trust-inner{max-width:1200px;margin:0 auto;display:grid;grid-template-columns:repeat(2,1fr);gap:20px}@media (min-width:768px){.trust-inner{grid-template-columns:repeat(4,1fr)}}.trust-item{text-align:center;color:#fff}.trust-item strong{display:block;font-size:24px;margin-bottom:4px;color:var(--azure)}.trust-item span{font-size:13px;opacity:.9;font-weight:500}.review-carousel{position:relative;overflow:hidden;padding:96px 0 104px;background-color:#fafbfc;background-image:linear-gradient(180deg,#fafbfc 0,#f5f7fa 50%,#fff 100%);content-visibility:auto;contain-intrinsic-size:0 500px}.review-track-container{overflow:hidden;max-width:1280px;margin:0 auto;padding:0 24px}.review-carousel::after,.review-carousel::before{content:"";position:absolute;left:0;right:0;height:64px;pointer-events:none;z-index:10}.review-carousel::before{top:0;background:linear-gradient(180deg,#f8f9fb 0,rgba(248,249,251,0) 100%)}.review-carousel::after{bottom:0;background:linear-gradient(0deg,#fff 0,rgba(255,255,255,0) 100%)}.review-carousel-header{text-align:center;margin-bottom:56px;max-width:600px;margin-left:auto;margin-right:auto;padding:0 16px;position:relative;z-index:20}.review-carousel-header h2{font-size:36px;margin-bottom:16px;letter-spacing:-.03em}.review-carousel-header p{font-size:18px;color:var(--muted);line-height:1.6}.review-track{display:flex;transition:transform .6s cubic-bezier(.25,1,.5,1);gap:0;will-change:transform;width:100%;padding-bottom:40px}.review-card{flex:0 0 calc(100% - 24px);background:#fff;border-radius:24px;padding:32px;box-shadow:0 4px 20px rgba(10,42,90,.06);border:1px solid rgba(10,42,90,.06);transition:transform .3s ease,box-shadow .3s ease;display:flex;flex-direction:column;margin:0 12px;height:auto;position:relative}.review-card:hover{transform:translateY(-6px);box-shadow:0 12px 32px rgba(10,42,90,.12);border-color:rgba(20,147,255,.3)}@media (min-width:768px){.review-card{flex:0 0 calc(50% - 24px)}}@media (min-width:1024px){.review-card{flex:0 0 calc(33.333% - 24px)}}.review-avatar,.review-header{display:flex;align-items:center}.review-header{gap:12px;margin-bottom:16px}.review-avatar{width:48px;height:48px;border-radius:50%;background:linear-gradient(135deg,var(--azure),var(--cobalt));justify-content:center;color:#fff;font-weight:700;font-size:18px}.review-meta{flex:1}.review-name{font-weight:700;color:var(--cobalt);margin-bottom:2px;font-size:15px}.review-stars{color:#fbbf24;font-size:14px;letter-spacing:2px}.review-time{font-size:12px;color:#9ca3af;margin-top:2px;font-weight:500}.review-text{color:#4b5563;line-height:1.65;font-size:15px;margin-bottom:16px;flex-grow:1;max-height:none;position:relative}.review-service::before,.review-text::before,.review-verified::before{content:none}.review-footer{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-top:auto;padding-top:16px;border-top:1px solid rgba(10,42,90,.06)}.review-service,.review-verified{display:inline-flex;align-items:center}.review-service{font-size:13px;color:var(--azure);font-weight:600;gap:6px}.review-verified{font-size:11px;color:#10b981;font-weight:700;gap:4px;background:rgba(16,185,129,.08);padding:4px 8px;border-radius:6px;white-space:nowrap}.review-nav{display:flex;justify-content:center;gap:8px;margin-top:24px}.review-dot{width:8px;height:8px;border-radius:50%;background:#d1d5db;cursor:pointer;transition:all .3s ease}.review-dot.active{background:var(--azure);width:24px;border-radius:4px}.package-grid{display:grid;gap:20px;grid-template-columns:1fr;overflow:visible;position:relative;z-index:1;margin:-8px;padding:8px}@media (min-width:640px){.package-grid{grid-template-columns:repeat(2,1fr)}}@media (min-width:1024px){.package-grid{grid-template-columns:repeat(4,1fr)}}.package{background:#fff;border:1px solid var(--border);border-radius:14px;padding:16px;display:flex;flex-direction:column;gap:10px;transition:box-shadow .2s ease,transform .2s ease,border-color .2s ease;position:relative;z-index:10;transform:translateZ(0);backface-visibility:hidden;contain:layout style paint;content-visibility:auto}.package:hover{border-color:rgba(20,147,255,.4);box-shadow:0 8px 28px rgba(10,42,90,.12);transform:translateY(-2px);z-index:20}.package:focus-within{z-index:20}.package.featured{border-color:rgba(20,147,255,.6);box-shadow:0 6px 20px rgba(20,147,255,.12)}.package.featured::before{content:"RECOMMENDED";position:absolute;top:10px;right:12px;background:rgba(20,147,255,.1);color:var(--azure);font-size:9px;font-weight:800;letter-spacing:.04em;padding:2px 6px;border-radius:999px;border:1px solid rgba(20,147,255,.3);pointer-events:none;z-index:1}.package-header{display:flex;flex-direction:column;gap:4px;position:relative}.package-name{font-size:19px;font-weight:900;color:var(--cobalt);line-height:1.2}.package-price{font-size:15px;font-weight:900;color:var(--azure)}.package-promise{font-size:14px;color:var(--ink);opacity:.88;line-height:1.4;flex-grow:1;display:-webkit-box;-webkit-line-clamp:2;line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}.package-includes{background:#f3f6fb;border-radius:10px;padding:10px;font-size:12.5px;line-height:1.45;color:var(--cobalt);border:1px solid rgba(10,42,90,.08)}.package-includes strong{display:block;font-weight:800;margin-bottom:6px;font-size:12px;text-transform:none;letter-spacing:0;opacity:.7}.package-includes ul{list-style:disc;padding-left:18px;display:flex;flex-direction:column;gap:3px}.package.featured .package-header{padding-right:96px}.package-includes li::before{content:none;margin:0}.package-includes li::marker{color:var(--azure)}.package .btn{margin-top:auto;width:100%}</style>

<style media="print" onload="this.media='all'" id="deferred-ui-styles">@keyframes h2s-split{0%{opacity:0;transform:translateY(24px)}36%,68%{opacity:1;transform:translateY(0)}to{opacity:0;transform:translateY(-12px)}}@keyframes skeleton-shimmer{0%{background-position:200%0}to{background-position:-200%0}}@keyframes reveal-fade-in{to{opacity:1;transform:translateY(0)}}@keyframes initial-reveal{0%{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}@keyframes loading{0%{background-position:200%0}to{background-position:-200%0}}.menu-drawer{position:fixed;top:0;left:0;bottom:0;width:min(320px,85vw);background:#fff;z-index:1150;transform:translateX(-100%);transition:transform .28s cubic-bezier(.4,0,.2,1);box-shadow:4px 0 16px rgba(0,0,0,.1);display:flex;flex-direction:column}.menu-drawer.open{transform:translateX(0)}.menu-header{display:flex;align-items:center;justify-content:space-between;padding:16px;border-bottom:1px solid var(--border)}.menu-header h3{font-size:16px;font-weight:900;color:var(--cobalt)}.menu-body{flex:1;overflow-y:auto;padding:16px}.menu-nav{display:flex;flex-direction:column;gap:8px}.menu-link{appearance:none;border:0;background:0 0;font-family:inherit;text-align:left;padding:12px;font-size:15px;font-weight:600;color:var(--cobalt);border-radius:8px;cursor:pointer;transition:background .15s ease;text-decoration:none}.menu-link:hover{background:#f5f7fa}.cart-drawer{position:fixed;top:0;right:0;bottom:0;width:min(420px,100vw);background:#fff;z-index:1150;transform:translateX(100%);transition:transform .28s cubic-bezier(.4,0,.2,1);box-shadow:-4px 0 16px rgba(0,0,0,.1);display:flex;flex-direction:column;overscroll-behavior:contain;-webkit-overflow-scrolling:touch}@media (max-width:768px){.cart-drawer{width:100vw;max-width:100vw}}.cart-drawer.open{transform:translateX(0)}.cart-header{display:flex;align-items:center;justify-content:space-between;padding:16px;border-bottom:1px solid var(--border);flex-shrink:0}@media (max-width:768px){.cart-header{padding:12px 16px}}.cart-title{font-size:18px;font-weight:900;color:var(--cobalt)}@media (max-width:768px){.cart-title{font-size:16px}}.cart-body{flex:1;overflow-y:auto;overflow-x:hidden;padding:0 20px 16px;-webkit-overflow-scrolling:touch;overscroll-behavior:contain;position:relative;min-height:0}@media (max-width:768px){.cart-body{padding:0 16px 12px}}.cart-empty::before{content:"";display:block;font-size:48px;margin-bottom:16px;opacity:.3}.cart-empty p{font-size:15px;color:var(--muted);margin:0}.bundle-panel{padding:12px;background:linear-gradient(135deg,#fff3cd 0,#ffeaa7 100%);border:1px solid #ffd97d;border-radius:12px}.bundle-card{background:#fff;margin-bottom:8px}.bundle-card:last-child{margin-bottom:0}.b-name{color:var(--cobalt)}.b-list{color:var(--muted)}.b-actions button{width:100%}.ai-recs-panel,.signin-banner{margin-bottom:16px;border-radius:12px}.signin-banner{display:flex;justify-content:space-between;align-items:center;gap:12px;padding:12px;background:linear-gradient(135deg,#e3f2fd 0,#bbdefb 100%);border:1px solid #90caf9;font-size:13px;color:var(--cobalt)}.signin-banner strong{display:block;font-size:14px;margin-bottom:4px}.ai-recs-panel{padding:14px;background:linear-gradient(135deg,#f3e5f5 0,#e1bee7 100%);border:1px solid #ce93d8}.ai-recs-header{display:flex;align-items:center;gap:8px;margin-bottom:12px}.ai-icon{font-size:20px}.ai-title{font-weight:800;font-size:15px;color:#6a1b9a}.ai-recs-list{display:grid;gap:10px}.ai-rec-card{padding:12px;background:#fff;border-radius:8px;box-shadow:0 1px 3px rgba(0,0,0,.08)}.ai-rec-name{font-weight:700;font-size:14px;color:var(--ink);margin-bottom:4px}.ai-rec-reason{font-size:12px;color:var(--muted);font-style:italic;line-height:1.4}.ai-rec-price{font-weight:600;font-size:13px;color:var(--cobalt)}.bundle-panel{margin-bottom:16px;display:grid;gap:10px}.bundle-card{padding:14px;background:linear-gradient(135deg,#fff3e0 0,#ffe0b2 100%);border:1px solid #ffb74d;border-radius:12px}.b-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}.b-name{font-weight:800;font-size:15px;color:#e65100}.b-save{font-weight:700;font-size:13px;color:#ff6f00;background:#fff;padding:4px 8px;border-radius:6px}.b-list{font-size:12px;color:#6d4c41;margin-bottom:10px;line-height:1.4}.b-actions{display:flex;gap:8px}.b-actions .btn{flex:1;padding:8px 12px;font-size:13px}.recs-panel{margin-bottom:16px;display:grid;gap:10px}.rec-card{display:grid;grid-template-columns:60px 1fr auto;gap:12px;padding:12px;background:#fff;border:1px solid var(--border);border-radius:10px;align-items:center;box-shadow:0 1px 3px rgba(0,0,0,.06)}.rec-card img{width:60px;height:60px;object-fit:cover;border-radius:8px}.r-text{flex:1}.r-title{font-weight:700;font-size:14px;color:var(--ink);margin-bottom:3px}.r-msg{font-size:12px;color:var(--muted);margin-bottom:6px;line-height:1.3}.rec-dismiss{font-size:11px;color:#999;background:0 0;border:0;padding:0;cursor:pointer;text-decoration:underline}.rec-dismiss:hover{color:#666}.r-price{font-weight:800;font-size:14px;color:var(--cobalt);margin-bottom:6px;text-align:right}.rec-card .btn{padding:6px 12px;font-size:12px;white-space:nowrap}.cart-lines{display:flex;flex-direction:column;gap:0;padding-top:16px}.cart-item{display:flex;justify-content:space-between;align-items:flex-start;padding:24px 0;border-bottom:1px solid var(--border);gap:20px}.cart-item:last-child{border-bottom:none}.cart-item-info{flex:1;min-width:0}.cart-item-name{font-weight:800;font-size:16px;color:var(--ink);margin-bottom:6px;line-height:1.3}.cart-item-price{font-size:14px;color:var(--muted);margin-bottom:14px;font-weight:500}.cart-qty-controls{display:flex;align-items:center;gap:10px}.cart-qty-btn{width:32px;height:32px;border:2px solid var(--cobalt);background:#fff;color:var(--cobalt);border-radius:6px;cursor:pointer;font-size:18px;font-weight:800;display:flex;align-items:center;justify-content:center;transition:all .15s ease;padding:0;line-height:1}.cart-qty-btn:hover{background:var(--cobalt);color:#fff}.cart-qty-btn:active{transform:scale(.92)}.cart-qty-value{font-weight:700;color:var(--cobalt);min-width:20px;text-align:center;font-size:14px}.cart-item-right{display:flex;flex-direction:column;align-items:flex-end;gap:8px}.cart-item-total{font-weight:900;font-size:19px;color:var(--ink);white-space:nowrap;letter-spacing:-.5px}.cart-remove-btn{font-size:13px;font-weight:700;color:#dc3545;background:0 0;border:0;cursor:pointer;padding:6px 0;text-decoration:none;transition:all .15s ease;text-transform:uppercase;letter-spacing:.5px}.cart-remove-btn:hover{color:#c82333;text-decoration:underline}.cart-foot{border-top:1px solid var(--border);padding:16px;background:#f8f9fb;flex-shrink:0}@media (max-width:768px){.cart-foot{padding:12px;background:#fff;border-top:2px solid var(--border)}}.checkout-error{display:flex;justify-content:space-between;align-items:center;gap:8px;padding:10px 12px;background:#fee;border:1px solid #fcc;border-radius:8px;margin-bottom:12px;font-size:13px;color:#c33}.checkout-error[hidden]{display:none!important}.error-dismiss{appearance:none;border:0;background:0 0;font-size:20px;line-height:1;color:#c33;cursor:pointer;padding:0;width:20px;height:20px}.totals{margin-bottom:16px;padding-top:12px}@media (max-width:768px){.totals{margin-bottom:8px;padding-top:8px}.totals .kv{padding-top:4px!important;padding-bottom:4px!important}.totals .note{font-size:11px;margin-top:3px}.promo-section{margin-bottom:10px!important}.promo-section .inp{padding:10px 12px!important}#promoCode,.promo-section .inp{font-size:16px!important}.promo-section .btn{padding:10px 14px!important;font-size:13px!important}.promo-section .help{margin-top:4px!important;font-size:11px!important}}.kv,.kv strong{color:var(--ink)}.kv{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;font-size:15px;font-weight:600}.kv strong{font-weight:900;font-size:20px;letter-spacing:-.5px}.note{font-size:12px;color:var(--muted);margin-top:6px}.foot-actions{display:flex;gap:10px;margin-top:8px}.foot-actions .btn{font-weight:700;padding:14px 20px;font-size:15px;border-radius:8px}.foot-actions .btn-ghost{flex:0 0 auto;background:#fff;border:2px solid var(--border);color:var(--cobalt)}.foot-actions .btn-ghost:hover{border-color:var(--cobalt);background:#fff}.foot-actions .btn-primary{flex:1;font-weight:800;letter-spacing:.5px}@media (max-width:768px){.foot-actions{flex-direction:column;gap:8px;margin-top:6px}.foot-actions .btn{width:100%;padding:16px 20px;font-size:16px}.foot-actions .btn-ghost{order:2;padding:12px 20px;font-size:14px;border:1px solid var(--border)}.foot-actions .btn-primary{order:1}}.cart-empty{text-align:center;color:var(--muted);padding:40px 20px;font-size:14px}.backdrop{background:0 0;z-index:1000;display:none}.backdrop.show{display:block;pointer-events:auto}.backdrop,.modal,.modal::before{position:fixed;inset:0;pointer-events:none}.modal{z-index:9999;display:none;align-items:flex-start;justify-content:center;padding:20px;padding-bottom:max(20px,env(safe-area-inset-bottom));overflow-y:auto}.modal::before{content:"";background:rgba(0,0,0,.5);z-index:0;opacity:0;transition:opacity .28s ease}.modal-content,.modal.show{display:flex;pointer-events:auto}.modal.show::before{opacity:1;pointer-events:auto}.modal-content{position:relative;background:#fff;border-radius:16px;width:100%;max-width:520px;max-height:calc(100vh - 40px - env(safe-area-inset-bottom));margin:auto 0;flex-direction:column;transform:scale(.95);transition:transform .28s cubic-bezier(.4,0,.2,1);box-shadow:0 20px 60px rgba(0,0,0,.4);overflow:hidden;z-index:1}.modal.show .modal-content{transform:scale(1)}.modal .inp,.modal-content .inp,.modal-content textarea{padding:12px 14px;border:2px solid var(--border);border-radius:10px;font-size:15px;width:100%;box-sizing:border-box}.modal .inp:focus,.modal-content .inp:focus,.modal-content textarea:focus{outline:0;border-color:var(--azure);box-shadow:0 0 0 4px rgba(20,147,255,.06)}::-webkit-scrollbar{width:12px;height:12px}::-webkit-scrollbar-track{background:#1a1d23;border-radius:10px}::-webkit-scrollbar-thumb{background:#3a3f47;border-radius:10px;border:3px solid #1a1d23}::-webkit-scrollbar-thumb:hover{background:#4a505a}*{scrollbar-width:thin;scrollbar-color:#3a3f47 #1a1d23}.modal-header{padding:24px 20px 16px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}.modal-header h3{font-size:22px;font-weight:900;margin-bottom:6px}.close-btn,.modal-header p{font-size:14px;color:var(--muted);line-height:1.5}.close-btn{appearance:none;border:0;background:0 0;font-size:32px;line-height:1;cursor:pointer;padding:0;width:32px;height:32px;display:flex;align-items:center;justify-content:center;transition:color .15s ease}.close-btn:hover,.modal-header h3{color:var(--cobalt)}.modal-body{padding:20px;flex:1;overflow-y:auto;overflow-x:hidden;-webkit-overflow-scrolling:touch;position:relative}.modal-body::after{content:"";position:sticky;bottom:-20px;left:0;right:0;height:20px;background:linear-gradient(to bottom,transparent,rgba(255,255,255,.95));transition:opacity .2s}.modal-body.has-scroll::after{opacity:1}.modal-footer{padding:16px 20px;border-top:1px solid var(--border);display:flex;flex-direction:column;gap:10px;background:#fff;flex-shrink:0;position:sticky;bottom:0;z-index:10}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}.hidden{display:none!important}.h2s-loader{position:fixed;inset:0;z-index:99999;display:grid;place-items:center;background:rgba(255,255,255,.98);backdrop-filter:blur(8px);pointer-events:auto;opacity:1;transition:opacity .4s cubic-bezier(.4,0,.2,1)}.h2s-loader.hidden,.modal-body::after{opacity:0;pointer-events:none}.h2s-loader-stage{position:relative;width:min(72vw,520px);aspect-ratio:5/2}.h2s-loader-slices{position:absolute;inset:0}.h2s-loader-slice{position:absolute;top:0;bottom:0;overflow:hidden;opacity:0;transform:translateY(24px);will-change:transform,opacity;animation:h2s-split 2.2s cubic-bezier(.22,.8,.32,1) infinite;animation-delay:calc(var(--i)*.06s)}.h2s-loader-slice img{position:absolute;inset:0 auto 0 0;width:100%;height:100%;object-fit:contain}.skeleton{border-radius:8px}.skeleton-hero{height:280px;margin-bottom:24px}.skeleton-trust{height:80px;margin-bottom:32px}.skeleton-card{height:420px;border-radius:16px;margin-bottom:16px}.skeleton-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px;padding:0 16px;max-width:1200px;margin:0 auto}.content-reveal{opacity:0;transform:translateY(16px);animation:reveal-fade-in .6s cubic-bezier(.4,0,.2,1) forwards}.reveal-delay-1{animation-delay:.05s}.reveal-delay-2{animation-delay:.1s}.reveal-delay-3{animation-delay:.15s}.reveal-delay-4{animation-delay:.2s}#outlet{min-height:calc(100vh - 56px);overflow:visible}@media (prefers-reduced-motion:reduce){.content-reveal,.h2s-loader-slice,.skeleton{animation:none!important}.content-reveal{opacity:1;transform:none}.h2s-loader{transition:none}}@media (max-width:390px){.modal{padding:12px;padding-bottom:max(12px,env(safe-area-inset-bottom))}.modal-content{max-height:calc(100vh - 24px - env(safe-area-inset-bottom))}}@media (min-width:768px){.hero{padding:88px 32px 72px}.hero h1{font-size:42px}.hero p{font-size:19px}.trust-bar{padding:32px 24px}.section{padding:80px 24px}.section-header h2{font-size:36px}.section-header p{font-size:18px}.review-carousel{padding:64px 24px}.modal{padding:32px}.modal-content{border-radius:16px;max-width:600px;max-height:calc(100vh - 64px)}}.form,.inp{background:#fff}.form{max-width:480px;margin:80px auto 40px;padding:32px;border-radius:16px;border:1px solid var(--border);box-shadow:var(--shadow-md)}.form h2{text-align:center;color:var(--cobalt);margin:0 0 24px;font-weight:900;font-size:28px}.inp{display:block;width:100%;padding:14px 16px;margin-bottom:14px;font-size:16px;font-family:inherit;border:2px solid var(--border);border-radius:10px;color:var(--ink);transition:all .2s ease}.inp:focus{outline:0;border-color:var(--azure);box-shadow:0 0 0 3px rgba(20,147,255,.1)}.inp:disabled{background:#f5f5f5;color:var(--muted);cursor:not-allowed;border-color:#e0e0e0}.form .help{font-size:13px;color:var(--muted);margin:-6px 0 16px;text-align:center}.form>div[style*="display:flex"]{justify-content:center;margin-top:20px}.pd-box{padding:16px;background:#fafcff;border:1px solid #e7eaf0;border-radius:10px;margin-bottom:16px}.details-grid{display:grid;gap:8px}.details-grid .row{display:grid;grid-template-columns:120px 1fr;gap:12px;padding:8px 0;border-bottom:1px solid #e7eaf0}.details-grid .row:last-child{border-bottom:none}.details-grid .k{font-weight:600;color:var(--muted);font-size:13px}.details-grid .v{font-weight:700;color:var(--cobalt);font-size:14px}.cal-embed{width:100%;height:680px;border:1px solid var(--border);border-radius:12px;overflow:hidden;margin:20px 0}.cal-embed iframe{width:100%;height:100%;border:0}@media (max-width:768px){.form{margin:20px;padding:20px}.details-grid .row{grid-template-columns:1fr;gap:4px}.cal-embed{height:600px}}#pageShell{opacity:1!important;visibility:visible!important}.skeleton{background:linear-gradient(90deg,#f0f0f0 25%,#e0e0e0 50%,#f0f0f0 75%);background-size:200% 100%;animation:loading 1.5s ease-in-out infinite}.bundle-skeleton{height:400px;border-radius:12px;margin-bottom:20px}</style>

<!-- Performance: Remove API preload - catalog now loads in background -->

</head>
<body>
<div id="pageShell">

<!-- URGENCY BANNER -->
<div class="urgency-banner" id="urgencyBanner">
  <div class="urgency-text">
    <span><strong id="urgencyMessage">Loading...</strong></span>
    <span class="urgency-separator">|</span>
    <span>We're available 7 days/week</span>
  </div>
    <button class="urgency-close" onclick="dismissUrgencyBanner()" aria-label="Dismiss banner">&times;</button>
</div>

<!-- HEADER -->
<header class="header">
  <div class="header-inner">
    <a href="#" class="logo" aria-label="Home2Smart home" onclick="navSet({view:'shop'}); return false;">
      <img src="https://storage.googleapis.com/msgsndr/7Drmpw623JAkrfDKPdjG/media/68da0ce6f00445991d64a63f.png" alt="Home2Smart" class="logo-img" width="36" height="36" fetchpriority="high" decoding="async">
    </a>

    <div class="header-actions">
      <button class="menu-btn" onclick="toggleMenu()" aria-label="Open menu">
        <svg class="icon" viewBox="0 0 24 24">
          <line x1="3" y1="12" x2="21" y2="12"></line>
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      </button>

      <button id="accountBtn" class="header-btn" aria-label="Account">
        <svg class="icon" viewBox="0 0 24 24">
          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
          <circle cx="12" cy="7" r="4"></circle>
        </svg>
      </button>

      <button class="cart-btn" onclick="toggleCart()" aria-label="Open cart">
        <svg class="icon" viewBox="0 0 24 24">
          <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path>
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <path d="M16 10a4 4 0 0 1-8 0"></path>
        </svg>
        <span class="cart-badge" id="cartCount">0</span>
      </button>
    </div>
  </div>
</header>

<!-- Main Outlet for Dynamic Views -->
<main id="mainView">
<div id="outlet">
<!-- HERO -->
<section class="hero">
  <div class="hero-inner">
    <h1>Expert Installation.<br>Done Right.</h1>
    <p>TV Mounting & Security Cameras. Pick a package, we handle the rest. Simple pricing, instant booking.</p>
    <div class="hero-ctas">
      <button class="btn btn-primary" onclick="scrollToSection('tv')">
        Shop TV Packages
      </button>
      <button class="btn btn-ghost" onclick="scrollToSection('security')">
        Shop Cameras
      </button>
    </div>
    
    <!-- Hero Review Carousel -->
    <div class="hero-reviews" id="heroReviews" style="min-height: 120px; contain: content;">
      <!-- OPTIMIZATION: Placeholder matches final structure to prevent CLS -->
      <div class="hero-review-slide active">
        <div class="hero-review-stars">&#9733;&#9733;&#9733;&#9733;&#9733;</div>
        <div class="hero-review-text">"Professional, on-time, and clean installation."</div>
        <div class="hero-review-author">&mdash; Recent Customer</div>
      </div>
      <div class="hero-review-dots">
        <div class="hero-review-dot active"></div>
        <div class="hero-review-dot"></div>
        <div class="hero-review-dot"></div>
        <div class="hero-review-dot"></div>
        <div class="hero-review-dot"></div>
      </div>
    </div>
  </div>
</section>

<!-- TRUST BAR -->
<section class="trust-bar content-reveal reveal-delay-1">
  <div class="trust-inner">
    <div class="trust-item">
      <strong>500+</strong>
      <span>Homes Served</span>
    </div>
    <div class="trust-item">
      <strong>4.9&#9733;</strong>
      <span>Average Rating</span>
    </div>
    <div class="trust-item">
      <strong>Licensed</strong>
      <span>& Insured</span>
    </div>
    <div class="trust-item">
      <strong>Instant</strong>
      <span>Booking Available</span>
    </div>
  </div>
</section>

<!-- REVIEWS CAROUSEL -->
<section class="review-carousel" aria-label="Customer reviews">
  <div class="review-carousel-header">
    <h2>Customer reviews</h2>
    <p>Real feedback from recent installations.</p>
  </div>
  <div class="review-track-container">
    <div class="review-track" id="reviewTrack" aria-live="polite">
      <div class="review-card" data-index="0">
        <div class="review-header">
          <div class="review-avatar">RC</div>
          <div class="review-meta">
            <div class="review-name">Recent Customer</div>
            <div class="review-stars"></div>
          </div>
        </div>
        <p class="review-text">Fast, professional installation. Everything looks clean and works perfectly.</p>
        <div class="review-footer">
          <div class="review-service">Smart Home Service</div>
        </div>
      </div>
      <div class="review-card" data-index="1">
        <div class="review-header">
          <div class="review-avatar">RC</div>
          <div class="review-meta">
            <div class="review-name">Recent Customer</div>
            <div class="review-stars"></div>
          </div>
        </div>
        <p class="review-text">On time, clear communication, and the setup was done right the first time.</p>
        <div class="review-footer">
          <div class="review-service">Smart Home Service</div>
        </div>
      </div>
      <div class="review-card" data-index="2">
        <div class="review-header">
          <div class="review-avatar">RC</div>
          <div class="review-meta">
            <div class="review-name">Recent Customer</div>
            <div class="review-stars"></div>
          </div>
        </div>
        <p class="review-text">Great experience from booking to completion. Highly recommend.</p>
        <div class="review-footer">
          <div class="review-service">Smart Home Service</div>
        </div>
      </div>
    </div>
  </div>
  <div class="review-nav" id="reviewNav" aria-label="Review navigation">
    <div class="review-dot active" aria-label="Go to page 1"></div>
  </div>
</section>

<!-- TV MOUNTING SECTION -->
<section class="section content-reveal reveal-delay-2" id="tv">
  <div class="section-header">
    <h2>TVs: pick by TV count</h2>
    <p>Clean installs, book instantly. First TV $249, each additional discounted.</p>
  </div>

  <div class="package-grid">
    <!-- Single TV -->
    <article class="package">
      <div class="package-header">
        <h3 class="package-name">1 TV</h3>
        <div class="package-price">$249</div>
      </div>
      <p class="package-promise">One TV mounted clean and ready to watch tonight.</p>
      <div class="package-includes">
        <strong>What's Included</strong>
        <ul>
          <li>TV securely mounted</li>
          <li>Wire concealment (when feasible)</li>
          <li>Streaming setup</li>
          <li>Ready to go</li>
        </ul>
      </div>
      <button class="btn btn-primary" onclick="selectPackage('tv_single', '1 TV', 249)">
        Add to Cart
      </button>
    </article>

    <!-- 2-TV Package (FEATURED) -->
    <article class="package featured">
      <div class="package-header">
        <h3 class="package-name">2 TVs (recommended)</h3>
        <div class="package-price">$428 <small style="opacity:.6">(save $70)</small></div>
      </div>
      <p class="package-promise">Two rooms, theater-ready. Same visit, better deal.</p>
      <div class="package-includes">
        <strong>What's Included</strong>
        <ul>
          <li>Both TVs mounted</li>
          <li>Wire concealment (when feasible)</li>
          <li>Streaming on both</li>
          <li>One appointment</li>
        </ul>
      </div>
      <button class="btn btn-primary" onclick="selectPackage('tv_2pack', '2 TVs (recommended)', 428)">
        Add to Cart
      </button>
    </article>

    <!-- Multi-Room -->
    <article class="package">
      <div class="package-header">
        <h3 class="package-name">34 TVs</h3>
        <div class="package-price">From $699</div>
      </div>
      <p class="package-promise">Whole-home entertainment in one visit.</p>
      <div class="package-includes">
        <strong>What's Included</strong>
        <ul>
          <li>3-4 TVs mounted</li>
          <li>Wire concealment (when feasible)</li>
          <li>Streaming + soundbar</li>
          <li>Universal remote</li>
        </ul>
      </div>
      <button class="btn btn-primary" onclick="selectPackage('tv_multi', '34 TVs', 699)">
        Add to Cart
      </button>
    </article>

    <!-- Custom -->
    <article class="package">
      <div class="package-header">
        <h3 class="package-name">5+ TVs (quote)</h3>
        <div class="package-price">Request Quote</div>
      </div>
      <p class="package-promise">Large properties or commercial setups&mdash;we'll design a plan.</p>
      <div class="package-includes">
        <strong>What's Included</strong>
        <ul>
          <li>Site consultation</li>
          <li>Custom wiring plan</li>
          <li>Volume pricing</li>
          <li>Project manager</li>
        </ul>
      </div>
      <button class="btn btn-secondary" onclick="safeRequestQuote('tv_custom')">
        Request Quote
      </button>
    </article>
  </div>
</section>

<!-- SECURITY CAMERAS SECTION -->
<section class="section" id="security">
  <div class="section-header">
    <h2>Cameras: pick by coverage level</h2>
    <p>Choose coverage by outcome  faces at the door, plates in the driveway, or full perimeter protection.</p>
  </div>

  <div class="package-grid">
    <!-- Front Door Only -->
    <article class="package">
      <div class="package-header">
        <h3 class="package-name">Front Door Only</h3>
        <div class="package-price">$599</div>
      </div>
      <p class="package-promise">See faces at the door with instant alerts.</p>
      <div class="package-includes">
        <strong>What's Included</strong>
        <ul>
          <li><strong>Areas covered:</strong> Front door</li>
          <li><strong>Visibility level:</strong> Faces at the door</li>
          <li><strong>Install + setup included:</strong> App setup, alerts, zones</li>
          <li><strong>Support level:</strong> Standard support</li>
        </ul>
      </div>
      <button class="btn btn-primary" onclick="selectPackage('cam_basic', 'Front Door Only', 599)">
        Add to Cart
      </button>
    </article>

    <!-- Standard Perimeter (FEATURED) -->
    <article class="package featured">
      <div class="package-header">
        <h3 class="package-name">Standard Perimeter</h3>
        <div class="package-price">$1,199</div>
      </div>
      <p class="package-promise">Front, driveway, backyard  practical coverage for most homes.</p>
      <div class="package-includes">
        <strong>What's Included</strong>
        <ul>
          <li><strong>Areas covered:</strong> Front, driveway, backyard</li>
          <li><strong>Visibility level:</strong> Faces at door + plates in driveway</li>
          <li><strong>Install + setup included:</strong> App setup, alerts, zones</li>
          <li><strong>Support level:</strong> Standard support</li>
        </ul>
      </div>
      <button class="btn btn-primary" onclick="selectPackage('cam_standard', 'Standard Perimeter', 1199)">
        Add to Cart
      </button>
    </article>

    <!-- Full Perimeter -->
    <article class="package">
      <div class="package-header">
        <h3 class="package-name">Full Perimeter</h3>
        <div class="package-price">$2,199</div>
      </div>
      <p class="package-promise">Full-property protection with visibility on faces and plates.</p>
      <div class="package-includes">
        <strong>What's Included</strong>
        <ul>
          <li><strong>Areas covered:</strong> Full perimeter</li>
          <li><strong>Visibility level:</strong> Full perimeter coverage (faces + plates)</li>
          <li><strong>Install + setup included:</strong> App setup, alerts, zones</li>
          <li><strong>Support level:</strong> Priority support</li>
        </ul>
      </div>
      <button class="btn btn-primary" onclick="selectPackage('cam_premium', 'Full Perimeter', 2199)">
        Add to Cart
      </button>
    </article>

    <!-- Custom -->
    <article class="package">
      <div class="package-header">
        <h3 class="package-name">Custom (quote)</h3>
        <div class="package-price">Quote</div>
      </div>
      <p class="package-promise">Unique property? Well design a coverage plan with you.</p>
      <div class="package-includes">
        <strong>What's Included</strong>
        <ul>
          <li><strong>Areas covered:</strong> Custom camera plan</li>
          <li><strong>Visibility level:</strong> Tailored to faces, plates, or both</li>
          <li><strong>Install + setup included:</strong> App setup, alerts, zones</li>
          <li><strong>Support level:</strong> Priority support</li>
        </ul>
      </div>
      <button class="btn btn-secondary" onclick="safeRequestQuote('cam_custom')">
        Request Quote
      </button>
    </article>
  </div>
</section>
</div>
<!-- End Outlet -->
</main>

<!-- Global Loader Overlay -->
<div id="h2s-loader" class="h2s-loader" aria-hidden="true" style="display:none">
  <div class="h2s-loader-stage">
    <div id="h2sLoaderSlices" class="h2s-loader-slices"></div>
  </div>
</div>

<!-- MENU DRAWER -->
<aside class="menu-drawer" id="menuDrawer" style="content-visibility: auto;">
  <div class="menu-header">
    <h3>Menu</h3>
    <button class="btn-subtle" onclick="toggleMenu()" style="padding: 6px 10px; font-size: 13px;">Close</button>
  </div>
  <nav class="menu-body">
    <div class="menu-nav">
      <a href="/" class="menu-link">Home</a>
      <button class="menu-link" onclick="scrollToSection('tv'); toggleMenu();">TV Mounting</button>
      <button class="menu-link" onclick="scrollToSection('security'); toggleMenu();">Security Cameras</button>
      <button class="menu-link" onclick="openBooking(); toggleMenu();">Schedule Appointment</button>
      <a href="tel:864-528-1475" class="menu-link">Call: 864-528-1475</a>
    </div>
  </nav>
</aside>

<!-- CART DRAWER -->
<aside class="cart-drawer" id="cartDrawer" onclick="event.stopPropagation()" style="content-visibility: auto;">
  <div class="cart-header">
    <h3 class="cart-title">Your Cart</h3>
    <button class="btn-subtle" onclick="toggleCart()" style="padding: 6px 10px; font-size: 13px;">Close</button>
  </div>
  
  <!-- Scrollable body -->
  <div class="cart-body">
    <!-- AI Recommendations Panel -->
    <div id="aiRecommendationsPanel" class="ai-recs-panel" style="display:none;min-height:80px">
      <div class="ai-recs-header">
        <div class="ai-icon">&#10024;</div>
        <div class="ai-title">Recommended for you</div>
      </div>
      <div id="aiRecommendations" class="ai-recs-list"></div>
    </div>
    
    <!-- Bundle recommendations (smart swap suggestions) -->
    <div id="bundlePanel" class="bundle-panel" style="display:none;min-height:60px"></div>
    
    <!-- Rule-based Recommendations -->
    <div id="recsPanel" class="recs-panel" style="display:none;min-height:60px"></div>
    
    <!-- Empty state -->
    <div id="cartEmpty" class="cart-empty" hidden>
      <p>Your cart is empty</p>
      <p style="font-size: 13px; margin-top: 8px;">Pick a package to get started</p>
    </div>
    
    <!-- Cart items -->
    <div id="cartItems" class="cart-lines">
      <!-- Items rendered by paintCart() -->
    </div>
  </div>
  
  <!-- Footer -->
  <div class="cart-foot">
    <!-- Error display -->
    <div id="checkoutError" class="checkout-error" role="alert" aria-live="polite" hidden>
      <span id="checkoutErrorMsg"></span>
      <button id="dismissError" class="error-dismiss" aria-label="Dismiss error">&times;</button>
    </div>

    <!-- Promo Code -->
    <div class="promo-section" style="margin-bottom: 16px;">
      <div style="display: flex; gap: 8px;">
        <input type="text" id="promoCode" class="inp" placeholder="Promo code" style="padding: 8px 12px; flex: 1;">
        <button id="applyPromo" class="btn ghost" style="padding: 8px 14px; font-size: 13px; white-space: nowrap;">Apply</button>
      </div>
      <div id="promoMsg" class="help" style="margin-top: 6px; font-size: 12px;"></div>
    </div>
    
    <!-- Totals -->
    <div class="totals">
      <div class="kv" style="font-size: 14px; color: var(--muted);">
        <span id="cartItemCount">0 items</span>
        <span></span>
      </div>
      <!-- Subtotal (visible when no promo active) -->
      <div id="cartSubtotalLine" class="kv" style="font-size: 14px; color: var(--ink); padding-top: 8px; border-top: 1px solid var(--border);">
        <span>Subtotal</span>
        <span id="cartSubtotal">$0.00</span>
      </div>
      
      <!-- Raw Subtotal (Visible when promo is active, replaces above) -->
      <div id="rawSubtotalLine" class="kv" style="font-size: 14px; color: var(--ink); display: none;">
        <span>Subtotal</span>
        <span id="rawSubtotalAmount">$0.00</span>
      </div>

      <!-- Promo Discount Line -->
      <div id="promoLine" class="kv" style="font-size: 14px; color: #059669; display: none;">
        <span id="promoLineLabel">Promo</span>
        <span id="promoAmount">-$0.00</span>
      </div>

      <!-- Grand Total (shows final amount after discount) -->
      <div class="kv" style="font-size: 16px; font-weight: 700; padding-top: 12px; border-top: 1px solid var(--border);">
        <span id="totalLabel">Total</span>
        <strong id="grandTotal">$0.00</strong>
      </div>
      <div class="note">Flat-rate pricing. No hidden fees. Workmanship guaranteed.</div>
    </div>
    
    <!-- Actions -->
    <div class="foot-actions">
      <button id="checkoutBtn" class="btn btn-primary">
        Checkout
      </button>
    </div>
  </div>
</aside>

<!-- BACKDROP -->
<div class="backdrop" id="backdrop"></div>

<!-- QUOTE REQUEST MODAL -->
<div class="modal" id="quoteModal">
  <div class="modal-content" style="max-width: 520px;">
    <div class="modal-header">
      <h3 id="quoteModalTitle">Request Custom Quote</h3>
      <p id="quoteModalSubtitle">Tell us what you need and we'll get back to you fast</p>
    </div>
    <div class="modal-body" style="padding: 24px;">
      <!-- Smart Fields for Dynamic Quote -->
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
        <div>
          <label style="display: block; font-weight: 600; margin-bottom: 6px; font-size: 14px;">Project Type</label>
          <select id="quoteType" class="inp" style="width: 100%;" onchange="updateQuoteEstimate()">
            <option value="tv">TV Mounting</option>
            <option value="camera">Security Cameras</option>
            <option value="both">Both / Other</option>
          </select>
        </div>
        <div>
          <label style="display: block; font-weight: 600; margin-bottom: 6px; font-size: 14px;">Quantity</label>
          <input type="number" id="quoteQty" class="inp" value="1" min="1" max="50" style="width: 100%;" onchange="updateQuoteEstimate()" oninput="updateQuoteEstimate()">
        </div>
      </div>
      
      <div style="margin-bottom: 16px;">
        <label style="display: block; font-weight: 600; margin-bottom: 6px; font-size: 14px;">Surface / Wall Type</label>
        <select id="quoteSurface" class="inp" style="width: 100%;" onchange="updateQuoteEstimate()">
          <option value="drywall">Drywall (Standard)</option>
          <option value="brick">Brick / Stone / Concrete (+$50/item)</option>
          <option value="commercial">Commercial / High Ceiling</option>
        </select>
      </div>

      <div style="background: #f0fdf4; border: 1px solid #bbf7d0; border-radius: 8px; padding: 12px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
        <span style="font-weight: 600; color: #166534; font-size: 14px;">Estimated Range:</span>
        <span id="quoteEstimateValue" style="font-weight: 800; color: #15803d; font-size: 18px;">$149 - $199</span>
      </div>
      
      <div style="display: grid; gap: 16px;">
        <div>
          <label style="display: block; font-weight: 600; margin-bottom: 6px; font-size: 14px;">Your Name *</label>
          <input type="text" id="quoteName" class="inp" placeholder="John Smith" style="width: 100%;" required>
        </div>
        
        <div>
          <label style="display: block; font-weight: 600; margin-bottom: 6px; font-size: 14px;">Email *</label>
          <input type="email" id="quoteEmail" class="inp" placeholder="john@example.com" style="width: 100%;" required>
        </div>
        
        <div>
          <label style="display: block; font-weight: 600; margin-bottom: 6px; font-size: 14px;">Phone *</label>
          <input type="tel" id="quotePhone" class="inp" placeholder="(864) 528-1475" style="width: 100%;" required>
        </div>
        
        <div>
          <label style="display: block; font-weight: 600; margin-bottom: 6px; font-size: 14px;">Project Details</label>
          <textarea id="quoteDetails" class="inp" placeholder="Tell us about your project..." style="width: 100%; min-height: 100px; resize: vertical; font-family: inherit;"></textarea>
        </div>
        
        <div id="quoteMessage" class="help" style="margin-top: 4px;"></div>
      </div>
      
      <div style="margin-top: 24px; padding-top: 20px; border-top: 1px solid var(--border);">
        <div style="font-size: 13px; font-weight: 600; color: var(--cobalt); margin-bottom: 12px;"> Prefer to call?</div>
        <a href="tel:864-528-1475" style="display: flex; align-items: center; gap: 10px; padding: 12px 16px; background: #f5f9ff; border: 1px solid #d7eafc; border-radius: 8px; text-decoration: none; color: var(--cobalt); font-weight: 600; transition: all 0.2s;">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
          </svg>
          <span>(864) 528-1475</span>
        </a>
      </div>
    </div>
    <div class="modal-footer" style="gap: 8px;">
      <button class="btn btn-primary" id="submitQuoteBtn" onclick="submitQuoteRequest()" style="flex: 1;">
        Send Request
      </button>
      <button class="btn btn-subtle" id="cancelQuoteBtn" onclick="safeCloseQuoteModal()">Cancel</button>
    </div>
  </div>
</div>

<!-- MODAL -->
<div class="modal" id="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 id="modalTitle">Package Selected</h3>
      <p id="modalSubtitle">We'll finalize the details during your free consultation.</p>
    </div>
    <div class="modal-body" id="modalBody">
      <!-- Dynamic content -->
    </div>
    <div class="modal-footer">
      <button class="btn btn-primary" id="modalPrimaryCTA" onclick="addPackageToCart()">Add to Cart</button>
      <button class="btn btn-subtle" onclick="closeModal()">Cancel</button>
    </div>
  </div>
</div>

<!-- SEO: Structured Data (JSON-LD) -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "LocalBusiness",
  "name": "Home2Smart",
  "description": "Professional smart home installation services including TV mounting and security camera installation",
  "url": "https://home2smart.com",
  "telephone": "+1-864-528-1475",
  "priceRange": "$$",
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": "4.9",
    "reviewCount": "500"
  },
  "areaServed": {
    "@type": "State",
    "name": "South Carolina"
  },
  "hasOfferCatalog": {
    "@type": "OfferCatalog",
    "name": "Installation Services",
    "itemListElement": [
      {
        "@type": "Offer",
        "itemOffered": {
          "@type": "Service",
          "name": "TV Mounting Installation",
          "description": "Professional TV mounting with wire concealment"
        },
        "price": "249",
        "priceCurrency": "USD"
      },
      {
        "@type": "Offer",
        "itemOffered": {
          "@type": "Service",
          "name": "Security Camera Installation",
          "description": "Complete security camera system installation"
        },
        "price": "599",
        "priceCurrency": "USD"
      }
    ]
  }
}
</script>

<!-- Performance: Detect when Archivo font loads and apply it -->
<!-- Font loading handled by CSS font-display: swap -->

<script>
(function(){
  // TBT guard (selective): throttle ONLY the tel:-link tracking MutationObserver.
  // This avoids changing MutationObserver semantics for other scripts.
  if (window.__H2S_TBT_GUARDS__) return;
  window.__H2S_TBT_GUARDS__ = true;

  try {
    if (window.MutationObserver) {
      var NativeMutationObserver = window.MutationObserver;
      var schedule = window.requestAnimationFrame
        ? window.requestAnimationFrame.bind(window)
        : function(fn){ return setTimeout(fn, 16); };

      function shouldThrottleMutationObserverCallback(cb) {
        if (typeof cb !== 'function') return false;
        try {
          var src = String(cb);
          return src.indexOf('trackPhoneClick') !== -1 && src.indexOf('tel:') !== -1;
        } catch (_) {
          return false;
        }
      }

      function makeThrottledCallback(originalCb) {
        var queued = [];
        var scheduled = false;
        var lastObserver = null;
        return function(mutations, observer) {
          lastObserver = observer;
          if (mutations && mutations.length) queued.push.apply(queued, mutations);
          if (scheduled) return;
          scheduled = true;
          schedule(function(){
            scheduled = false;
            var batch = queued.length ? queued.splice(0, queued.length) : mutations;
            try {
              originalCb(batch, lastObserver);
            } catch (e) {
              setTimeout(function(){ throw e; });
            }
          });
        };
      }

      function WrappedMutationObserver(callback) {
        if (!(this instanceof WrappedMutationObserver)) return new WrappedMutationObserver(callback);
        var cb = callback;
        if (shouldThrottleMutationObserverCallback(callback)) {
          cb = makeThrottledCallback(callback);
        }
        return new NativeMutationObserver(cb);
      }

      WrappedMutationObserver.prototype = NativeMutationObserver.prototype;
      window.MutationObserver = WrappedMutationObserver;
    }
  } catch (_) {
    // Fail open.
  }

  // TBT guard (selective): reduce Meta Pixel readiness polling overhead.
  // Only targets the internal h2sTrack fbq polling interval.
  try {
    if (!window.__H2S_SI_PATCHED__ && window.setInterval && window.clearInterval) {
      window.__H2S_SI_PATCHED__ = true;
      var nativeSetInterval = window.setInterval.bind(window);
      var nativeClearInterval = window.clearInterval.bind(window);

      window.setInterval = function(cb, ms) {
        try {
          if (ms === 150 && typeof cb === 'function') {
            var src = '';
            try { src = String(cb); } catch (_) { src = ''; }
            if (src && src.indexOf('fbq') !== -1 && src.indexOf('__H2S_FB_INIT__') !== -1) {
              var runs = 0;
              var id;
              var wrapped = function(){
                runs++;
                if (runs > 8) {
                  try { nativeClearInterval(id); } catch (_) {}
                  return;
                }
                return cb.apply(this, arguments);
              };
              id = nativeSetInterval(wrapped, 500);
              return id;
            }
          }
        } catch (_) {
          // fall through
        }
        return nativeSetInterval.apply(this, arguments);
      };
    }
  } catch (_) {
    // Fail open.
  }
})();
</script>

<script defer>"use strict";const isDev="localhost"===window.location.hostname||window.location.hostname.includes("127.0.0.1")||window.location.hostname.includes("vercel.app"),logger={log:isDev?console.log.bind(console):()=>{},warn:isDev?console.warn.bind(console):()=>{},error:console.error.bind(console)};function byId(id){return document.getElementById(id)}function money(cents){return"number"==typeof cents?"$"+cents.toFixed(2):"$0.00"}function escapeHtml(text){if(!text)return"";const div=document.createElement("div");return div.textContent=text,div.innerHTML}logger.log("[BundlesJS] Script loaded and executing");const BUNDLES_DATA_API="https://h2s-backend.vercel.app/api/bundles-data",API="https://h2s-backend.vercel.app/api/shop",APIV1="https://h2s-backend.vercel.app/api/schedule-appointment",DASH_URL="https://h2s-backend.vercel.app/api/track",CAL_FORM_URL="https://api.leadconnectorhq.com/widget/booking/RjwOQacM3FAjRNCfm6uU",PIXEL_ID="2384221445259822",TEST_EVENT_CODE=null,IS_LOCAL="127.0.0.1"===location.hostname||"localhost"===location.hostname;window.H2S_TRACKING_ENDPOINT=DASH_URL,window.H2S_META_ENDPOINT=DASH_URL;const bundlesFetchPromise=IS_LOCAL?Promise.resolve(null):fetch(BUNDLES_DATA_API,{cache:"default",headers:{Accept:"application/json"},priority:"high",credentials:"omit"}).then(res=>res.ok?res.json():(logger.warn("[Bundles] API returned",res.status,"- using fallback"),null)).catch(err=>(logger.warn("[Bundles] Aggregated fetch failed, will fallback:",err),null));let SESSION_ID=localStorage.getItem("h2s_session_id");function showTrackingDebugPanel(){const panel=document.createElement("div");panel.id="trackingDebugPanel",panel.style.cssText="position:fixed;bottom:16px;right:16px;background:#0a2a5a;color:#fff;padding:16px;border-radius:12px;font-family:monospace;font-size:12px;max-width:400px;max-height:500px;overflow:auto;z-index:99999;box-shadow:0 8px 24px rgba(0,0,0,0.3);",panel.innerHTML=`\n    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">\n      <strong style="font-size:14px;"> Tracking Monitor</strong>\n      <button onclick="this.parentElement.parentElement.remove()" style="background:rgba(255,255,255,0.2);border:none;color:#fff;padding:4px 8px;border-radius:4px;cursor:pointer;font-size:11px;">Close</button>\n    </div>\n    <div style="margin-bottom:8px;"><strong>Session:</strong><br/><span style="font-size:10px;opacity:0.8;word-break:break-all;">${SESSION_ID}</span></div>\n    <div style="margin-bottom:8px;"><strong>Meta Pixel:</strong> <span id="pixelStatus">Checking...</span></div>\n    <div style="margin-bottom:8px;"><strong>Backend API:</strong> <span id="backendStatus">Checking...</span></div>\n    <div style="margin-bottom:8px;"><strong>Events Sent:</strong> <span id="eventCount">0</span></div>\n    <div style="margin-top:12px;padding-top:12px;border-top:1px solid rgba(255,255,255,0.2);">\n      <button onclick="testH2STracking()" style="width:100%;background:#1493ff;border:none;color:#fff;padding:8px;border-radius:6px;cursor:pointer;font-weight:600;font-size:12px;margin-bottom:8px;"> Test Tracking</button>\n      <a href="https://business.facebook.com/events_manager2/list/pixel/" target="_blank" style="display:block;text-align:center;padding:6px;background:rgba(255,255,255,0.1);border-radius:6px;color:#fff;text-decoration:none;font-size:11px;">View Meta Events Manager </a>\n    </div>\n    <div id="recentEvents" style="margin-top:12px;padding-top:12px;border-top:1px solid rgba(255,255,255,0.2);font-size:10px;max-height:200px;overflow:auto;"></div>\n  `,document.body.appendChild(panel);const pixelStatus=document.getElementById("pixelStatus");"undefined"!=typeof fbq?pixelStatus.innerHTML='<span style="color:#10b981;"> Active</span>':pixelStatus.innerHTML='<span style="color:#ef4444;"> Not Loaded</span>';const backendStatus=document.getElementById("backendStatus");fetch("https://h2s-backend.vercel.app/api/stats",{credentials:"omit",cache:"no-store"}).then(res=>{backendStatus.innerHTML=res.ok?'<span style="color:#10b981;"> Online</span>':'<span style="color:#f59e0b;"> HTTP '+res.status+"</span>"}).catch(()=>{backendStatus.innerHTML='<span style="color:#ef4444;"> Offline</span>'}),window._trackingDebugCount=0;const originalH2STrack=window.h2sTrack||h2sTrack;window.h2sTrack=function(...args){window._trackingDebugCount++,document.getElementById("eventCount").textContent=window._trackingDebugCount;const recentEvents=document.getElementById("recentEvents"),eventDiv=document.createElement("div");return eventDiv.style.cssText="padding:6px 8px;margin-bottom:4px;opacity:0.9;background:rgba(255,255,255,0.05);border-radius:4px;border-left:3px solid #10b981;",eventDiv.innerHTML='<div style="font-weight:600;margin-bottom:2px;">'+args[0]+'</div><div style="opacity:0.7;font-size:9px;">'+(new Date).toLocaleTimeString()+"</div>",recentEvents.insertBefore(eventDiv,recentEvents.firstChild),recentEvents.children.length>8&&recentEvents.lastChild.remove(),originalH2STrack.apply(this,args)}}function testH2STracking(){h2sTrack("DebugTest",{source:"debug_panel",test:!0,timestamp:(new Date).toISOString(),page:"bundles"}),setTimeout(()=>{alert(' Test event fired!\n\n1. Open browser console (F12) to see detailed logs\n2. Look for " [H2S Track]" and " Backend response"\n3. Check your database/sheet for the event\n\nIf you see " Backend unavailable" in console, there\'s a timing issue.')},500)}SESSION_ID||(SESSION_ID=crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){const r=16*Math.random()|0;return("x"===c?r:3&r|8).toString(16)}),localStorage.setItem("h2s_session_id",SESSION_ID));let catalog={services:[],serviceOptions:[],priceTiers:[],bundles:[],bundleItems:[],recommendations:[],memberships:[],membershipPrices:[]},allReviews=[],heroReviews=[],reviewsLoadedFromAPI=!1,cart=loadCart(),user=loadUser(),lastSearch="",lastCat="",_bundlesDeferredPromise=null;function loadBundlesDeferred(){return _bundlesDeferredPromise||(_bundlesDeferredPromise=Promise.resolve(),_bundlesDeferredPromise)}function loadExtraDeferred(){return loadBundlesDeferred()}function queueRenderRecsPanel(){if(window._queuedRecs)return;window._queuedRecs=!0;const invoke=()=>loadExtraDeferred().then(()=>{window.renderRecsPanel&&window.renderRecsPanel(),window._queuedRecs=!1}).catch(err=>{console.warn("[Recommendations] Failed to load, skipping"),window._queuedRecs=!1});"requestIdleCallback"in window?requestIdleCallback(invoke,{timeout:3e3}):setTimeout(invoke,1500)}function buildLoader(){const slices=byId("h2sLoaderSlices");if(!slices)return;const c1="#1493ff",c2="#0a2a5a",c3="#6b778c",colors=[c1,c2,c3,c1,c2,c3,c1,c2];slices.innerHTML=colors.map((col,i)=>`<div class="h2s-loader-slice" style="background:${col};animation-delay:${.05*i}s"></div>`).join("")}function showLoader(){const el=byId("h2s-loader");el&&(el.classList.remove("hidden"),el.style.display="")}function hideLoader(){const el=byId("h2s-loader");el&&(el.classList.add("hidden"),setTimeout(()=>{el.classList.contains("hidden")&&(el.style.display="none")},400))}function showSkeleton(){byId("outlet").innerHTML='\n    <div class="skeleton skeleton-hero"></div>\n    <div class="skeleton skeleton-trust"></div>\n    <div class="skeleton-grid">\n      <div class="skeleton skeleton-card"></div>\n      <div class="skeleton skeleton-card"></div>\n      <div class="skeleton skeleton-card"></div>\n      <div class="skeleton skeleton-card"></div>\n      <div class="skeleton skeleton-card"></div>\n      <div class="skeleton skeleton-card"></div>\n    </div>\n  '}function h2sTrack(event,data={}){!function(){if("function"==typeof fbq&&window.__H2S_FB_INIT__)try{const params=buildAdvancedParams(),eventData={...data};fbq("track",event,eventData,params)}catch(e){console.warn(" [Meta Pixel] send failed:",e)}else{let tries=0;const maxTries=20,timer=setInterval(()=>{if("function"==typeof fbq&&window.__H2S_FB_INIT__){clearInterval(timer);try{const params=buildAdvancedParams(),eventData={...data};fbq("track",event,eventData,params)}catch(e){console.warn(" [Meta Pixel] delayed send failed:",e)}}else++tries>=maxTries&&(clearInterval(timer),console.warn(" [Meta Pixel] fbq not loaded; skipping send:",event))},150)}}(),function sendToBackend(attempt=1){if(window.h2sSendBackend&&"function"==typeof window.h2sSendBackend){const event_type=event.toLowerCase().replace(/([A-Z])/g,"_$1").replace(/^_/,""),trackingData={...data,user_email:user?.email||"",timestamp:(new Date).toISOString()};try{const result=window.h2sSendBackend(event_type,trackingData);result&&"function"==typeof result.catch&&result.catch(()=>{})}catch(err){}}else attempt<=5&&setTimeout(()=>sendToBackend(attempt+1),100*attempt)}()}async function sha256(text){if(!crypto||!crypto.subtle)return"";try{const data=(new TextEncoder).encode(text),hashBuffer=await crypto.subtle.digest("SHA-256",data);return Array.from(new Uint8Array(hashBuffer)).map(b=>b.toString(16).padStart(2,"0")).join("")}catch(_){return""}}function buildAdvancedParams(){const params={};if(user&&user.email){if(sha256(user.email.trim().toLowerCase()).then(h=>{h&&(params.em=h)}),user.phone){sha256(user.phone.replace(/\D/g,"")).then(h=>{h&&(params.ph=h)})}if(user.name){const parts=user.name.trim().toLowerCase().split(" ");parts[0]&&sha256(parts[0]).then(h=>{h&&(params.fn=h)}),parts[parts.length-1]&&sha256(parts[parts.length-1]).then(h=>{h&&(params.ln=h)})}}return params}async function init(){const checkoutBtn=byId("checkoutBtn");checkoutBtn?checkoutBtn.hasAttribute("data-listener-attached")?logger.log("[Init] Checkout button listener already attached"):(checkoutBtn.setAttribute("data-listener-attached","true"),checkoutBtn.addEventListener("click",function(e){logger.log("[Checkout] Button clicked"),e.preventDefault(),e.stopPropagation();try{checkout()}catch(err){logger.error("[Checkout] Critical error:",err);try{showCheckoutModal()}catch(err2){logger.error("[Checkout] Fallback failed:",err2),alert("Unable to open checkout. Please refresh the page or call (864) 528-1475 to complete your order.")}}},{passive:!1}),logger.log("[Init] Checkout button event listener attached")):logger.error("[Init] Checkout button not found!"),function(){function trackPhoneClick(link){h2sTrack("PhoneClick",{phone:link.href.replace("tel:","").trim(),click_location:link.closest("nav")?"menu":link.closest("#cartDrawer")?"cart":link.closest("#quoteModal")?"quote":link.closest("header")?"header":link.closest("footer")?"footer":"unknown",page_url:window.location.href,page_path:window.location.pathname})}if(document.querySelectorAll('a[href^="tel:"]').forEach(link=>{link.addEventListener("click",function(e){trackPhoneClick(link)},{once:!1})}),window.MutationObserver){new MutationObserver(function(mutations){mutations.forEach(function(mutation){mutation.addedNodes.forEach(function(node){1===node.nodeType&&("A"===node.tagName&&node.href&&node.href.startsWith("tel:")&&node.addEventListener("click",function(e){trackPhoneClick(node)}),node.querySelectorAll&&node.querySelectorAll('a[href^="tel:"]').forEach(function(link){link.addEventListener("click",function(e){trackPhoneClick(link)})}))})})}).observe(document.body,{childList:!0,subtree:!0})}}();try{performance.mark("phase1-start"),document.body.classList.add("app-ready");const outlet=byId("outlet");outlet&&outlet.querySelector(".hero")&&(window.shopHTML=outlet.innerHTML),performance.mark("phase1-end"),performance.measure("Phase 1: Critical Setup","phase1-start","phase1-end"),requestAnimationFrame(()=>{wireCart(),"requestIdleCallback"in window?requestIdleCallback(()=>updateCartBadge(),{timeout:1e3}):setTimeout(()=>updateCartBadge(),250)});const view=getParam("view"),isSpecialView=view&&"shop"!==view;route(),bundlesFetchPromise.then(data=>{if(data){if(data.catalog&&(catalog=data.catalog,isSpecialView&&route()),data.reviews&&(allReviews=data.reviews,reviewsLoadedFromAPI=!0,heroReviews=allReviews.slice(0,5).map(r=>({text:r.text&&r.text.trim()?r.text.trim():"",author:r.name||"Customer",stars:r.rating||5})).filter(r=>r.text.length>0),!isSpecialView)){try{initHeroReviews()}catch(e){logger.warn("initHeroReviews error",e)}"requestIdleCallback"in window?requestIdleCallback(()=>{try{renderReviews()}catch(e){logger.warn("renderReviews error",e)}},{timeout:2e3}):setTimeout(()=>{try{renderReviews()}catch(e){logger.warn("renderReviews error",e)}},1500)}}else if(logger.warn("[Bundles] Aggregated data missing, using fallback"),IS_LOCAL)try{initHeroReviews()}catch(e){logger.warn("initHeroReviews error",e)}else{fetch(API+"?action=catalog").then(r=>r.json()).then(d=>{d.ok&&(catalog=d.catalog||catalog)});try{initHeroReviews()}catch(e){logger.warn("initHeroReviews error",e)}}});const urlCart=getParam("cart");if(urlCart){const decoded=decodeCartFromUrl(urlCart);decoded.length&&(cart=decoded,saveCart(),updateCartBadge(),paintCart())}const url=new URL(location.href);url.searchParams.has("cart")&&(url.searchParams.delete("cart"),history.replaceState({},"",url.toString())),"tracking"===url.searchParams.get("debug")&&setTimeout(()=>showTrackingDebugPanel(),1e3),window.__H2S_ENABLE_AI_RECS&&user&&user.email&&requestIdleCallback(()=>loadAIRecommendations(),{timeout:3e3}),"requestIdleCallback"in window&&requestIdleCallback(()=>{},{timeout:8e3}),function(){const run=()=>{try{const srcs=Array.from(document.scripts).filter(s=>"string"==typeof s.src&&-1!==s.src.indexOf("connect.facebook.net")&&-1!==s.src.indexOf("fbevents.js")).map(s=>s.src);srcs.length>1&&console.warn("[Meta Pixel] Multiple fbevents.js scripts detected:",srcs)}catch(_){}};"requestIdleCallback"in window?requestIdleCallback(run,{timeout:4e3}):setTimeout(run,4e3)}(),"requestIdleCallback"in window?requestIdleCallback(()=>h2sTrack("PageView"),{timeout:4e3}):setTimeout(()=>h2sTrack("PageView"),2500),performance.mark("init-end"),performance.measure("Total Init Time","init-start","init-end")}catch(err){document.body.classList.add("app-ready")}window.innerWidth<=768&&setupMobileInputHandling()}function setupMobileInputHandling(){document.querySelectorAll("input, textarea, select").forEach(input=>{input.addEventListener("focus",function(e){setTimeout(()=>{e.target.scrollIntoView({behavior:"smooth",block:"center"})},300)},{passive:!0}),input.addEventListener("blur",function(){setTimeout(()=>{window.scrollTo({top:window.scrollY,behavior:"smooth"})},100)},{passive:!0})});let lastTouchEnd=0;document.addEventListener("touchend",function(e){const now=Date.now();now-lastTouchEnd<=300&&(["INPUT","TEXTAREA","SELECT"].includes(e.target.tagName)||e.preventDefault()),lastTouchEnd=now},{passive:!1}),logger.log("[Mobile] Input handling initialized")}if("loading"===document.readyState)document.addEventListener("DOMContentLoaded",()=>{try{init()}catch(e){logger.error("[Init] Failed:",e)}});else try{init()}catch(e){logger.error("[Init] Failed:",e)}async function fetchCatalogFromAPI(cacheBust=!1){try{const url=API+"?action=catalog"+(cacheBust?"&cb="+Date.now():""),res=await fetch(url,{cache:"no-store"});if(!res.ok)return logger.warn("[Catalog] HTTP",res.status),!1;const data=await res.json();return data&&data.ok&&data.catalog?(catalog=data.catalog,!0):(logger.warn("[Catalog] Unexpected response while fetching catalog",data),!1)}catch(err){return logger.warn("[Catalog] Fetch failed:",err),!1}}function route(){const view=getParam("view");if(logger.log("[ROUTE] View parameter:",view),"shopsuccess"===view){H2S_unlockScroll();const outlet=byId("outlet");outlet&&(outlet.style.opacity="0",outlet.style.visibility="hidden"),logger.log("[ROUTE] Calling renderShopSuccess()...");try{renderShopSuccess()}catch(err){logger.error("[ROUTE] renderShopSuccess failed critically:",err),outlet&&(outlet.innerHTML='\n          <div style="padding:60px 20px; text-align:center; max-width:600px; margin:0 auto;">\n            <div style="width:64px; height:64px; background:#10b981; border-radius:50%; display:flex; align-items:center; justify-content:center; margin:0 auto 24px;">\n              <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#ffffff" stroke-width="3">\n                <polyline points="20 6 9 17 4 12"></polyline>\n              </svg>\n            </div>\n            <h2 style="margin:0 0 16px 0; font-weight:900; font-size:28px; color:#0a2a5a;">Order Confirmed!</h2>\n            <p style="margin:0 0 24px 0; color:#6b778c; font-size:16px;">Your payment was successful. We\'ll send confirmation details to your email shortly.</p>\n            <p style="margin:0 0 24px 0; color:#6b778c; font-size:16px;">Our team will contact you within 24 hours to schedule your installation.</p>\n            <a href="tel:864-528-1475" style="display:inline-block; padding:14px 28px; background:#1493ff; color:white; border-radius:10px; text-decoration:none; font-weight:700; font-size:16px;">Call Us: (864) 528-1475</a>\n            <div style="margin-top:24px;">\n              <button onclick="navSet({view:null})" class="btn btn-ghost">Back to Shop</button>\n            </div>\n          </div>\n        ',outlet.style.opacity="1",outlet.style.visibility="visible")}return}if(closeAll(),"signin"===view)return void renderSignIn();if("signup"===view)return void renderSignUp();if("account"===view)return void renderAccount();if("forgot"===view)return void renderForgot();if("reset"===view)return void renderReset(getParam("token"));if("calreturn"===view||"apptreturn"===view)return void handleCalReturn();const outlet=byId("outlet");if(!outlet)return;if(outlet.querySelector(".hero")){outlet.style.opacity="1",outlet.style.transition="",document.body.classList.add("app-ready");const heroReviewsEl=document.getElementById("heroReviews");heroReviewsEl&&heroReviewsEl.querySelector(".hero-review-slide")}else renderShop()}function renderShop(){const outlet=byId("outlet");if(!outlet)return;if(outlet.querySelector(".hero"))return;const isFirstRender=!window.__shopRenderedOnce;let html=window.shopHTML||"";if(!html)return logger.warn("[Shop] Static HTML missing, reloading..."),void location.reload();if(isFirstRender){outlet.style.opacity="",outlet.style.transition="",outlet.innerHTML=html,document.body.classList.add("app-ready");try{initHeroReviews()}catch(e){logger.warn("initHeroReviews error",e)}window.scrollTo(0,0),window.__shopRenderedOnce=!0,renderSigninState()}else outlet.style.opacity="0",outlet.style.transition="opacity 0.3s ease",setTimeout(()=>{outlet.innerHTML=html,requestAnimationFrame(()=>{outlet.style.opacity="1",document.body.classList.add("app-ready")});try{initHeroReviews()}catch(e){logger.warn("initHeroReviews error",e)}renderSigninState(),window.scrollTo(0,0),window.__shopRenderedOnce=!0},300)}function navSet(params){const u=new URL(location.href);Object.entries(params||{}).forEach(([k,v])=>{null==v?u.searchParams.delete(k):u.searchParams.set(k,v)}),history.pushState({},"",u.toString()),route()}function getParam(k){return new URL(location.href).searchParams.get(k)}function wireCart(){const acctBtn=byId("accountBtn");acctBtn&&(acctBtn.onclick=()=>{closeAll(),user&&user.email?navSet({view:"account"}):navSet({view:"signin"})});const bsi=byId("bannerSignIn");bsi&&(bsi.onclick=()=>{closeAll(),navSet({view:user?.email?"account":"signin"})})}function renderSigninState(){const btn=byId("accountBtn");btn&&(user&&user.email?btn.textContent="Account":btn.textContent="Sign in")}function scrollToSection(id){const el=document.getElementById(id);if(el){const headerHeight=56,offsetPosition=el.getBoundingClientRect().top+window.pageYOffset-headerHeight-16;window.scrollTo({top:offsetPosition,behavior:"smooth"})}}function toggleMenu(){const menu=document.getElementById("menuDrawer"),backdrop=document.getElementById("backdrop");if(!menu||!backdrop)return;menu.classList.contains("open")||(menu.style.contentVisibility="visible");menu.classList.contains("open")?(menu.classList.remove("open"),backdrop.classList.remove("show"),document.documentElement.classList.remove("modal-open"),document.body.classList.remove("modal-open"),H2S_unlockScroll(),setTimeout(()=>{menu.classList.contains("open")||(menu.style.contentVisibility="hidden")},300)):(closeAll(),menu.classList.add("open"),backdrop.classList.add("show"),document.documentElement.classList.add("modal-open"),document.body.classList.add("modal-open"))}function toggleCart(){logger.log("[Cart] toggleCart() called");const drawer=document.getElementById("cartDrawer"),backdrop=document.getElementById("backdrop");drawer.classList.contains("open")||(drawer.style.contentVisibility="visible");drawer.classList.contains("open")?(drawer.classList.remove("open"),backdrop.classList.remove("show"),document.documentElement.classList.remove("modal-open"),document.body.classList.remove("modal-open"),H2S_unlockScroll(),setTimeout(()=>{drawer.classList.contains("open")||(drawer.style.contentVisibility="hidden")},300)):(closeAll(),drawer.classList.add("open"),backdrop.classList.add("show"),document.documentElement.classList.add("modal-open"),document.body.classList.add("modal-open"),H2S_lockScroll(),paintCart(),requestAnimationFrame(()=>{const cartBody=drawer.querySelector(".cart-body");cartBody&&(cartBody.scrollTop=0,cartBody.style.webkitOverflowScrolling="touch",cartBody.style.overflowY="auto")}))}function closeAll(){const menu=document.getElementById("menuDrawer"),cart=document.getElementById("cartDrawer");menu.classList.remove("open"),cart.classList.remove("open"),document.getElementById("backdrop").classList.remove("show"),H2S_unlockScroll(),setTimeout(()=>{menu.classList.contains("open")||(menu.style.contentVisibility="hidden"),cart.classList.contains("open")||(cart.style.contentVisibility="hidden")},300),closeModal(),safeCloseQuoteModal(),"function"==typeof closeTVSizeModal&&closeTVSizeModal(),document.documentElement.classList.remove("modal-open"),document.body.classList.remove("modal-open")}function showModal(){closeAll();byId("modal").classList.add("show"),document.documentElement.classList.add("modal-open"),document.body.classList.add("modal-open")}function closeModal(){const m=byId("modal"),backdrop=byId("backdrop");m.classList.remove("show"),backdrop&&backdrop.classList.remove("show"),byId("menuDrawer")?.classList.contains("open")||byId("cartDrawer")?.classList.contains("open")||(document.documentElement.classList.remove("modal-open"),document.body.classList.remove("modal-open"),H2S_unlockScroll())}function safeRequestQuote(p){"function"==typeof window.requestQuote&&window.requestQuote(p)}function safeCloseQuoteModal(){"function"==typeof window.closeQuoteModal&&window.closeQuoteModal()}document.addEventListener("DOMContentLoaded",function(){setTimeout(function(){try{window.h2sFbTrack&&window.h2sFbTrack("ViewContent",{content_name:"Bundles Page",content_category:"product_catalog"})}catch(err){logger.warn("[Pixel] ViewContent failed",err)}},800)}),window.scrollToSection=scrollToSection,window.toggleMenu=toggleMenu,window.toggleCart=toggleCart;let currentPackage=null;function addPackageDirectToCart(id,name,price,metadata={}){const numPrice=Number(price),existing=cart.find(item=>"package"===item.type&&item.id===id);if(existing)existing.qty++,Object.keys(metadata).length>0&&(existing.metadata={...existing.metadata,...metadata});else{const newItem={type:"package",id:id,name:name,price:numPrice,qty:1,metadata:metadata};cart.push(newItem)}h2sTrack("AddToCart",{product_id:id,product_name:name,quantity:1,price:numPrice,currency:"USD",...metadata}),saveCart();const drawer=byId("cartDrawer");logger.log("[Cart] Opening cart drawer. Currently open:",drawer?.classList.contains("open")),drawer&&!drawer.classList.contains("open")?(toggleCart(),logger.log("[Cart] Cart drawer toggled open")):logger.log("[Cart] Cart drawer already open")}function showTVSizeModal(packageId,packageName,packagePrice){let tvCountOptions=[],autoSelectCount=null,quantityLabel="How many TVs are you mounting?";"tv_single"===packageId?autoSelectCount=1:"tv_2pack"===packageId?autoSelectCount=2:"tv_multi"===packageId?(tvCountOptions=[3,4],quantityLabel="How many TVs? (Multi-room: 3-4 TVs)"):(tvCountOptions=[1,2,3,4,5,6,7,8,9,10],quantityLabel="How many TVs are you mounting?");let modal=byId("tvSizeModal");modal&&modal.remove(),modal=document.createElement("div"),modal.id="tvSizeModal",modal.className="modal";const quantitySelectorHTML=autoSelectCount?"":`\n    \x3c!-- Number of TVs --\x3e\n    <div id="tvQuantitySelector" style="margin-bottom:24px;">\n      <label style="display:block;font-weight:700;margin-bottom:12px;color:var(--cobalt);font-size:15px;">\n        ${quantityLabel}\n      </label>\n      <div style="display:flex;gap:8px;flex-wrap:wrap;">\n        ${tvCountOptions.map(num=>`\n          <button type="button" class="tv-count-btn" data-count="${num}" onclick="setTVCount(${num})" style="\n            flex:${tvCountOptions.length<=4?"1":"0 0 calc(25% - 6px)"};\n            min-width:60px;\n            padding:12px;\n            border:2px solid #e5e7eb;\n            border-radius:8px;\n            background:#f9fafb;\n            font-weight:700;\n            font-size:16px;\n            cursor:pointer;\n            transition:all 0.2s;\n          ">${num} TV${num>1?"s":""}</button>\n        `).join("")}\n      </div>\n    </div>\n  `;if(modal.innerHTML=`\n    <div class="modal-content" style="max-width: 600px;">\n      <div class="modal-header">\n        <h3 style="margin:0;font-size:20px;font-weight:800;">Configure Your TV Installation</h3>\n        <button class="close-btn" onclick="closeTVSizeModal()" aria-label="Close">&times;</button>\n      </div>\n      <div class="modal-body" style="padding: 32px 24px;">\n        \n        \x3c!-- STEP 1: Mount Provider Selection --\x3e\n        <div id="mountProviderSection" style="margin-bottom:24px;">\n          <label style="display:block;font-weight:700;margin-bottom:12px;color:var(--cobalt);font-size:15px;">\n            Do you already have TV mounts?\n          </label>\n          <div style="display:flex;gap:12px;margin-bottom:12px;">\n            <button type="button" class="mount-provider-btn" data-provider="h2s" onclick="selectMountProvider('h2s')" style="\n              flex:1;\n              padding:16px;\n              border:2px solid #e5e7eb;\n              border-radius:8px;\n              background:#f9fafb;\n              font-weight:600;\n              font-size:15px;\n              cursor:pointer;\n              transition:all 0.2s;\n              text-align:left;\n            ">\n              <div style="font-weight:700;margin-bottom:4px;">We'll Provide Mounts</div>\n              <div style="font-size:12px;color:#6b7280;">Professional-grade mounts included</div>\n            </button>\n            <button type="button" class="mount-provider-btn" data-provider="customer" onclick="selectMountProvider('customer')" style="\n              flex:1;\n              padding:16px;\n              border:2px solid #e5e7eb;\n              border-radius:8px;\n              background:#f9fafb;\n              font-weight:600;\n              font-size:15px;\n              cursor:pointer;\n              transition:all 0.2s;\n              text-align:left;\n            ">\n              <div style="font-weight:700;margin-bottom:4px;">I Have Mounts</div>\n              <div style="font-size:12px;color:#6b7280;">Save on mount costs</div>\n            </button>\n          </div>\n          <div style="padding:10px;background:#fef3c7;border-left:3px solid #f59e0b;border-radius:4px;font-size:12px;color:#92400e;">\n            <strong>Important:</strong> Customer-provided mounts must be compatible with your TV size and wall type. We recommend professional-grade mounts for safety.\n          </div>\n        </div>\n        \n        \x3c!-- Mount Type Guide (shown only if H2S provides) --\x3e\n        <div id="mountGuideSection" style="display:none;margin:0 0 16px 0;">\n          <button type="button" onclick="toggleMountGuide()" style="\n            width:100%;\n            padding:12px;\n            background:#f0f9ff;\n            border:1px solid #bfdbfe;\n            border-radius:8px;\n            font-size:13px;\n            font-weight:600;\n            color:#1e40af;\n            cursor:pointer;\n            text-align:left;\n            display:flex;\n            align-items:center;\n            justify-content:space-between;\n            transition:all 0.2s;\n          ">\n            <span>Mount Selection Guide</span>\n            <span id="guideToggleIcon" style="transition:transform 0.2s;"></span>\n          </button>\n          <div id="mountGuideContent" style="display:none;padding:12px 0 0 0;color:#4b5563;font-size:13px;line-height:1.6;">\n            <ul style="margin:0;padding-left:20px;">\n              <li style="margin-bottom:6px;"><strong>Fixed/Flat:</strong> Bedrooms, kids' rooms - sleek, low-profile</li>\n              <li style="margin-bottom:6px;"><strong>Tilt:</strong> Above eye level - reduces glare, neck strain</li>\n              <li style="margin-bottom:6px;"><strong>Full Motion:</strong> Living rooms, open spaces - adjust viewing angle from anywhere</li>\n            </ul>\n          </div>\n        </div>\n        \n        ${quantitySelectorHTML}\n        \n        \x3c!-- TV Configurations Container --\x3e\n        <div id="tvConfigsContainer" style="display:none;">\n          \x3c!-- Dynamically populated --\x3e\n        </div>\n      </div>\n      \n      <div class="modal-footer">\n        <button class="btn btn-primary" id="confirmTVSizeBtn" onclick="confirmTVSize()" disabled style="\n          width:100%;\n          font-size:16px;\n          padding:16px;\n          font-weight:700;\n          background:linear-gradient(135deg, var(--cobalt) 0%, #1e40af 100%);\n          border:none;\n          border-radius:12px;\n          box-shadow:0 4px 12px rgba(37, 99, 235, 0.25);\n          transition:all 0.2s ease;\n        ">\n          <span id="confirmBtnText">Add to Cart</span>\n        </button>\n      </div>\n    </div>\n  `,document.body.appendChild(modal),!document.getElementById("tvModalStyles")){const style=document.createElement("style");style.id="tvModalStyles",style.textContent="\n      .tv-count-btn.active {\n        background: var(--cobalt) !important;\n        color: white !important;\n        border-color: var(--cobalt) !important;\n      }\n      .tv-count-btn:hover {\n        border-color: var(--cobalt);\n        background: #f3f4f6;\n      }\n      .mount-provider-btn.active {\n        background: var(--cobalt) !important;\n        color: white !important;\n        border-color: var(--cobalt) !important;\n      }\n      .mount-provider-btn:hover {\n        border-color: var(--cobalt);\n        background: #f3f4f6;\n      }\n      .tv-config-card {\n        background: #f9fafb;\n        border: 2px solid #e5e7eb;\n        border-radius: 12px;\n        padding: 20px;\n        margin-bottom: 16px;\n      }\n      .tv-config-card select {\n        width: 100%;\n        font-size: 14px;\n        padding: 12px 14px;\n        border: 2px solid #e5e7eb;\n        border-radius: 8px;\n        background: white;\n        cursor: pointer;\n        transition: all 0.2s ease;\n        appearance: none;\n        background-image: url('data:image/svg+xml;charset=UTF-8,%3csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 24 24%22 fill=%22none%22 stroke=%22%234b5563%22 stroke-width=%222%22 stroke-linecap=%22round%22 stroke-linejoin=%22round%22%3e%3cpolyline points=%226 9 12 15 18 9%22%3e%3c/polyline%3e%3c/svg%3e');\n        background-repeat: no-repeat;\n        background-position: right 12px center;\n        background-size: 18px;\n        padding-right: 40px;\n      }\n      .tv-config-card select:hover {\n        border-color: var(--cobalt);\n      }\n      .tv-config-card select:focus {\n        outline: none;\n        border-color: var(--cobalt);\n        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);\n      }\n      .mount-price-badge {\n        display: inline-block;\n        background: #22c96f;\n        color: white;\n        padding: 4px 12px;\n        border-radius: 6px;\n        font-size: 12px;\n        font-weight: 700;\n        margin-left: 8px;\n      }\n      #confirmTVSizeBtn:hover:not(:disabled) {\n        transform: translateY(-2px);\n        box-shadow: 0 6px 16px rgba(37, 99, 235, 0.35);\n      }\n      #confirmTVSizeBtn:active:not(:disabled) {\n        transform: translateY(0);\n      }\n      #confirmTVSizeBtn:disabled {\n        opacity: 0.5;\n        cursor: not-allowed;\n      }\n    ",document.head.appendChild(style)}modal.dataset.packageId=packageId,modal.dataset.packageName=packageName,modal.dataset.packagePrice=packagePrice,modal.dataset.autoSelectCount=autoSelectCount||"",modal.tvConfigs=[],modal.tvCount=0,modal.mountProvider=null,modal.classList.add("show");const scrollY=window.scrollY;document.documentElement.classList.add("modal-open"),document.body.classList.add("modal-open"),document.body.style.top=`-${scrollY}px`,modal._savedScrollY=scrollY;const quantitySelector=byId("tvQuantitySelector"),configContainer=byId("tvConfigsContainer");if(quantitySelector&&!autoSelectCount&&(quantitySelector.style.display="none"),configContainer&&(configContainer.style.display="none"),setTimeout(()=>checkModalScroll(),100),"visualViewport"in window){const adjustModalForKeyboard=()=>{const modalContent=modal.querySelector(".modal-content");if(modalContent){const viewportHeight=window.visualViewport.height;modalContent.style.maxHeight=.85*viewportHeight+"px"}};window.visualViewport.addEventListener("resize",adjustModalForKeyboard),modal._keyboardHandler=adjustModalForKeyboard}const escHandler=e=>{"Escape"===e.key&&(closeTVSizeModal(),document.removeEventListener("keydown",escHandler))};document.addEventListener("keydown",escHandler);const backdropClickHandler=e=>{"backdrop"===e.target.id&&(closeTVSizeModal(),byId("backdrop").removeEventListener("click",backdropClickHandler))};byId("backdrop").addEventListener("click",backdropClickHandler)}window.selectPackage=function(id,name,price){id.includes("tv_")||name.toLowerCase().includes("tv")?showTVSizeModal(id,name,price):addPackageDirectToCart(id,name,price)},window.selectPackage=selectPackage;const MOUNT_PRICING={fixed:0,tilt:25,full_motion:75};function validateTVConfigs(){const modal=byId("tvSizeModal"),confirmBtn=byId("confirmTVSizeBtn"),btnText=byId("confirmBtnText");if(!modal.tvConfigs||0===modal.tvConfigs.length)return confirmBtn.disabled=!0,void(btnText.textContent="Add to Cart");const mountProvider=modal.mountProvider;if(!mountProvider)return confirmBtn.disabled=!0,void(btnText.textContent="Select Mount Provider First");const allConfigured=modal.tvConfigs.every(config=>{const sizeValid=config.size&&""!==config.size,mountValid="customer"===mountProvider||config.mountType&&""!==config.mountType;return sizeValid&&mountValid});if(confirmBtn.disabled=!allConfigured,allConfigured){const packageId=modal.dataset.packageId;let basePrice=parseFloat(modal.dataset.packagePrice);"tv_multi"===packageId&&(3===modal.tvConfigs.length?basePrice=699:4===modal.tvConfigs.length&&(basePrice=899));const totalPrice=basePrice+("h2s"===mountProvider?modal.tvConfigs.reduce((sum,config)=>sum+(MOUNT_PRICING[config.mountType]||0),0):0);btnText.textContent=`Add to Cart - $${totalPrice}`}else btnText.textContent="Add to Cart"}function closeTVSizeModal(){const modal=byId("tvSizeModal");if(modal){modal.classList.remove("show"),modal._keyboardHandler&&"visualViewport"in window&&window.visualViewport.removeEventListener("resize",modal._keyboardHandler);const scrollY=modal._savedScrollY||0;document.documentElement.classList.remove("modal-open"),document.body.classList.remove("modal-open"),document.body.style.top="",window.scrollTo(0,scrollY)}}function confirmTVSize(){const modal=byId("tvSizeModal"),packageId=modal.dataset.packageId,packageName=modal.dataset.packageName;let basePrice=parseFloat(modal.dataset.packagePrice);const tvConfigs=modal.tvConfigs,mountProvider=modal.mountProvider;if(!mountProvider)return void alert("Please select whether you have mounts or need us to provide them");if(!tvConfigs||0===tvConfigs.length)return void alert("Please select number of TVs");if(!tvConfigs.every(c=>{const sizeValid=c.size&&""!==c.size,mountValid="customer"===mountProvider||c.mountType&&""!==c.mountType;return sizeValid&&mountValid}))return void alert("Please configure all TVs (size"+("h2s"===mountProvider?" and mount type":"")+")");"tv_multi"===packageId&&(3===tvConfigs.length?basePrice=699:4===tvConfigs.length&&(basePrice=899));const mountUpcharges="h2s"===mountProvider?tvConfigs.reduce((sum,config)=>sum+(MOUNT_PRICING[config.mountType]||0),0):0,totalPrice=basePrice+mountUpcharges,items=tvConfigs.map((config,idx)=>{let requiresTeam=!1,teamRecommended=!1,teamReason="";"75-85"===config.size||"86+"===config.size?(requiresTeam=!0,teamReason=`Large TV (${config.size}) - safety requirement`):"65-74"===config.size&&(teamRecommended=!0,teamReason=`Heavy TV (${config.size}) - team recommended`);const perTVBase=basePrice/tvConfigs.length,mountUpcharge="h2s"===mountProvider&&MOUNT_PRICING[config.mountType]||0,itemPrice=perTVBase+mountUpcharge;return{bundle_id:packageId,service_name:packageName,qty:1,unit_price:itemPrice,line_total:itemPrice,metadata:{tv_size:config.size,mount_type:config.mountType||"customer_provided",mount_provider:mountProvider,mount_upcharge:mountUpcharge,mounts_needed:"h2s"===mountProvider?1:0,requires_team:requiresTeam,team_recommended:teamRecommended,team_reason:teamReason,min_team_size:requiresTeam?2:1,tv_number:idx+1,total_tvs:tvConfigs.length}}}),metadata={tv_count:tvConfigs.length,mount_provider:mountProvider,items_json:items,total_mount_upcharges:mountUpcharges,original_price:basePrice,final_price:totalPrice};logger.log("[TV Modal] Confirming",tvConfigs.length,"TVs with mount provider:",mountProvider),logger.log("[TV Modal] Configs:",tvConfigs),logger.log("[TV Modal] Metadata:",metadata),logger.log("[TV Modal] Items:",items),closeTVSizeModal(),setTimeout(()=>{addPackageDirectToCart(packageId,packageName,totalPrice,metadata)},100)}function addPackageToCart(){if(!currentPackage)return;const curKey=currentPackage.id||currentPackage.bundle_id,existing=cart.find(item=>{const itemKey=item.id||item.bundle_id;return"package"===item.type&&itemKey===curKey});if(existing)existing.qty++;else{const normalized={...currentPackage};!normalized.id&&normalized.bundle_id&&(normalized.id=normalized.bundle_id),!normalized.stripe_price_id&&currentPackage.stripe_price_id&&(normalized.stripe_price_id=currentPackage.stripe_price_id),cart.push({type:"package",...normalized,qty:1})}h2sTrack("AddToCart",{product_id:currentPackage.id,product_name:currentPackage.name,quantity:1,price:currentPackage.price,currency:"USD"}),saveCart(),closeModal(),toggleCart()}function saveCart(){logger.log("[Cart] Saving cart with",cart.length,"items:",cart);try{localStorage.setItem("h2s_cart",JSON.stringify(cart)),logger.log("[Cart] Successfully saved to localStorage")}catch(err){logger.warn("Failed to save cart to localStorage (may be in private mode):",err)}updateCartBadge(),paintCart(),syncCartToUrl()}function loadCart(){try{const raw=localStorage.getItem("h2s_cart");if(logger.log("[Cart] Raw localStorage data:",raw),!raw)return[];const loaded=JSON.parse(raw);if(logger.log("[Cart] Parsed cart data:",loaded),!Array.isArray(loaded))return logger.warn("[Cart] Cart data is not an array, returning empty"),[];const cleaned=loaded.filter(item=>{const hasValidQty=Number(item.qty||0)>0,hasId=!!(item.id||item.service_id||item.bundle_id);return!(!hasValidQty||!hasId)||(logger.warn("[Cart] Removing invalid item on load (bad qty or missing id):",item),!1)});return cleaned.length!==loaded.length&&localStorage.setItem("h2s_cart",JSON.stringify(cleaned)),cleaned}catch(_){return[]}}function updateQuantity(idx,delta){if(!cart[idx])return;const newQty=(Number(cart[idx].qty)||1)+delta;newQty<=0?cart.splice(idx,1):cart[idx].qty=newQty,saveCart()}let heroReviewInterval;window.selectMountProvider=function(provider){const modal=byId("tvSizeModal");modal.mountProvider=provider,document.querySelectorAll(".mount-provider-btn").forEach(btn=>{btn.classList.toggle("active",btn.dataset.provider===provider)});const mountGuide=byId("mountGuideSection"),quantitySelector=byId("tvQuantitySelector");"h2s"===provider?mountGuide&&(mountGuide.style.display="block"):mountGuide&&(mountGuide.style.display="none");const autoSelectCount=modal.dataset.autoSelectCount;autoSelectCount?setTimeout(()=>setTVCount(parseInt(autoSelectCount)),100):quantitySelector&&(quantitySelector.style.display="block")},window.setTVCount=function(count){const modal=byId("tvSizeModal");modal.tvCount=count;const mountProvider=modal.mountProvider;if(!mountProvider)return void logger.error("[TV Modal] setTVCount called before mount provider selected");modal.tvConfigs=Array(count).fill(null).map(()=>({size:"",mountType:"h2s"===mountProvider?"":"customer_provided"})),document.querySelectorAll(".tv-count-btn").forEach(btn=>{btn.classList.toggle("active",parseInt(btn.dataset.count)===count)});const container=byId("tvConfigsContainer");container.style.display="block";const tvCards=[];for(let idx=0;idx<count;idx++){const mountSection="h2s"===mountProvider?`<div>\n        <label style="display:block; font-weight:600; margin-bottom:8px; font-size:13px; color:#374151;">\n          Mount Type <span style="font-weight:400; color:#6b7280;">(Choose based on room usage)</span>\n        </label>\n        <select id="tvMount_${idx}" onchange="updateTVConfig(${idx}, 'mountType', this.value)">\n          <option value="">Select mount type...</option>\n          <option value="fixed">Fixed/Flat - Flush against wall (Bedrooms, kids' rooms)</option>\n          <option value="tilt">Tilt +$25 - Angle down to reduce glare (Above eye level)</option>\n          <option value="full_motion">Full Motion +$75 - Swivel & extend (Living room, open concept)</option>\n        </select>\n        <div style="margin-top:8px; padding:10px; background:#f0f9ff; border-left:3px solid var(--azure); border-radius:4px; font-size:12px; color:#1e40af;">\n          <strong>Tip:</strong> Full motion mounts are perfect when you need to adjust viewing angles from different seating areas. Fixed/flat mounts work great for bedrooms where the TV faces one direction.\n        </div>\n      </div>`:'<div style="padding:12px; background:#d1fae5; border-left:3px solid #10b981; border-radius:4px; font-size:13px; color:#065f46;">\n        <strong>Customer Providing Mount</strong> - Please ensure your mount is compatible with this TV size and rated for your wall type.\n      </div>';tvCards.push(`\n      <div class="tv-config-card">\n        <div style="font-weight:700; font-size:15px; color:var(--cobalt); margin-bottom:16px; display:flex; align-items:center; gap:8px;">\n          <span>TV #${idx+1}</span>\n          <span style="font-weight:400; color:#6b7280; font-size:13px;">(Which room is this TV in?)</span>\n        </div>\n        \n        <div style="margin-bottom:${"h2s"===mountProvider?"12px":"0"};">\n          <label style="display:block; font-weight:600; margin-bottom:8px; font-size:13px; color:#374151;">\n            Screen Size\n          </label>\n          <select id="tvSize_${idx}" onchange="updateTVConfig(${idx}, 'size', this.value)">\n            <option value="">Select size...</option>\n            <option value="32-43">32" - 43"</option>\n            <option value="44-54">44" - 54"</option>\n            <option value="55-64">55" - 64"</option>\n            <option value="65-74">65" - 74"</option>\n            <option value="75-85">75" - 85"</option>\n            <option value="86+">86" and larger</option>\n          </select>\n        </div>\n        \n        ${mountSection}\n      </div>\n    `)}container.innerHTML=`\n    <div style="margin-top:24px; margin-bottom:24px;">\n      ${tvCards.join("")}\n    </div>\n  `,validateTVConfigs(),setTimeout(()=>checkModalScroll(),50)},window.updateTVConfig=function(index,field,value){byId("tvSizeModal").tvConfigs[index][field]=value,validateTVConfigs()},window.toggleMountGuide=function(){const content=byId("mountGuideContent"),icon=byId("guideToggleIcon");if(content&&icon){const isHidden="none"===content.style.display;content.style.display=isHidden?"block":"none",icon.style.transform=isHidden?"rotate(180deg)":"rotate(0deg)"}},window.checkModalScroll=function(){const modalBody=document.querySelector("#tvSizeModal .modal-body");if(modalBody){const hasScroll=modalBody.scrollHeight>modalBody.clientHeight;modalBody.classList.toggle("has-scroll",hasScroll)}};let resizeTimeout,currentHeroReviewIndex=0;async function loadHeroReviews(){try{const reviewsUrl=API.replace("/shop","/reviews")+"?limit=5&onlyVerified=true",res=await fetch(reviewsUrl,{cache:"default"}),data=await res.json();if(data.ok&&data.reviews&&data.reviews.length>0){const newReviews=data.reviews.slice(0,5).map(r=>({text:r.text&&r.text.trim()?r.text.trim():"",author:r.name||"Customer",stars:r.rating||5})).filter(r=>r.text.length>0);newReviews.length>0&&(heroReviews=newReviews,renderHeroReviews())}}catch(err){}}function renderHeroReviews(){const container=byId("heroReviews");if(!container||0===heroReviews.length)return;const reviewsHTML=heroReviews.map((review,index)=>{const hasText=review.text&&review.text.trim().length>0;return`\n    <div class="hero-review-slide ${index===currentHeroReviewIndex?"active":""}" data-index="${index}">\n      <div class="hero-review-stars">${"&#9733;".repeat(review.stars)}</div>\n      ${hasText?`<div class="hero-review-text">"${review.text}"</div>`:""}\n      <div class="hero-review-author">&mdash; ${review.author}</div>\n    </div>\n  `}).join(""),dotsHTML=heroReviews.map((_,index)=>`\n    <div class="hero-review-dot ${index===currentHeroReviewIndex?"active":""}" data-index="${index}" onclick="goToHeroReview(${index})"></div>\n  `).join("");container.innerHTML=reviewsHTML+`<div class="hero-review-dots">${dotsHTML}</div>`,container.onclick=()=>{window.location.href="https://home2smart.com/reviews"}}function initHeroReviews(){const container=document.getElementById("heroReviews");container&&container.querySelector(".hero-review-slide.active")||renderHeroReviews();const startRotation=()=>{heroReviewInterval&&clearInterval(heroReviewInterval),heroReviewInterval=setInterval(nextHeroReview,5e3)},interactionHandler=()=>{startRotation(),window.removeEventListener("pointerdown",interactionHandler,{passive:!0})};window.addEventListener("pointerdown",interactionHandler,{passive:!0,once:!0}),"requestIdleCallback"in window?requestIdleCallback(startRotation,{timeout:5e3}):setTimeout(startRotation,5e3),setTimeout(()=>loadHeroReviews(),6e3)}function nextHeroReview(){currentHeroReviewIndex=(currentHeroReviewIndex+1)%heroReviews.length,showHeroReview(currentHeroReviewIndex)}function goToHeroReview(index){event?.stopPropagation(),currentHeroReviewIndex=index,showHeroReview(index),heroReviewInterval&&clearInterval(heroReviewInterval),heroReviewInterval=setInterval(nextHeroReview,5e3)}function showHeroReview(index){const slides=document.querySelectorAll(".hero-review-slide"),dots=document.querySelectorAll(".hero-review-dot");slides.forEach((slide,i)=>{slide.classList.toggle("active",i===index)}),dots.forEach((dot,i)=>{dot.classList.toggle("active",i===index)})}function renderReviews(){const track=byId("reviewTrack"),nav=byId("reviewNav");if(!track||!nav)return;if(0===allReviews.length)return void(track.innerHTML='<p style="text-align: center; color: var(--muted); padding: 40px;">No reviews available</p>');track.innerHTML=allReviews.map((review,index)=>{const displayName=review.display_name||"Customer",initials=displayName.split(" ").map(n=>n[0]).join("").toUpperCase().slice(0,2),rating=Number(review.rating||5),stars="?".repeat(rating),greyStars="?".repeat(5-rating),escapedName=displayName.replace(/</g,"&lt;").replace(/>/g,"&gt;"),escapedText=(review.review_text||"").replace(/</g,"&lt;").replace(/>/g,"&gt;"),escapedService=(review.services_selected?review.services_selected.split(",")[0].trim():"Smart Home Service").replace(/</g,"&lt;").replace(/>/g,"&gt;");let formattedDate="";if(review.timestamp_iso)try{formattedDate=new Date(review.timestamp_iso).toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})}catch(e){formattedDate=""}return`\n      <div class="review-card" data-index="${index}">\n        <div class="review-header">\n          <div class="review-avatar">${initials}</div>\n          <div class="review-meta">\n            <div class="review-name">${escapedName}</div>\n            <div class="review-stars">${stars}${greyStars}</div>\n            ${formattedDate?`<div class="review-time">${formattedDate}</div>`:""}\n          </div>\n        </div>\n        <p class="review-text">${escapedText}</p>\n        <div class="review-footer">\n          <div class="review-service">${escapedService}</div>\n          ${review.verified?'<div class="review-verified">Verified Customer</div>':""}\n        </div>\n      </div>\n    `}).join("");const slidesPerView=window.innerWidth>=1024?3:window.innerWidth>=768?2:1,totalPages=Math.ceil(allReviews.length/slidesPerView);nav.innerHTML=Array.from({length:totalPages},(_,i)=>`<div class="review-dot ${0===i?"active":""}" onclick="goToReview(${i})" aria-label="Go to page ${i+1}"></div>`).join("")}function startCarousel(){reviewInterval&&clearInterval(reviewInterval);const slidesPerView=window.innerWidth>=1024?3:window.innerWidth>=768?2:1,totalPages=Math.ceil(allReviews.length/slidesPerView);if(totalPages<=1)return;reviewInterval=setInterval(()=>{reviewIndex++,reviewIndex>=totalPages&&(reviewIndex=0),updateCarousel()},5e3);const carousel=document.querySelector(".review-carousel");carousel&&(carousel.addEventListener("mouseenter",()=>{reviewInterval&&clearInterval(reviewInterval)}),carousel.addEventListener("mouseleave",()=>{startCarousel()}))}function goToReview(pageIndex){reviewIndex=pageIndex,updateCarousel(),startCarousel()}function updateCarousel(){const track=byId("reviewTrack");if(!track||0===allReviews.length)return;const vw=window.innerWidth,slidesPerView=vw>=1024?3:vw>=768?2:1,totalPages=Math.ceil(allReviews.length/slidesPerView),safeIndex=Math.min(reviewIndex,totalPages-1),offset=100*-safeIndex;requestAnimationFrame(()=>{track.style.transform=`translateX(${offset}%)`;document.querySelectorAll(".review-dot").forEach((dot,i)=>{const active=i===safeIndex;active!==dot.classList.contains("active")&&dot.classList.toggle("active",active)})})}function encodeCartToUrl(cartItems=cart){return cartItems&&cartItems.length?cartItems.map(item=>{if("package"===item.type)return`pkg:${item.id}*${item.qty}`;return`${item.service_id||""}${item.option_id?`:${item.option_id}`:""}*${item.qty}`}).join(","):""}function decodeCartFromUrl(cartParam){if(!cartParam)return[];return String(cartParam).split(",").map(item=>{const parts=item.split("*"),qty=Number(parts[1])||1,servicePart=parts[0];if(servicePart.startsWith("pkg:")){const bundle_id=servicePart.replace("pkg:",""),bundle=catalog.bundles?.find(b=>b.bundle_id===bundle_id);return bundle?{type:"package",id:bundle_id,name:bundle.name||bundle_id,price:Number(bundle.bundle_price||0),qty:qty}:(logger.warn("[Cart] Bundle not found in catalog:",bundle_id),null)}const[service_id,option_id]=servicePart.split(":");return{service_id:service_id,qty:qty,option_id:option_id||null}}).filter(item=>null!==item&&(item.service_id||item.id))}function syncCartToUrl(){}function saveUser(){try{localStorage.setItem("h2s_user",JSON.stringify(user||{}))}catch(err){logger.warn("Failed to save user to localStorage:",err)}renderSigninState()}function loadUser(){try{return JSON.parse(localStorage.getItem("h2s_user")||"{}")}catch(_){return{}}}function updateCartBadge(){const count=cart.reduce((n,l)=>n+Number(l.qty||0),0);byId("cartCount").textContent=count}function cartSubtotal(lines=cart){return lines.reduce((sum,ln)=>"package"===ln.type?sum+Number(ln.price||0)*Number(ln.qty||1):sum,0)}function paintCart(){const items=byId("cartItems"),emptyState=byId("cartEmpty"),subtotal=byId("cartSubtotal"),itemCount=byId("cartItemCount");if(!items||!emptyState||!subtotal)return;if(cart&&Array.isArray(cart)||(cart=[]),!cart.length){logger.log("[Cart] Cart is empty, showing empty state"),emptyState.hidden=!1,items.innerHTML="",subtotal.textContent="$0.00";const grandTotal=byId("grandTotal");grandTotal&&(grandTotal.textContent="$0.00");const checkoutBtn=byId("checkoutBtn");return checkoutBtn&&(checkoutBtn.disabled=!0),void(itemCount&&(itemCount.textContent="0 items"))}logger.log("[Cart] Rendering",cart.length,"items"),emptyState.hidden=!0;let cartSubtotalVal=0,totalQty=0;items.innerHTML=cart.map((item,idx)=>{const qty=Number(item.qty||1),itemPrice=Number(item.price||0),itemTotal=itemPrice*qty;logger.log("[Cart] Rendering item:",item.name,"qty:",qty,"price:",itemPrice,"total:",itemTotal),cartSubtotalVal+=itemTotal,totalQty+=qty;const metadata=item.metadata||{};let metadataHTML="";if(metadata.items_json&&Array.isArray(metadata.items_json)&&metadata.items_json.length>0){const tvCount=metadata.tv_count||metadata.items_json.length,mountProvider=metadata.items_json[0]?.metadata?.mount_provider||"h2s",totalUpcharges=metadata.total_mount_upcharges||0,basePrice=metadata.original_price||itemPrice-totalUpcharges;metadataHTML=`\n        <div style="margin-top:12px;padding:12px;background:#f8f9fb;border-radius:8px;border-left:3px solid var(--cobalt);">\n          <div style="font-weight:700;color:var(--cobalt);margin-bottom:8px;display:flex;align-items:center;gap:8px;">\n            <span>${tvCount} TV Installation${tvCount>1?"s":""}</span>\n            ${"customer"===mountProvider?'<span style="background:#10b981;color:white;padding:2px 8px;border-radius:4px;font-size:11px;">Customer Mounts</span>':""}\n          </div>\n          \n          ${metadata.items_json.map((tvItem,tvIdx)=>{const tvMeta=tvItem.metadata||{},tvSize=tvMeta.tv_size||"Unknown",mountType=tvMeta.mount_type||"fixed",mountUpcharge=tvMeta.mount_upcharge||0;return`\n              <div style="padding:8px;background:white;border-radius:6px;margin-bottom:6px;border:1px solid #e5e7eb;">\n                <div style="display:flex;justify-content:space-between;align-items:start;">\n                  <div>\n                    <div style="font-weight:600;font-size:13px;color:#111;">TV #${tvMeta.tv_number||tvIdx+1}</div>\n                    <div style="font-size:12px;color:#6b7280;margin-top:2px;">Size: ${tvSize}"</div>\n                    ${"h2s"===mountProvider?`<div style="font-size:12px;color:#6b7280;">Mount: ${{fixed:"Fixed/Flat",tilt:"Tilt",full_motion:"Full Motion"}[mountType]||mountType}</div>`:""}\n                  </div>\n                  ${"h2s"===mountProvider&&mountUpcharge>0?`\n                    <div style="text-align:right;">\n                      <div style="font-size:11px;color:#6b7280;">Mount upgrade</div>\n                      <div style="font-weight:600;color:var(--cobalt);font-size:13px;">+$${mountUpcharge}</div>\n                    </div>\n                  `:""}\n                </div>\n              </div>\n            `}).join("")}\n          \n          <div style="margin-top:12px;padding-top:10px;border-top:1px solid #e5e7eb;display:flex;justify-content:space-between;font-size:12px;">\n            <div style="color:#6b7280;">\n              ${"h2s"===mountProvider?`\n                <div>Base Package: $${basePrice.toFixed(2)}</div>\n                ${totalUpcharges>0?`<div>Mount Upgrades: +$${totalUpcharges.toFixed(2)}</div>`:""}\n              `:"<div>Installation Only (customer mounts)</div>"}\n            </div>\n            <div style="font-weight:700;color:var(--cobalt);">Total: $${itemPrice.toFixed(2)}</div>\n          </div>\n        </div>\n      `}else if(metadata.tv_size||metadata.mount_type||metadata.requires_team){if(metadataHTML='<div style="margin-top:8px;padding:10px;background:#f8f9fb;border-radius:6px;border-left:3px solid var(--azure);font-size:12px;">',metadata.tv_size&&(metadataHTML+=`<div style="color:var(--cobalt);font-weight:600;margin-bottom:4px;">TV Size: ${escapeHtml(metadata.tv_size)}"</div>`),metadata.mount_type){const mountLabel={fixed:"Fixed/Flat Mount",tilt:"Tilt Mount",full_motion:"Full Motion Mount"}[metadata.mount_type]||metadata.mount_type,mountUpcharge=metadata.mount_upcharge||0;metadataHTML+=`<div style="color:#374151;font-weight:500;">${mountLabel}${mountUpcharge>0?` <span style="color:var(--cobalt);font-weight:700;">(+$${mountUpcharge})</span>`:""}</div>`}"customer"===metadata.mount_provider&&(metadataHTML+='<div style="color:#10b981;font-weight:600;margin-top:4px;">Customer-provided mount</div>'),metadataHTML+="</div>"}return`\n      <div class="cart-item">\n        <div class="cart-item-info">\n          <div class="cart-item-name">${escapeHtml(item.name||item.id||"Item")}</div>\n          <div class="cart-item-price">${money(itemPrice)} each</div>\n          ${metadataHTML}\n          \n          <div class="cart-qty-controls">\n            <button \n              class="cart-qty-btn"\n              onclick="updateQuantity(${idx}, -1)"\n              aria-label="Decrease quantity"\n            >&minus;</button>\n            \n            <span class="cart-qty-value">${qty}</span>\n            \n            <button \n              class="cart-qty-btn"\n              onclick="updateQuantity(${idx}, 1)"\n              aria-label="Increase quantity"\n            >+</button>\n          </div>\n        </div>\n        \n        <div class="cart-item-right">\n          <div class="cart-item-total">${money(itemTotal)}</div>\n          <button \n            class="cart-remove-btn"\n            onclick="removeFromCart(${idx})"\n          >Remove</button>\n        </div>\n      </div>\n    `}).join(""),subtotal.textContent=money(cartSubtotalVal),itemCount&&(itemCount.textContent=`${totalQty} item${1===totalQty?"":"s"}`);const rawLine=byId("rawSubtotalLine"),promoLine=byId("promoLine"),totalLabel=byId("totalLabel"),cartSubtotalLine=byId("cartSubtotalLine");cartSubtotalLine&&(cartSubtotalLine.style.display="flex"),rawLine&&(rawLine.style.display="none"),promoLine&&(promoLine.style.display="none"),totalLabel&&(totalLabel.textContent="Total");const grandTotal=byId("grandTotal");grandTotal&&(grandTotal.textContent=money(cartSubtotalVal)),renderSigninState();try{const promoInput=byId("promoCode"),promoBtn=byId("applyPromo"),promoMsg=byId("promoMsg");if(promoInput&&promoMsg){const saved=localStorage.getItem("h2s_promo_code")||"";saved&&!promoInput.value&&(promoInput.value=saved,promoMsg.textContent="Saved code will be applied at checkout.",promoMsg.style.color="#0b6e0b")}promoBtn&&(promoBtn.onclick=async()=>{const code=(byId("promoCode")?.value||"").trim();if(!code)return void(promoMsg&&(promoMsg.textContent="Enter a promo code",promoMsg.style.color="#c33"));const prev=promoBtn.textContent;promoBtn.disabled=!0,promoBtn.textContent="Checking";try{const baseUrl=API.replace("/api/shop","/api/promo_validate")+"?code="+encodeURIComponent(code);console.log(" [PROMO] Validating code:",code),console.log(" [PROMO] Validation URL:",baseUrl);const resp=await fetch(baseUrl),data=await resp.json();if(console.log(" [PROMO] Validation response:",data),data&&data.ok&&data.valid){if(localStorage.setItem("h2s_promo_code",data.promo?.code||code),promoMsg){const c=data.promo?.coupon||{};let desc="";c.percent_off?desc=`${c.percent_off}% off`:c.amount_off&&(desc=`${money((c.amount_off||0)/100)} off`),promoMsg.textContent=`? Code recognized${desc?`: ${desc}`:""}. Checking cart`,promoMsg.style.color="#0b6e0b"}await updatePromoEstimate()}else localStorage.removeItem("h2s_promo_code"),promoMsg&&(promoMsg.textContent="Invalid or expired code",promoMsg.style.color="#c33")}catch(e){promoMsg&&(promoMsg.textContent="Could not validate code. Try again.",promoMsg.style.color="#c33")}finally{promoBtn.disabled=!1,promoBtn.textContent=prev}})}catch(_){}renderBundlePanel(),queueRenderRecsPanel(),Promise.resolve().then(()=>{try{updatePromoEstimate()}catch(_){}})}async function updatePromoEstimate(){try{const promoLine=byId("promoLine"),promoAmount=byId("promoAmount"),promoMsg=byId("promoMsg"),totalLabel=(byId("cartSubtotal"),byId("totalLabel")),rawLine=byId("rawSubtotalLine"),rawAmount=byId("rawSubtotalAmount");if(!promoLine||!promoAmount)return;totalLabel&&(totalLabel.textContent="Subtotal"),rawLine&&(rawLine.style.display="none");const code=localStorage.getItem("h2s_promo_code")||"";if(!code)return void(promoLine.style.display="none");const line_items=(cart||[]).map(item=>{const bundle="package"===item.type||"bundle"===item.type?(catalog?.bundles||[]).find(b=>b.bundle_id===(item.bundle_id||item.id)):null,priceId=bundle?.stripe_price_id||item.stripe_price_id||"custom";let unitAmount=0;const isDynamic=["tv_multi","cam_basic","cam_standard","cam_premium"].includes(item.id||item.bundle_id);return unitAmount=bundle&&!isDynamic&&void 0!==bundle.bundle_price&&null!==bundle.bundle_price?Math.round(100*Number(bundle.bundle_price)):Math.round(100*Number(item.price||0)),!unitAmount||unitAmount<=0?null:{price:priceId,unit_amount:unitAmount,quantity:item.qty||1}}).filter(Boolean);if(!line_items.length)return void(promoLine.style.display="none");console.log(" [PROMO] Checking cart with code:",code,"line_items:",line_items);const resp=await fetch(API,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({__action:"promo_check_cart",promotion_code:code,line_items:line_items})}),data=await resp.json();if(console.log(" [PROMO] Cart check response:",data),data&&data.ok&&data.applicable&&data.estimate){const savingsCents=Number(data.estimate.savings_cents||0),totalCents=Number(data.estimate.total_cents||0),subtotalCents=Number(data.estimate.subtotal_cents||0);promoAmount.textContent="-"+money(savingsCents/100);const label=byId("promoLineLabel");label&&(label.textContent=`Promo (${(data.promotion_code||code).toUpperCase()})`),promoLine.style.display="flex";const cartSubtotalLine=byId("cartSubtotalLine");cartSubtotalLine&&(cartSubtotalLine.style.display="none"),rawLine&&rawAmount&&(rawAmount.textContent=money(subtotalCents/100),rawLine.style.display="flex");const grandTotal=byId("grandTotal");grandTotal&&(grandTotal.textContent=money(totalCents/100),0===totalCents?(grandTotal.style.color="#10b981",grandTotal.style.fontSize="20px"):(grandTotal.style.color="",grandTotal.style.fontSize="")),totalLabel&&(totalLabel.textContent="Grand Total"),promoMsg&&(promoMsg.textContent="Code will apply at checkout.",promoMsg.style.color="#0b6e0b")}else{const cartSubtotalLine=byId("cartSubtotalLine");cartSubtotalLine&&(cartSubtotalLine.style.display="flex"),promoLine.style.display="none",rawLine&&(rawLine.style.display="none");const cartSubtotal=byId("cartSubtotal"),grandTotal=byId("grandTotal");cartSubtotal&&grandTotal&&(grandTotal.textContent=cartSubtotal.textContent,grandTotal.style.color="",grandTotal.style.fontSize=""),totalLabel&&(totalLabel.textContent="Total"),promoMsg&&(promoMsg.textContent="This code does not apply to your current items.",promoMsg.style.color="#c33")}}catch(_){const promoLine=byId("promoLine");promoLine&&(promoLine.style.display="none");const rawLine=byId("rawSubtotalLine");rawLine&&(rawLine.style.display="none")}}function removeFromCart(idx){logger.log("[Cart] Removing item at index:",idx);try{cart.splice(idx,1),saveCart()}catch(e){logger.error("[Cart] Error removing item:",e)}}async function loadAIRecommendations(){if(user&&user.email)try{const res=await fetch(`${API}?action=ai_sales&email=${encodeURIComponent(user.email)}&mode=recommendations`),data=await res.json();if(!data.success||!data.ai_analysis||!data.ai_analysis.recommendations)return;const recs=data.ai_analysis.recommendations.slice(0,3);if(0===recs.length)return;renderAIRecommendations(recs)}catch(err){logger.error("Failed to load AI recommendations:",err)}}function renderAIRecommendations(recs){const panel=byId("aiRecommendationsPanel"),container=byId("aiRecommendations");if(!panel||!container)return;const html=recs.map(rec=>{const service=rec.service||rec.title||"Recommended Service",reason=rec.thought_spark||rec.reason||"",price=rec.price||0;return`\n      <div class="ai-rec-card">\n        <div class="ai-rec-name">${escapeHtml(service)}</div>\n        <div class="ai-rec-reason">"${escapeHtml(reason)}"</div>\n        ${price>0?`<div class="ai-rec-price" style="margin-top:8px;font-size:14px;color:var(--muted);">Starting at ${money(price)}</div>`:""}\n      </div>\n    `}).join("");container.innerHTML=html,panel.style.display="block"}function bundlesMatchingCart(){const rec=[],bundles=(catalog.bundles||[]).filter(b=>!1!==b.active);for(const b of bundles){const plan=calcBundlePlan(b);plan&&plan.savings>0&&rec.push(plan)}return rec.sort((a,b)=>b.savings-a.savings),rec}function calcBundlePlan(bundle){const recipe=(catalog.bundleItems||[]).filter(it=>String(it.bundle_id)===String(bundle.bundle_id));if(!recipe.length)return null;const use={};for(const item of recipe){const need=Number(item.required_qty||0),have=cart.find(l=>!l.type&&String(l.service_id)===String(item.service_id));if(!have||Number(have.qty||0)<need)return null;use[item.service_id]=need}let requiredCost=0;for(const item of recipe){const tier=pickTier(item.service_id,Number(item.required_qty||0),null)||pickTier(item.service_id,1,null);requiredCost+=(tier?Number(tier.unit||0):0)*Number(item.required_qty||0)}const bundlePrice=Number(bundle.bundle_price||0),savings=Math.max(0,requiredCost-bundlePrice),serviceMap=indexBy(catalog.services||[],"service_id"),lineList=recipe.map(r=>{const s=serviceMap[r.service_id];return`${Number(r.required_qty||0)} ?&mdash; ${s&&s.name?s.name:r.service_id}`});return{bundle_id:bundle.bundle_id,name:bundle.name||bundle.bundle_id,image_url:bundle.image_url||"",savings:savings,requiredCost:requiredCost,bundlePrice:bundlePrice,use:use,recipeList:lineList}}function applyBundleSwap(bundle_id){const plan=bundlesMatchingCart().find(p=>p.bundle_id===bundle_id);if(!plan)return;Object.entries(plan.use).forEach(([sid,reqQty])=>{const ln=cart.find(l=>!l.type&&l.service_id===sid);ln&&(ln.qty=Math.max(0,Number(ln.qty||0)-Number(reqQty||0)))}),cart=cart.filter(l=>!(!l.type&&0===Number(l.qty||0)));const existing=cart.find(l=>"bundle"===l.type&&l.bundle_id===bundle_id);if(existing)existing.qty+=1;else{const bundleData=catalog.bundles?.find(b=>b.bundle_id===bundle_id);cart.push({type:"bundle",bundle_id:bundle_id,qty:1,name:bundleData?.title||bundleData?.name||bundle_id,price:bundleData?.price||0,stripe_price_id:bundleData?.stripe_price_id})}saveCart()}function renderBundlePanel(){const panel=byId("bundlePanel");if(!panel)return;const suggestions=bundlesMatchingCart();if(!suggestions.length)return panel.style.display="none",void(panel.innerHTML="");panel.style.display="",panel.innerHTML=suggestions.map(p=>`\n    <div class="bundle-card">\n      <div class="b-head">\n        <div class="b-name">${escapeHtml(p.name)}</div>\n        <div class="b-save">Save ${money(p.savings)}</div>\n      </div>\n      <div class="b-list">${p.recipeList.map(escapeHtml).join(" &bull; ")}</div>\n      <div class="b-actions">\n        <button class="btn btn-primary" data-apply="${p.bundle_id}">Swap & Save</button>\n      </div>\n    </div>\n  `).join(""),panel.querySelectorAll("[data-apply]").forEach(btn=>{btn.onclick=()=>applyBundleSwap(btn.getAttribute("data-apply"))})}function showCheckoutError(msg){const errorDiv=byId("checkoutError"),errorMsg=byId("checkoutErrorMsg"),dismissBtn=byId("dismissError");errorDiv&&errorMsg&&(errorMsg.textContent=msg,errorDiv.hidden=!1,dismissBtn&&(dismissBtn.onclick=()=>errorDiv.hidden=!0),setTimeout(()=>errorDiv.hidden=!0,8e3))}function escapeAttr(text){return text?String(text).replace(/"/g,"&quot;").replace(/'/g,"&#39;"):""}function showMsg(elId,txt,isError=!0){const el=document.getElementById(elId);el&&(el.textContent=txt,el.style.color=isError?"#d32f2f":"#2e7d32")}function showCheckoutModal(){const modal=document.getElementById("modal"),backdrop=document.getElementById("backdrop");if(!modal||!backdrop)return void logger.error("Modal elements missing!");const cartDrawer=document.getElementById("cartDrawer");cartDrawer&&cartDrawer.classList.contains("open")&&cartDrawer.classList.remove("open");const preName=user?.name||"",preEmail=user?.email||"",prePhone=user?.phone||"";let preAddress="",preCity="",preZip="";try{const pending=JSON.parse(sessionStorage.getItem("h2s_pending_account")||"{}");pending.address&&(preAddress=pending.address),pending.city&&(preCity=pending.city),pending.zip&&(preZip=pending.zip)}catch(e){}const html=`\n    <div style="padding: 24px; max-width: 500px; margin: 0 auto;">\n      <h2 style="margin-top:0; color:var(--cobalt); font-weight:900; font-size:24px;">Complete Your Order</h2>\n      <p style="color:var(--muted); margin-bottom:20px; font-size:14px;">Enter your details to finalize checkout and schedule installation.</p>\n      \n      <form id="checkoutForm" onsubmit="handleCheckoutSubmit(event)">\n        <div style="margin-bottom:12px;">\n          <label style="display:block; font-weight:600; font-size:14px; margin-bottom:4px; color:var(--ink);">Full Name</label>\n          <input type="text" id="coName" class="inp" required value="${escapeAttr(preName)}" placeholder="Jane Doe" style="width:100%">\n        </div>\n        \n        <div style="margin-bottom:12px;">\n          <label style="display:block; font-weight:600; font-size:14px; margin-bottom:4px; color:var(--ink);">Email Address</label>\n          <input type="email" id="coEmail" class="inp" required value="${escapeAttr(preEmail)}" placeholder="jane@example.com" style="width:100%">\n        </div>\n        \n        <div style="margin-bottom:12px;">\n          <label style="display:block; font-weight:600; font-size:14px; margin-bottom:4px; color:var(--ink);">Phone Number</label>\n          <input type="tel" id="coPhone" class="inp" required value="${escapeAttr(prePhone)}" placeholder="(864) 528-1475" style="width:100%">\n        </div>\n        \n        <div style="margin-bottom:12px;">\n          <label style="display:block; font-weight:600; font-size:14px; margin-bottom:4px; color:var(--ink);">Service Address</label>\n          <input type="text" id="coAddress" class="inp" required value="${escapeAttr(preAddress)}" placeholder="123 Main St" style="width:100%">\n        </div>\n        \n        <div style="display:grid; grid-template-columns: 2fr 1fr; gap:12px; margin-bottom:20px;">\n          <div>\n            <label style="display:block; font-weight:600; font-size:14px; margin-bottom:4px; color:var(--ink);">City</label>\n            <input type="text" id="coCity" class="inp" required value="${escapeAttr(preCity)}" placeholder="Greenville" style="width:100%">\n          </div>\n          <div>\n            <label style="display:block; font-weight:600; font-size:14px; margin-bottom:4px; color:var(--ink);">Zip</label>\n            <input type="text" id="coZip" class="inp" required value="${escapeAttr(preZip)}" placeholder="29601" style="width:100%">\n          </div>\n        </div>\n\n        <div id="coError" style="color:#d32f2f; font-size:14px; margin-bottom:12px; display:none; background:#fee; padding:8px; border-radius:4px;"></div>\n\n        <div style="display:flex; gap:10px;">\n          <button type="button" class="btn btn-ghost" onclick="closeModal()" style="flex:1;">Cancel</button>\n          <button type="submit" class="btn btn-primary" id="coSubmitBtn" style="flex:2;">Proceed to Payment</button>\n        </div>\n      </form>\n    </div>\n  `,modalContent=modal.querySelector(".modal-content");modalContent?modalContent.innerHTML=html:modal.innerHTML=`<div class="modal-content">${html}</div>`,modal.classList.add("show"),backdrop.classList.add("show"),document.documentElement.classList.add("modal-open"),document.body.classList.add("modal-open"),H2S_lockScroll(),setTimeout(()=>{document.getElementById("coName").value?document.getElementById("coAddress").value||document.getElementById("coAddress").focus():document.getElementById("coName").focus()},100)}function showCheckoutError(msg){const el=document.getElementById("cartMsg"),btn=document.getElementById("checkoutBtn");el&&(el.textContent=msg,el.style.color="#d32f2f"),btn&&(btn.disabled=!1,btn.textContent="Checkout"),alert(msg)}async function loadOrders(){const box=byId("ordersBox");if(box)try{const res=await fetch(API+"?action=orders&email="+encodeURIComponent(user.email)),data=await res.json(),orders=Array.isArray(data.orders)?data.orders:[];if(!orders.length)return void(box.innerHTML='<div class="help">No orders yet.</div>');orders.sort((a,b)=>new Date(b.created_at||0)-new Date(a.created_at||0)),box.innerHTML=orders.map(o=>{const oid=o.order_id||o.stripe_session_id||"";let itemsHTML="";try{let itemsData=null;if(o.items)if(Array.isArray(o.items))itemsData=o.items;else if("string"==typeof o.items)try{itemsData=JSON.parse(o.items)}catch(e){}if(!itemsData&&o.order_summary&&"string"==typeof o.order_summary&&o.order_summary.trim().startsWith("["))try{itemsData=JSON.parse(o.order_summary)}catch(e){}Array.isArray(itemsData)&&itemsData.length>0?itemsHTML=itemsData.map(item=>{const name=item.service_name||item.name||item.description||item.bundle_id||item.service_id||"Service",qty=item.qty||item.quantity||1,price=item.unit_price||item.price||0;return`${qty} ${escapeHtml(name)}  ${money(price)}`}).join("<br>"):!o.order_summary||"string"==typeof o.order_summary&&o.order_summary.trim().startsWith("[")||(itemsHTML=escapeHtml(o.order_summary))}catch(e){console.error("Error rendering items:",e)}itemsHTML||(itemsHTML="Items unavailable");let dateHTML="";if(o.install_at||o.delivery_date||o.service_date){const dateValue=o.install_at||o.delivery_date||o.service_date;try{const dt=new Date(dateValue);if(isNaN(dt.getTime()))dateHTML=escapeHtml(String(dateValue));else{const options={month:"short",day:"numeric",year:"numeric"};dateHTML=dt.toLocaleDateString("en-US",options),o.delivery_time&&(dateHTML+=`  ${escapeHtml(o.delivery_time)}`)}}catch(e){dateHTML=escapeHtml(String(dateValue))}}let actionHTML="";dateHTML?actionHTML=`<button class="btn btn-sm ghost" onclick="rescheduleOrder('${escapeHtml(oid)}', '${escapeHtml(o.delivery_date||"")}', '${escapeHtml(o.delivery_time||"")}')">Reschedule</button>`:(actionHTML=`<button class="btn btn-sm azure" onclick="scheduleOrder('${escapeHtml(oid)}')">Schedule Now</button>`,dateHTML='<span style="color:#94a3b8">Not scheduled</span>');const total=Number(o.order_total)||0;return`\n        <div class="pd-box" style="margin-bottom:10px">\n          <div class="details-grid">\n            <div class="row"><div class="k">Order ID</div><div class="v">${escapeHtml(String(oid))}</div></div>\n            <div class="row"><div class="k">Total</div><div class="v">${money(total)}</div></div>\n            <div class="row"><div class="k">Items</div><div class="v">${itemsHTML}</div></div>\n            <div class="row"><div class="k">Service date</div><div class="v">${dateHTML}</div></div>\n            <div class="row"><div class="k">Actions</div><div class="v">${actionHTML}</div></div>\n          </div>\n        </div>\n      `}).join("")}catch(e){box.innerHTML='<div class="help">Could not load orders.</div>'}}heroReviews=[{text:"Professional, on-time, and clean installation.",author:"Recent Customer",stars:5},{text:"Had 4 cameras installed. The app setup was seamless and now I have total peace of mind.",author:"Mike T.",stars:5},{text:"Quick, clean, professional. They hid all the wires perfectly. Looks like it came with the house!",author:"Jennifer L.",stars:5},{text:"Same-day service saved me! TV mounted and streaming setup done in under an hour.",author:"David R.",stars:5},{text:"The whole-home security package was a game changer. Professional install, great support.",author:"Amanda K.",stars:5}],window.addEventListener("resize",()=>{clearTimeout(resizeTimeout),resizeTimeout=setTimeout(()=>{allReviews.length>0&&updateCarousel()},100)}),window.checkout=function(){if(logger.log("[Checkout] Starting checkout flow..."),!cart||0===cart.length)return void alert("Your cart is empty.");const cartValue=cart.reduce((sum,item)=>sum+(item.price||0)*(item.qty||1),0),cartItems=cart.map(item=>({product_id:item.id||item.service_id||item.bundle_id,product_name:item.name||item.service_name,quantity:item.qty||1,price:item.price||item.unit_price||0}));h2sTrack("InitiateCheckout",{value:cartValue,currency:"USD",num_items:cart.length,items:cartItems,customer_email:user?.email||null,customer_phone:user?.phone||null}),showCheckoutModal()},window.handleCheckoutSubmit=async function(e){e.preventDefault();const btn=document.getElementById("coSubmitBtn"),errEl=document.getElementById("coError"),name=document.getElementById("coName").value.trim(),email=document.getElementById("coEmail").value.trim(),phone=document.getElementById("coPhone").value.trim(),address=document.getElementById("coAddress").value.trim(),city=document.getElementById("coCity").value.trim(),zip=document.getElementById("coZip").value.trim();if(!(name&&email&&phone&&address&&city&&zip))return void(errEl&&(errEl.textContent="Please fill in all fields.",errEl.style.display="block"));if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email))return void(errEl&&(errEl.textContent="Please enter a valid email address.",errEl.style.display="block"));if(!cart||0===cart.length)return void(errEl&&(errEl.textContent="Your cart is empty. Please add items first.",errEl.style.display="block"));btn&&(btn.disabled=!0,btn.innerHTML='<span class="spinner"></span> Processing...'),errEl&&(errEl.style.display="none");let attempt=0;for(;attempt<3;){attempt++,logger.log(`[Checkout] Attempt ${attempt}/3`);try{const promoCode=localStorage.getItem("h2s_promo_code"),cart_items=cart.map(item=>({name:item.name||item.service_name||item.id,qty:item.qty||1,price:Math.round(100*(item.price||item.unit_price||0)),metadata:item.metadata||{}})),payload={__action:"create_checkout_session",customer:{name:name,email:email,phone:phone},cart:cart,source:"shop_rebuilt",success_url:"https://home2smart.com/bundles?view=shopsuccess&session_id={CHECKOUT_SESSION_ID}",cancel_url:window.location.href,metadata:{customer_name:name,customer_phone:phone,customer_email:email,service_address:address,service_city:city,service_zip:zip,source:"shop_rebuilt",cart_items:JSON.stringify(cart_items)}};promoCode&&(payload.promotion_code=promoCode),logger.log("[Checkout] Sending payload:",payload);const controller=new AbortController,timeoutId=setTimeout(()=>controller.abort(),15e3),res=await fetch(API,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(payload),signal:controller.signal});let data;clearTimeout(timeoutId);const contentType=res.headers.get("content-type");if(!contentType||!contentType.includes("application/json")){const text=await res.text();throw new Error(`Server returned non-JSON response: ${text.substring(0,100)}`)}if(data=await res.json(),!res.ok||!data.ok)throw new Error(data.error||data.message||`Server error: ${res.status}`);if(!data.pay||!data.pay.session_url)throw new Error("No Stripe session URL in response");try{localStorage.setItem("h2s_guest_checkout",JSON.stringify({name:name,email:email,phone:phone,address:address,city:city,zip:zip})),user.email||(user={name:name,email:email,phone:phone},saveUser())}catch(e){logger.warn("[Checkout] Could not save user data:",e)}try{window.h2sTrack&&h2sTrack("InitiateCheckout",{value:cart.reduce((sum,item)=>sum+item.price*item.qty,0),currency:"USD",num_items:cart.length})}catch(e){logger.warn("[Checkout] Tracking failed (non-blocking):",e)}try{const checkoutData={session_id:data.pay.session_id||data.pay.session_url.split("session_id=")[1]||"",timestamp:Date.now(),cart_count:cart.length,customer_email:email};localStorage.setItem("h2s_last_checkout",JSON.stringify(checkoutData)),logger.log("[Checkout] Session persisted for recovery")}catch(e){logger.warn("[Checkout] Could not persist session (non-blocking):",e)}H2S_unlockScroll(),document.documentElement.classList.remove("modal-open"),document.body.classList.remove("modal-open"),logger.log("[Checkout]  Success! Redirecting to:",data.pay.session_url);try{window.location.href=data.pay.session_url}catch(e){window.location.assign(data.pay.session_url)}return}catch(err){if(logger.error(`[Checkout] Attempt ${attempt} failed:`,err),console.error(" [CHECKOUT DEBUG]  Checkout attempt",attempt,"failed"),console.error(" [CHECKOUT DEBUG] Error:",err),console.error(" [CHECKOUT DEBUG] Error name:",err.name),console.error(" [CHECKOUT DEBUG] Error message:",err.message),err.stack&&console.error(" [CHECKOUT DEBUG] Error stack:",err.stack),attempt>=3){const errorMsg="AbortError"===err.name?"Request timed out. Please check your connection and try again.":`Checkout failed: ${err.message}`;return errEl&&(errEl.textContent=errorMsg,errEl.style.display="block"),btn&&(btn.disabled=!1,btn.textContent="Proceed to Payment"),void alert("Unable to process checkout. Please try again or contact support at (864) 528-1475.")}const delay=1e3*Math.pow(2,attempt-1);logger.log(`[Checkout] Retrying in ${delay}ms...`),btn&&(btn.innerHTML='<span class="spinner"></span> Retrying...'),await new Promise(resolve=>setTimeout(resolve,delay))}}},window.__runDiagnoseCheckout=async function(){const errEl=document.getElementById("coError")||document.getElementById("cartMsg"),showErr=msg=>{errEl&&(errEl.textContent=msg,errEl.style.display="block"),logger.error("[Diagnose] "+msg)};if(!Array.isArray(cart)||0===cart.length)return showErr("Cart is empty. Add at least one item.");try{const line_items=cart.map(item=>{let priceId=item.stripe_price_id;if(!priceId&&("package"===item.type||"bundle"===item.type)){const id=item.id||item.bundle_id,b=catalog?.bundles?.find(x=>x.bundle_id===id);b&&(priceId=b.stripe_price_id)}if(!priceId&&item.service_id&&catalog?.priceTiers){const qty=Number(item.qty||1),tier=catalog.priceTiers.filter(t=>t.service_id===item.service_id).find(t=>{const min=Number(t.min_qty||0),max=""===t.max_qty||null==t.max_qty?1/0:Number(t.max_qty);return qty>=min&&qty<=max});tier&&(priceId=tier.stripe_price_id)}return priceId?{price:priceId,quantity:item.qty||1}:(logger.warn("[Diagnose] Missing price ID for item:",item),null)}).filter(Boolean);if(0===line_items.length)return showErr("No valid Stripe price IDs found for cart items.");const payload={__action:"create_checkout_session",line_items:line_items,customer_email:user?.email||"guest@example.com",success_url:"https://home2smart.com/bundles?view=shopsuccess&session_id={CHECKOUT_SESSION_ID}",cancel_url:window.location.href,metadata:{source:"shop_rebuilt_diagnose"},diagnose:!0};logger.log("[Diagnose] Payload preview:",payload);const res=await fetch(API,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(payload)}),text=await res.text();let data={};try{data=JSON.parse(text)}catch(e){logger.warn("[Diagnose] Non-JSON response:",text)}if(logger.log("[Diagnose] Response status:",res.status),logger.log("[Diagnose] Response body:",data.ok?data:text),!res.ok)return showErr("Backend HTTP error "+res.status+". Body: "+(text||""));if(!data.ok)return showErr("Backend returned error: "+(data.error||"Unknown error"));if(!data.pay||!data.pay.session_url)return showErr("No session_url from backend. Check Stripe session creation.");logger.log("? Diagnose OK. session_url:",data.pay.session_url),errEl&&(errEl.style.display="none")}catch(err){showErr("Diagnose failed: "+err.message)}},window.renderShopSuccess=async function(){try{logger.log("[renderShopSuccess] Function called");const isMobile=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)||window.innerWidth<=768;logger.log("[renderShopSuccess] Mobile detected:",isMobile),isMobile&&(logger.log("[renderShopSuccess] Preparing mobile viewport..."),window.scrollTo(0,0),document.body.style.overflow="auto",document.body.style.height="auto",document.documentElement.style.overflow="auto",document.body.style.position="",document.body.style.width="",document.body.style.top="");const params=new URL(location.href).searchParams,sessionId=params.get("session_id")||params.get("stripe_session_id")||"";if(logger.log("[renderShopSuccess] Session ID:",sessionId),cart&&cart.length>0&&(logger.log("[renderShopSuccess] Clearing cart immediately (had",cart.length,"items)"),cart=[],saveCart(),localStorage.removeItem("h2s_checkout_snapshot")),!sessionId){logger.warn("[renderShopSuccess] No session_id in URL. Checking for recent checkout...");try{const recentCheckout=JSON.parse(localStorage.getItem("h2s_last_checkout")||"{}");if(Date.now()-(recentCheckout.timestamp||0)<3e5&&recentCheckout.session_id)return logger.log("[renderShopSuccess] Recovered session from localStorage:",recentCheckout.session_id),void(window.location.href=`${window.location.origin}${window.location.pathname}?view=shopsuccess&session_id=${recentCheckout.session_id}`)}catch(e){logger.warn("[renderShopSuccess] Could not recover session:",e)}logger.warn("[renderShopSuccess] No session ID available. Showing generic success page.")}let order={order_id:params.get("order_id")||sessionId||"N/A",stripe_session_id:sessionId,order_total:params.get("order_total")||"",order_currency:params.get("order_currency")||"USD",order_item_count:params.get("order_item_count")||"",order_summary:params.get("order_summary")||"",order_discount_code:params.get("order_discount_code")||""};const displayOrderId=order.order_id,shortOrderId=displayOrderId.length>20?displayOrderId.substring(0,20)+"...":displayOrderId,prettyTotal=order.order_total?money(Number(order.order_total)):"Loading...",outlet=byId("outlet");outlet.innerHTML=`\n    <section class="form" style="max-width: 720px; margin: 60px auto 40px;">\n      \x3c!-- Success Header --\x3e\n      <div style="text-align: center; margin-bottom: 32px;">\n        <div style="width: 64px; height: 64px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 16px; box-shadow: 0 4px 16px rgba(16, 185, 129, 0.3);">\n          <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#ffffff" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">\n            <polyline points="20 6 9 17 4 12"></polyline>\n          </svg>\n        </div>\n        <h2 style="margin: 0 0 8px 0; font-weight: 900; font-size: 28px; color: var(--cobalt);">Order Confirmed!</h2>\n        <p style="margin: 0; color: var(--muted); font-size: 15px;">Thank you for choosing Home2Smart</p>\n      </div>\n\n      \x3c!-- Order Details Card --\x3e\n      <div style="background: #f8f9fb; border: 1px solid var(--border); border-radius: 12px; padding: 24px; margin-bottom: 24px;">\n        <h3 style="margin: 0 0 16px 0; font-size: 16px; font-weight: 800; color: var(--cobalt); text-transform: uppercase; letter-spacing: 0.5px;">Order Details</h3>\n        \n        <div class="details-grid" style="display: grid; gap: 12px;">\n          <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #e5e7eb;">\n            <span style="font-weight: 600; color: var(--muted); font-size: 14px;">Order ID</span>\n            <span id="successOrderId" style="font-family: monospace; font-size: 13px; color: var(--cobalt); font-weight: 700; word-break: break-all; max-width: 60%; text-align: right;" title="${escapeHtml(displayOrderId)}">${escapeHtml(shortOrderId)}</span>\n          </div>\n          \n          <div style="display: flex; flex-direction: column; gap: 6px; padding: 12px 0; border-bottom: 1px solid #e5e7eb;">\n            <span style="font-weight: 600; color: var(--muted); font-size: 14px;">Items</span>\n            <span id="successOrderItems" style="font-weight: 700; color: var(--ink); font-size: 14px; line-height: 1.5; text-align: left;">${order.order_summary?escapeHtml(order.order_summary):"Loading details..."}</span>\n          </div>\n          \n          <div id="successPromoRow" style="display: ${order.order_discount_code?"flex":"none"}; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #e5e7eb;">\n            <span style="font-weight: 600; color: var(--muted); font-size: 14px;">Promo Applied</span>\n            <span id="successPromoCode" style="font-weight: 700; color: #059669; font-size: 14px; font-family: monospace;">${escapeHtml(order.order_discount_code)}</span>\n          </div>\n\n          <div id="successTaxRow" style="display: none; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #e5e7eb;">\n            <span style="font-weight: 600; color: var(--muted); font-size: 14px;">Sales Tax</span>\n            <span id="successTaxAmount" style="font-weight: 700; color: var(--ink); font-size: 14px;">$0.00</span>\n          </div>\n          \n          <div style="display: flex; justify-content: space-between; align-items: center; padding: 16px 0 0 0;">\n            <span style="font-weight: 800; color: var(--ink); font-size: 16px;">Total Paid</span>\n            <span id="successOrderTotal" style="font-weight: 900; color: var(--cobalt); font-size: 22px;">${escapeHtml(prettyTotal)} <span style="font-size: 14px; font-weight: 600; color: var(--muted);">${escapeHtml(order.order_currency)}</span></span>\n          </div>\n        </div>\n      </div>\n\n      \x3c!-- Next Step: Native Scheduling --\x3e\n      <div class="schedule-container" style="background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); border: 2px solid #93c5fd; border-radius: 12px; margin-bottom: 24px; box-sizing: border-box; overflow: hidden;">\n        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">\n          <div style="width: 32px; height: 32px; background: var(--cobalt); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">\n            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#ffffff" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">\n              <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>\n              <line x1="16" y1="2" x2="16" y2="6"></line>\n              <line x1="8" y1="2" x2="8" y2="6"></line>\n              <line x1="3" y1="10" x2="21" y2="10"></line>\n            </svg>\n          </div>\n          <h3 style="margin: 0; font-size: 17px; font-weight: 800; color: var(--cobalt);">Schedule Your Installation</h3>\n        </div>\n        <p style="margin: 0; color: #1e3a8a; font-size: 14px; line-height: 1.6;">Pick a date from the calendar, then choose your preferred time window.</p>\n        \n        \x3c!-- Calendar Grid --\x3e\n        <div id="calendarWidget" class="calendar-widget" style="background: white; border-radius: 8px; margin: 16px auto 0; max-width: 100%; width: 100%; box-sizing: border-box; overflow-x: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">\n          <div style="padding: 20px; text-align: center; color: var(--muted);">Loading calendar...</div>\n        </div>\n        \n        \x3c!-- Time Window Selection (appears after date selected) --\x3e\n        <div id="timeWindowSection" style="display:none; margin-top:16px;">\n          <label style="display:block; font-weight:600; font-size:14px; margin-bottom:8px; color:var(--ink);">Select Time Window</label>\n          <div style="display:grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap:8px; max-width: 100%; overflow: hidden;">\n            <button class="time-slot-btn" data-window="9:00 AM - 12:00 PM" style="padding:10px 8px; border:2px solid var(--border); border-radius:8px; background:white; cursor:pointer; font-weight:600; font-size:13px; transition: all 0.2s; min-width:0; box-sizing:border-box;">9AM - 12PM</button>\n            <button class="time-slot-btn" data-window="12:00 PM - 3:00 PM" style="padding:10px 8px; border:2px solid var(--border); border-radius:8px; background:white; cursor:pointer; font-weight:600; font-size:13px; transition: all 0.2s; min-width:0; box-sizing:border-box;">12PM - 3PM</button>\n            <button class="time-slot-btn" data-window="3:00 PM - 6:00 PM" style="padding:10px 8px; border:2px solid var(--border); border-radius:8px; background:white; cursor:pointer; font-weight:600; font-size:13px; transition: all 0.2s; min-width:0; box-sizing:border-box;">3PM - 6PM</button>\n          </div>\n        </div>\n        \n        <div style="display:flex; gap:12px; margin-top:16px; justify-content: center;">\n          <button class="btn btn-primary" id="confirmApptBtn" style="width: 100%; max-width: 300px; opacity: 0.5; pointer-events: none;">Confirm Appointment</button>\n        </div>\n        <div id="schedMsg" class="help" style="margin-top:8px;"></div>\n      </div>\n\n      \x3c!-- Footer Actions --\x3e\n      <div style="display: flex; gap: 12px; flex-wrap: wrap; justify-content: center;">\n        <button class="btn btn-ghost" id="backToShop" style="min-width: 160px;">Return to Shop</button>\n        <a href="tel:864-528-1475" class="btn btn-secondary" style="min-width: 160px; text-decoration: none; display: inline-flex; align-items: center; justify-content: center;">Call Support</a>\n      </div>\n    </section>\n  `,outlet.style.opacity="1",outlet.style.visibility="visible",outlet.style.display="block",isMobile&&(logger.log("[renderShopSuccess] Forcing mobile visibility immediately"),requestAnimationFrame(()=>{outlet.style.transform="none",window.scrollTo(0,0)})),logger.log("[renderShopSuccess]  Success page visible"),byId("backToShop").onclick=()=>navSet({view:null});let selectedDate=null,selectedWindow=null,availabilityData=null;async function loadAvailability(){try{const resp=await fetch("https://h2s-backend.vercel.app/api/get-availability"),data=await resp.json();data.ok?(availabilityData=data.availability,window._availMap=new Map(availabilityData.map(d=>[d.date,d])),logger.log("[Calendar] Loaded availability:",availabilityData.length,"days")):logger.warn("[Calendar] Failed to load availability:",data.error)}catch(err){logger.error("[Calendar] Availability fetch error:",err)}renderCalendar()}function renderCalendar(){const cal=byId("calendarWidget");if(cal)try{const now=new Date,currentMonth=now.getMonth(),currentYear=now.getFullYear(),firstDay=new Date(currentYear,currentMonth,1).getDay(),daysInMonth=new Date(currentYear,currentMonth+1,0).getDate(),today=now.getDate();let html=`\n      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">\n        <h4 style="margin:0; font-size:16px; font-weight:800; color:var(--cobalt);">${["January","February","March","April","May","June","July","August","September","October","November","December"][currentMonth]} ${currentYear}</h4>\n      </div>\n      <div style="display:grid; grid-template-columns: repeat(7, minmax(0, 1fr)); gap:2px; text-align:center; max-width:100%; overflow:hidden;">\n        <div style="font-size:12px; font-weight:700; color:var(--muted); padding:8px 0; min-width:0;">Sun</div>\n        <div style="font-size:12px; font-weight:700; color:var(--muted); padding:8px 0; min-width:0;">Mon</div>\n        <div style="font-size:12px; font-weight:700; color:var(--muted); padding:8px 0; min-width:0;">Tue</div>\n        <div style="font-size:12px; font-weight:700; color:var(--muted); padding:8px 0; min-width:0;">Wed</div>\n        <div style="font-size:12px; font-weight:700; color:var(--muted); padding:8px 0; min-width:0;">Thu</div>\n        <div style="font-size:12px; font-weight:700; color:var(--muted); padding:8px 0; min-width:0;">Fri</div>\n        <div style="font-size:12px; font-weight:700; color:var(--muted); padding:8px 0; min-width:0;">Sat</div>\n    `;for(let i=0;i<firstDay;i++)html+="<div></div>";for(let day=1;day<=daysInMonth;day++){const isPast=day<today,isToday=day===today,dateStr=`${currentYear}-${String(currentMonth+1).padStart(2,"0")}-${String(day).padStart(2,"0")}`,dayAvail=window._availMap?window._availMap.get(dateStr):availabilityData?availabilityData.find(d=>d.date===dateStr):null;if(isPast)html+=`<div style="padding:12px; color:#ccc; font-size:14px; min-width:0;">${day}</div>`;else if(!(!1!==dayAvail?.available)&&availabilityData)html+=`<div style="padding:12px; color:#ccc; font-size:14px; min-width:0; text-decoration:line-through;" title="No availability">${day}</div>`;else{html+=`<div class="cal-day" data-date="${dateStr}" style="${isToday?"border:2px solid var(--cobalt); border-radius:8px; cursor:pointer; font-weight:700; font-size:14px; color:var(--cobalt); transition: all 0.2s; min-width:0;":"border:2px solid transparent; border-radius:8px; cursor:pointer; font-size:14px; transition: all 0.2s; hover:border-color:var(--azure); min-width:0;"}">${day}</div>`}}html+="</div>",cal.innerHTML=html,document.querySelectorAll(".cal-day").forEach(dayEl=>{dayEl.onclick=()=>{selectedDate=dayEl.getAttribute("data-date"),document.querySelectorAll(".cal-day").forEach(d=>{d.classList.remove("selected"),d.style.background="white",d.style.borderColor="transparent",d.style.color="inherit"}),dayEl.classList.add("selected"),dayEl.style.background="var(--azure)",dayEl.style.borderColor="var(--azure)",dayEl.style.color="white",byId("timeWindowSection").style.display="block",selectedWindow=null,updateTimeSlots(selectedDate),byId("confirmApptBtn").style.opacity="0.5",byId("confirmApptBtn").style.pointerEvents="none"}})}catch(err){logger.error("[Calendar] Render failed:",err),cal.innerHTML='\n        <div style="padding:20px; text-align:center; color:var(--muted);">\n          <p style="margin:0 0 12px 0;">Calendar temporarily unavailable. Please call to schedule:</p>\n          <a href="tel:864-528-1475" style="display:inline-block; padding:12px 24px; background:var(--cobalt); color:white; border-radius:8px; text-decoration:none; font-weight:700;">Call (864) 528-1475</a>\n        </div>\n      '}else logger.warn("[Calendar] Widget not found in DOM")}function updateTimeSlots(dateStr){const dayAvail=availabilityData?.find(d=>d.date===dateStr),slots=dayAvail?.slots||[];document.querySelectorAll(".time-slot-btn").forEach(btn=>{const window=btn.getAttribute("data-window"),slotAvail=slots.find(s=>s.time===window);btn.style.borderColor="var(--border)",btn.style.background="white",btn.style.color="inherit",btn.disabled=!1,btn.style.cursor="pointer",btn.style.opacity="1",slotAvail&&!slotAvail.available?(btn.disabled=!0,btn.style.background="#f3f4f6",btn.style.color="#9ca3af",btn.style.cursor="not-allowed",btn.style.opacity="0.5",btn.title="Fully booked"):slotAvail&&slotAvail.spots_remaining&&(btn.title=`${slotAvail.spots_remaining} spot${slotAvail.spots_remaining>1?"s":""} available`)})}loadAvailability().catch(err=>{logger.error("[Calendar] Failed to load, showing fallback:",err);const cal=byId("calendarWidget");cal&&(cal.innerHTML='\n        <div style="padding:20px; text-align:center; color:var(--muted);">\n          <p style="margin:0 0 12px 0;">Unable to load calendar. Please call us to schedule:</p>\n          <a href="tel:864-528-1475" style="display:inline-block; padding:12px 24px; background:var(--cobalt); color:white; border-radius:8px; text-decoration:none; font-weight:700;">Call (864) 528-1475</a>\n        </div>\n      ')}).finally(()=>{isMobile&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{logger.log("[renderShopSuccess] Applying mobile optimizations...");const outlet=document.getElementById("outlet");outlet?(outlet.style.overflow="visible",outlet.style.minHeight="auto",logger.log("[renderShopSuccess]  Outlet optimized")):logger.warn("[renderShopSuccess]  Outlet not found");const calendar=document.getElementById("calendarWidget");calendar?(calendar.style.webkitOverflowScrolling="touch",calendar.style.overflowX="auto",logger.log("[renderShopSuccess]  Calendar optimized")):logger.warn("[renderShopSuccess]  Calendar widget not found"),document.body.style.overflow="auto",document.body.style.height="auto",logger.log("[renderShopSuccess]  Mobile optimizations complete")})})}),sessionId&&(fetch(API,{method:"POST",body:JSON.stringify({__action:"mark_session",session_id:sessionId,status:"success_redirect",note:"User returned from Stripe at "+(new Date).toISOString()})}).catch(e=>logger.error("Failed to mark session:",e)),fetch(`${API}?action=orderpack&session_id=${sessionId}`).then(res=>res.json()).then(data=>{if(data.ok&&data.summary){logger.log("? Fetched order pack:",data.summary.order_id);const finalOrderId=data.summary.order_id||sessionId,finalShortId=finalOrderId.length>20?finalOrderId.substring(0,20)+"...":finalOrderId,idEl=byId("successOrderId");idEl&&(idEl.textContent=finalShortId,idEl.title=finalOrderId);const total="number"==typeof data.summary.total?data.summary.total:0,tax="number"==typeof data.summary.tax?data.summary.tax:0,currency=data.summary.currency||"USD",totalEl=byId("successOrderTotal");totalEl&&(totalEl.innerHTML=`${money(total)} <span style="font-size: 14px; font-weight: 600; color: var(--muted);">${currency}</span>`);const taxRow=byId("successTaxRow"),taxEl=byId("successTaxAmount");taxRow&&taxEl&&(tax>0?(taxRow.style.display="flex",taxEl.textContent=money(tax)):taxRow.style.display="none");const itemsEl=byId("successOrderItems");if(itemsEl&&data.lines&&data.lines.length>0){const parts=[];data.lines.forEach(l=>{const name=l.service_name||l.name||l.bundle_id||l.service_id||("bundle"===l.line_type?"Bundle":"Service");parts.push(`<div style="margin-bottom:4px;"> ${Number(l.qty||1)}x ${escapeHtml(name)}</div>`)}),itemsEl.innerHTML=parts.join("")}else itemsEl&&(itemsEl.textContent="Order details loaded");if(data.summary.discount_code){const promoRow=byId("successPromoRow"),promoCode=byId("successPromoCode");promoRow&&promoCode&&(promoRow.style.display="flex",promoCode.textContent=data.summary.discount_code)}h2sTrack("Purchase",{order_id:finalOrderId,value:String(total),currency:currency,num_items:String(data.lines?.length||0),customer_email:user?.email||data.customer?.email||null,customer_phone:user?.phone||data.customer?.phone||null,revenue_amount:parseFloat(total)||0})}}).catch(err=>logger.error("Failed to fetch order pack:",err))),document.querySelectorAll(".time-slot-btn").forEach(btn=>{btn.onclick=()=>{if(btn.disabled)return;selectedWindow=btn.getAttribute("data-window"),document.querySelectorAll(".time-slot-btn").forEach(b=>{b.style.borderColor="var(--border)",b.style.background="white",b.style.color="inherit"}),btn.style.borderColor="var(--azure)",btn.style.background="var(--azure)",btn.style.color="white";const confirmBtn=byId("confirmApptBtn");confirmBtn.style.opacity="1",confirmBtn.style.pointerEvents="auto"}});const confirmBtn=byId("confirmApptBtn"),schedMsg=byId("schedMsg");confirmBtn&&(confirmBtn.onclick=async()=>{if(!selectedDate||!selectedWindow)return void(schedMsg&&(schedMsg.style.color="#c33",schedMsg.textContent="Select a date and time window."));confirmBtn.disabled=!0;const prev=confirmBtn.textContent;confirmBtn.textContent="Saving...";try{const tz=Intl.DateTimeFormat().resolvedOptions().timeZone||"America/New_York",params=new URL(location.href).searchParams,stableId=params.get("session_id")||params.get("stripe_session_id")||""||displayOrderId,[startLabel,endLabel]=selectedWindow.split(" - "),toIso=label=>{const match=label.trim().match(/(\d{1,2}):(\d{2})\s*(AM|PM)/i);if(!match)throw new Error("Invalid time format");let hours=parseInt(match[1],10);const minutes=parseInt(match[2],10),isPM="PM"===match[3].toUpperCase();isPM&&12!==hours&&(hours+=12),isPM||12!==hours||(hours=0);const isoDate=`${selectedDate}T${String(hours).padStart(2,"0")}:${String(minutes).padStart(2,"0")}:00`;return new Date(isoDate).toISOString()},startIso=toIso(startLabel),endIso=toIso(endLabel);logger.log("[Schedule] Sending payload",{order_id:stableId,delivery_date:selectedDate,delivery_time:selectedWindow});const resp=await fetch(APIV1,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({order_id:stableId,delivery_date:selectedDate,delivery_time:selectedWindow,start_iso:startIso,end_iso:endIso,timezone:tz})}),data=await resp.json();if(!resp.ok||!data.ok){const errorMsg=data.error||`HTTP ${resp.status}`;if("slot_full"===data.error_code)throw new Error(`${errorMsg}\n\nTip: Try selecting a different time window or date.`);throw new Error(errorMsg)}schedMsg&&(schedMsg.style.color="#0b6e0b",schedMsg.textContent="Appointment scheduled. Check your email for confirmation."),confirmBtn.textContent="Scheduled",confirmBtn.style.background="linear-gradient(135deg, #10b981 0%, #059669 100%)",confirmBtn.disabled=!0}catch(err){schedMsg&&(schedMsg.style.color="#c33",schedMsg.textContent="Failed to schedule: "+err.message),logger.error("[Schedule] Failed to schedule",err)}finally{confirmBtn.disabled=!1,confirmBtn.textContent=prev}})}catch(err){console.error("[renderShopSuccess] Critical Error:",err);const outlet=document.getElementById("outlet");if(outlet)try{const recentCheckout=JSON.parse(localStorage.getItem("h2s_last_checkout")||"{}"),cartTotal=cart&&cart.length>0?cart.reduce((sum,item)=>sum+item.price*item.qty,0):0;outlet.innerHTML=`\n          <section class="form" style="max-width: 720px; margin: 60px auto 40px; padding: 20px;">\n            <div style="text-align: center; margin-bottom: 32px;">\n              <div style="width: 64px; height: 64px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 16px; box-shadow: 0 4px 16px rgba(16, 185, 129, 0.3);">\n                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#ffffff" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">\n                  <polyline points="20 6 9 17 4 12"></polyline>\n                </svg>\n              </div>\n              <h2 style="margin: 0 0 8px 0; font-weight: 900; font-size: 28px; color: var(--cobalt);">Order Confirmed!</h2>\n              <p style="margin: 0; color: var(--muted); font-size: 15px;">Your payment has been processed successfully</p>\n            </div>\n            \n            <div style="background: #f8f9fb; border: 1px solid var(--border); border-radius: 12px; padding: 24px; margin-bottom: 24px;">\n              <h3 style="margin: 0 0 16px 0; font-size: 16px; font-weight: 800; color: var(--cobalt);">ORDER DETAILS</h3>\n              <div style="display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #e5e7eb;">\n                <span style="font-weight: 600; color: var(--muted);">Order ID</span>\n                <span style="font-family: monospace; color: var(--cobalt); font-weight: 700;">${recentCheckout.session_id?recentCheckout.session_id.substring(0,20)+"...":"Processing..."}</span>\n              </div>\n              <div style="display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #e5e7eb;">\n                <span style="font-weight: 600; color: var(--muted);">Items</span>\n                <span style="font-weight: 700; color: var(--ink);">${recentCheckout.cart_count||cart?.length||"Multiple"} item${1!==(recentCheckout.cart_count||cart?.length)?"s":""}</span>\n              </div>\n              <div style="display: flex; justify-content: space-between; padding: 16px 0 0 0;">\n                <span style="font-weight: 800; color: var(--ink); font-size: 16px;">Total Paid</span>\n                <span style="font-weight: 900; color: var(--cobalt); font-size: 22px;">${cartTotal?money(cartTotal):"Paid"}</span>\n              </div>\n            </div>\n            \n            <div style="background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); border: 2px solid #93c5fd; border-radius: 12px; padding: 20px; margin-bottom: 24px;">\n              <h3 style="margin: 0 0 12px 0; font-size: 17px; font-weight: 800; color: var(--cobalt);">What's Next?</h3>\n              <p style="margin: 0 0 16px 0; color: #1e3a8a; font-size: 14px;">Our team will contact you within 24 hours to schedule your installation. You'll receive a confirmation email at <strong>${recentCheckout.customer_email||"your email address"}</strong>.</p>\n              <a href="tel:864-528-1475" style="display: inline-block; padding: 12px 24px; background: var(--cobalt); color: white; border-radius: 8px; text-decoration: none; font-weight: 700; font-size: 14px;">Call Us: (864) 528-1475</a>\n            </div>\n            \n            <div style="text-align: center; padding: 20px; color: var(--muted); font-size: 13px;">\n              <p style="margin: 0;">Questions? Call us at <a href="tel:864-528-1475" style="color: var(--cobalt); font-weight: 600;">(864) 528-1475</a></p>\n            </div>\n            \n            ${err.message.includes("network")||err.message.includes("fetch")?'<div style="background: #fee; border: 1px solid #fca5a5; border-radius: 8px; padding: 12px; margin-top: 16px; text-align: center; font-size: 13px; color: #991b1b;"> Unable to load full order details. Your payment was successful and we\'ll send confirmation via email.</div>':""}\n          </section>\n        `;try{cart=[],localStorage.setItem("h2s_cart","[]"),window.updateCartBadge&&updateCartBadge()}catch(e){logger.warn("[renderShopSuccess] Could not clear cart:",e)}}catch(fallbackErr){outlet.innerHTML='\n          <div style="padding:40px;text-align:center;font-family:sans-serif;">\n            <div style="width:64px;height:64px;background:#10b981;border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 16px;">\n              <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#ffffff" stroke-width="3">\n                <polyline points="20 6 9 17 4 12"></polyline>\n              </svg>\n            </div>\n            <h2 style="margin:0 0 8px 0;font-weight:900;font-size:28px;color:#1e3a8a;">Payment Successful!</h2>\n            <p style="margin:0 0 20px 0;color:#64748b;">Your order has been received. We\'ll send confirmation via email.</p>\n            <a href="tel:864-528-1475" style="display:inline-block;padding:12px 24px;background:#2563eb;color:white;border-radius:8px;text-decoration:none;font-weight:700;">Call (864) 528-1475</a>\n          </div>\n        '}}},window.handleCalReturn=async function(){const order_id=getParam("order_id")||"",startIso=getParam("start")||"";byId("outlet").innerHTML='\n    <section class="form">\n      <h2 style="margin:0 0 10px 0;font-weight:900">Saving your appointment...</h2>\n      <div class="help">Just a moment.</div>\n    </section>\n  ';try{let email=user?.email||getParam("email")||"";if(!email)try{email=JSON.parse(localStorage.getItem("h2s_guest_checkout")||"{}").email||""}catch(e){}if(!email)throw new Error("Missing customer email. Please sign in or complete checkout.");if(!startIso)throw new Error("Missing appointment time.");const apptDate=new Date(startIso),today=new Date;if(apptDate.setHours(0,0,0,0),today.setHours(0,0,0,0),apptDate<=today)throw new Error("Appointments must be scheduled at least 1 day in advance. Please choose a later date.");const res=await fetch(APIV1,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({order_id:order_id||"",email:email,install_at:startIso||"",install_end_at:getParam("end")||"",timezone:getParam("tz")||""})}),data=await res.json();if(!data.ok)throw new Error(data.error||"Failed to save appointment");logger.log("Appointment saved, job creation triggered"),logger.log("Job ID:",data.job_id),localStorage.removeItem("h2s_guest_checkout"),byId("outlet").innerHTML='\n      <section class="form" style="text-align: center;">\n        <div style="width: 64px; height: 64px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 16px; box-shadow: 0 4px 16px rgba(16, 185, 129, 0.3);">\n          <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#ffffff" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">\n            <polyline points="20 6 9 17 4 12"></polyline>\n          </svg>\n        </div>\n        <h2 style="margin:0 0 10px 0;font-weight:900; color: var(--cobalt);">All Set!</h2>\n        <p class="help" style="color: var(--muted);">Your appointment has been confirmed. We\'ll send you a reminder before your scheduled time.</p>\n        <button class="btn btn-primary" onclick="navSet({view:null})" style="margin-top: 24px;">Back to Shop</button>\n      </section>\n    '}catch(err){logger.error("Appointment save failed:",err);const orderId=getParam("order_id")||getParam("session_id"),retryBtn=orderId?`<button class="btn btn-primary" onclick="navSet({view:'shopsuccess', order_id:'${escapeAttr(orderId)}'})" style="margin-top: 24px;">Pick a Different Date</button>`:'<button class="btn btn-primary" onclick="navSet({view:null})" style="margin-top: 24px;">Back to Shop</button>';byId("outlet").innerHTML=`\n      <section class="form" style="text-align: center;">\n        <h2 style="margin:0 0 10px 0;font-weight:900; color: #d32f2f;">Booking Failed</h2>\n        <p class="help" style="color: var(--muted);">${escapeHtml(err.message)}</p>\n        ${retryBtn}\n      </section>\n    `}},window.renderSignIn=function(){const outlet=byId("outlet");outlet.innerHTML=`\n    <section class="form">\n      <div style="text-align:center; margin-bottom:24px;">\n        <a href="#" onclick="navSet({view:'shop'}); return false;" class="link-btn" style="font-size:14px; color:var(--azure); font-weight:600;">\n          Back to shop\n        </a>\n      </div>\n      <h2>Sign in to your account</h2>\n      <p class="help" style="text-align:center; color:var(--text-muted); margin-bottom:20px;">Access your dashboard, track orders, and manage your account.</p>\n      <input class="inp" id="siEmail" type="email" placeholder="Email address" value="${escapeAttr(user?.email||"")}" autocomplete="email">\n      <input class="inp" id="siPass"  type="password" placeholder="Password" autocomplete="current-password">\n      <div style="display:flex; gap:12px; margin-top:24px; flex-direction:column;">\n        <button class="btn btn-primary" id="signin" style="width:100%;">Sign in</button>\n        <button class="btn btn-ghost" id="toSignup" style="width:100%;">Create account</button>\n        <button class="btn btn-subtle" id="toForgot" style="padding:10px; margin-top:8px;">Forgot password?</button>\n      </div>\n      <div id="siMsg" class="help" style="margin-top:16px; color:#d32f2f;"></div>\n    </section>\n  `,outlet.style.opacity="1",outlet.style.transition="",document.body.classList.add("app-ready"),byId("toSignup").onclick=()=>navSet({view:"signup"}),byId("toForgot").onclick=()=>navSet({view:"forgot"}),byId("signin").onclick=async()=>{const email=byId("siEmail").value.trim(),pass=byId("siPass").value;if(!email)return showMsg("siMsg","Enter your email.");if(!pass)return showMsg("siMsg","Enter your password.");showLoader();try{const resp=await fetch(API,{method:"POST",body:JSON.stringify({__action:"signin",email:email,password:pass})}),text=await resp.text();if(!resp.ok)return void showMsg("siMsg",text||"Error "+resp.status);const data=JSON.parse(text);if(!data.ok)return void showMsg("siMsg",data.error||"Sign in failed");user={name:data.user.name||"",email:data.user.email,phone:data.user.phone||"",referral_code:data.user.referral_code||"",credits:data.user.credits||0,total_spent:data.user.total_spent||0},saveUser(),window.__H2S_ENABLE_AI_RECS&&loadAIRecommendations(),h2sTrack("Login",{user_email:user.email}),navSet({view:"account"})}catch(err){showMsg("siMsg",String(err))}finally{hideLoader()}}},window.renderSignUp=function(){const seed=user||{},outlet=byId("outlet");outlet.innerHTML=`\n    <section class="form">\n      <div style="text-align:center; margin-bottom:24px;">\n        <a href="#" onclick="navSet({view:'shop'}); return false;" class="link-btn" style="font-size:14px; color:var(--azure); font-weight:600;">\n          Back to shop\n        </a>\n      </div>\n      <h2>Create your account</h2>\n      <p class="help" style="text-align:center; color:var(--text-muted); margin-bottom:20px;">Get exclusive discounts, earn credits, and track your installations.</p>\n      <input class="inp" id="suName"  type="text"  placeholder="Full name" value="${escapeAttr(seed.name||"")}" autocomplete="name">\n      <input class="inp" id="suEmail" type="email" placeholder="Email address" value="${escapeAttr(seed.email||"")}" autocomplete="email">\n      <input class="inp" id="suPhone" type="tel"   placeholder="Phone number" value="${escapeAttr(seed.phone||"")}" autocomplete="tel">\n      <input class="inp" id="suPass"  type="password" placeholder="Password (min 8 characters)" autocomplete="new-password">\n      <input class="inp" id="suPass2" type="password" placeholder="Confirm password" autocomplete="new-password">\n      <div class="help" style="text-align:center; color:var(--text-muted); margin-top:8px;">Secure checkout, order tracking, and rewards</div>\n      <div style="display:flex; gap:12px; margin-top:24px; flex-direction:column;">\n        <button class="btn btn-primary" id="createAcct" style="width:100%;">Create account</button>\n        <button class="btn btn-ghost" id="toSignin" style="width:100%;">Already have an account? Sign in</button>\n      </div>\n      <div id="suMsg" class="help" style="margin-top:16px;"></div>\n    </section>\n  `,outlet.style.opacity="1",outlet.style.transition="",document.body.classList.add("app-ready"),byId("toSignin").onclick=()=>navSet({view:"signin"}),byId("createAcct").onclick=async()=>{const name=byId("suName").value.trim(),email=byId("suEmail").value.trim(),phone=byId("suPhone").value.trim(),pw1=byId("suPass").value,pw2=byId("suPass2").value,msg=byId("suMsg"),btn=byId("createAcct");if(!email)return showMsg("suMsg","Enter your email.");if(pw1.length<8)return showMsg("suMsg","Password must be at least 8 characters.");if(pw1!==pw2)return showMsg("suMsg","Passwords do not match.");showLoader();try{const resp=await fetch(API,{method:"POST",body:JSON.stringify({__action:"create_user",user:{name:name,email:email,phone:phone,password:pw1}})}),text=await resp.text();if(!resp.ok)return void showMsg("suMsg",text||"Error "+resp.status);const data=JSON.parse(text);if(!data.ok)return void showMsg("suMsg",data.error||"Create failed");user={name:data.user.name||"",email:data.user.email,phone:data.user.phone||"",referral_code:data.user.referral_code||"",credits:data.user.credits||0,total_spent:data.user.total_spent||0},saveUser(),window.__H2S_ENABLE_AI_RECS&&loadAIRecommendations(),h2sTrack("CompleteRegistration",{user_email:user.email,user_name:user.name}),msg&&btn&&(msg.style.color="#2e7d32",msg.textContent="Account created! Welcome to Home2Smart.",btn.textContent="Success!",btn.disabled=!0),setTimeout(()=>{navSet({view:"account"})},1200)}catch(err){showMsg("suMsg",String(err))}finally{hideLoader()}}},window.renderForgot=function(){const outlet=byId("outlet");outlet.innerHTML='\n    <section class="form">\n      <div style="text-align:center; margin-bottom:24px;">\n        <a href="#" onclick="navSet({view:\'shop\'}); return false;" class="link-btn" style="font-size:14px; color:var(--azure); font-weight:600;">\n          Back to shop\n        </a>\n      </div>\n      <h2>Forgot password</h2>\n      <p class="help" style="text-align:center; color:var(--text-muted); margin-bottom:20px;">Enter your email and we\'ll send you a reset link.</p>\n      <input class="inp" id="fpEmail" type="email" placeholder="Email address" autocomplete="email">\n      <div style="display:flex; gap:12px; margin-top:24px; flex-direction:column;">\n        <button class="btn btn-primary" id="fpSend" style="width:100%;">Send reset link</button>\n        <button class="btn btn-ghost" id="fpBack" style="width:100%;">Back to sign in</button>\n      </div>\n      <div id="fpMsg" class="help" style="margin-top:16px; color:#d32f2f;"></div>\n    </section>\n  ',outlet.style.opacity="1",outlet.style.transition="",document.body.classList.add("app-ready"),byId("fpBack").onclick=()=>navSet({view:"signin"}),byId("fpSend").onclick=async()=>{const email=byId("fpEmail").value.trim();if(!email)return showMsg("fpMsg","Enter your email.");showLoader();try{const resp=await fetch(API,{method:"POST",body:JSON.stringify({__action:"request_password_reset",email:email})}),txt=await resp.text();if(!resp.ok)return void showMsg("fpMsg",txt||"Error "+resp.status);showMsg("fpMsg","If that email has an account, a reset link has been sent. Check your inbox.")}catch(err){showMsg("fpMsg",String(err))}finally{hideLoader()}}},window.renderReset=function(token){const outlet=byId("outlet");outlet.innerHTML=`\n    <section class="form">\n      <h2 style="margin:0 0 10px 0;font-weight:900">Reset password</h2>\n      <input class="inp" id="rpToken" type="text" placeholder="Reset token" value="${escapeAttr(token||"")}">\n      <input class="inp" id="rpNew1" type="password" placeholder="New password (min 8)">\n      <input class="inp" id="rpNew2" type="password" placeholder="Confirm new password">\n      <div style="display:flex; gap:10px; margin-top:6px; flex-wrap:wrap">\n        <button class="btn azure" id="rpDo">Set new password</button>\n        <button class="btn ghost" id="rpBack">Back to sign in</button>\n      </div>\n      <div id="rpMsg" class="help"></div>\n    </section>\n  `,outlet.style.opacity="1",outlet.style.transition="",document.body.classList.add("app-ready"),byId("rpBack").onclick=()=>navSet({view:"signin"}),byId("rpDo").onclick=async()=>{const tok=byId("rpToken").value.trim(),p1=byId("rpNew1").value,p2=byId("rpNew2").value;if(!tok)return showMsg("rpMsg","Missing reset token.");if(p1.length<8)return showMsg("rpMsg","Password must be at least 8 characters.");if(p1!==p2)return showMsg("rpMsg","Passwords do not match.");showLoader();try{const resp=await fetch(API,{method:"POST",body:JSON.stringify({__action:"reset_password",token:tok,new_password:p1})}),txt=await resp.text();if(!resp.ok)return void showMsg("rpMsg",txt||"Error "+resp.status);const data=JSON.parse(txt);if(!data.ok)return void showMsg("rpMsg",data.error||"Could not reset password");showMsg("rpMsg","Password updated. You can now sign in."),setTimeout(()=>navSet({view:"signin"}),800)}catch(err){showMsg("rpMsg",String(err))}finally{hideLoader()}}},window.renderAccount=function(){if(!user||!user.email)return void navSet({view:"signin"});user.referral_code||window._userRefreshing||(window._userRefreshing=!0,fetch(API+"?action=user&email="+encodeURIComponent(user.email)).then(r=>r.json()).then(d=>{window._userRefreshing=!1,d.ok&&d.user&&(user={...user,...d.user},saveUser(),renderAccount())}).catch(()=>window._userRefreshing=!1));const outlet=byId("outlet");outlet.innerHTML=`\n    <section class="form">\n      <div style="text-align:center; margin-bottom:24px;">\n        <a href="#" onclick="navSet({view:null}); return false;" class="link-btn" style="font-size:14px; color:var(--azure); font-weight:600;">\n          Back to shop\n        </a>\n      </div>\n      <h2 style="margin:0 0 10px 0;font-weight:900">Your account</h2>\n      <p class="help" style="text-align:center; color:var(--text-muted); margin-bottom:20px;">Manage your profile, view orders, and track your rewards.</p>\n      <input class="inp" id="acName"  type="text"  placeholder="Full name" value="${escapeAttr(user.name||"")}">\n      <input class="inp" id="acEmail" type="email" placeholder="Email" value="${escapeAttr(user.email||"")}" disabled>\n      <input class="inp" id="acPhone" type="tel"   placeholder="Phone" value="${escapeAttr(user.phone||"")}">\n      <div style="display:flex; gap:12px; margin-top:24px; flex-direction:column;">\n        <button class="btn btn-primary" id="saveAcct" style="width:100%;">Save changes</button>\n        <div style="display:flex; gap:8px;">\n          <button class="btn btn-ghost" id="signOut" style="flex:1;">Sign out</button>\n        </div>\n      </div>\n      <div id="acMsg" class="help" style="margin-top:16px;"></div>\n    </section>\n\n    <section class="form" style="margin-top:24px">\n      <h3 style="margin:0 0 10px 0;font-weight:900">Rewards & Credits</h3>\n      <div class="pd-box" style="background:#f0f9ff; border-color:#bae6fd;">\n        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px">\n          <div style="font-weight:800; color:#0284c7;">Available Credits</div>\n          <div style="font-weight:900; font-size:18px; color:#0284c7;">${money(user.credits||0)}</div>\n        </div>\n        <div style="margin-top:12px; padding-top:12px; border-top:1px solid #bae6fd;">\n          <div style="font-weight:800; color:#0284c7; margin-bottom:4px;">Your Referral Code</div>\n          <div style="display:flex; gap:8px; align-items:center;">\n            <div style="font-family:monospace; font-weight:900; font-size:18px; letter-spacing:1px; background:#fff; padding:8px 12px; border-radius:6px; border:1px dashed #0284c7; color:#0284c7;">\n              ${escapeHtml(user.referral_code||"Loading...")}\n            </div>\n            <button class="btn btn-primary" style="padding:8px 16px; font-size:13px;" onclick="navigator.clipboard.writeText('${escapeHtml(user.referral_code||"")}').then(()=>this.textContent='Copied!')">Copy Code</button>\n          </div>\n          <div style="font-size:13px; color:#0369a1; margin-top:8px;">Share this code. Friends get discount, you get credit.</div>\n        </div>\n      </div>\n    </section>\n\n    <section class="form" style="margin-top:24px">\n      <button class="btn ghost" id="cpToggle" aria-expanded="false">Change password</button>\n      <div id="cpPanel" class="pd-box" style="display:none; margin-top:10px">\n        <h3 style="margin:0 0 10px 0;font-weight:900">Change password</h3>\n        <input class="inp" id="cpOld" type="password" placeholder="Current password">\n        <input class="inp" id="cpNew1" type="password" placeholder="New password (min 8)">\n        <input class="inp" id="cpNew2" type="password" placeholder="Confirm new password">\n        <div style="display:flex; gap:10px; margin-top:6px; flex-wrap:wrap">\n          <button class="btn azure" id="cpDo">Update password</button>\n        </div>\n        <div id="cpMsg" class="help"></div>\n      </div>\n    </section>\n\n    <section class="form" style="margin-top:24px">\n      <h3 style="margin:0 0 10px 0;font-weight:900">Previous orders</h3>\n      <div id="ordersBox" class="pd-box"><div class="help">Loading</div></div>\n    </section>\n  `,byId("saveAcct").onclick=async()=>{const name=byId("acName").value.trim(),phone=byId("acPhone").value.trim();showLoader();try{const resp=await fetch(API,{method:"POST",body:JSON.stringify({__action:"upsert_user",user:{name:name,phone:phone,email:user.email}})}),text=await resp.text();if(!resp.ok)return void showMsg("acMsg",text||"Error "+resp.status);const data=JSON.parse(text);if(!data.ok)return void showMsg("acMsg",data.error||"Save failed");user={...user,...data.user},saveUser(),showMsg("acMsg","Saved successfully.")}catch(err){showMsg("acMsg",String(err))}finally{hideLoader()}},byId("signOut").onclick=()=>{user={},saveUser(),navSet({view:null})},outlet.style.opacity="1",outlet.style.transition="",document.body.classList.add("app-ready");const cpToggle=byId("cpToggle"),cpPanel=byId("cpPanel");cpToggle&&cpPanel&&(cpToggle.onclick=()=>{const open="none"!==cpPanel.style.display;cpPanel.style.display=open?"none":"",cpToggle.setAttribute("aria-expanded",String(!open))});const cpDo=byId("cpDo");cpDo&&(cpDo.onclick=async()=>{const oldp=byId("cpOld").value,p1=byId("cpNew1").value,p2=byId("cpNew2").value;if(!oldp)return showMsg("cpMsg","Enter your current password.");if(p1.length<8)return showMsg("cpMsg","New password must be at least 8 characters.");if(p1!==p2)return showMsg("cpMsg","Passwords do not match.");showLoader();try{const resp=await fetch(API,{method:"POST",body:JSON.stringify({__action:"change_password",email:user.email,old_password:oldp,new_password:p1})}),txt=await resp.text();if(!resp.ok)return void showMsg("cpMsg",txt||"Error "+resp.status);const data=JSON.parse(txt);if(!data.ok)return void showMsg("cpMsg",data.error||"Could not change password");showMsg("cpMsg","Password updated."),byId("cpOld").value=byId("cpNew1").value=byId("cpNew2").value=""}catch(err){showMsg("cpMsg",String(err))}finally{hideLoader()}}),loadOrders()},window.updateQuoteEstimate=function(){const type=document.getElementById("quoteType")?.value||"tv",qty=parseInt(document.getElementById("quoteQty")?.value)||1,surface=document.getElementById("quoteSurface")?.value||"standard",estimateBox=document.getElementById("quoteEstimateValue");if(!estimateBox)return;if("commercial"===surface)return void(estimateBox.innerText="Custom Quote");let basePrice=0,perItem=0;"tv"===type?(basePrice=149,perItem=183):"camera"===type?(basePrice=0,perItem=250):(basePrice=199,perItem=200);let totalLow=basePrice+perItem*qty;"brick"===surface&&(totalLow+=50*qty);let totalHigh=Math.round(1.15*totalLow);estimateBox.innerText=`$${totalLow} - $${totalHigh}`},window.requestQuote=function(packageId){const modal=document.getElementById("quoteModal"),backdrop=document.getElementById("backdrop"),titleEl=document.getElementById("quoteModalTitle");if(!modal||!backdrop)return;const typeSelect=document.getElementById("quoteType");if(typeSelect){if(Array.from(typeSelect.options).forEach(opt=>opt.disabled=!1),"tv_custom"===packageId){typeSelect.value="tv";const camOpt=Array.from(typeSelect.options).find(o=>"camera"===o.value);camOpt&&(camOpt.disabled=!0)}else if("cam_custom"===packageId){typeSelect.value="camera";const tvOpt=Array.from(typeSelect.options).find(o=>"tv"===o.value);tvOpt&&(tvOpt.disabled=!0)}else typeSelect.value="both";"function"==typeof window.updateQuoteEstimate&&window.updateQuoteEstimate()}titleEl.textContent="tv_custom"===packageId?"Custom TV Mounting Quote":"cam_custom"===packageId?"Custom Security Camera Quote":"Request Custom Quote";const detailsField=document.getElementById("quoteDetails");if(detailsField){const projectType="tv_custom"===packageId?"TV mounting":"security camera installation";detailsField.placeholder=`Describe any specific needs for your ${projectType}...`}modal.dataset.packageId=packageId;try{modal.dataset.prevFocus=document.activeElement?.id||""}catch(e){modal.dataset.prevFocus=""}modal.classList.add("show"),backdrop.classList.add("show"),H2S_lockScroll(),setTimeout(()=>{const nameInput=document.getElementById("quoteName");nameInput&&nameInput.focus()},100)},window.closeQuoteModal=function(){const modal=document.getElementById("quoteModal"),backdrop=document.getElementById("backdrop");modal&&modal.classList.remove("show");const menuOpen=document.getElementById("menuDrawer")?.classList.contains("open"),cartOpen=document.getElementById("cartDrawer")?.classList.contains("open"),mainModalOpen=document.getElementById("modal")?.classList.contains("show");menuOpen||cartOpen||mainModalOpen||!backdrop||backdrop.classList.remove("show"),H2S_unlockScroll(),["quoteName","quoteEmail","quotePhone","quoteDetails"].forEach(id=>{const el=document.getElementById(id);el&&(el.value="")});const msg=document.getElementById("quoteMessage");msg&&(msg.textContent="");try{const prevId=modal?.dataset?.prevFocus;if(prevId){const prevEl=document.getElementById(prevId);prevEl&&"function"==typeof prevEl.focus&&prevEl.focus()}else{const outlet=document.getElementById("outlet");outlet&&"function"==typeof outlet.focus&&outlet.focus()}modal&&modal.dataset&&(modal.dataset.prevFocus="")}catch(e){}},window.submitQuoteRequest=async function(){const name=document.getElementById("quoteName")?.value.trim()||"",email=document.getElementById("quoteEmail")?.value.trim()||"",phone=document.getElementById("quotePhone")?.value.trim()||"",details=document.getElementById("quoteDetails")?.value.trim()||"",type=document.getElementById("quoteType")?.value||"N/A",qty=document.getElementById("quoteQty")?.value||"N/A",surface=document.getElementById("quoteSurface")?.value||"N/A",estimate=document.getElementById("quoteEstimateValue")?.innerText||"N/A",msg=document.getElementById("quoteMessage"),btn=document.getElementById("submitQuoteBtn"),modal=document.getElementById("quoteModal"),packageId=modal?.dataset.packageId||"unknown";if(msg&&btn){if(!name)return msg.style.color="#d32f2f",void(msg.textContent="Please enter your name");if(!email||!email.includes("@"))return msg.style.color="#d32f2f",void(msg.textContent="Please enter a valid email address");if(!phone)return msg.style.color="#d32f2f",void(msg.textContent="Please enter your phone number");btn.disabled=!0,btn.textContent="Sending...",msg.textContent="";try{const quoteEndpoint=API.replace("/api/shop","/api/quote"),smartDetails=`\n[Smart Quote Data]\nType: ${type}\nQuantity: ${qty}\nSurface: ${surface}\nEst. Range: ${estimate}\n------------------\n${details}\n    `.trim();if(btn.disabled)return;btn.disabled=!0,btn.textContent="Sending...";const response=await fetch(quoteEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:name,email:email,phone:phone,details:smartDetails,package_type:packageId,source:"/shop",timestamp:(new Date).toISOString()})}),data=await response.json();if(!response.ok||!data.ok)throw new Error(data.error||"Server error");msg.style.color="#2e7d32",msg.textContent="Request sent! We'll contact you within 1 hour.",h2sTrack("QuoteRequested",{package_type:packageId,email:email,name:name,phone:phone,customer_email:email,quote_id:data.quote_id}),setTimeout(()=>{closeQuoteModal()},2e3)}catch(error){logger.error("Quote request failed:",error),msg.style.color="#d32f2f",msg.textContent="Failed to send. Please call us at (864) 528-1475",btn.disabled=!1,btn.textContent="Send Request"}}},window.scheduleOrder=function(orderId){navSet({view:"shopsuccess",order_id:orderId})},window.rescheduleOrder=async function(orderId,currentDate,currentTime){const newDate=prompt(`Reschedule appointment\n\nCurrent: ${currentDate} at ${currentTime}\n\nEnter new date (YYYY-MM-DD):`,currentDate);if(!newDate)return;const newTime=prompt('Enter new time (e.g., "9:00 AM - 11:00 AM"):',currentTime||"9:00 AM - 11:00 AM");if(!newTime)return;if(!/^\d{4}-\d{2}-\d{2}$/.test(newDate))return void alert("Invalid date format. Please use YYYY-MM-DD (e.g., 2025-12-15)");const reason=prompt("Reason for reschedule (optional):","")||"Customer request";showLoader();try{const response=await fetch(API,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({__action:"reschedule_appointment",order_id:orderId,delivery_date:newDate,delivery_time:newTime,reason:reason})}),data=await response.json();if(!response.ok||!data.ok)throw new Error(data.error||"Reschedule failed");alert(" Appointment rescheduled successfully!\n\nNew date: "+newDate+"\nNew time: "+newTime),loadOrders()}catch(error){console.error("Reschedule error:",error),alert("Failed to reschedule: "+error.message+"\n\nPlease call us at (864) 528-1475")}finally{hideLoader()}},logger.log("? Deferred logic loaded");</script>

<script>
(function () {
  // Capture the giant inline deferred app script and run it just-after-first-paint.
  // This avoids JS compilation/parse work during initial render.
  try {
    if (window.__H2S_MONOLITH_CAPTURED__) return;

    // If the monolith is already stored as an inert node, do not capture.
    try {
      var existing = document.getElementById('__H2S_APP_MONOLITH__');
      if (existing && existing.tagName === 'SCRIPT') {
        window.__H2S_MONOLITH_CAPTURED__ = true;
        return;
      }
    } catch (_) {}

    // If the app already booted (monolith already executed), do not capture/remove it.
    // This prevents accidental double-exec via the runner.
    if (typeof window.checkout === 'function') return;

    var prev = document.currentScript && document.currentScript.previousElementSibling;
    if (!prev || prev.tagName !== 'SCRIPT') return;
    // Heuristic: the monolith always starts with this prefix.
    var code = (prev.text || prev.textContent || '');
    if (code.indexOf('"use strict";const isDev=') !== 0) return;

    // Store code in an inert node for the runner.
    window.__H2S_MONOLITH_CAPTURED__ = true;
    try {
      var inert = document.createElement('script');
      inert.type = 'text/plain';
      inert.id = '__H2S_APP_MONOLITH__';
      inert.text = code;
      prev.parentNode.insertBefore(inert, prev);
    } catch (_) {}

    // Neutralize the original deferred script in-place (do not remove it).
    // This avoids any edge case where a removed deferred script still executes.
    try { prev.type = 'text/plain'; } catch (_) {}
    try { prev.removeAttribute && prev.removeAttribute('defer'); } catch (_) {}
    try { prev.text = ''; } catch (_) {}
    try { prev.textContent = ''; } catch (_) {}
  } catch (_) {
    // Fail open (page still works as before).
  }
})();
</script>

<script>
(function () {
  function getCode() {
    try {
      var node = document.getElementById('__H2S_APP_MONOLITH__');
      if (node && (node.text || node.textContent)) return node.text || node.textContent;
    } catch (_) {}
    return '';
  }

  function flushQueue() {
    try {
      var q = window.__H2S_CALL_QUEUE__;
      if (!q || !q.length) return;
      var next = [];
      for (var i = 0; i < q.length; i++) {
        var item = q[i];
        var fn = window[item && item.name];
        if (typeof fn === 'function') {
          try { fn.apply(window, item.args || []); } catch (_) {}
        } else {
          next.push(item);
        }
      }
      window.__H2S_CALL_QUEUE__ = next;
    } catch (_) {}
  }

  function run() {
    try {
      if (window.__H2S_MONOLITH_RAN__) return;

      // If the monolith already executed (inline script ran during parsing),
      // do NOT execute it again; just drain any queued early calls.
      if (typeof window.checkout === 'function') {
        window.__H2S_MONOLITH_RAN__ = true;
        var triesBooted = 0;
        var bootedTimer = setInterval(function () {
          triesBooted++;
          flushQueue();
          if (!window.__H2S_CALL_QUEUE__ || window.__H2S_CALL_QUEUE__.length === 0 || triesBooted > 60) {
            clearInterval(bootedTimer);
          }
        }, 50);
        return;
      }

      window.__H2S_MONOLITH_RAN__ = true;

      var code = getCode();
      if (!code) return;

      var s = document.createElement('script');
      s.text = code;
      document.head.appendChild(s);

      var tries = 0;
      var timer = setInterval(function () {
        tries++;
        flushQueue();
        if (!window.__H2S_CALL_QUEUE__ || window.__H2S_CALL_QUEUE__.length === 0 || tries > 60) {
          clearInterval(timer);
        }
      }, 50);
    } catch (_) {}
  }

  // Schedule for after first paint (rAF -> next paint; setTimeout -> after paint work).
  if (typeof requestAnimationFrame === 'function') {
    requestAnimationFrame(function () { setTimeout(run, 0); });
  } else {
    setTimeout(run, 0);
  }
})();
</script>

<!-- Performance metrics moved to deferred module to avoid main-thread work affecting LCP -->
</div><!-- /#pageShell -->
<div id="modalRoot"></div>
<script>
(function() {
  // Portal Pattern: Move modal root to body to escape GHL stacking contexts
  function moveModalsToBody() {
    var root = document.getElementById('modalRoot');
    if (!root) {
      root = document.createElement('div');
      root.id = 'modalRoot';
      document.body.appendChild(root);
    } else {
      document.body.appendChild(root);
    }
    
    // Move known fixed elements
    var ids = ['quoteModal', 'modal', 'tvSizeModal', 'menuDrawer', 'cartDrawer', 'backdrop', 'urgencyBanner'];
    ids.forEach(function(id) {
      var el = document.getElementById(id);
      if (el) root.appendChild(el);
    });
  }
  
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', moveModalsToBody);
  } else {
    moveModalsToBody();
  }
})();

// === CHARACTER SANITIZER (Bundles Page) ===
// Goal: ensure no mojibake/replacement characters leak into user-visible UI.
(function(){
  try {
    if (window.__H2S_CHAR_SANITIZER__) return;
    window.__H2S_CHAR_SANITIZER__ = true;

    var pairs = [
      // Common mojibake from UTF-8 -> Latin1
      ['', ''],
      ['', ''],
      ['', ''],
      ['', ''],
      ['', ''],
      ['', ''],
      ['', ''],
      ['', ''],
      ['', ''],
      // Replacement char sequences (keep intent: ellipsis)
      ['', ''],
      // Emoji mojibake in debug-only strings (remove rather than show garbage)
      ['', ''],
      ['', ''],
      ['', ''],
      ['', ''],
    ];

    function sanitizeString(s) {
      if (!s || typeof s !== 'string') return s;
      var out = s;
      for (var i = 0; i < pairs.length; i++) {
        var from = pairs[i][0];
        var to = pairs[i][1];
        if (out.indexOf(from) !== -1) out = out.split(from).join(to);
      }
      // Final fallback: actual replacement character.
      if (out.indexOf('\uFFFD') !== -1) out = out.split('\uFFFD').join('');
      return out;
    }

    function sanitizeAttributes(el) {
      try {
        if (!el || el.nodeType !== 1) return;
        var attrs = ['title', 'aria-label', 'placeholder'];
        for (var i = 0; i < attrs.length; i++) {
          var k = attrs[i];
          var v = el.getAttribute && el.getAttribute(k);
          if (v && typeof v === 'string') {
            var fixed = sanitizeString(v);
            if (fixed !== v) el.setAttribute(k, fixed);
          }
        }
      } catch (_) {}
    }

    function sanitizeSubtree(root) {
      try {
        if (!root) return;
        if (root.nodeType === 3) {
          var v = root.nodeValue;
          var fixedText = sanitizeString(v);
          if (fixedText !== v) root.nodeValue = fixedText;
          return;
        }
        if (root.nodeType !== 1 && root.nodeType !== 9 && root.nodeType !== 11) return;

        if (root.nodeType === 1) sanitizeAttributes(root);

        var walker = document.createTreeWalker(root, NodeFilter.SHOW_TEXT, null);
        var node;
        while ((node = walker.nextNode())) {
          var txt = node.nodeValue;
          var fixed = sanitizeString(txt);
          if (fixed !== txt) node.nodeValue = fixed;
        }

        if (root.querySelectorAll) {
          root.querySelectorAll('[title],[aria-label],[placeholder]').forEach(function(el){
            sanitizeAttributes(el);
          });
        }
      } catch (_) {}
    }

    function runOnce() {
      sanitizeSubtree(document.body || document.documentElement);
      // Explicitly fix the Mount Selection Guide caret if present.
      try {
        var icon = document.getElementById('guideToggleIcon');
        if (icon && typeof icon.textContent === 'string') {
          var fixed = sanitizeString(icon.textContent);
          if (fixed !== icon.textContent) icon.textContent = fixed;
        }
      } catch (_) {}
    }

    // Initial pass
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', function(){
        setTimeout(runOnce, 0);
      }, { once: true });
    } else {
      setTimeout(runOnce, 0);
    }

    // Keep it clean for dynamically injected HTML (modals, orders, promo messages).
    if (window.MutationObserver) {
      var pending = [];
      var scheduled = false;
      var flush = function(){
        scheduled = false;
        for (var i = 0; i < pending.length; i++) sanitizeSubtree(pending[i]);
        pending = [];
      };
      var obs = new MutationObserver(function(muts){
        for (var i = 0; i < muts.length; i++) {
          var m = muts[i];
          if (m && m.addedNodes && m.addedNodes.length) {
            for (var j = 0; j < m.addedNodes.length; j++) {
              var n = m.addedNodes[j];
              if (n) pending.push(n);
            }
          }
          if (m && m.type === 'characterData' && m.target) pending.push(m.target);
        }
        if (!scheduled) {
          scheduled = true;
          if (typeof queueMicrotask === 'function') queueMicrotask(flush);
          else if (typeof Promise !== 'undefined') Promise.resolve().then(flush);
          else if (typeof requestAnimationFrame === 'function') requestAnimationFrame(flush);
          else setTimeout(flush, 0);
        }
      });
      obs.observe(document.documentElement, { subtree: true, childList: true, characterData: true });
    }
  } catch (_) {}
})();

// === TEXT / GLYPH FIXES (Bundles Page) ===
// Fixes a legacy encoding artifact where '?&mdash;' renders literally.
(function(){
  try {
    if (typeof window.escapeHtml === 'function' && !window.escapeHtml.__h2s_textfix) {
      var origEscapeHtml = window.escapeHtml;
      var patched = function(text) {
        try {
          if (typeof text === 'string') {
            // Replace any accidental literal HTML entity text with a real em dash.
            text = text
              .replace(/\?\s*&mdash;/g, ' ')
              .replace(/\?&mdash;/g, '')
              .replace(/&mdash;/g, '');
          }
        } catch (_) {}
        return origEscapeHtml(text);
      };
      patched.__h2s_textfix = true;
      window.escapeHtml = patched;
    }

    if (typeof window.renderHeroReviews === 'function' && !window.renderHeroReviews.__h2s_textfix) {
      var origRenderHeroReviews = window.renderHeroReviews;
      window.renderHeroReviews = function(){
        var res = origRenderHeroReviews.apply(this, arguments);
        try {
          document.querySelectorAll('.hero-review-text').forEach(function(el){
            if (el && typeof el.textContent === 'string') {
              el.textContent = el.textContent.replace('Same-day service saved me!', 'Instant booking saved me!');
            }
          });
        } catch (_) {}
        return res;
      };
      window.renderHeroReviews.__h2s_textfix = true;
    }
  } catch (_) {}
})();

// === UX / SMOOTHNESS PATCHES (Bundles Page) ===
// Goal: improve click/close behavior + animation consistency without editing minified app code.
(function(){
  if (window.__H2S_BUNDLES_UX_PATCH__) return;
  window.__H2S_BUNDLES_UX_PATCH__ = true;

  function getView(){
    try { return new URL(location.href).searchParams.get('view'); } catch (_) { return null; }
  }

  function safeCloseAll(){
    try {
      if (typeof window.closeAll === 'function') return window.closeAll();
    } catch (_) {}
    try {
      document.getElementById('menuDrawer')?.classList.remove('open');
      document.getElementById('cartDrawer')?.classList.remove('open');
      document.getElementById('backdrop')?.classList.remove('show');
      document.getElementById('modal')?.classList.remove('show');
      document.getElementById('quoteModal')?.classList.remove('show');
      document.getElementById('tvSizeModal')?.classList.remove('show');
      document.documentElement.classList.remove('modal-open');
      document.body.classList.remove('modal-open');
      if (typeof window.H2S_unlockScroll === 'function') window.H2S_unlockScroll();
    } catch (_) {}
  }

  function anyOverlayOpen(){
    try {
      return !!(
        document.getElementById('menuDrawer')?.classList.contains('open') ||
        document.getElementById('cartDrawer')?.classList.contains('open') ||
        document.getElementById('modal')?.classList.contains('show') ||
        document.getElementById('quoteModal')?.classList.contains('show') ||
        document.getElementById('tvSizeModal')?.classList.contains('show')
      );
    } catch (_) {
      return false;
    }
  }

  // Backdrop click should consistently close overlays.
  try {
    var bd = document.getElementById('backdrop');
    if (bd && !bd.__h2sUxBound) {
      bd.addEventListener('click', function(e){
        if (e && e.target && e.target.id === 'backdrop' && anyOverlayOpen()) safeCloseAll();
      });
      bd.__h2sUxBound = true;
    }
  } catch (_) {}

  // ESC should consistently close overlays (menu/cart/modals).
  try {
    document.addEventListener('keydown', function(e){
      if (e && e.key === 'Escape' && anyOverlayOpen()) {
        e.preventDefault();
        safeCloseAll();
      }
    }, { passive: false });
  } catch (_) {}

  // Ensure menu open uses the same scroll-lock behavior as cart.
  try {
    if (typeof window.toggleMenu === 'function' && !window.toggleMenu.__h2sUxWrapped) {
      var origToggleMenu = window.toggleMenu;
      window.toggleMenu = function(){
        var wasOpen = !!document.getElementById('menuDrawer')?.classList.contains('open');
        var res = origToggleMenu.apply(this, arguments);
        var isOpen = !!document.getElementById('menuDrawer')?.classList.contains('open');
        if (!wasOpen && isOpen && typeof window.H2S_lockScroll === 'function') {
          window.H2S_lockScroll();
        }
        if (wasOpen && !isOpen) {
          // Only unlock if nothing else is open.
          if (!anyOverlayOpen() && typeof window.H2S_unlockScroll === 'function') window.H2S_unlockScroll();
        }
        return res;
      };
      window.toggleMenu.__h2sUxWrapped = true;
    }
  } catch (_) {}

  // Success view: show loader during render and avoid pushing phone calls as the default next step.
  function patchSuccessView(){
    if (getView() !== 'shopsuccess') return;
    try { if (typeof window.showLoader === 'function') window.showLoader(); } catch (_) {}

    function formatMoneyMaybe(n){
      try {
        var v = Number(n);
        if (!isFinite(v)) return '$0.00';
        return (typeof window.money === 'function') ? window.money(v) : ('$' + v.toFixed(2));
      } catch (_) {
        return '$0.00';
      }
    }

    function readCheckoutSnapshot(){
      try {
        var raw = localStorage.getItem('h2s_checkout_snapshot');
        if (!raw) return null;
        return JSON.parse(raw);
      } catch (_) {
        return null;
      }
    }

    function parseSessionIdFromUrl(){
      try {
        var params = new URL(window.location.href).searchParams;
        return params.get('session_id') || params.get('stripe_session_id') || '';
      } catch (_) {
        return '';
      }
    }

    function ensureOrderValueRow(){
      try {
        if (document.getElementById('successOrderValue')) return;
        var totalEl = document.getElementById('successOrderTotal');
        if (!totalEl) return;
        // Find the containing grid/card
        var grid = null;
        try { grid = totalEl.closest('.details-grid'); } catch (_) { grid = null; }
        if (!grid) return;

        // Insert a row before the total row.
        var totalRow = null;
        try { totalRow = totalEl.parentElement && totalEl.parentElement.parentElement ? totalEl.parentElement.parentElement : totalEl.parentElement; } catch (_) { totalRow = null; }
        if (!totalRow || !totalRow.insertAdjacentHTML) return;

        totalRow.insertAdjacentHTML('beforebegin',
          '<div id="successOrderValueRow" style="display:flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #e5e7eb;">' +
            '<span style="font-weight: 600; color: var(--muted); font-size: 14px;">Order Value</span>' +
            '<span id="successOrderValue" style="font-weight: 800; color: var(--ink); font-size: 14px;">Loading</span>' +
          '</div>'
        );

        // Relabel the existing row from Total Paid -> Paid Today (so we can show value + paid).
        try {
          var labelSpan = totalRow.querySelector && totalRow.querySelector('span');
          if (labelSpan && /total\s*paid/i.test(labelSpan.textContent || '')) labelSpan.textContent = 'Paid Today';
        } catch (_) {}
      } catch (_) {}
    }

    async function hydrateSuccessAmountsAndItems(){
      try {
        if (window.__H2S_SUCCESS_HYDRATE_ONCE__) return;
        window.__H2S_SUCCESS_HYDRATE_ONCE__ = true;
      } catch (_) {}

      ensureOrderValueRow();

      var sessionId = parseSessionIdFromUrl();
      if (!sessionId) return;

      // Fast paint: use snapshot (captured pre-redirect) if available.
      var snap = readCheckoutSnapshot();
      try {
        var valueElFast = document.getElementById('successOrderValue');
        if (valueElFast && snap && typeof snap.order_value_cents === 'number') {
          valueElFast.textContent = formatMoneyMaybe(snap.order_value_cents / 100);
        }
        var paidElFast = document.getElementById('successOrderTotal');
        if (paidElFast && snap && typeof snap.expected_paid_cents === 'number') {
          paidElFast.innerHTML = formatMoneyMaybe(snap.expected_paid_cents / 100) + ' <span style="font-size: 14px; font-weight: 600; color: var(--muted);">USD</span>';
        }
      } catch (_) {}

      // Authoritative: order details from backend (deployment-safe endpoint).
      // The checkout deployment supports: GET /api/get-order-details?session_id=...
      // Retry once for transient errors, then replace infinite-loading with a customer-safe message.
      try {
        var endpoint = 'https://h2s-backend.vercel.app/api/get-order-details?session_id=' + encodeURIComponent(sessionId);

        async function doFetch(){
          var r = await fetch(endpoint, { method: 'GET', headers: { 'Accept': 'application/json' }, cache: 'no-store' });
          var txt = '';
          try { txt = await r.text(); } catch (_) { txt = ''; }
          var parsed = null;
          try { parsed = txt ? JSON.parse(txt) : null; } catch (_) { parsed = null; }
          return { res: r, data: parsed, text: txt };
        }

        var attempt1 = await doFetch();
        var r1 = attempt1.res;
        var data1 = attempt1.data;

        // Quick retry for transient/network-ish issues.
        if (!r1.ok && (r1.status === 500 || r1.status === 502 || r1.status === 503 || r1.status === 504)) {
          await new Promise(function(resolve){ setTimeout(resolve, 800); });
          attempt1 = await doFetch();
          r1 = attempt1.res;
          data1 = attempt1.data;
        }

        if (!r1.ok || !data1 || !data1.ok || !data1.order) {
          // Stop infinite loading.
          try {
            var itemsElFail = document.getElementById('successOrderItems');
            if (itemsElFail) {
              var shownId = sessionId;
              var msg = "Were confirming your order. If this doesnt update in a moment, contact support with your Order ID.";
              itemsElFail.innerHTML = '<div style="color: var(--muted); font-weight: 700;">' + msg + '</div>' +
                '<div style="margin-top:6px; font-family: monospace; font-size: 12px; color: var(--cobalt); word-break: break-all;">' + (typeof window.escapeHtml === 'function' ? window.escapeHtml(shownId) : String(shownId)) + '</div>';
            }
            var valueElFail = document.getElementById('successOrderValue');
            if (valueElFail && (valueElFail.textContent || '').indexOf('Loading') >= 0) valueElFail.textContent = '';
            var paidElFail = document.getElementById('successOrderTotal');
            if (paidElFail && (paidElFail.textContent || '').indexOf('Loading') >= 0) paidElFail.textContent = '';
          } catch (_) {}
          return;
        }

        ensureOrderValueRow();

        var order = data1.order;

        // Order ID display: prefer stored order_id, fallback to Stripe session id.
        try {
          var finalOrderId = String(order.order_id || order.stripe_session_id || sessionId || '');
          var idEl = document.getElementById('successOrderId');
          if (idEl && finalOrderId) {
            var shortId = finalOrderId.length > 20 ? finalOrderId.substring(0, 20) + '...' : finalOrderId;
            idEl.textContent = shortId;
            idEl.title = finalOrderId;
          }
        } catch (_) {}

        // Compute order value (pre-discount) from snapshot first, else from items' price fields.
        var orderValue = 0;
        try {
          if (snap && typeof snap.order_value_cents === 'number') {
            orderValue = snap.order_value_cents / 100;
          }
        } catch (_) {}
        if (!orderValue && order && Array.isArray(order.items)) {
          try {
            orderValue = order.items.reduce(function(sum, it){
              var q = Number(it.qty || it.quantity || 1) || 1;
              var pc = Number(it.price_cents || it.price || it.unit_price_cents || 0) || 0;
              // If pc looks like dollars, it will be < 1000 typically; assume dollars only if non-integer cents provided.
              var dollars = pc;
              if (pc > 0 && pc > 1000) dollars = pc / 100;
              return sum + (dollars * q);
            }, 0);
          } catch (_) {}
        }

        // Paid Today: prefer backend amount_total, else snapshot expected_paid.
        var paidToday = 0;
        try {
          paidToday = Number(order.amount_total || order.total || 0) || 0;
        } catch (_) { paidToday = 0; }
        if ((!paidToday || !isFinite(paidToday)) && snap && typeof snap.expected_paid_cents === 'number') {
          paidToday = snap.expected_paid_cents / 100;
        }

        var currency = String(order.currency || 'USD');

        try {
          var valueEl = document.getElementById('successOrderValue');
          if (valueEl && orderValue) valueEl.textContent = formatMoneyMaybe(orderValue);
        } catch (_) {}

        try {
          var paidEl = document.getElementById('successOrderTotal');
          if (paidEl) {
            paidEl.innerHTML = formatMoneyMaybe(paidToday) + ' <span style="font-size: 14px; font-weight: 600; color: var(--muted);">' + (typeof window.escapeHtml === 'function' ? window.escapeHtml(currency) : currency) + '</span>';
          }
        } catch (_) {}

        // Items list.
        try {
          var itemsEl = document.getElementById('successOrderItems');
          if (itemsEl && Array.isArray(order.items) && order.items.length) {
            var parts = [];
            order.items.forEach(function(it){
              var nm = String(it.name || it.service_name || it.id || it.service_id || 'Item');
              var q3 = Number(it.qty || it.quantity || 1) || 1;
              parts.push('<div style="margin-bottom:4px;"> ' + q3 + 'x ' + (typeof window.escapeHtml === 'function' ? window.escapeHtml(nm) : nm) + '</div>');
            });
            itemsEl.innerHTML = parts.join('');
          }
        } catch (_) {}
      } catch (_) {}
    }

    // Post-process the outlet once it renders.
    var tries = 0;
    var t = setInterval(function(){
      tries++;
      var outlet = document.getElementById('outlet');
      if (outlet) {
        try {
          // Keep calling as an optional secondary path (do not remove).
          // Demote any prominent tel CTA on success (covers "Call Us", "Call Support", "Call (864)...", etc).
          outlet.querySelectorAll('a[href^="tel:"]').forEach(function(a){
            if (!a) return;
            var txt = ((a.textContent || '') + '').trim();
            var txtLower = txt.toLowerCase();

            // Heuristic: only demote links that look like primary CTAs.
            // (If it's just inline text like "Questions? Call...", leave it alone.)
            var looksButton = false;
            try {
              looksButton = a.classList.contains('btn') ||
                a.classList.contains('btn-primary') ||
                a.classList.contains('btn-secondary');
            } catch (_) {}
            try {
              if (!looksButton) {
                var bg = (a.style && a.style.background) ? String(a.style.background) : '';
                if (bg && bg !== 'transparent' && bg !== 'none') looksButton = true;
              }
            } catch (_) {}

            if (!looksButton) return;

            // If it smells like a call CTA, demote it.
            if (txtLower.includes('call') || txtLower.includes('support') || txtLower.includes('phone') || txtLower.includes('(864)') || txtLower.includes('864')) {
              a.textContent = 'Prefer to call?';
              try {
                a.classList.remove('btn-primary');
                a.classList.remove('btn-secondary');
                a.classList.add('btn-ghost');
              } catch (_) {}
              try {
                a.style.background = '';
                a.style.color = '';
                a.style.borderRadius = '';
                a.style.fontSize = '14px';
                a.style.opacity = '0.9';
                a.style.marginTop = '12px';
                a.style.padding = '';
                a.style.display = '';
              } catch (_) {}
            }
          });

          // Normalize legacy fallback copy if it appears.
          outlet.querySelectorAll('p').forEach(function(p){
            if (!p || typeof p.textContent !== 'string') return;
            p.textContent = p.textContent
              .replace('Our team will contact you within 24 hours to schedule your installation.', 'Next: pick an installation time (subject to availability).');
          });
        } catch (_) {}
      }

      // Hide loader when success UI is present, or time out.
      var ready = !!document.getElementById('successOrderId') || !!document.getElementById('scheduleEmbed') || (outlet && outlet.querySelector && outlet.querySelector('.schedule-container'));
      if (ready || tries >= 40) {
        clearInterval(t);
        try { hydrateSuccessAmountsAndItems(); } catch (_) {}
        try { if (typeof window.hideLoader === 'function') window.hideLoader(); } catch (_) {}
      }
    }, 150);
  }

  // Detect SPA-like navigation changes.
  try {
    var _ps = history.pushState;
    history.pushState = function(){
      var r = _ps.apply(this, arguments);
      try { patchSuccessView(); } catch (_) {}
      return r;
    };
    var _rs = history.replaceState;
    history.replaceState = function(){
      var r2 = _rs.apply(this, arguments);
      try { patchSuccessView(); } catch (_) {}
      return r2;
    };
    window.addEventListener('popstate', function(){
      try { patchSuccessView(); } catch (_) {}
    });
  } catch (_) {}

  try {
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', patchSuccessView);
    } else {
      patchSuccessView();
    }
  } catch (_) {}
})();

// === TRACKING DEDUPE (Bundles Page) ===
// Goal: avoid duplicate PageView/ViewContent fires from multiple layers (global header + bundles inline code).
(function(){
  if (window.__H2S_BUNDLES_TRACK_DEDUPE__) return;
  window.__H2S_BUNDLES_TRACK_DEDUPE__ = true;

  // Bundles page relies on the global header for PageView.
  window.__H2S_EVENT_ONCE__ = window.__H2S_EVENT_ONCE__ || {};
  window.__H2S_EVENT_ONCE__.pageview = true;

  function norm(ev){
    return String(ev || '').replace(/\s+/g,'').toLowerCase();
  }

  function wrapTrackFn(key){
    var fn = window[key];
    if (typeof fn !== 'function' || fn.__h2s_deduped) return;
    window[key] = function(eventName, data){
      var k = norm(eventName);
      if (k === 'pageview' || k === 'page_view') {
        return;
      }
      if (k === 'viewcontent' || k === 'view_content') {
        if (window.__H2S_EVENT_ONCE__.viewcontent) return;
        window.__H2S_EVENT_ONCE__.viewcontent = true;
      }
      return fn.apply(this, arguments);
    };
    window[key].__h2s_deduped = true;
  }

  function apply(){
    wrapTrackFn('h2sTrack');
    wrapTrackFn('h2sFbTrack');
  }

  apply();
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', apply);
  } else {
    setTimeout(apply, 0);
  }
})();

// === REVIEWS / CAROUSEL HARDENING (Bundles Page) ===
// Goal: keep the reviews carousel rendering even if API schemas drift or reviews fail to load.
(function(){
  if (window.__H2S_BUNDLES_REVIEWS_PATCH__) return;
  window.__H2S_BUNDLES_REVIEWS_PATCH__ = true;

  function isDebugHost(){
    try {
      var h = String(location.hostname || '');
      return h === 'localhost' || h.indexOf('127.0.0.1') >= 0 || h.indexOf('vercel.app') >= 0;
    } catch (_) {
      return false;
    }
  }

  function isDebugEnabled(){
    try {
      if (isDebugHost()) return true;
      try {
        if (location && location.search && String(location.search).indexOf('debugReviews=1') >= 0) return true;
      } catch (_) {}
      try {
        if (window.localStorage && localStorage.getItem('h2s_debug_reviews') === '1') return true;
      } catch (_) {}
    } catch (_) {}
    return false;
  }

  function logOnce(key, level, msg){
    try {
      var k = '__h2s_reviews_log_' + key;
      if (window[k]) return;
      window[k] = true;
      if (!isDebugEnabled()) return;
      (console && console[level] ? console[level] : console.log).call(console, msg);
    } catch (_) {}
  }

  function logDebug(level, msg){
    try {
      if (!isDebugEnabled()) return;
      (console && console[level] ? console[level] : console.log).call(console, msg);
    } catch (_) {}
  }

  function safeArray(x){
    return Array.isArray(x) ? x : [];
  }

  // === UI TEXT SANITIZER (mojibake cleanup) ===
  function h2sFixText(s){
    if (s == null) return s;
    s = String(s);

    // Common replacement char sequence rendered as 
    s = s.replace(/\u00EF\u00BF\u00BD/g, '');

    // Emoji mojibake prefixes (UTF-8 bytes shown as Latin1/Windows-1252)
    s = s.replace(/\u00F0\u0178\u201C\u0160/g, ''); // 
    s = s.replace(/\u00F0\u0178\u00A7\u00AA/g, ''); // 
    s = s.replace(/\u00F0\u0178\u016A\u00AB/g, ''); // 

    // Common arrows/dashes/bullets
    s = s.replace(/\u00E2\u2020\u2014/g, ''); // 
    s = s.replace(/\u00E2\u20AC\u201C/g, ''); // 
    s = s.replace(/\u00E2\u20AC\u201D/g, ''); // 
    s = s.replace(/\u00E2\u20AC\u00A2/g, ''); // 

    // Checkmark/cross
    s = s.replace(/\u00E2\u009C\u0085/g, ''); // 
    s = s.replace(/\u00E2\u009D\u008C/g, ''); // 

    // Multiplication
    s = s.replace(/\u00C3\u0097/g, ''); // 

    // Fix stray leading question-mark in some promo copy
    s = s.replace(/^\?\s+(Code recognized)/, '$1');

    return s;
  }

  function h2sSanitizeTree(root){
    if (!root) return;
    try {
      var walker = document.createTreeWalker(root, NodeFilter.SHOW_TEXT, null);
      var node;
      while ((node = walker.nextNode())) {
        var fixed = h2sFixText(node.nodeValue);
        if (fixed !== node.nodeValue) node.nodeValue = fixed;
      }
    } catch (_) {}
  }

  function installMojibakeObserver(){
    if (window.__H2S_MOJIBAKE_OBS__) return;
    window.__H2S_MOJIBAKE_OBS__ = true;

    try { h2sSanitizeTree(document.body); } catch (_) {}

    try {
      var obs = new MutationObserver(function(muts){
        for (var i = 0; i < muts.length; i++) {
          var m = muts[i];
          if (m.type === 'characterData') {
            var t = m.target;
            if (t && t.nodeValue) {
              var fixed = h2sFixText(t.nodeValue);
              if (fixed !== t.nodeValue) t.nodeValue = fixed;
            }
          } else if (m.addedNodes && m.addedNodes.length) {
            for (var j = 0; j < m.addedNodes.length; j++) {
              var n = m.addedNodes[j];
              if (!n) continue;
              if (n.nodeType === 3) {
                var fixed2 = h2sFixText(n.nodeValue);
                if (fixed2 !== n.nodeValue) n.nodeValue = fixed2;
              } else if (n.nodeType === 1) {
                h2sSanitizeTree(n);
              }
            }
          }
        }
      });
      obs.observe(document.documentElement || document.body, { subtree: true, childList: true, characterData: true });
    } catch (_) {}
  }

  // === PROMO ESTIMATE: prevent flicker (stale responses) ===
  function installPromoEstimateOverride(){
    // IMPORTANT: This page bootstraps the main app via a deferred monolith runner.
    // This installer must be safe to call multiple times until the app functions exist.
    try {
      if (!window.__H2S_PROMO_EST_STATE__) window.__H2S_PROMO_EST_STATE__ = { didOverrideUpdate: false, didWrapPaint: false };
    } catch (_) {}

    async function ensureCatalogPopulated(){
      try {
        if (typeof catalog !== 'undefined' && catalog && Array.isArray(catalog.bundles) && catalog.bundles.length > 0) return true;
      } catch (_) {}
      try {
        // bundles-data is currently returning an empty catalog; the app has a fallback
        // fetchCatalogFromAPI() that hits /api/shop?action=catalog.
        if (typeof window.fetchCatalogFromAPI === 'function') {
          var ok = await window.fetchCatalogFromAPI(true);
          try {
            if (ok && typeof catalog !== 'undefined' && catalog && Array.isArray(catalog.bundles) && catalog.bundles.length > 0) return true;
          } catch (_) {}
        }
      } catch (_) {}
      return false;
    }

    function buildLineItems(){
      var out = [];
      try {
        (cart || []).forEach(function(item){
          var isPkg = item && (item.type === 'package' || item.type === 'bundle');
          var bundle = null;
          try {
            if (isPkg) {
              var id = item.bundle_id || item.id;
              bundle = (catalog && catalog.bundles ? catalog.bundles : []).find(function(b){ return b.bundle_id === id; });
            }
          } catch (_) {}

          var priceId = (bundle && bundle.stripe_price_id) || item.stripe_price_id || 'custom';
          var isDynamic = ['tv_multi','cam_basic','cam_standard','cam_premium'].indexOf(item.id || item.bundle_id) >= 0;
          var unitAmount = 0;

          if (bundle && !isDynamic && bundle.bundle_price !== undefined && bundle.bundle_price !== null) {
            unitAmount = Math.round(100 * Number(bundle.bundle_price));
          } else {
            unitAmount = Math.round(100 * Number(item.price || 0));
          }

          if (!unitAmount || unitAmount <= 0) return;
          out.push({ price: priceId, unit_amount: unitAmount, quantity: item.qty || 1 });
        });
      } catch (_) {}
      return out;
    }

    function applyEstimateToUI(code, promotionCode, savingsCents, subtotalCents, totalCents){
      try {
        var promoLine = document.getElementById('promoLine');
        var promoAmount = document.getElementById('promoAmount');
        var promoMsg = document.getElementById('promoMsg');
        var totalLabel = document.getElementById('totalLabel');
        var rawLine = document.getElementById('rawSubtotalLine');
        var rawAmount = document.getElementById('rawSubtotalAmount');
        var cartSubtotalLine = document.getElementById('cartSubtotalLine');
        var grandTotal = document.getElementById('grandTotal');
        var label = document.getElementById('promoLineLabel');

        if (!promoLine || !promoAmount) return;

        promoAmount.textContent = '-' + money(Number(savingsCents || 0) / 100);
        if (label) label.textContent = 'Promo (' + String((promotionCode || code || '')).toUpperCase() + ')';
        promoLine.style.display = 'flex';

        if (cartSubtotalLine) cartSubtotalLine.style.display = 'none';
        if (rawLine && rawAmount) {
          rawAmount.textContent = money(Number(subtotalCents || 0) / 100);
          rawLine.style.display = 'flex';
        }

        if (grandTotal) {
          grandTotal.textContent = money(Number(totalCents || 0) / 100);
          if (Number(totalCents || 0) === 0) { grandTotal.style.color = '#10b981'; grandTotal.style.fontSize = '20px'; }
          else { grandTotal.style.color = ''; grandTotal.style.fontSize = ''; }
        }

        if (totalLabel) totalLabel.textContent = 'Grand Total';
        if (promoMsg) { promoMsg.textContent = 'Code will apply at checkout.'; promoMsg.style.color = '#0b6e0b'; }
      } catch (_) {}
    }

    async function patchedUpdatePromoEstimate(){
      try {
        var promoLine = document.getElementById('promoLine');
        var promoAmount = document.getElementById('promoAmount');
        var promoMsg = document.getElementById('promoMsg');
        var totalLabel = document.getElementById('totalLabel');
        var rawLine = document.getElementById('rawSubtotalLine');
        var rawAmount = document.getElementById('rawSubtotalAmount');
        if (!promoLine || !promoAmount) return;

        if (totalLabel) totalLabel.textContent = 'Subtotal';
        if (rawLine) rawLine.style.display = 'none';

        var code = '';
        try { code = localStorage.getItem('h2s_promo_code') || ''; } catch (_) { code = ''; }
        if (!code) { promoLine.style.display = 'none'; return; }

        var line_items = buildLineItems();
        if (!line_items.length) { promoLine.style.display = 'none'; return; }

        // If catalog is empty, buildLineItems() often falls back to price:'custom', which
        // can cause promo_check_cart to report non-applicable even for valid codes.
        // Force-load the fallback catalog and retry once.
        var needsCatalog = false;
        try {
          needsCatalog = line_items.some(function(li){ return !li || !li.price || li.price === 'custom'; });
        } catch (_) { needsCatalog = false; }
        if (needsCatalog) {
          await ensureCatalogPopulated();
          line_items = buildLineItems();
          try {
            needsCatalog = line_items.some(function(li){ return !li || !li.price || li.price === 'custom'; });
          } catch (_) { needsCatalog = false; }
        }

        // If we still cant construct real Stripe prices, dont flip the UI to not applicable
        // (thats misleading). Keep last-good UI if available.
        if (needsCatalog) {
          if (promoMsg) { promoMsg.textContent = 'Checking cart'; promoMsg.style.color = '#666'; }
          if (rawLine) rawLine.style.display = 'none';
          return;
        }

        var cartSig = code + '|' + line_items.map(function(li){ return li.price + ':' + li.unit_amount + 'x' + li.quantity; }).join(',');
        var rid = window.__H2S_PROMO_REQ_ID__ = (window.__H2S_PROMO_REQ_ID__ || 0) + 1;

        var resp = await fetch(API, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ __action: 'promo_check_cart', promotion_code: code, line_items: line_items })
        });

        var data = await resp.json();
        if (rid !== window.__H2S_PROMO_REQ_ID__) return;

        // If a stale non-applicable response comes back after an applicable one for the same cart, keep the good UI.
        if (!(data && data.ok && data.applicable && data.estimate)) {
          if (window.__H2S_PROMO_LAST_GOOD_SIG__ === cartSig && window.__H2S_PROMO_LAST_GOOD_CODE__ === code && window.__H2S_PROMO_LAST_GOOD_EST__) {
            var last = window.__H2S_PROMO_LAST_GOOD_EST__;
            applyEstimateToUI(code, last.promotion_code || code, last.savings_cents, last.subtotal_cents, last.total_cents);
            return;
          }
        }

        if (data && data.ok && data.applicable && data.estimate) {
          window.__H2S_PROMO_LAST_GOOD_SIG__ = cartSig;
          window.__H2S_PROMO_LAST_GOOD_CODE__ = code;

          var savingsCents = Number(data.estimate.savings_cents || 0);
          var totalCents = Number(data.estimate.total_cents || 0);
          var subtotalCents = Number(data.estimate.subtotal_cents || 0);

          window.__H2S_PROMO_LAST_GOOD_EST__ = {
            promotion_code: data.promotion_code || code,
            savings_cents: savingsCents,
            subtotal_cents: subtotalCents,
            total_cents: totalCents
          };

          applyEstimateToUI(code, data.promotion_code || code, savingsCents, subtotalCents, totalCents);
          return;
        }

        // Not applicable
        var cartSubtotalLine2 = document.getElementById('cartSubtotalLine');
        if (cartSubtotalLine2) cartSubtotalLine2.style.display = 'flex';
        promoLine.style.display = 'none';
        if (rawLine) rawLine.style.display = 'none';

        var cartSubtotal = document.getElementById('cartSubtotal');
        var grandTotal2 = document.getElementById('grandTotal');
        if (cartSubtotal && grandTotal2) { grandTotal2.textContent = cartSubtotal.textContent; grandTotal2.style.color = ''; grandTotal2.style.fontSize = ''; }
        if (totalLabel) totalLabel.textContent = 'Total';
        if (promoMsg) { promoMsg.textContent = 'This code does not apply to your current items.'; promoMsg.style.color = '#c33'; }
      } catch (_) {
        try {
          var promoLine2 = document.getElementById('promoLine');
          if (promoLine2) promoLine2.style.display = 'none';
          var rawLine2 = document.getElementById('rawSubtotalLine');
          if (rawLine2) rawLine2.style.display = 'none';
        } catch (_) {}
      }
    }

    try {
      if (window.__H2S_PROMO_EST_STATE__) {
        if (!window.__H2S_PROMO_EST_STATE__.didOverrideUpdate) {
          // Only override after the app defines updatePromoEstimate, otherwise the deferred
          // monolith can overwrite us.
          if (typeof window.updatePromoEstimate === 'function' || typeof updatePromoEstimate === 'function') {
            window.updatePromoEstimate = patchedUpdatePromoEstimate;
            try { updatePromoEstimate = patchedUpdatePromoEstimate; } catch (_) {}
            window.__H2S_PROMO_EST_STATE__.didOverrideUpdate = true;
          }
        }
      } else {
        window.updatePromoEstimate = patchedUpdatePromoEstimate;
        try { updatePromoEstimate = patchedUpdatePromoEstimate; } catch (_) {}
      }
    } catch (_) {}

    // paintCart() currently resets totals/promo UI on every render and then
    // asynchronously calls updatePromoEstimate(), causing visible flicker.
    // Wrap it so the last-good estimate is immediately re-applied after render.
    try {
      var origPaint = window.paintCart;
      if (typeof origPaint === 'function' && !origPaint.__h2s_promo_wrapped) {
        window.paintCart = function(){
          var r = origPaint.apply(this, arguments);
          try {
            var code = '';
            try { code = localStorage.getItem('h2s_promo_code') || ''; } catch (_) { code = ''; }
            if (!code) return r;

            var line_items = buildLineItems();
            if (!line_items || !line_items.length) return r;
            // If prices are still unresolved, try to populate the fallback catalog in the background.
            try {
              var needsCatalog = line_items.some(function(li){ return !li || !li.price || li.price === 'custom'; });
              if (needsCatalog) {
                ensureCatalogPopulated().then(function(){
                  try { patchedUpdatePromoEstimate(); } catch (_) {}
                });
                return r;
              }
            } catch (_) {}
            var cartSig = code + '|' + line_items.map(function(li){ return li.price + ':' + li.unit_amount + 'x' + li.quantity; }).join(',');

            if (window.__H2S_PROMO_LAST_GOOD_SIG__ === cartSig && window.__H2S_PROMO_LAST_GOOD_CODE__ === code && window.__H2S_PROMO_LAST_GOOD_EST__) {
              var last = window.__H2S_PROMO_LAST_GOOD_EST__;
              applyEstimateToUI(code, last.promotion_code || code, last.savings_cents, last.subtotal_cents, last.total_cents);
            }

            // Refresh estimate in background (will be ignored if stale)
            setTimeout(function(){
              try { patchedUpdatePromoEstimate(); } catch (_) {}
            }, 0);
          } catch (_) {}
          return r;
        };
        window.paintCart.__h2s_promo_wrapped = true;
        try { if (window.__H2S_PROMO_EST_STATE__) window.__H2S_PROMO_EST_STATE__.didWrapPaint = true; } catch (_) {}
      }
    } catch (_) {}
  }

  // === REVIEWS: replace '?' stars based on rating ===
  function installReviewsStarsFix(){
    // Safe to call repeatedly until renderReviews exists (deferred monolith boot).
    try {
      if (!window.__H2S_REVIEWS_STAR_STATE__) window.__H2S_REVIEWS_STAR_STATE__ = { didWrapRender: false };
    } catch (_) {}

    function fixStars(){
      try {
        var track = document.getElementById('reviewTrack');
        if (!track || !track.querySelectorAll) return;
        var cards = track.querySelectorAll('.review-card');
        for (var i = 0; i < cards.length; i++) {
          var card = cards[i];
          var idx = Number(card.getAttribute('data-index') || 0);
          var rating = 5;
          try {
            if (typeof allReviews !== 'undefined' && Array.isArray(allReviews) && allReviews[idx]) {
              rating = Number(allReviews[idx].rating || allReviews[idx].stars || 5);
            }
          } catch (_) {}
          rating = Math.max(1, Math.min(5, Math.round(rating)));
          var el = card.querySelector('.review-stars');
          if (el) el.textContent = ''.repeat(rating) + ''.repeat(5 - rating);
        }
      } catch (_) {}
    }

    try {
      var orig = window.renderReviews;
      if (typeof orig === 'function' && !orig.__h2s_wrapped) {
        window.renderReviews = function(){
          try {
            // Keep the initial hardcoded placeholder review cards visible
            // until real reviews are actually loaded.
            if (typeof allReviews !== 'undefined' && Array.isArray(allReviews) && allReviews.length === 0) {
              var track = document.getElementById('reviewTrack');
              if (track && track.querySelector && track.querySelector('.review-card')) {
                return;
              }
            }
          } catch (_) {}

          var r = orig.apply(this, arguments);
          fixStars();
          return r;
        };
        window.renderReviews.__h2s_wrapped = true;
        try { if (window.__H2S_REVIEWS_STAR_STATE__) window.__H2S_REVIEWS_STAR_STATE__.didWrapRender = true; } catch (_) {}
      }
    } catch (_) {}

    try { setTimeout(fixStars, 300); } catch (_) {}
  }

  // Post-boot patch scheduler: the main app JS is deferred, so we re-attempt
  // these wrappers until the corresponding functions exist.
  (function schedulePostBootPatches(){
    try {
      if (window.__H2S_POSTBOOT_PATCH_SCHED__) return;
      window.__H2S_POSTBOOT_PATCH_SCHED__ = true;
    } catch (_) {}

    try { installMojibakeObserver(); } catch (_) {}

    var startedAt = Date.now();
    var intId = null;

    function tick(){
      try { installPromoEstimateOverride(); } catch (_) {}
      try { installReviewsStarsFix(); } catch (_) {}

      // If bundles-data seeded an empty catalog, kick the fallback catalog fetch once.
      try {
        if (!window.__H2S_CATALOG_REFILL_ONCE__) {
          if (typeof catalog !== 'undefined' && catalog && Array.isArray(catalog.bundles) && catalog.bundles.length === 0 && typeof window.fetchCatalogFromAPI === 'function') {
            window.__H2S_CATALOG_REFILL_ONCE__ = true;
            window.fetchCatalogFromAPI(true).catch(function(){});
          }
        }
      } catch (_) {}

      var promoDone = false;
      var reviewsDone = false;
      try { promoDone = !!(window.__H2S_PROMO_EST_STATE__ && window.__H2S_PROMO_EST_STATE__.didOverrideUpdate && window.__H2S_PROMO_EST_STATE__.didWrapPaint); } catch (_) { promoDone = false; }
      try { reviewsDone = !!(window.__H2S_REVIEWS_STAR_STATE__ && window.__H2S_REVIEWS_STAR_STATE__.didWrapRender); } catch (_) { reviewsDone = false; }

      if ((promoDone && reviewsDone) || (Date.now() - startedAt) > 15000) {
        try { clearInterval(intId); } catch (_) {}
      }
    }

    try { tick(); } catch (_) {}
    try { intId = setInterval(tick, 50); } catch (_) {}
  })();

  function normalizeReview(r){
    if (!r || typeof r !== 'object') return null;

    var displayName = (r.display_name || r.name || r.author || r.customer_name || 'Customer');
    if (typeof displayName !== 'string') displayName = String(displayName || 'Customer');
    displayName = displayName.trim() || 'Customer';

    var text = (r.review_text || r.text || r.review || r.body || '');
    if (typeof text !== 'string') text = String(text || '');
    text = text.trim();
    if (!text) return null;

    var rating = r.rating;
    if (rating == null) rating = r.stars;
    rating = Number(rating || 5);
    if (!isFinite(rating)) rating = 5;
    rating = Math.max(1, Math.min(5, Math.round(rating)));

    var verified = !!(r.verified || r.is_verified || r.verified_customer);
    var services = r.services_selected || r.service || r.service_name || r.services || '';
    if (services && typeof services !== 'string') services = String(services);

    var ts = r.timestamp_iso || r.timestamp || r.created_at || r.createdAt || '';
    if (ts && typeof ts !== 'string') ts = String(ts);

    return {
      rating: rating,
      review_text: text,
      display_name: displayName,
      verified: verified,
      services_selected: services,
      timestamp_iso: ts,
      // Keep alias fields for the hero widget.
      text: text,
      name: displayName,
      stars: rating
    };
  }

  function normalizeReviewsList(list){
    var out = [];
    safeArray(list).forEach(function(r){
      var n = normalizeReview(r);
      if (n) out.push(n);
    });
    return out;
  }

  function ensureReviewsData(){
    try {
      if (typeof allReviews !== 'undefined') {
        allReviews = normalizeReviewsList(allReviews);
      }
    } catch (_) {}

    // If heroReviews still contains placeholder testimonials (not real customers), clear it.
    // Real reviews will repopulate via aggregated data or /api/reviews.
    try {
      var hasRealFromApi = (typeof reviewsLoadedFromAPI !== 'undefined' && reviewsLoadedFromAPI);
      if (!hasRealFromApi && typeof heroReviews !== 'undefined' && Array.isArray(heroReviews) && heroReviews.length) {
        var looksPlaceholder = heroReviews.some(function(r){
          var a = (r && (r.author || r.name)) ? String(r.author || r.name) : '';
          var t = (r && r.text) ? String(r.text) : '';
          return a === 'Recent Customer' || a === 'Mike T.' || a === 'Jennifer L.' || a === 'David R.' || a === 'Amanda K.' || t.indexOf('Professional, on-time') >= 0;
        });
        if (looksPlaceholder) {
          heroReviews = [];
        }
      }
    } catch (_) {}

    // Hero reviews widget is intentionally disabled (we keep only the main carousel).
  }

  function disableHeroReviews(){
    try {
      var hero = document.getElementById('heroReviews');
      if (hero) {
        hero.style.display = 'none';
        hero.innerHTML = '';
      }
    } catch (_) {}

    try {
      if (typeof heroReviewInterval !== 'undefined' && heroReviewInterval) {
        clearInterval(heroReviewInterval);
        heroReviewInterval = null;
      }
    } catch (_) {}

    try { if (typeof heroReviews !== 'undefined') heroReviews = []; } catch (_) {}

    try { if (typeof window.renderHeroReviews === 'function') window.renderHeroReviews = function(){}; } catch (_) {}
    try { if (typeof window.loadHeroReviews === 'function') window.loadHeroReviews = function(){ return Promise.resolve(); }; } catch (_) {}
    try { if (typeof window.initHeroReviews === 'function') window.initHeroReviews = function(){}; } catch (_) {}
    try { if (typeof window.nextHeroReview === 'function') window.nextHeroReview = function(){}; } catch (_) {}
    try { if (typeof window.goToHeroReview === 'function') window.goToHeroReview = function(){}; } catch (_) {}
  }

  function seedPlaceholderCarouselReviews(){
    try {
      if (typeof allReviews === 'undefined') return;
      try {
        if (typeof reviewsLoadedFromAPI !== 'undefined' && reviewsLoadedFromAPI) return;
      } catch (_) {}
      if (Array.isArray(allReviews) && allReviews.length > 0) return;
      allReviews = normalizeReviewsList([
        { display_name: 'Recent Customer', rating: 5, review_text: 'Fast, professional installation. Everything looks clean and works perfectly.' },
        { display_name: 'Recent Customer', rating: 5, review_text: 'On time, clear communication, and the setup was done right the first time.' },
        { display_name: 'Recent Customer', rating: 5, review_text: 'Great experience from booking to completion. Highly recommend.' }
      ]);
      window.__h2sReviewsArePlaceholders = true;
      logOnce('placeholders', 'info', '[Reviews] Showing placeholders; fetching real reviews');
    } catch (_) {}
  }

  function ensurePlaceholderDOM(){
    try {
      var track = document.getElementById('reviewTrack');
      var nav = document.getElementById('reviewNav');
      if (!track || !nav) return;

      var hasCards = track.querySelector && track.querySelector('.review-card');
      var isNoReviewsMsg = (track.textContent || '').indexOf('No reviews available') >= 0;
      if (hasCards && !isNoReviewsMsg) return;

      // If the app rendered the empty message, restore placeholders immediately.
      track.innerHTML = [
        '<div class="review-card" data-index="0">',
        '  <div class="review-header">',
        '    <div class="review-avatar">RC</div>',
        '    <div class="review-meta">',
        '      <div class="review-name">Recent Customer</div>',
        '      <div class="review-stars"></div>',
        '    </div>',
        '  </div>',
        '  <p class="review-text">Fast, professional installation. Everything looks clean and works perfectly.</p>',
        '  <div class="review-footer"><div class="review-service">Smart Home Service</div></div>',
        '</div>',
        '<div class="review-card" data-index="1">',
        '  <div class="review-header">',
        '    <div class="review-avatar">RC</div>',
        '    <div class="review-meta">',
        '      <div class="review-name">Recent Customer</div>',
        '      <div class="review-stars"></div>',
        '    </div>',
        '  </div>',
        '  <p class="review-text">On time, clear communication, and the setup was done right the first time.</p>',
        '  <div class="review-footer"><div class="review-service">Smart Home Service</div></div>',
        '</div>',
        '<div class="review-card" data-index="2">',
        '  <div class="review-header">',
        '    <div class="review-avatar">RC</div>',
        '    <div class="review-meta">',
        '      <div class="review-name">Recent Customer</div>',
        '      <div class="review-stars"></div>',
        '    </div>',
        '  </div>',
        '  <p class="review-text">Great experience from booking to completion. Highly recommend.</p>',
        '  <div class="review-footer"><div class="review-service">Smart Home Service</div></div>',
        '</div>'
      ].join('\n');

      if (!nav.querySelector || !nav.querySelector('.review-dot')) {
        nav.innerHTML = '<div class="review-dot active" aria-label="Go to page 1"></div>';
      }

      try { track.style.transform = 'translateX(0%)'; } catch (_) {}
    } catch (_) {}
  }

  function markReviewsVisible(mode){
    try {
      var root = document.documentElement;
      if (!root) return;
      if (mode === 'loaded') {
        root.classList.add('h2s-reviews-loaded');
        root.classList.remove('h2s-reviews-show-placeholders');
      } else if (mode === 'placeholders') {
        root.classList.add('h2s-reviews-show-placeholders');
      }
    } catch (_) {}
  }

  function schedulePlaceholderFallback(){
    try {
      if (window.__h2sReviewsPlaceholderTimer) return;
    } catch (_) {}

    try {
      window.__h2sReviewsPlaceholderTimer = setTimeout(function(){
        try { window.__h2sReviewsPlaceholderTimer = null; } catch (_) {}

        // If real reviews are already available, show them.
        try {
          if (typeof reviewsLoadedFromAPI !== 'undefined' && reviewsLoadedFromAPI) {
            markReviewsVisible('loaded');
            return;
          }
        } catch (_) {}

        // If we have non-placeholder reviews in memory, prefer them.
        try {
          if (typeof allReviews !== 'undefined' && Array.isArray(allReviews) && allReviews.length > 0 && !window.__h2sReviewsArePlaceholders) {
            markReviewsVisible('loaded');
            return;
          }
        } catch (_) {}

        // Otherwise, allow placeholders to render.
        markReviewsVisible('placeholders');
        try { ensurePlaceholderDOM(); } catch (_) {}
        try { seedPlaceholderCarouselReviews(); } catch (_) {}
        try { ensureCarouselPages(); } catch (_) {}
        try { if (typeof renderReviews === 'function') renderReviews(); } catch (_) {}
        try { if (typeof updateCarousel === 'function') updateCarousel(); } catch (_) {}
        try { if (typeof startCarousel === 'function') startCarousel(); } catch (_) {}
      }, 650);
    } catch (_) {}
  }

  function ensureCarouselPages(){
    try {
      if (typeof allReviews === 'undefined' || !Array.isArray(allReviews)) return;
      if (allReviews.length < 2) return;

      // Never duplicate placeholder reviews (avoid the 4th card peeking and the carousel looking stuck).
      try {
        if (window.__h2sReviewsArePlaceholders) return;
      } catch (_) {}

      var slidesPerView = window.innerWidth >= 1024 ? 3 : (window.innerWidth >= 768 ? 2 : 1);
      var totalPages = Math.ceil(allReviews.length / slidesPerView);

      // If we're exactly at a single page (e.g., 3 reviews on desktop), duplicate to allow motion.
      if (totalPages <= 1) {
        var maxLen = Math.min(12, allReviews.length * 3);
        while (allReviews.length < Math.min(maxLen, slidesPerView + 1)) {
          allReviews = allReviews.concat(allReviews);
        }
      }
    } catch (_) {}
  }

  function fetchRealReviewsForCarousel(){
    // NOTE: placeholders seed `allReviews` so length>0 is not sufficient.
    // We still need to fetch when placeholders are showing.
    try {
      var alreadyLoaded = false;
      try { alreadyLoaded = (typeof reviewsLoadedFromAPI !== 'undefined' && !!reviewsLoadedFromAPI); } catch (_) { alreadyLoaded = false; }
      if (alreadyLoaded) return;

      var hasAny = (typeof allReviews !== 'undefined' && Array.isArray(allReviews) && allReviews.length > 0);
      var placeholders = false;
      try { placeholders = !!window.__h2sReviewsArePlaceholders; } catch (_) { placeholders = false; }
      if (hasAny && !placeholders) return;
    } catch (_) {}

    try {
      var now = Date.now();
      if (window.__h2sReviewsFetchInFlight) return;
      // Only throttle successful fetches; if we failed (alias 404 / bad JSON), allow quick retry.
      if (window.__h2sReviewsLastFetchOk && window.__h2sReviewsLastFetch && (now - window.__h2sReviewsLastFetch) < 15000) return;
      window.__h2sReviewsFetchInFlight = true;
    } catch (_) {}

    var base = null;
    try {
      if (typeof API !== 'undefined') base = String(API);
    } catch (_) {}
    if (!base) base = 'https://h2s-backend.vercel.app/api/shop';

    var qs = '?limit=12&onlyVerified=true';
    var primary = String(base).replace('/shop', '/reviews') + qs;
    // Congruent fallback: same path on the currently-live shop deployment.
    var SHOP_ORIGIN = 'https://h2s-backend-5o9147lik-tabari-ropers-projects-6f2e090b.vercel.app';
    var fallback = SHOP_ORIGIN + '/api/reviews' + qs;

    function pickReviews(data){
      try {
        if (!data) return null;
        if (Array.isArray(data.reviews)) return data.reviews;
        if (data.data && Array.isArray(data.data.reviews)) return data.data.reviews;
        if (data.result && Array.isArray(data.result.reviews)) return data.result.reviews;
        if (Array.isArray(data.data)) return data.data;
      } catch (_) {}
      return null;
    }

    function tryParseJson(res){
      var ct = '';
      try { ct = (res.headers && res.headers.get) ? (res.headers.get('content-type') || '') : ''; } catch (_) {}
      if (ct.indexOf('application/json') >= 0) return res.json();
      return res.text().then(function(t){
        try { return JSON.parse(t); } catch (_) { return null; }
      });
    }

    function attempt(url){
      logDebug('log', '[Reviews] Fetching: ' + url);
      return fetch(url, { cache: 'default' }).then(function(res){
        try { logDebug('log', '[Reviews] Response ' + (res ? res.status : 'ERR') + ' for ' + url); } catch (_) {}
        if (!res || !res.ok) throw new Error('HTTP ' + (res ? res.status : 'ERR'));
        return tryParseJson(res);
      });
    }

    attempt(primary)
      .catch(function(){
        // If the alias host is drifting/404, retry directly to the known live origin.
        return attempt(fallback);
      })
      .then(function(data){
        try {
          var list = pickReviews(data);
          if (!list || !list.length) throw new Error('no reviews');
          try { window.reviewsLoadedFromAPI = true; } catch (_) {}
          try {
            allReviews = normalizeReviewsList(list);
            window.__h2sReviewsArePlaceholders = false;
            markReviewsVisible('loaded');
            ensureCarouselPages();
          } catch (_) {}
          logOnce('loaded', 'info', '[Reviews] Loaded real reviews; starting carousel.');
          try { logDebug('log', '[Reviews] Loaded count=' + (Array.isArray(allReviews) ? allReviews.length : 0)); } catch (_) {}
          try {
            window.__h2sReviewsLastFetchOk = true;
            window.__h2sReviewsLastFetch = Date.now();
          } catch (_) {}
          try {
            // Reset to first page and restart interval after swapping in real reviews.
            try { if (typeof reviewInterval !== 'undefined' && reviewInterval) { clearInterval(reviewInterval); reviewInterval = null; } } catch (_) {}
            try { if (typeof reviewIndex !== 'undefined') reviewIndex = 0; } catch (_) {}

            if (typeof renderReviews === 'function') renderReviews();
            try { if (typeof updateCarousel === 'function') updateCarousel(); } catch (_) {}
            if (typeof startCarousel === 'function') startCarousel();
          } catch (_) {}
        } catch (_) {
          try { window.__h2sReviewsLastFetchOk = false; } catch (_) {}
        }
      })
      .catch(function(){
        logOnce('failed', 'warn', '[Reviews] Failed to load real reviews (showing placeholders).');
        try { logDebug('warn', '[Reviews] Fetch failed for both primary + fallback.'); } catch (_) {}
        try { window.__h2sReviewsLastFetchOk = false; } catch (_) {}
      })
      .finally(function(){
        try { window.__h2sReviewsFetchInFlight = false; } catch (_) {}
      });
  }

  function fixStarsInDOM(){
    try {
      document.querySelectorAll('.review-card .review-stars').forEach(function(el){
        var card = el.closest('.review-card');
        if (!card) return;
        var idx = Number(card.getAttribute('data-index'));
        if (!isFinite(idx)) return;
        try {
          if (typeof allReviews !== 'undefined' && Array.isArray(allReviews) && allReviews[idx]) {
            var r = Number(allReviews[idx].rating || allReviews[idx].stars || 5);
            if (!isFinite(r)) r = 5;
            r = Math.max(1, Math.min(5, Math.round(r)));
            el.textContent = ''.repeat(r) + ''.repeat(5 - r);
          }
        } catch (_) {}
      });
    } catch (_) {}
  }

  function safeKickCarousel(){
    try { if (typeof updateCarousel === 'function') updateCarousel(); } catch (_) {}
    // Avoid repeatedly restarting the interval (core startCarousel re-binds hover listeners each call).
    try {
      // Allow mobile to auto-advance even while placeholders are showing.
      // Desktop stays conservative to avoid visible swapping/jank.
      try {
        var isMobile = window.innerWidth < 768;
        if (window.__h2sReviewsArePlaceholders && !isMobile) return;
      } catch (_) {}
      var hasInterval = (typeof reviewInterval !== 'undefined' && !!reviewInterval);
      if (!hasInterval && typeof startCarousel === 'function') startCarousel();
    } catch (_) {}
  }

  function wrapOnce(obj, key, wrapperKey, wrapFn){
    try {
      var fn = obj[key];
      if (typeof fn !== 'function' || fn[wrapperKey]) return;
      var wrapped = wrapFn(fn);
      wrapped[wrapperKey] = true;
      obj[key] = wrapped;
    } catch (_) {}
  }

  function apply(){
    ensureReviewsData();
    disableHeroReviews();

    // Always ensure there are cards present immediately.
    ensurePlaceholderDOM();
    seedPlaceholderCarouselReviews();

    // If the core app already loaded real reviews, show them immediately.
    try {
      if (typeof reviewsLoadedFromAPI !== 'undefined' && reviewsLoadedFromAPI) {
        markReviewsVisible('loaded');
      }
    } catch (_) {}

    try {
      if (typeof allReviews !== 'undefined' && Array.isArray(allReviews) && allReviews.length > 0 && !window.__h2sReviewsArePlaceholders) {
        markReviewsVisible('loaded');
      }
    } catch (_) {}

    ensureCarouselPages();
    fetchRealReviewsForCarousel();

    // If the HTML placeholders rendered before JS, the nav may have only 1 dot.
    // Re-render once with the placeholder data so totalPages/dots match and the carousel can advance.
    try {
      if (window.__h2sReviewsArePlaceholders && !window.__h2sPlaceholderNavSynced && typeof renderReviews === 'function') {
        window.__h2sPlaceholderNavSynced = true;
        requestAnimationFrame(function(){
          try { renderReviews(); } catch (_) {}
        });
      }
    } catch (_) {}

    // Keep the main carousel visible; it will populate once /api/reviews loads.
    try {
      var main = document.querySelector('.review-carousel');
      if (main && main.style.display === 'none') main.style.display = '';
      var hero = document.getElementById('heroReviews');
      if (hero) hero.style.display = 'none';
    } catch (_) {}

    // Wrap renderReviews to normalize input + start carousel.
    wrapOnce(window, 'renderReviews', '__h2sReviewsWrapped', function(orig){
      return function(){
        ensureReviewsData();

        // If we have real reviews, ensure the UI is visible (prevents being stuck hidden by the first-paint guard).
        try {
          var loaded = false;
          try { loaded = (typeof reviewsLoadedFromAPI !== 'undefined' && !!reviewsLoadedFromAPI); } catch (_) { loaded = false; }
          if (!loaded) {
            try {
              loaded = (typeof allReviews !== 'undefined' && Array.isArray(allReviews) && allReviews.length > 0 && !window.__h2sReviewsArePlaceholders);
            } catch (_) { loaded = false; }
          }
          if (loaded) markReviewsVisible('loaded');
        } catch (_) {}

        if (typeof allReviews !== 'undefined' && Array.isArray(allReviews) && allReviews.length === 0) {
          seedPlaceholderCarouselReviews();
          ensureCarouselPages();
        }
        fetchRealReviewsForCarousel();
        var res = orig.apply(this, arguments);

        // Desktop-only: rebuild dots as starting indices (scroll-by-1, hard-stop at len-3).
        // This prevents an "incomplete last page" and keeps dots consistent with allowed range.
        try {
          var vwDots = window.innerWidth || 0;
          if (vwDots >= 1024) {
            var nav = document.getElementById('reviewNav');
            var track = document.getElementById('reviewTrack');
            var len = 0;
            try {
              if (typeof allReviews !== 'undefined' && Array.isArray(allReviews)) len = allReviews.length;
            } catch (_) { len = 0; }
            if (!len && track) {
              try { len = track.querySelectorAll('.review-card').length; } catch (_) { len = 0; }
            }

            if (nav && len) {
              var maxStart = Math.max(0, len - 3);
              var idx = 0;
              try { idx = (typeof reviewIndex === 'number' && isFinite(reviewIndex)) ? reviewIndex : 0; } catch (_) { idx = 0; }
              if (idx > maxStart) { idx = maxStart; try { reviewIndex = idx; } catch (_) {} }
              nav.innerHTML = Array.from({ length: (maxStart + 1) || 1 }, function(_, i){
                return '<div class="review-dot ' + (i === idx ? 'active' : '') + '" onclick="goToReview(' + i + ')" aria-label="Go to position ' + (i + 1) + '"></div>';
              }).join('');
            }
          }
        } catch (_) {}

        try { fixStarsInDOM(); } catch (_) {}
        try { safeKickCarousel(); } catch (_) {}
        return res;
      };
    });

    // Wrap startCarousel to avoid rebinding hover listeners on every call.
    // Rebinding can lead to multiple intervals ("double speed") after mouseleave.
    wrapOnce(window, 'startCarousel', '__h2sStartCarouselWrapped', function(orig){
      return function(){
        try {
          var carousel = document.querySelector('.review-carousel');

          // Desktop-only: scroll by 1 card; clamp to maxStart=len-3; loop within range.
          if ((window.innerWidth || 0) >= 1024) {
            try { if (typeof reviewInterval !== 'undefined' && reviewInterval) { clearInterval(reviewInterval); reviewInterval = null; } } catch (_) {}

            var len = 0;
            try {
              if (typeof allReviews !== 'undefined' && Array.isArray(allReviews)) len = allReviews.length;
            } catch (_) { len = 0; }
            if (!len) {
              try { len = carousel ? carousel.querySelectorAll('.review-card').length : 0; } catch (_) { len = 0; }
            }
            var maxStart = Math.max(0, len - 3);
            if (!len || maxStart <= 0) return;

            // Bind hover pause/resume once.
            if (carousel && !carousel.__h2sHoverBound) {
              try {
                carousel.addEventListener('mouseenter', function(){
                  try { if (typeof reviewInterval !== 'undefined' && reviewInterval) { clearInterval(reviewInterval); reviewInterval = null; } } catch (_) {}
                });
                carousel.addEventListener('mouseleave', function(){
                  try { if (typeof startCarousel === 'function') startCarousel(); } catch (_) {}
                });
              } catch (_) {}
              try { carousel.__h2sHoverBound = true; } catch (_) {}
            }

            // Clamp current index into allowed range.
            try {
              var idx = (typeof reviewIndex === 'number' && isFinite(reviewIndex)) ? reviewIndex : 0;
              if (idx < 0) idx = 0;
              if (idx > maxStart) idx = maxStart;
              reviewIndex = idx;
            } catch (_) {}

            try {
              reviewInterval = setInterval(function(){
                try {
                  var idx2 = (typeof reviewIndex === 'number' && isFinite(reviewIndex)) ? reviewIndex : 0;
                  idx2 = idx2 + 1;
                  if (idx2 > maxStart) idx2 = 0;
                  reviewIndex = idx2;
                  if (typeof updateCarousel === 'function') updateCarousel();
                } catch (_) {}
              }, 5000);
            } catch (_) {}

            return;
          }

          if (carousel && carousel.__h2sHoverBound) {
            try { if (typeof reviewInterval !== 'undefined' && reviewInterval) clearInterval(reviewInterval); } catch (_) {}

            var slidesPerView = window.innerWidth >= 1024 ? 3 : (window.innerWidth >= 768 ? 2 : 1);
            var len = (typeof allReviews !== 'undefined' && Array.isArray(allReviews)) ? allReviews.length : 0;
            var totalPages = Math.ceil(len / slidesPerView);
            if (totalPages <= 1) return;

            try {
              reviewInterval = setInterval(function(){
                try {
                  reviewIndex++;
                  if (reviewIndex >= totalPages) reviewIndex = 0;
                  if (typeof updateCarousel === 'function') updateCarousel();
                } catch (_) {}
              }, 5000);
            } catch (_) {}
            return;
          }

          var res = orig.apply(this, arguments);
          try { if (carousel) carousel.__h2sHoverBound = true; } catch (_) {}
          return res;
        } catch (_) {
          return orig.apply(this, arguments);
        }
      };
    });

    // Wrap hero reviews loader to fail-open (do not clobber existing heroReviews on bad responses).
    wrapOnce(window, 'loadHeroReviews', '__h2sHeroReviewsWrapped', function(orig){
      return async function(){
        // Hero reviews are disabled; do not fetch.
        return;
      };
    });

    // Wrap updateCarousel to use pixel-based stepping.
    // The core code uses translateX(-100% * page), but % is relative to the track width,
    // which breaks when we render true full-width cards on mobile.
    wrapOnce(window, 'updateCarousel', '__h2sUpdateCarouselWrapped', function(orig){
      return function(){
        try {
          var track = document.getElementById('reviewTrack');
          if (!track) return orig.apply(this, arguments);

          var vw = window.innerWidth || 0;
          var slidesPerView = vw >= 1024 ? 3 : (vw >= 768 ? 2 : 1);
          var len = 0;
          try {
            if (typeof allReviews !== 'undefined' && Array.isArray(allReviews)) len = allReviews.length;
          } catch (_) {}
          if (!len) {
            try { len = track.querySelectorAll('.review-card').length; } catch (_) { len = 0; }
          }
          if (!len) return;

          var totalPages = Math.ceil(len / slidesPerView);
          if (!totalPages || totalPages <= 0) return;

          var idx = 0;
          try { idx = (typeof reviewIndex === 'number' && isFinite(reviewIndex)) ? reviewIndex : 0; } catch (_) { idx = 0; }
          var safeIndex = Math.min(Math.max(0, idx), totalPages - 1);

          var firstCard = track.querySelector('.review-card');
          if (!firstCard) return orig.apply(this, arguments);

          // Mobile: step by the viewport width to guarantee perfect centering and avoid fractional-pixel drift.
          // Our CSS makes each slide occupy exactly one viewport-width page (basis + margins == 100%).
          if (vw < 768 && slidesPerView === 1) {
            var viewport = document.querySelector('.review-track-container');
            var viewportW = 0;
            try { viewportW = viewport ? (viewport.getBoundingClientRect().width || viewport.clientWidth || 0) : 0; } catch (_) { viewportW = 0; }
            if (viewportW && isFinite(viewportW)) {
              var xMobile = -safeIndex * viewportW;
              track.style.transform = 'translateX(' + xMobile + 'px)';
              try {
                document.querySelectorAll('.review-dot').forEach(function(dot, i){
                  var active = (i === safeIndex);
                  if (dot.classList.contains('active') !== active) dot.classList.toggle('active', active);
                });
              } catch (_) {}
              return;
            }
          }

          var cardW = 0;
          try { cardW = firstCard.getBoundingClientRect().width || firstCard.offsetWidth || 0; } catch (_) { cardW = 0; }
          if (!cardW) return orig.apply(this, arguments);

          var gap = 0;
          try {
            var cs = window.getComputedStyle(track);
            gap = parseFloat(cs.gap || cs.columnGap || '0') || 0;
          } catch (_) { gap = 0; }

          // Account for spacing created by margins on the cards (the base CSS uses margins, not flex gap).
          var mL = 0, mR = 0;
          try {
            var csCard = window.getComputedStyle(firstCard);
            mL = parseFloat(csCard.marginLeft || '0') || 0;
            mR = parseFloat(csCard.marginRight || '0') || 0;
          } catch (_) { mL = 0; mR = 0; }

          // Desktop-only: treat reviewIndex as a starting card index (scroll-by-1), hard-stop at len-3.
          // This guarantees exactly 3 full cards and prevents any partial 4th/5th peeking.
          if (vw >= 1024) {
            var maxStart = Math.max(0, len - 3);
            var startIdx = 0;
            try { startIdx = (typeof reviewIndex === 'number' && isFinite(reviewIndex)) ? reviewIndex : 0; } catch (_) { startIdx = 0; }
            startIdx = Math.min(Math.max(0, startIdx), maxStart);
            try { reviewIndex = startIdx; } catch (_) {}

            var stepOne = (cardW + gap + mL + mR);
            var xDesk = -startIdx * stepOne;
            track.style.transform = 'translateX(' + xDesk + 'px)';

            try {
              document.querySelectorAll('.review-dot').forEach(function(dot, i){
                var active = (i === startIdx);
                if (dot.classList.contains('active') !== active) dot.classList.toggle('active', active);
              });
            } catch (_) {}
            return;
          }

          var step = (cardW + gap + mL + mR) * slidesPerView;
          var x = -safeIndex * step;
          track.style.transform = 'translateX(' + x + 'px)';

          try {
            document.querySelectorAll('.review-dot').forEach(function(dot, i){
              var active = (i === safeIndex);
              if (dot.classList.contains('active') !== active) dot.classList.toggle('active', active);
            });
          } catch (_) {}

          return;
        } catch (_) {
          return orig.apply(this, arguments);
        }
      };
    });
  }

  // Apply now + after SPA-ish rerenders.
  function scheduleApply(){
    try {
      if (window.__h2sReviewsApplyScheduled) return;
      window.__h2sReviewsApplyScheduled = true;
    } catch (_) {}

    var run = function(){
      try { window.__h2sReviewsApplyScheduled = false; } catch (_) {}
      try { apply(); } catch (_) {}
    };

    // Run quickly to restore placeholders, then run again after the deferred/minified script has
    // definitely created globals like `allReviews`/`renderReviews`.
    try { setTimeout(run, 0); } catch (_) {}
    try { setTimeout(run, 1500); } catch (_) {}
  }

  scheduleApply();
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function(){
      scheduleApply();
      // In case nothing calls renderReviews (API down), try once after paint.
      setTimeout(function(){
        try {
          var track = document.getElementById('reviewTrack');
          if (track && track.children && track.children.length === 0 && typeof renderReviews === 'function') renderReviews();
        } catch (_) {}
      }, 1500);
    });
  } else {
    setTimeout(function(){
      try {
        var track = document.getElementById('reviewTrack');
        if (track && track.children && track.children.length === 0 && typeof renderReviews === 'function') renderReviews();
      } catch (_) {}
    }, 1500);
  }
})();

// === TRACKING CONGRUENCE ===
// Fire ViewContent after 3s delay (Engaged Browser)
setTimeout(function() {
  if (typeof h2sTrack === 'function') {
    h2sTrack('ViewContent', {
      content_name: 'Bundles Shop',
      content_type: 'product_group',
      page: '/bundles',
      currency: 'USD'
    });
  } else {
    console.warn('h2sTrack not found for ViewContent');
  }
}, 3000);
</script>

<script>
(function(){
  if (typeof window.showSkeleton !== 'function') return;
  var originalShowSkeleton = window.showSkeleton;
  window.showSkeleton = function(){
    try {
      var outlet = document.getElementById('outlet');
      if (outlet && outlet.children && outlet.children.length > 0) {
        if (!outlet.querySelector || !outlet.querySelector('.skeleton')) {
          return;
        }
      }
    } catch (e) {}
    return originalShowSkeleton.apply(this, arguments);
  };
})();
</script>

<script defer>
(function(){
  try{
    if(window.__H2S_EMPTY_CART_RESET_PATCH__) return;
    window.__H2S_EMPTY_CART_RESET_PATCH__=!0;
    const originalPaintCart=window.paintCart;
    if("function"!=typeof originalPaintCart) return;
    window.paintCart=function(){
      const result=originalPaintCart.apply(this,arguments);
      try{
        if(!Array.isArray(cart)||cart.length) return result;
        const subtotal=document.getElementById("cartSubtotal");
        subtotal&&(subtotal.textContent="$0.00");
        const grandTotal=document.getElementById("grandTotal");
        grandTotal&&(grandTotal.textContent="$0.00",grandTotal.style.color="",grandTotal.style.fontSize="");
        const cartSubtotalLine=document.getElementById("cartSubtotalLine");
        cartSubtotalLine&&(cartSubtotalLine.style.display="flex");
        const rawLine=document.getElementById("rawSubtotalLine");
        rawLine&&(rawLine.style.display="none");
        const promoLine=document.getElementById("promoLine");
        promoLine&&(promoLine.style.display="none");
        const totalLabel=document.getElementById("totalLabel");
        totalLabel&&(totalLabel.textContent="Total");
        const promoMsg=document.getElementById("promoMsg");
        promoMsg&&(promoMsg.textContent="",promoMsg.style.color="");
      }catch(_){
        // fail open
      }
      return result;
    };
  }catch(_){
    // fail open
  }
})();
</script>

<script>
(function(){
  // Patch goal: ensure bundles checkout collects State and sends `service_state`.
  // This avoids editing the huge inlined script block above.

  function safeJsonParse(raw){
    try { return JSON.parse(raw); } catch (_) { return null; }
  }

  function getPrefillState(){
    const saved = safeJsonParse(localStorage.getItem('h2s_guest_checkout') || '{}') || {};
    if (saved.state) return String(saved.state).trim().toUpperCase();
    const pending = safeJsonParse(sessionStorage.getItem('h2s_pending_account') || '{}') || {};
    const st = pending.state || pending.service_state || '';
    return String(st || '').trim().toUpperCase();
  }

  function ensureStateField(){
    const cityEl = document.getElementById('coCity');
    const zipEl = document.getElementById('coZip');
    if (!cityEl || !zipEl) return;
    if (document.getElementById('coState')) return;

    const zipContainer = zipEl.closest('div');
    const grid = zipContainer && zipContainer.parentElement;
    if (!grid) return;

    try { grid.style.gridTemplateColumns = '2fr 1fr 1fr'; } catch (_) {}

    const stateContainer = document.createElement('div');
    stateContainer.innerHTML = [
      '<label style="display:block; font-weight:600; font-size:14px; margin-bottom:4px; color:var(--ink);">State</label>',
      '<input type="text" id="coState" class="inp" required placeholder="SC" maxlength="2" style="width:100%; text-transform:uppercase">'
    ].join('');

    grid.insertBefore(stateContainer, zipContainer);

    const st = getPrefillState();
    const stEl = document.getElementById('coState');
    if (stEl && st) stEl.value = st;
  }

  // Observe DOM changes so we can inject state field when checkout modal is rendered.
  try {
    const obs = new MutationObserver(function(){ ensureStateField(); });
    obs.observe(document.body, { childList: true, subtree: true });
  } catch (_) {}

  // Override checkout submit handler to include state in Stripe metadata.
  window.handleCheckoutSubmit = async function(e){
    if (e && typeof e.preventDefault === 'function') e.preventDefault();
    ensureStateField();

    function safeJsonParse(value, fallback){
      try { return JSON.parse(value); } catch (_) { return fallback; }
    }

    const btn = document.getElementById('coSubmitBtn');
    const errEl = document.getElementById('coError');

    function showErr(msg){
      if (errEl) { errEl.textContent = msg; errEl.style.display = 'block'; }
      try { alert(msg); } catch (_) {}
    }

    const name = (document.getElementById('coName')?.value || '').trim();
    const email = (document.getElementById('coEmail')?.value || '').trim();
    const phone = (document.getElementById('coPhone')?.value || '').trim();
    const address = (document.getElementById('coAddress')?.value || '').trim();
    const city = (document.getElementById('coCity')?.value || '').trim();
    const state = (document.getElementById('coState')?.value || '').trim().toUpperCase();
    const zip = (document.getElementById('coZip')?.value || '').trim();

    if (!name || !email || !phone || !address || !city || !state || !zip) return showErr('Please fill in all fields.');
    if (!/^[A-Z]{2}$/.test(state)) return showErr('Please enter a valid 2-letter state code (e.g., SC).');
    if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) return showErr('Please enter a valid email address.');

    const cart = safeJsonParse(localStorage.getItem('h2s_cart') || '[]', []);
    if (!Array.isArray(cart) || cart.length === 0) return showErr('Your cart is empty. Please add items first.');

    if (btn) { btn.disabled = true; btn.innerHTML = '<span class="spinner"></span> Processing...'; }
    if (errEl) errEl.style.display = 'none';

    const API = 'https://h2s-backend.vercel.app/api/shop';
    const promoCode = localStorage.getItem('h2s_promo_code');

    async function ensureCatalog(){
      try {
        if (typeof catalog !== 'undefined' && catalog && Array.isArray(catalog.bundles) && catalog.bundles.length > 0) return true;
      } catch (_) {}
      try {
        if (typeof window.fetchCatalogFromAPI === 'function') {
          const ok = await window.fetchCatalogFromAPI(true);
          try {
            if (ok && typeof catalog !== 'undefined' && catalog && Array.isArray(catalog.bundles) && catalog.bundles.length > 0) return true;
          } catch (_) {}
        }
      } catch (_) {}
      return false;
    }

    function resolveStripePriceId(item){
      try {
        if (!item) return '';
        if (item.stripe_price_id) return String(item.stripe_price_id);
        if (item.price_id) return String(item.price_id);

        // Bundles/packages
        const bundleId = item.bundle_id || item.id;
        if (bundleId && typeof catalog !== 'undefined' && catalog && Array.isArray(catalog.bundles)) {
          const b = catalog.bundles.find(function(x){ return x && x.bundle_id === bundleId; });
          if (b && b.stripe_price_id) return String(b.stripe_price_id);
        }

        // Services with tiers
        const serviceId = item.service_id;
        const qty = Number(item.qty || item.quantity || 1) || 1;
        if (serviceId && typeof catalog !== 'undefined' && catalog) {
          if (Array.isArray(catalog.priceTiers)) {
            const tiers = catalog.priceTiers.filter(function(t){ return t && t.service_id === serviceId; });
            const tier = tiers.find(function(t){
              const min = Number(t.min_qty || 0);
              const max = (t.max_qty === '' || t.max_qty == null) ? Infinity : Number(t.max_qty);
              return qty >= min && qty <= max;
            });
            if (tier && tier.stripe_price_id) return String(tier.stripe_price_id);
          }
          if (Array.isArray(catalog.services)) {
            const s = catalog.services.find(function(x){ return x && x.service_id === serviceId; });
            if (s && s.stripe_price_id) return String(s.stripe_price_id);
          }
        }
      } catch (_) {}
      return '';
    }

    function buildStripeLineItems(cartRows){
      const out = [];
      try {
        (cartRows || []).forEach(function(item){
          const quantity = Number(item.qty || item.quantity || 1) || 1;
          const priceId = resolveStripePriceId(item);
          if (priceId) {
            out.push({ price: priceId, quantity: quantity });
            return;
          }

          // Fallback: dynamic price_data (only if we have a positive numeric unit price)
          const unit = Number(item.price ?? item.unit_price ?? 0);
          if (!isFinite(unit) || unit <= 0) return;
          out.push({
            price_data: {
              currency: 'usd',
              product_data: {
                name: String(item.name || item.service_name || item.id || item.bundle_id || 'Service').slice(0, 120)
              },
              unit_amount: Math.round(unit * 100)
            },
            quantity: quantity
          });
        });
      } catch (_) {}
      return out;
    }
    function truncateStripeMetaValue(value, maxLen){
      try {
        var s = (value == null) ? '' : (typeof value === 'string' ? value : JSON.stringify(value));
        s = String(s);
        var max = Number(maxLen || 450);
        if (!isFinite(max) || max <= 0) max = 450;
        if (s.length <= max) return s;
        return s.slice(0, max);
      } catch (_) {
        return '';
      }
    }

    function sanitizeCartForBackend(rawCart){
      const out = [];
      const dropped = [];

      function toIntQty(v){
        const n = Number(v);
        if (!isFinite(n) || n <= 0) return 1;
        return Math.max(1, Math.round(n));
      }

      try {
        (rawCart || []).forEach(function(item){
          if (!item || typeof item !== 'object') { dropped.push(item); return; }

          const type = String(item.type || '').toLowerCase();
          const id = item.id || item.bundle_id || item.service_id || item.serviceId || item.service || '';
          const qty = toIntQty(item.qty || item.quantity || 1);
          const metadata = (item.metadata && typeof item.metadata === 'object') ? item.metadata : {};
          const name = item.name || item.service_name || item.serviceName || '';

          // 1) Bundles/packages: backend accepts item.type === 'bundle'|'package'
          //    and uses bundle_id (or id) to look up a Stripe price ID.
          if (type === 'bundle' || type === 'package' || item.bundle_id || String(item.bundle_id || '').length) {
            const bundleId = item.bundle_id || item.id;
            if (!bundleId) { dropped.push(item); return; }
            out.push({
              type: 'bundle',
              id: bundleId,
              bundle_id: bundleId,
              qty: qty,
              name: name || bundleId,
              metadata: metadata
            });
            return;
          }

          // 2) Services: backend requires service_id (it does NOT treat id as service_id).
          const serviceId = item.service_id || item.serviceId || (type === 'service' ? item.id : null) || null;
          if (serviceId) {
            out.push({
              type: 'service',
              service_id: serviceId,
              qty: qty,
              option_id: item.option_id || item.optionId || item.option || undefined,
              name: name || serviceId,
              metadata: metadata
            });
            return;
          }

          // 3) Known dynamic bundle IDs (tv_multi / cams) are handled by backend via item.id
          //    even before it checks type/service_id. Preserve them.
          if (item.id && ['tv_multi','cam_basic','cam_standard','cam_premium'].indexOf(String(item.id)) >= 0) {
            out.push({ type: 'bundle', id: item.id, bundle_id: item.id, qty: qty, name: name || item.id, metadata: metadata });
            return;
          }

          dropped.push(item);
        });
      } catch (_) {}

      try {
        if (dropped.length) console.warn('[Checkout] Dropped invalid cart rows (would 400):', dropped);
      } catch (_) {}

      return out;
    }

    // Use var to avoid any temporal-dead-zone issues if this block gets reordered
    // by future edits or overwritten by deferred scripts.
    var cartForCheckout = null;
    cartForCheckout = sanitizeCartForBackend(cart);
    if (!Array.isArray(cartForCheckout) || cartForCheckout.length === 0) {
      if (btn) { btn.disabled = false; btn.textContent = 'Proceed to Payment'; }
      return showErr('Checkout failed: cart items could not be prepared for checkout. Please refresh and try again.');
    }

    // Stripe metadata values must be <= 500 chars. The cart can contain nested config
    // (e.g., tv mount items_json) that can easily exceed that. Only send a compact
    // summary in Stripe metadata; the full cart is still sent in the request body.
    const cart_items_meta_obj = (cartForCheckout || []).map(function(item){
      var id = item && (item.bundle_id || item.service_id || item.id) || '';
      return {
        id: id,
        type: item && item.type || '',
        name: item && (item.name || item.service_name || item.service_id || item.bundle_id || item.id) || '',
        qty: item && (item.qty || item.quantity || 1) || 1,
        // dollars -> cents
        price_cents: Math.round((Number(item && (item.price || item.unit_price || 0)) || 0) * 100)
      };
    });
    const cart_items_meta = truncateStripeMetaValue(cart_items_meta_obj, 450);

    // Ensure we can build price IDs for checkout (for the newer shop handler).
    try {
      await ensureCatalog();
    } catch (e) {
      if (btn) { btn.disabled = false; btn.textContent = 'Proceed to Payment'; }
      return showErr('Checkout failed: unable to load pricing. Please refresh and try again.');
    }
    const line_items = buildStripeLineItems(cartForCheckout);

    const payload = {
      __action: 'create_checkout_session',
      customer: { name: name, email: email, phone: phone },
      customer_email: email,
      line_items: line_items,
      cart: cartForCheckout,
      source: 'shop_rebuilt',
      success_url: 'https://home2smart.com/bundles?view=shopsuccess&session_id={CHECKOUT_SESSION_ID}',
      cancel_url: window.location.href,
      metadata: {
        customer_name: name,
        customer_phone: phone,
        customer_email: email,
        service_address: address,
        service_city: city,
        service_state: state,
        service_zip: zip,
        state: state,
        source: 'shop_rebuilt',
        cart_items: cart_items_meta
      }
    };
    if (promoCode) payload.promotion_code = promoCode;

    try {
      const res = await fetch(API, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
      const contentType = res.headers.get('content-type') || '';
      const data = contentType.includes('application/json') ? await res.json() : safeJsonParse(await res.text());
      if (!res.ok || !data || !data.ok) throw new Error((data && (data.error || data.message)) || ('HTTP ' + res.status));
      if (!data.pay || !data.pay.session_url) throw new Error('No Stripe session URL in response');

      // Snapshot for success page fast rendering (keep small; avoid Stripe metadata limits).
      try {
        var rawCart = safeJsonParse(localStorage.getItem('h2s_cart') || '[]', []);
        var orderValueCents = 0;
        if (Array.isArray(rawCart)) {
          rawCart.forEach(function(it){
            var q = Number(it && (it.qty || it.quantity || 1)) || 1;
            var p = Number(it && (it.price || it.unit_price || 0)) || 0;
            if (isFinite(p) && p > 0) orderValueCents += Math.round(p * 100) * q;
          });
        }

        var expectedPaidCents = null;
        try {
          // If we have a last-known promo estimate (from the cart UI), use it.
          if (window.__H2S_PROMO_LAST_GOOD_EST__ && typeof window.__H2S_PROMO_LAST_GOOD_EST__.total_cents === 'number') {
            expectedPaidCents = window.__H2S_PROMO_LAST_GOOD_EST__.total_cents;
          }
        } catch (_) {}

        localStorage.setItem('h2s_checkout_snapshot', JSON.stringify({
          session_id: data.pay.session_id || '',
          ts: Date.now(),
          order_value_cents: orderValueCents,
          expected_paid_cents: expectedPaidCents,
          promo_code: promoCode || null
        }));
      } catch (_) {}

      try {
        localStorage.setItem('h2s_guest_checkout', JSON.stringify({ name: name, email: email, phone: phone, address: address, city: city, state: state, zip: zip }));
      } catch (_) {}

      try {
        document.documentElement.classList.remove('modal-open');
        document.body.classList.remove('modal-open');
      } catch (_) {}

      window.location.href = data.pay.session_url;
    } catch (err) {
      showErr('Checkout failed: ' + (err && err.message ? err.message : String(err)));
      if (btn) { btn.disabled = false; btn.textContent = 'Proceed to Payment'; }
    }
  };

  // The main bundles app JS is deferred and may re-define handleCheckoutSubmit.
  // Re-apply our handler for a short window so checkout stays stable.
  try {
    window.handleCheckoutSubmit.__h2s_checkout_override = true;
  } catch (_) {}

  try {
    if (!window.__H2S_CHECKOUT_OVERRIDE_SCHED__) {
      window.__H2S_CHECKOUT_OVERRIDE_SCHED__ = true;
      const start = Date.now();
      const overrideRef = window.handleCheckoutSubmit;
      const id = setInterval(function(){
        try {
          // If overridden, restore
          if (!window.handleCheckoutSubmit || !window.handleCheckoutSubmit.__h2s_checkout_override) {
            window.handleCheckoutSubmit = overrideRef;
            try { window.handleCheckoutSubmit.__h2s_checkout_override = true; } catch (_) {}
          }
          if ((Date.now() - start) > 15000) clearInterval(id);
        } catch (_) { try { clearInterval(id); } catch (_) {} }
      }, 50);
    }
  } catch (_) {}
})();
</script>

<script>
// Runtime endpoint shim (safe, additive): rewrites stale backend alias requests to live deployments.
(function () {
  var OLD_ORIGIN = 'https://h2s-backend.vercel.app';
  // NOTE: checkout + promo + bundles-data must all live on the same deployment.
  // The production alias can lag behind; this pins calls to the known-good deployment.
  var SHOP_ORIGIN = 'https://h2s-backend-robgbyphx-tabari-ropers-projects-6f2e090b.vercel.app';
  var SCHED_ORIGIN = 'https://h2s-backend-robgbyphx-tabari-ropers-projects-6f2e090b.vercel.app';

  if (!window.fetch || window.__H2S_FETCH_SHIM__) return;
  window.__H2S_FETCH_SHIM__ = true;

  function rewriteUrl(input) {
    try {
      var raw = typeof input === 'string' ? input : (input && input.url ? input.url : String(input));
      var url = new URL(raw, window.location.href);

      if (url.origin === OLD_ORIGIN) {
        if (url.pathname.indexOf('/api/shop') === 0 || url.pathname.indexOf('/api/reviews') === 0) {
          url = new URL(url.toString());
          url.host = new URL(SHOP_ORIGIN).host;
          url.protocol = 'https:';
        } else if (url.pathname.indexOf('/api/quote') === 0 || url.pathname.indexOf('/api/promo_validate') === 0) {
          // Quote + promo validation are shop-adjacent and are served from the shop deployment.
          url = new URL(url.toString());
          url.host = new URL(SHOP_ORIGIN).host;
          url.protocol = 'https:';
        } else if (url.pathname.indexOf('/api/bundles-data') === 0) {
          // bundles-data is currently served from the scheduling deployment.
          url = new URL(url.toString());
          url.host = new URL(SCHED_ORIGIN).host;
          url.protocol = 'https:';
        } else if (url.pathname.indexOf('/api/schedule-appointment') === 0 || url.pathname.indexOf('/api/get-availability') === 0) {
          url = new URL(url.toString());
          url.host = new URL(SCHED_ORIGIN).host;
          url.protocol = 'https:';
        } else if (url.pathname === '/api/stats') {
          url.pathname = '/api/v1';
          url.searchParams.set('action', 'stats');
        }
      }

      return url.toString();
    } catch (_) {
      return input;
    }
  }

  var originalFetch = window.fetch.bind(window);
  window.fetch = function (input, init) {
    var rewritten = rewriteUrl(input);

    // Lighthouse/perf: avoid marking bundles-data as high priority; let LCP resources win.
    try {
      var u = new URL(typeof rewritten === 'string' ? rewritten : (rewritten && rewritten.url) || '', window.location.href);
      if (u.pathname.indexOf('/api/bundles-data') === 0 && init && typeof init === 'object') {
        init = Object.assign({}, init);
        if ('priority' in init) init.priority = 'low';
      }
    } catch (_) {}

    var fetchInput = input;
    try {
      if (input instanceof Request) {
        var baseReq = init ? new Request(input, init) : input;
        fetchInput = new Request(rewritten, baseReq);
        init = undefined;
      } else {
        fetchInput = rewritten;
      }
    } catch (_) {
      fetchInput = rewritten;
    }

    return originalFetch(fetchInput, init).then(function (res) {
      try {
        var u = new URL(typeof rewritten === 'string' ? rewritten : (fetchInput && fetchInput.url) || '', window.location.href);
        if (u.pathname.indexOf('/api/reviews') === 0) {
          res.clone().json().then(function (data) {
            try {
              if (!data || !data.ok || !Array.isArray(data.reviews)) return;
              if (typeof allReviews === 'undefined') return;
              if (Array.isArray(allReviews) && allReviews.length > 0) return;

              allReviews = data.reviews.map(function (r) {
                return Object.assign({}, r, {
                  display_name: r.display_name || r.name || 'Customer',
                  review_text: r.review_text || r.text || '',
                  rating: r.rating || 5
                });
              });

              if (typeof reviewsLoadedFromAPI !== 'undefined') reviewsLoadedFromAPI = true;
              try { typeof renderReviews === 'function' && renderReviews(); } catch (_) {}
              try { typeof startCarousel === 'function' && startCarousel(); } catch (_) {}
            } catch (_) {}
          }).catch(function () {});
        }
      } catch (_) {}

      return res;
    });
  };
})();
</script>

<style id="h2s-reviews-ui-patch">
  /* Keep only the main (bigger) reviews carousel */
  #heroReviews { display: none !important; }

  /* Prevent hover-lift shadows from being clipped and avoid pseudo-element overlays */
  .review-carousel { overflow-x: hidden !important; overflow-y: visible !important; }
  .review-carousel-header { position: relative; z-index: 30; margin-bottom: 72px !important; }
  .review-track-container { overflow-x: hidden !important; overflow-y: visible !important; position: relative; z-index: 20; padding-top: 12px !important; }
  .review-track { position: relative; z-index: 20; }
  .review-nav { position: relative; z-index: 20; }
  .review-carousel::before,
  .review-carousel::after { z-index: 5 !important; }

  .review-card { z-index: 1; }
  .review-card:hover { z-index: 25; }

  /* Mobile: exactly one card visible per page (no peek/bleed). */
  @media (max-width: 767.98px) {
    html, body { overflow-x: hidden !important; }

    /* Reduce the large vertical gaps on mobile */
    .review-carousel { padding-top: 48px !important; padding-bottom: 24px !important; overflow: hidden !important; }
    .review-carousel-header { margin-bottom: 28px !important; }

    /* Critical: the clipping viewport must NOT add horizontal padding.
       If the viewport has padding, the next slide becomes visible inside the padding area. */
    .review-track-container { overflow: hidden !important; padding-left: 0 !important; padding-right: 0 !important; box-sizing: border-box; }
    .review-track { gap: 0 !important; padding-left: 0 !important; padding-right: 0 !important; width: 100% !important; box-sizing: border-box; }

    /* One slide per view: (basis + margins) == 100% so no peek is possible.
       Provide breathing room via margins on the card itself. */
    .review-card {
      flex: 0 0 calc(100% - 32px) !important;
      max-width: calc(100% - 32px) !important;
      width: auto !important;
      margin-left: 16px !important;
      margin-right: 16px !important;
      box-sizing: border-box !important;
      min-width: 0 !important;
    }

    .review-track { padding-bottom: 16px !important; }
    .review-nav { margin-top: 10px !important; }
  }
</style>

</body>
</html>






</div><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----></div><!--]--><!--]--></div><!----><!----><!----><!----><span></span><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----></div><!--]--><!--]--></div><!----><!----><!----><!----><span></span><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----></div><!--]--><!--]--></div><!----><!----><!----><!----><span></span><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----></div><!--]--><!--]--></div></div><!----><!----></div><!--]--></div><!--]--><!--]--><!--]--><!--]--></div><div id="teleports"></div><script type="application/json" data-nuxt-data="nuxt-app" data-ssr="true" id="__NUXT_DATA__">[["ShallowReactive",1],{"data":2,"state":236,"once":579,"_errors":580,"serverRendered":58},["ShallowReactive",3],{"pageData":4},{"elements":5,"popup":173,"fontsToLoad":174,"customFonts":175,"meta":176,"domainName":177,"pageUrl":178,"pageId":179,"pageName":180,"locationId":181,"headerCode":182,"footerCode":55,"popupsList":183,"favicon":231,"globalHeadTrackingCode":55,"globalBodyTrackingCode":55,"funnelId":232,"funnelName":233,"stepId":234,"affiliateId":-1,"cookieConsent":-1,"disablePageLevelCookieConsent":51,"pixelToInit":235,"isOptimisePageLoad":58,"backgroundSettingsClass":57},[6,10,69,113,160],{"id":7,"child":8},"hl_main",[9],"section-zwgfsNCznE",{"id":9,"type":11,"child":12,"class":14,"styles":23,"extra":46,"wrapper":64,"meta":11,"tagName":65,"title":66,"mobileStyles":67,"mobileWrapper":68,"_id":9},"section",[13],"row-g7f2wkYs_s",{"width":15,"borders":17,"borderRadius":19,"radiusEdge":21},{"value":16},"fullSection",{"value":18},"noBorder",{"value":20},"radius0",{"value":22},"none",{"boxShadow":24,"paddingLeft":25,"paddingRight":28,"paddingBottom":29,"paddingTop":31,"marginTop":32,"marginBottom":33,"marginLeft":34,"marginRight":35,"backgroundColor":36,"background":38,"backdropFilter":39,"borderColor":40,"borderWidth":42,"borderStyle":44},{"value":22},{"unit":26,"value":27},"px",0,{"value":27,"unit":26},{"unit":26,"value":30},20,{"unit":26,"value":30},{"unit":26,"value":27},{"unit":26,"value":27},{"unit":26,"value":27},{"unit":26,"value":27},{"value":37},"var(--transparent)",{"value":22},{"value":22},{"value":41},"var(--black)",{"value":43,"unit":26},"2",{"value":45},"solid",{"sticky":47,"visibility":49,"bgImage":52,"allowRowMaxWidth":59,"customClass":60,"elementScreenshot":62},{"value":48},"noneSticky",{"value":50},{"hideDesktop":51,"hideMobile":51},false,{"value":53},{"mediaType":54,"url":55,"opacity":56,"options":57,"svgCode":55,"videoUrl":55,"videoThumbnail":55,"videoLoop":58},"image","","1","bgCover",true,{"value":51},{"value":61},[],{"value":63},[],{},"c-section","Section",{},{},{"id":13,"type":70,"child":71,"class":73,"styles":79,"extra":93,"wrapper":103,"tagName":109,"meta":70,"title":110,"mobileStyles":111,"mobileWrapper":112},"row",[72],"col-0KXXeTJt-F",{"alignRow":74,"borders":76,"borderRadius":77,"radiusEdge":78},{"value":75},"row-align-center",{"value":18},{"value":20},{"value":22},{"boxShadow":80,"paddingLeft":81,"paddingRight":83,"paddingTop":84,"paddingBottom":86,"backgroundColor":87,"background":88,"backdropFilter":89,"borderColor":90,"borderWidth":91,"borderStyle":92},{"value":22},{"value":82,"unit":26},5,{"value":82,"unit":26},{"value":85,"unit":26},10,{"value":85,"unit":26},{"value":37},{"value":22},{"value":22},{"value":41},{"value":43,"unit":26},{"value":45},{"visibility":94,"bgImage":96,"rowWidth":98,"customClass":101},{"value":95},{"hideDesktop":51,"hideMobile":51},{"value":97},{"mediaType":54,"url":55,"opacity":56,"options":57,"svgCode":55,"videoUrl":55,"videoThumbnail":55,"videoLoop":58},{"value":99,"unit":100},100,"%",{"value":102},[],{"marginTop":104,"marginBottom":105,"marginLeft":106,"marginRight":108},{"unit":26,"value":27},{"unit":26,"value":27},{"unit":55,"value":107},"auto",{"unit":55,"value":107},"c-row","1 Column Row",{},{},{"id":72,"type":114,"child":115,"class":117,"styles":121,"extra":134,"wrapper":150,"tagName":155,"meta":114,"title":156,"noOfColumns":157,"mobileStyles":158,"mobileWrapper":159},"col",[116],"custom-code-F7m1yuu79Z",{"borders":118,"borderRadius":119,"radiusEdge":120},{"value":18},{"value":20},{"value":22},{"boxShadow":122,"paddingLeft":123,"paddingRight":124,"paddingTop":125,"paddingBottom":126,"backgroundColor":127,"background":128,"backdropFilter":129,"width":130,"borderColor":131,"borderWidth":132,"borderStyle":133},{"value":22},{"value":82,"unit":26},{"value":82,"unit":26},{"value":85,"unit":26},{"value":85,"unit":26},{"value":37},{"value":22},{"value":22},{"value":99,"unit":100},{"value":41},{"value":43,"unit":26},{"value":45},{"visibility":135,"bgImage":137,"columnLayout":139,"justifyContentColumnLayout":141,"alignContentColumnLayout":143,"forceColumnLayoutForMobile":145,"customClass":146,"elementVersion":148},{"value":136},{"hideDesktop":51,"hideMobile":51},{"value":138},{"mediaType":54,"url":55,"opacity":56,"options":57,"svgCode":55,"videoUrl":55,"videoThumbnail":55,"videoLoop":58},{"value":140},"column",{"value":142},"center",{"value":144},"inherit",{"value":58},{"value":147},[],{"value":149},2,{"marginLeft":151,"marginRight":152,"marginTop":153,"marginBottom":154},{"unit":26,"value":27},{"unit":26,"value":27},{"unit":26,"value":27},{"unit":26,"value":27},"c-column","1st Column",1,{},{},{"extra":161,"id":116,"meta":170,"tagName":171,"class":172},{"visibility":162,"customCode":164,"customClass":167,"nodeId":169},{"value":163},{"hideMobile":55,"hideDesktop":55},{"value":165},{"rawCustomCode":166},"\u003C!DOCTYPE html>\n\u003Chtml lang=\"en\" class=\"h2s-reviews-show-placeholders\">\n\u003Chead>\n\u003Cmeta charset=\"UTF-8\">\n\u003C!-- CACHE BUSTER v1.0.8 REMOVE-DEFERRED-404 -->\n\u003C!-- Performance: Preconnect to critical origins -->\n\u003Clink rel=\"preconnect\" href=\"https://js.stripe.com\">\n\u003Clink rel=\"preconnect\" href=\"https://connect.facebook.net\">\n\n\u003C!-- EARLY ENDPOINT SHIM: must run before the large deferred bundles script executes. -->\n\u003C!-- Prevents /api/bundles-data 404s (alias drift) and avoids competing with LCP by forcing low priority. -->\n\u003Cscript>\n(function () {\n  try {\n    // Versioned so a newer deploy can override an older cached shim.\n    var SHIM_VERSION = 2;\n    if (window.__H2S_EARLY_FETCH_SHIM_VERSION__ && window.__H2S_EARLY_FETCH_SHIM_VERSION__ >= SHIM_VERSION) return;\n    window.__H2S_EARLY_FETCH_SHIM_VERSION__ = SHIM_VERSION;\n    window.__H2S_EARLY_FETCH_SHIM__ = true;\n\n    // IMPORTANT: the production alias can serve an app shell (HTML) for missing API routes.\n    // Pin the critical API calls to the known-good deployment *before* the app code runs.\n    var OLD_ORIGIN = 'https://h2s-backend.vercel.app';\n    var SHOP_ORIGIN = 'https://h2s-backend-robgbyphx-tabari-ropers-projects-6f2e090b.vercel.app';\n    var SCHED_ORIGIN = 'https://h2s-backend-robgbyphx-tabari-ropers-projects-6f2e090b.vercel.app';\n\n    var originalFetch = window.fetch && window.fetch.bind(window);\n    if (!originalFetch) return;\n\n    function rewrite(input) {\n      try {\n        if (!input) return input;\n        var raw = typeof input === 'string' ? input : (input && input.url) ? input.url : '';\n        var url = new URL(raw, window.location.href);\n\n        // Rewrite any request whose hostname is the broken production alias.\n        // (Some browsers normalize URL strings slightly; hostname match is safest.)\n        if (String(url.hostname || '') !== 'h2s-backend.vercel.app') return input;\n\n        // Keep tracking on the alias (this route is live there).\n        if (url.pathname && url.pathname.indexOf('/api/track') === 0) return input;\n\n        // Compatibility: legacy success page uses /api/shop?action=orderpack. The live checkout deployment\n        // exposes order details at /api/get-order-details instead (orderpack may not exist).\n        try {\n          if (url.pathname && url.pathname.indexOf('/api/shop') === 0) {\n            var act = '';\n            try { act = String(url.searchParams.get('action') || '').trim(); } catch (_) { act = ''; }\n            if (act === 'orderpack') {\n              var sid = '';\n              try { sid = String(url.searchParams.get('session_id') || '').trim(); } catch (_) { sid = ''; }\n              if (sid) {\n                url.pathname = '/api/get-order-details';\n                try { url.search = ''; } catch (_) {}\n                try { url.searchParams.set('session_id', sid); } catch (_) { url.search = 'session_id=' + encodeURIComponent(sid); }\n              }\n            }\n          }\n        } catch (_) {}\n\n        // Shop + reviews + order-details should be routed to the deployment that supports checkout + JSON.\n        if (url.pathname && (\n          url.pathname.indexOf('/api/shop') === 0 ||\n          url.pathname.indexOf('/api/reviews') === 0 ||\n          url.pathname.indexOf('/api/quote') === 0 ||\n          url.pathname.indexOf('/api/promo_validate') === 0 ||\n          url.pathname.indexOf('/api/get-order-details') === 0 ||\n          url.pathname.indexOf('/api/get-order') === 0\n        )) {\n          url = new URL(url.toString());\n          url.host = new URL(SHOP_ORIGIN).host;\n          url.protocol = 'https:';\n          return url.toString();\n        }\n\n        // Bundles-data + scheduling endpoints live on the scheduling deployment.\n        if (url.pathname && (\n          url.pathname.indexOf('/api/bundles-data') === 0 ||\n          url.pathname.indexOf('/api/schedule-appointment') === 0 ||\n          url.pathname.indexOf('/api/get-availability') === 0\n        )) {\n          url = new URL(url.toString());\n          url.host = new URL(SCHED_ORIGIN).host;\n          url.protocol = 'https:';\n          return url.toString();\n        }\n\n        return input;\n      } catch (_) {\n        return input;\n      }\n    }\n\n    window.fetch = function (input, init) {\n      var rewritten = rewrite(input);\n\n      // The live checkout deployment may not implement __action=mark_session; it's non-critical.\n      // Avoid spamming the console with 400s and keep the success page clean.\n      try {\n        var method = (init && init.method) ? String(init.method).toUpperCase() : (input && input.method ? String(input.method).toUpperCase() : 'GET');\n        if (method === 'POST') {\n          var targetUrl = new URL(typeof rewritten === 'string' ? rewritten : (rewritten && rewritten.url) ? rewritten.url : '', window.location.href);\n          if (targetUrl.hostname === new URL(SHOP_ORIGIN).hostname && targetUrl.pathname.indexOf('/api/shop') === 0) {\n            var bodyText = '';\n            try { bodyText = typeof init.body === 'string' ? init.body : ''; } catch (_) { bodyText = ''; }\n            if (bodyText && bodyText.indexOf('mark_session') >= 0) {\n              return Promise.resolve(new Response(JSON.stringify({ ok: true, skipped: true }), { status: 200, headers: { 'Content-Type': 'application/json' } }));\n            }\n          }\n        }\n      } catch (_) {}\n\n      // Perf: never let bundles-data compete with LCP.\n      try {\n        // Ensure the URL is valid before processing\n        if (!rewritten) return originalFetch(input, init);\n        \n        var u = new URL(typeof rewritten === 'string' ? rewritten : (rewritten && rewritten.url) || '', window.location.href);\n        if (u.pathname && u.pathname.indexOf('/api/bundles-data') === 0) {\n          if (init && typeof init === 'object') {\n            init = Object.assign({}, init);\n            if ('priority' in init) init.priority = 'low';\n          } else {\n            init = { priority: 'low' };\n          }\n        }\n      } catch (_) {}\n\n      try {\n        if (input instanceof Request) {\n          var baseReq = init ? new Request(input, init) : input;\n          return originalFetch(new Request(rewritten, baseReq), undefined);\n        }\n      } catch (_) {}\n\n      return originalFetch(rewritten, init);\n    };\n  } catch (_) {}\n})();\n\u003C/script>\n\u003C!-- H2S SAFE-START: prevent early clicks throwing before app loads -->\n\u003Cscript>\n(function () {\n  try {\n    if (window.__H2S_EARLY_STUBS__) return;\n    window.__H2S_EARLY_STUBS__ = true;\n\n    var q = (window.__H2S_CALL_QUEUE__ = window.__H2S_CALL_QUEUE__ || []);\n    function enqueue(name, args) {\n      q.push({ name: name, args: Array.prototype.slice.call(args || []) });\n    }\n\n    function stub(name) {\n      if (typeof window[name] === 'function') return;\n      window[name] = function () {\n        enqueue(name, arguments);\n      };\n    }\n\n    // Only what the static HTML calls before app init.\n    [\n      'dismissUrgencyBanner',\n      'navSet',\n      'toggleMenu',\n      'toggleCart',\n      'scrollToSection',\n      'selectPackage',\n      'safeRequestQuote',\n      'safeCloseQuoteModal',\n      'submitQuoteRequest',\n      'addPackageToCart',\n      'closeModal',\n      'openBooking'\n    ].forEach(stub);\n  } catch (_) {}\n})();\n\u003C/script>\n\n\u003C!-- H2S BASE GLOBALS: required by strict-mode app code -->\n\u003Cscript>\n(function () {\n  try {\n    // Ensure these exist before the strict-mode monolith runs.\n    if (typeof window.reviewIndex !== 'number' || !isFinite(window.reviewIndex)) window.reviewIndex = 0;\n    if (typeof window.reviewInterval === 'undefined') window.reviewInterval = null;\n\n    if (typeof window.H2S_lockScroll !== 'function') {\n      window.H2S_lockScroll = function () {\n        try {\n          if (document.documentElement.classList.contains('modal-open') || document.body.classList.contains('modal-open')) return;\n          var y = window.scrollY || document.documentElement.scrollTop || 0;\n          document.documentElement.dataset.h2sScrollY = String(y);\n          document.documentElement.classList.add('modal-open');\n          document.body.classList.add('modal-open');\n          document.body.style.top = '-' + y + 'px';\n        } catch (_) {}\n      };\n    }\n\n    if (typeof window.H2S_unlockScroll !== 'function') {\n      window.H2S_unlockScroll = function () {\n        try {\n          if (!document.documentElement.classList.contains('modal-open') && !document.body.classList.contains('modal-open')) return;\n          var y = parseInt(document.documentElement.dataset.h2sScrollY || '0', 10) || 0;\n          document.documentElement.classList.remove('modal-open');\n          document.body.classList.remove('modal-open');\n          document.body.style.top = '';\n          delete document.documentElement.dataset.h2sScrollY;\n          window.scrollTo(0, y);\n        } catch (_) {}\n      };\n    }\n  } catch (_) {}\n})();\n\u003C/script>\n\n\u003C!-- Security -->\n\u003Cmeta http-equiv=\"X-Content-Type-Options\" content=\"nosniff\">\n\u003Cmeta name=\"referrer\" content=\"strict-origin-when-cross-origin\">\n\u003Cmeta name=\"viewport\" content=\"width=device-width, initial-scale=1, maximum-scale=5, user-scalable=yes, viewport-fit=cover\">\n\u003Clink rel=\"preconnect\" href=\"https://h2s-backend.vercel.app\" crossorigin>\n\u003Clink rel=\"preconnect\" href=\"https://fonts.googleapis.com\">\n\u003Clink rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossorigin>\n\u003Clink rel=\"preconnect\" href=\"https://js.stripe.com\" crossorigin>\n\u003Clink rel=\"preconnect\" href=\"https://api.stripe.com\" crossorigin>\n\u003Clink rel=\"dns-prefetch\" href=\"https://connect.facebook.net\">\n\u003Ctitle>Smart Home Packages &bull; Home2Smart\u003C/title>\n\u003Cmeta name=\"description\" content=\"TV mounting and security camera packages. Pick a package, we handle the rest. Done right, done once.\">\n\u003Cmeta name=\"theme-color\" content=\"#0a2a5a\">\n\n\u003C!-- SEO: Open Graph -->\n\u003Cmeta property=\"og:title\" content=\"Smart Home Installation Packages | Home2Smart\">\n\u003Cmeta property=\"og:description\" content=\"Professional TV mounting & security camera installation. Licensed, insured, instant booking within availability. 500+ homes served, 4.9&#9733; rating.\">\n\u003Cmeta property=\"og:type\" content=\"website\">\n\u003Cmeta property=\"og:url\" content=\"https://home2smart.com/bundles\">\n\u003Cmeta property=\"og:site_name\" content=\"Home2Smart\">\n\n\u003C!-- SEO: Twitter Card -->\n\u003Cmeta name=\"twitter:card\" content=\"summary_large_image\">\n\u003Cmeta name=\"twitter:title\" content=\"Smart Home Installation Packages | Home2Smart\">\n\u003Cmeta name=\"twitter:description\" content=\"Professional TV mounting & security camera installation. Licensed, insured, instant booking within availability.\">\n\n\u003C!-- SEO: Canonical URL -->\n\u003Clink rel=\"canonical\" href=\"https://home2smart.com/bundles\">\n\n\u003C!-- SEO: Robots -->\n\u003Cmeta name=\"robots\" content=\"index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1\">\n\n\u003C!-- Performance: Critical Resource Hints -->\n\u003Clink rel=\"dns-prefetch\" href=\"https://h2s-backend.vercel.app\">\n\u003Clink rel=\"preconnect\" href=\"https://js.stripe.com\" crossorigin>\n\u003Clink rel=\"preconnect\" href=\"https://api.stripe.com\" crossorigin>\n\u003Clink rel=\"dns-prefetch\" href=\"https://storage.googleapis.com\">\n\u003C!-- Add favicon to avoid 404 in local dev -->\n\u003Clink rel=\"icon\" href=\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3E%3Ccircle cx='8' cy='8' r='8' fill='%230a2a5a'/%3E%3C/svg%3E\">\n\u003C!-- Preload logo for faster LCP (highest priority resource) -->\n\u003Clink rel=\"preload\" href=\"https://storage.googleapis.com/msgsndr/7Drmpw623JAkrfDKPdjG/media/68da0ce6f00445991d64a63f.png\" as=\"image\" fetchpriority=\"high\" imagesrcset=\"https://storage.googleapis.com/msgsndr/7Drmpw623JAkrfDKPdjG/media/68da0ce6f00445991d64a63f.png 1x\" imagesizes=\"64px\">\n\u003C!-- Font woff2 preload removed - version-specific URL (v18) causes 404 errors -->\n\n\u003C!-- H2S Tracking Diagnostics & Enforcement -->\n\u003Cscript>\n(function() {\n  function __h2sStartTracking() {\n  const ls = window.localStorage;\n  \n  // RFC4122 v4 UUID fallback (for browsers without crypto.randomUUID)\n  function uuidv4Fallback() {\n    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n      const r = Math.random() * 16 | 0;\n      const v = c === 'x' ? r : (r & 0x3 | 0x8);\n      return v.toString(16);\n    });\n  }\n  \n  function getOrCreateVisitorId() {\n    let vid = ls.getItem('h2s_visitor_id');\n    if (!vid) {\n      vid = (self.crypto && self.crypto.randomUUID) ? self.crypto.randomUUID() : uuidv4Fallback();\n      ls.setItem('h2s_visitor_id', vid);\n    }\n    return vid;\n  }\n  \n  function getOrCreateSessionId() {\n    let sid = ls.getItem('h2s_session_id');\n    if (!sid) {\n      sid = (self.crypto && self.crypto.randomUUID) ? self.crypto.randomUUID() : uuidv4Fallback();\n      ls.setItem('h2s_session_id', sid);\n    }\n    return sid;\n  }\n  async function sendBackend(event_type, params={}) {\n    const visitor_id = getOrCreateVisitorId();\n    const session_id = getOrCreateSessionId();\n    \n    // Validate UUIDs before sending\n    const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;\n    if (!uuidRegex.test(visitor_id)) {\n      // Regenerate and try again\n      ls.removeItem('h2s_visitor_id');\n      return sendBackend(event_type, params);\n    }\n    if (!uuidRegex.test(session_id)) {\n      ls.removeItem('h2s_session_id');\n      return sendBackend(event_type, params);\n    }\n    \n    // Extract UTM parameters from URL\n    const urlParams = new URLSearchParams(window.location.search);\n    const utm_source = urlParams.get('utm_source') || null;\n    const utm_medium = urlParams.get('utm_medium') || null;\n    const utm_campaign = urlParams.get('utm_campaign') || null;\n    const utm_term = urlParams.get('utm_term') || null;\n    const utm_content = urlParams.get('utm_content') || null;\n    \n    function normalizePathname(p) {\n      const s = (p || '').toString().trim();\n      if (!s) return '/';\n      if (s === '/') return '/';\n      // remove trailing slashes\n      return s.replace(/\\/+$/g, '');\n    }\n\n    const payload = {\n      event_type,\n      visitor_id,\n      session_id,\n      occurred_at: new Date().toISOString(),\n      page_url: location.href,\n      page_path: normalizePathname(location.pathname),\n      referrer: document.referrer || '(direct)',\n      user_agent: navigator.userAgent,\n      // UTM parameters\n      utm_source,\n      utm_medium,\n      utm_campaign,\n      utm_term,\n      utm_content,\n      // Merge custom params\n      ...params\n    };\n    \n    const endpoint = 'https://h2s-backend.vercel.app/api/track';\n    const body = JSON.stringify(payload);\n\n    // IMPORTANT:\n    // In local previews (127.0.0.1/localhost), browsers enforce CORS.\n    // The backend currently responds in a way that trips credentialed-CORS rules.\n    // To ensure events still reach the backend (and downstream Meta/CAPI), we send a\n    // simple, non-preflighted request in `no-cors` mode when running locally.\n    const isLocalPreview = (location.hostname === '127.0.0.1' || location.hostname === 'localhost');\n\n    try {\n      if (isLocalPreview) {\n        // Fire-and-forget: avoid preflight and avoid CORS console failures.\n        // Body will be sent as text/plain; backend can JSON.parse it.\n        await fetch(endpoint, {\n          method: 'POST',\n          mode: 'no-cors',\n          credentials: 'omit',\n          body,\n          cache: 'no-store',\n          keepalive: true\n        });\n        return { ok: true, via: 'no-cors' };\n      }\n\n      const res = await fetch(endpoint, {\n        method: 'POST',\n        mode: 'cors',\n        headers: { 'Content-Type': 'application/json' },\n        body,\n        credentials: 'omit',\n        cache: 'no-store',\n        keepalive: true\n      });\n\n      if (res.ok) return { ok: true };\n\n      const txt = await res.text();\n      let errorDetails = txt;\n      try {\n        const errorJson = JSON.parse(txt);\n        errorDetails = errorJson.error || errorJson.details || txt;\n        if (String(errorDetails).includes('invalid input syntax for type uuid')) {\n          ls.removeItem('h2s_visitor_id');\n          ls.removeItem('h2s_session_id');\n        }\n      } catch (e) {\n        // txt is not JSON, use as-is\n      }\n\n      return { ok: false, error: errorDetails, status: res.status };\n    } catch (err) {\n      // In tracking, fail-open: do not break UX.\n      return { ok: false, error: err && err.message ? err.message : String(err) };\n    }\n  }\n  function onReady(fn){\n    if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', fn);\n    else fn();\n  }\n  // REMOVED: page_view auto-send (global header handles it to avoid duplication)\n  // Global header tracking auto-sends page_view on page load\n  onReady(() => {\n    // PageView is handled by global header tracking\n    // Only send custom events here if needed\n  });\n  \n  // Expose globally with initialization flag\n  window.h2sSendBackend = sendBackend;\n  window.__H2S_TRACKING_READY__ = true;\n  }\n  if ('requestIdleCallback' in window) {\n    requestIdleCallback(__h2sStartTracking, { timeout: 2500 });\n  } else {\n    setTimeout(__h2sStartTracking, 0);\n  }\n})();\n\n(function(){\n  // TBT guard: reduce Meta Pixel polling overhead (the 150ms fbq readiness loop).\n  // We only touch intervals whose callback clearly references fbq + __H2S_FB_INIT__.\n  if (window.__H2S_FB_POLL_PATCH__) return;\n  window.__H2S_FB_POLL_PATCH__ = true;\n  if (!window.setInterval) return;\n\n  var originalSetInterval = window.setInterval.bind(window);\n  window.setInterval = function(fn, ms){\n    try {\n      if (ms === 150 && typeof fn === 'function') {\n        var src = Function.prototype.toString.call(fn);\n        if (src && src.indexOf('window.__H2S_FB_INIT__') !== -1 && src.indexOf('fbq') !== -1) {\n          var maxRuns = 8;\n          var runs = 0;\n          var id;\n          var wrapped = function(){\n            runs++;\n            if (runs > maxRuns) {\n              try { clearInterval(id); } catch (e) {}\n              return;\n            }\n            return fn();\n          };\n          id = originalSetInterval(wrapped, 500);\n          return id;\n        }\n      }\n    } catch (e) {\n      // Fail open\n    }\n    return originalSetInterval(fn, ms);\n  };\n})();\n\u003C/script>\n\n\u003C!-- Critical Fonts -->\n\u003C!-- Fonts loaded async to avoid render-blocking -->\n\u003Clink rel=\"stylesheet\" href=\"https://fonts.googleapis.com/css2?family=Archivo:wght@400;600;800;900&display=swap\" media=\"print\" onload=\"this.media='all'\" crossorigin>\n\u003Cnoscript>\u003Clink href=\"https://fonts.googleapis.com/css2?family=Archivo:wght@400;600;800;900&display=swap\" rel=\"stylesheet\" crossorigin>\u003C/noscript>\n\n\u003Cstyle>\n@font-face {\n  font-family: 'Archivo-fallback';\n  src: local('Arial');\n  font-display: swap;\n  size-adjust: 105%;\n  ascent-override: 95%;\n  descent-override: 25%;\n}\nbody { font-family: Archivo, 'Archivo-fallback', system-ui, -apple-system, sans-serif; }\n\u003C/style>\n\n\n\u003C!-- Page-only overrides: remove chat emoji/bubble on this page -->\n\u003Cstyle>\n  /* Hide decorative emoji/pseudo content used by chat launchers */\n  [data-chat-widget]::before,\n  [data-chat-widget]::after { content: '' !important; display: none !important; }\n  /* Hide common chat launcher containers (LeadConnector/GHL variants) */\n  [data-chat-widget],\n  .chat-widget-container,\n  #ghl-widget,\n  .ghl-widget,\n  .ghl-chat-widget,\n  .hl-cw-widget,\n  .leadconnector-chat-widget { display: none !important; }\n  /* Safety: strip any inline emoji spans inside chat launchers */\n  [data-chat-widget] .emoji, .chat-widget-container .emoji { display: none !important; }\n\u003C/style>\n\n\u003Cstyle>.package{content-visibility:visible!important}\u003C/style>\n\n\n\n\u003C!-- Load remaining font weights async (non-blocking, low priority) -->\n\u003Cstyle>@keyframes hero-review-fade{0%{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}@keyframes spin{to{transform:rotate(360deg)}}html{-webkit-text-size-adjust:100%;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;text-rendering:optimizeLegibility;scroll-behavior:smooth;background:var(--cobalt);overscroll-behavior-y:none;overflow-x:clip}img,video{max-width:100%;height:auto}:where(.c-column),:where(.c-row),:where(.c-section),:where(.hl_page-preview--content),:where(.inner){padding:0!important;margin:0!important;border:0!important;background:0 0!important;max-width:none!important;width:100%!important;overflow:visible!important;transform:none!important;filter:none!important;perspective:none!important}#pageShell{width:100%;background:var(--bg);font-family:Archivo,-apple-system,BlinkMacSystemFont,\"Segoe UI\",Roboto,sans-serif;font-size:16px;line-height:1.6;isolation:isolate;z-index:1}#modalRoot{position:relative;z-index:99999}:root{--cobalt:#0a2a5a;--azure:#1493ff;--ink:#0b1420;--bg:#ffffff;--border:#e1e6ed;--muted:#6b778c;--shadow-sm:0 2px 8px rgba(11,20,32,.06);--shadow-md:0 4px 16px rgba(11,20,32,.08);--shadow-lg:0 8px 24px rgba(11,20,32,.12)}*,body{margin:0;padding:0}*{box-sizing:border-box}body{font-family:Archivo,-apple-system,BlinkMacSystemFont,\"Segoe UI\",Roboto,\"Archivo-fallback\",Arial,sans-serif;background:var(--bg);color:var(--ink);line-height:1.6;min-height:100vh}body.modal-open,html.modal-open{overflow:hidden!important;touch-action:none}body.modal-open{position:fixed;width:100%;height:100%}#pageShell{background:#fff;min-height:100vh;position:relative}.urgency-banner,.urgency-text{display:flex;align-items:center;justify-content:center}.urgency-banner{position:fixed;bottom:24px;top:auto;left:50%;right:auto;width:auto;min-width:300px;max-width:90%;transform:translateX(-50%) translateY(150%);z-index:1200;background:linear-gradient(135deg,#ff6b35 0,#f7931e 100%);color:#fff;padding:12px 24px;text-align:center;font-size:14px;font-weight:600;line-height:1.3;box-shadow:0 8px 24px rgba(247,147,30,.3);border-radius:50px;gap:8px;transition:transform .4s cubic-bezier(.4,0,.2,1);height:auto;border:1px solid rgba(255,255,255,.2)}.urgency-banner.visible{transform:translateX(-50%) translateY(0)}#security.section::before,#tv.section::before,.urgency-banner.dismissed{display:none}.urgency-text{gap:12px;flex-wrap:wrap}.urgency-text strong{font-weight:800}.urgency-separator{opacity:.6}.urgency-close{background:rgba(255,255,255,.2);border:0;color:#fff;width:24px;height:24px;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:16px;line-height:1;transition:background .2s ease;padding:0;margin-left:8px}.urgency-close:hover{background:rgba(255,255,255,.3)}@media (max-width:768px){.urgency-banner{bottom:16px;padding:10px 16px;font-size:13px;width:92%;border-radius:12px}.urgency-text{gap:8px}.form h2{font-size:24px}.inp{font-size:16px}.cal-day,.link-btn{align-items:center;justify-content:center}.link-btn{min-height:44px;display:inline-flex}.cal-day{padding:6px!important;font-size:13px!important;display:flex;min-height:32px;white-space:nowrap;word-break:normal;overflow-wrap:normal;line-height:1}.calendar-widget{padding:8px}.btn,.link-btn,a,button{touch-action:manipulation}.btn:active,.link-btn:active,button:active{transform:scale(.98);opacity:.9}.bundle-card:active,.cart-item:active{background:#f8f9fb}.cart-body,.modal-content,.outlet,body{-webkit-overflow-scrolling:touch;overscroll-behavior-y:contain}body,html{overscroll-behavior-x:none;overflow-x:hidden}input[type=email],input[type=number],input[type=search],input[type=tel],input[type=text],select,textarea{font-size:16px!important}.btn,a,button,input[type=button],input[type=submit]{min-height:44px;min-width:44px}a,button,input,select,textarea{-webkit-tap-highlight-color:transparent}.cart-drawer{-webkit-overflow-scrolling:touch;overscroll-behavior:contain}.form{padding:20px 16px!important;margin:20px auto 40px!important;max-width:100%!important}.details-grid>div{padding:10px 0!important}.schedule-container{padding:16px!important}#calendarWidget,#outlet{-webkit-overflow-scrolling:touch}#calendarWidget{overflow-x:auto}.calendar-grid{min-width:280px}#outlet{overscroll-behavior-y:contain}.cart-body,.cart-item{-webkit-user-select:none;user-select:none}input,textarea{-webkit-user-select:text;user-select:text}}.cal-day{padding:12px;white-space:nowrap;word-break:normal;overflow-wrap:normal;line-height:1}.schedule-container{padding:16px}.calendar-widget{padding:12px}.header{position:fixed;inset:0 0 auto 0;height:56px;z-index:200;background:var(--cobalt);border-bottom:1px solid rgba(255,255,255,.12);box-shadow:var(--shadow-md);width:100%;will-change:transform;transition:top .4s cubic-bezier(.4,0,.2,1);top:0}.header-inner,.logo{display:flex;align-items:center}.header-inner{justify-content:space-between;height:56px;padding:0 16px;max-width:1400px;margin:0 auto}.logo{gap:10px;text-decoration:none;color:#fff;font-weight:900;font-size:18px;letter-spacing:-.02em}.logo-img{width:36px;height:36px;display:block}.header-actions{display:flex;align-items:center;gap:12px}#accountBtn,.cart-btn,.menu-btn{appearance:none;border:0;background:0 0;color:#fff;cursor:pointer;padding:8px;border-radius:6px;transition:background .15s ease;position:relative}#accountBtn:hover,.cart-btn:hover,.menu-btn:hover{background:rgba(255,255,255,.1)}#accountBtn:focus-visible,.cart-btn:focus-visible,.menu-btn:focus-visible{outline:2px solid rgba(255,255,255,.4);outline-offset:2px}.icon{width:24px;height:24px;stroke:currentColor;stroke-width:2;fill:none;stroke-linecap:round;stroke-linejoin:round}.cart-badge{position:absolute;top:4px;right:4px;background:var(--azure);color:var(--cobalt);font-size:11px;font-weight:900;padding:2px 5px;border-radius:10px;line-height:1;min-width:18px;text-align:center}.hero{background-color:var(--cobalt);background-image:linear-gradient(160deg,var(--cobalt) 0%,#0b1420 100%);color:#fff;padding:72px 16px 56px;text-align:center;position:relative;width:100vw;margin-left:calc(50% - 50vw);margin-right:calc(50% - 50vw);box-sizing:border-box;transition:padding-top .4s cubic-bezier(.4,0,.2,1)}.hero-inner{max-width:640px;margin:0 auto}.hero h1{font-size:32px;font-weight:900;line-height:1.1;letter-spacing:-.03em;margin-bottom:12px}.hero p{font-size:17px;opacity:1;margin-bottom:28px;line-height:1.5}.hero-ctas{display:grid;grid-template-columns:1fr 1fr;gap:12px;max-width:480px;margin:0 auto 24px}.hero .btn-ghost{background:0 0;color:#fff;border:2px solid rgba(255,255,255,.5);font-weight:600}.hero .btn-ghost:hover{background:rgba(255,255,255,.15);border-color:#fff;color:#fff;box-shadow:0 2px 12px rgba(255,255,255,.2)}.hero .btn-ghost:active{background:rgba(255,255,255,.25)}.hero-reviews{max-width:500px;margin:0 auto;padding:16px 20px;background:rgba(255,255,255,.95);backdrop-filter:blur(12px);border-radius:12px;box-shadow:0 4px 20px rgba(10,42,90,.12);border:1px solid rgba(255,255,255,.6);position:relative;overflow:hidden;cursor:pointer;transition:all .2s ease;min-height:120px;display:flex;flex-direction:column;justify-content:center}.hero-reviews:hover{transform:translateY(-2px);box-shadow:0 6px 24px rgba(10,42,90,.18);border-color:rgba(20,147,255,.3)}.hero-review-slide{display:none;animation:hero-review-fade .5s ease}.hero-review-slide.active{display:block}.hero-review-stars{display:flex;gap:4px;justify-content:center;margin-bottom:8px;font-size:16px;color:#fbbf24}.hero-review-text{font-size:14px;line-height:1.5;color:var(--ink);text-align:center;margin-bottom:8px;font-style:italic;display:-webkit-box;-webkit-line-clamp:2;line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;min-height:42px;max-height:42px}.hero-review-text:empty{display:none}.hero-review-author{font-size:12px;font-weight:600;color:var(--muted);text-align:center}.hero-review-dots{display:flex;gap:6px;justify-content:center;margin-top:12px;padding-bottom:4px}.hero-review-dots::after{content:\"\";display:none}.hero-reviews:hover .hero-review-dots::after{opacity:.7}.hero-review-dot{width:6px;height:6px;border-radius:50%;background:var(--border);cursor:pointer;transition:all .3s ease}.hero-review-dot.active{background:var(--azure);width:20px;border-radius:3px}.btn{appearance:none;border:0;background:var(--azure);color:var(--cobalt);font-family:inherit;font-size:16px;font-weight:800;padding:14px 20px;border-radius:8px;cursor:pointer;transition:all .18s cubic-bezier(.4,0,.2,1);text-decoration:none;display:inline-flex;align-items:center;justify-content:center;gap:8px;line-height:1}.btn:hover{transform:translateY(-1px);box-shadow:0 6px 16px rgba(20,147,255,.25)}.btn:active{transform:translateY(0)}.btn:focus-visible{outline:3px solid rgba(20,147,255,.3);outline-offset:2px}.btn-ghost{background:0 0;color:var(--cobalt);border:2px solid var(--azure);font-weight:600}.btn-ghost:hover,.btn-primary{background:var(--azure);color:#fff}.btn-ghost:hover{border-color:var(--azure);box-shadow:0 2px 8px rgba(20,147,255,.2)}.btn-ghost:active{background:#0c7fd9}.btn-primary{font-weight:700;box-shadow:0 2px 8px rgba(20,147,255,.25);transition:all .2s ease}.btn-primary:hover{background:#0c7fd9;box-shadow:0 4px 12px rgba(20,147,255,.35);transform:translateY(-1px)}.btn-primary:active{transform:translateY(0);box-shadow:0 2px 6px rgba(20,147,255,.3)}.btn-secondary{background:var(--cobalt);color:#fff}.btn-subtle{background:0 0;color:var(--muted);border:1px solid var(--border);font-weight:700;font-size:14px;padding:10px 16px}.btn-subtle:hover{background:#f5f7fa;color:var(--cobalt);box-shadow:none}.spinner{display:inline-block;width:14px;height:14px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:spin .6s linear infinite;vertical-align:middle;margin-right:8px}.spinner-dark{border-color:rgba(10,42,90,.2);border-top-color:var(--cobalt)}.section{padding:64px 16px;max-width:1200px;margin:0 auto;background:#fff;position:relative;isolation:isolate}#security.section,#tv.section{overflow:visible}.section::before{content:\"\";position:absolute;top:0;left:0;right:0;height:32px;background:linear-gradient(180deg,#f8f9fb 0,transparent 100%);pointer-events:none;z-index:0}.section-header{text-align:center;margin-bottom:40px}.review-carousel-header h2,.section-header h2,.trust-item strong{font-size:28px;font-weight:900;color:var(--cobalt);margin-bottom:8px;letter-spacing:-.02em}.section-header p{font-size:16px;color:var(--muted);max-width:560px;margin:0 auto}.trust-bar{background-color:var(--cobalt);background-image:linear-gradient(135deg,var(--cobalt) 0%,#0d3568 100%);padding:24px 16px;position:relative;width:100vw;margin-left:calc(50% - 50vw);margin-right:calc(50% - 50vw);box-sizing:border-box;content-visibility:auto;contain-intrinsic-size:0 100px}.trust-bar::after,.trust-bar::before{content:\"\";position:absolute;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent 0,rgba(20,147,255,.3) 50%,transparent 100%)}.trust-bar::before{top:0}.trust-bar::after{bottom:0}.trust-inner{max-width:1200px;margin:0 auto;display:grid;grid-template-columns:repeat(2,1fr);gap:20px}@media (min-width:768px){.trust-inner{grid-template-columns:repeat(4,1fr)}}.trust-item{text-align:center;color:#fff}.trust-item strong{display:block;font-size:24px;margin-bottom:4px;color:var(--azure)}.trust-item span{font-size:13px;opacity:.9;font-weight:500}.review-carousel{position:relative;overflow:hidden;padding:96px 0 104px;background-color:#fafbfc;background-image:linear-gradient(180deg,#fafbfc 0,#f5f7fa 50%,#fff 100%);content-visibility:auto;contain-intrinsic-size:0 500px}.review-track-container{overflow:hidden;max-width:1280px;margin:0 auto;padding:0 24px}.review-carousel::after,.review-carousel::before{content:\"\";position:absolute;left:0;right:0;height:64px;pointer-events:none;z-index:10}.review-carousel::before{top:0;background:linear-gradient(180deg,#f8f9fb 0,rgba(248,249,251,0) 100%)}.review-carousel::after{bottom:0;background:linear-gradient(0deg,#fff 0,rgba(255,255,255,0) 100%)}.review-carousel-header{text-align:center;margin-bottom:56px;max-width:600px;margin-left:auto;margin-right:auto;padding:0 16px;position:relative;z-index:20}.review-carousel-header h2{font-size:36px;margin-bottom:16px;letter-spacing:-.03em}.review-carousel-header p{font-size:18px;color:var(--muted);line-height:1.6}.review-track{display:flex;transition:transform .6s cubic-bezier(.25,1,.5,1);gap:0;will-change:transform;width:100%;padding-bottom:40px}.review-card{flex:0 0 calc(100% - 24px);background:#fff;border-radius:24px;padding:32px;box-shadow:0 4px 20px rgba(10,42,90,.06);border:1px solid rgba(10,42,90,.06);transition:transform .3s ease,box-shadow .3s ease;display:flex;flex-direction:column;margin:0 12px;height:auto;position:relative}.review-card:hover{transform:translateY(-6px);box-shadow:0 12px 32px rgba(10,42,90,.12);border-color:rgba(20,147,255,.3)}@media (min-width:768px){.review-card{flex:0 0 calc(50% - 24px)}}@media (min-width:1024px){.review-card{flex:0 0 calc(33.333% - 24px)}}.review-avatar,.review-header{display:flex;align-items:center}.review-header{gap:12px;margin-bottom:16px}.review-avatar{width:48px;height:48px;border-radius:50%;background:linear-gradient(135deg,var(--azure),var(--cobalt));justify-content:center;color:#fff;font-weight:700;font-size:18px}.review-meta{flex:1}.review-name{font-weight:700;color:var(--cobalt);margin-bottom:2px;font-size:15px}.review-stars{color:#fbbf24;font-size:14px;letter-spacing:2px}.review-time{font-size:12px;color:#9ca3af;margin-top:2px;font-weight:500}.review-text{color:#4b5563;line-height:1.65;font-size:15px;margin-bottom:16px;flex-grow:1;max-height:none;position:relative}.review-service::before,.review-text::before,.review-verified::before{content:none}.review-footer{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-top:auto;padding-top:16px;border-top:1px solid rgba(10,42,90,.06)}.review-service,.review-verified{display:inline-flex;align-items:center}.review-service{font-size:13px;color:var(--azure);font-weight:600;gap:6px}.review-verified{font-size:11px;color:#10b981;font-weight:700;gap:4px;background:rgba(16,185,129,.08);padding:4px 8px;border-radius:6px;white-space:nowrap}.review-nav{display:flex;justify-content:center;gap:8px;margin-top:24px}.review-dot{width:8px;height:8px;border-radius:50%;background:#d1d5db;cursor:pointer;transition:all .3s ease}.review-dot.active{background:var(--azure);width:24px;border-radius:4px}.package-grid{display:grid;gap:20px;grid-template-columns:1fr;overflow:visible;position:relative;z-index:1;margin:-8px;padding:8px}@media (min-width:640px){.package-grid{grid-template-columns:repeat(2,1fr)}}@media (min-width:1024px){.package-grid{grid-template-columns:repeat(4,1fr)}}.package{background:#fff;border:1px solid var(--border);border-radius:14px;padding:16px;display:flex;flex-direction:column;gap:10px;transition:box-shadow .2s ease,transform .2s ease,border-color .2s ease;position:relative;z-index:10;transform:translateZ(0);backface-visibility:hidden;contain:layout style paint;content-visibility:auto}.package:hover{border-color:rgba(20,147,255,.4);box-shadow:0 8px 28px rgba(10,42,90,.12);transform:translateY(-2px);z-index:20}.package:focus-within{z-index:20}.package.featured{border-color:rgba(20,147,255,.6);box-shadow:0 6px 20px rgba(20,147,255,.12)}.package.featured::before{content:\"RECOMMENDED\";position:absolute;top:10px;right:12px;background:rgba(20,147,255,.1);color:var(--azure);font-size:9px;font-weight:800;letter-spacing:.04em;padding:2px 6px;border-radius:999px;border:1px solid rgba(20,147,255,.3);pointer-events:none;z-index:1}.package-header{display:flex;flex-direction:column;gap:4px;position:relative}.package-name{font-size:19px;font-weight:900;color:var(--cobalt);line-height:1.2}.package-price{font-size:15px;font-weight:900;color:var(--azure)}.package-promise{font-size:14px;color:var(--ink);opacity:.88;line-height:1.4;flex-grow:1;display:-webkit-box;-webkit-line-clamp:2;line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}.package-includes{background:#f3f6fb;border-radius:10px;padding:10px;font-size:12.5px;line-height:1.45;color:var(--cobalt);border:1px solid rgba(10,42,90,.08)}.package-includes strong{display:block;font-weight:800;margin-bottom:6px;font-size:12px;text-transform:none;letter-spacing:0;opacity:.7}.package-includes ul{list-style:disc;padding-left:18px;display:flex;flex-direction:column;gap:3px}.package.featured .package-header{padding-right:96px}.package-includes li::before{content:none;margin:0}.package-includes li::marker{color:var(--azure)}.package .btn{margin-top:auto;width:100%}\u003C/style>\n\n\u003Cstyle media=\"print\" onload=\"this.media='all'\" id=\"deferred-ui-styles\">@keyframes h2s-split{0%{opacity:0;transform:translateY(24px)}36%,68%{opacity:1;transform:translateY(0)}to{opacity:0;transform:translateY(-12px)}}@keyframes skeleton-shimmer{0%{background-position:200%0}to{background-position:-200%0}}@keyframes reveal-fade-in{to{opacity:1;transform:translateY(0)}}@keyframes initial-reveal{0%{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}@keyframes loading{0%{background-position:200%0}to{background-position:-200%0}}.menu-drawer{position:fixed;top:0;left:0;bottom:0;width:min(320px,85vw);background:#fff;z-index:1150;transform:translateX(-100%);transition:transform .28s cubic-bezier(.4,0,.2,1);box-shadow:4px 0 16px rgba(0,0,0,.1);display:flex;flex-direction:column}.menu-drawer.open{transform:translateX(0)}.menu-header{display:flex;align-items:center;justify-content:space-between;padding:16px;border-bottom:1px solid var(--border)}.menu-header h3{font-size:16px;font-weight:900;color:var(--cobalt)}.menu-body{flex:1;overflow-y:auto;padding:16px}.menu-nav{display:flex;flex-direction:column;gap:8px}.menu-link{appearance:none;border:0;background:0 0;font-family:inherit;text-align:left;padding:12px;font-size:15px;font-weight:600;color:var(--cobalt);border-radius:8px;cursor:pointer;transition:background .15s ease;text-decoration:none}.menu-link:hover{background:#f5f7fa}.cart-drawer{position:fixed;top:0;right:0;bottom:0;width:min(420px,100vw);background:#fff;z-index:1150;transform:translateX(100%);transition:transform .28s cubic-bezier(.4,0,.2,1);box-shadow:-4px 0 16px rgba(0,0,0,.1);display:flex;flex-direction:column;overscroll-behavior:contain;-webkit-overflow-scrolling:touch}@media (max-width:768px){.cart-drawer{width:100vw;max-width:100vw}}.cart-drawer.open{transform:translateX(0)}.cart-header{display:flex;align-items:center;justify-content:space-between;padding:16px;border-bottom:1px solid var(--border);flex-shrink:0}@media (max-width:768px){.cart-header{padding:12px 16px}}.cart-title{font-size:18px;font-weight:900;color:var(--cobalt)}@media (max-width:768px){.cart-title{font-size:16px}}.cart-body{flex:1;overflow-y:auto;overflow-x:hidden;padding:0 20px 16px;-webkit-overflow-scrolling:touch;overscroll-behavior:contain;position:relative;min-height:0}@media (max-width:768px){.cart-body{padding:0 16px 12px}}.cart-empty::before{content:\"\";display:block;font-size:48px;margin-bottom:16px;opacity:.3}.cart-empty p{font-size:15px;color:var(--muted);margin:0}.bundle-panel{padding:12px;background:linear-gradient(135deg,#fff3cd 0,#ffeaa7 100%);border:1px solid #ffd97d;border-radius:12px}.bundle-card{background:#fff;margin-bottom:8px}.bundle-card:last-child{margin-bottom:0}.b-name{color:var(--cobalt)}.b-list{color:var(--muted)}.b-actions button{width:100%}.ai-recs-panel,.signin-banner{margin-bottom:16px;border-radius:12px}.signin-banner{display:flex;justify-content:space-between;align-items:center;gap:12px;padding:12px;background:linear-gradient(135deg,#e3f2fd 0,#bbdefb 100%);border:1px solid #90caf9;font-size:13px;color:var(--cobalt)}.signin-banner strong{display:block;font-size:14px;margin-bottom:4px}.ai-recs-panel{padding:14px;background:linear-gradient(135deg,#f3e5f5 0,#e1bee7 100%);border:1px solid #ce93d8}.ai-recs-header{display:flex;align-items:center;gap:8px;margin-bottom:12px}.ai-icon{font-size:20px}.ai-title{font-weight:800;font-size:15px;color:#6a1b9a}.ai-recs-list{display:grid;gap:10px}.ai-rec-card{padding:12px;background:#fff;border-radius:8px;box-shadow:0 1px 3px rgba(0,0,0,.08)}.ai-rec-name{font-weight:700;font-size:14px;color:var(--ink);margin-bottom:4px}.ai-rec-reason{font-size:12px;color:var(--muted);font-style:italic;line-height:1.4}.ai-rec-price{font-weight:600;font-size:13px;color:var(--cobalt)}.bundle-panel{margin-bottom:16px;display:grid;gap:10px}.bundle-card{padding:14px;background:linear-gradient(135deg,#fff3e0 0,#ffe0b2 100%);border:1px solid #ffb74d;border-radius:12px}.b-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}.b-name{font-weight:800;font-size:15px;color:#e65100}.b-save{font-weight:700;font-size:13px;color:#ff6f00;background:#fff;padding:4px 8px;border-radius:6px}.b-list{font-size:12px;color:#6d4c41;margin-bottom:10px;line-height:1.4}.b-actions{display:flex;gap:8px}.b-actions .btn{flex:1;padding:8px 12px;font-size:13px}.recs-panel{margin-bottom:16px;display:grid;gap:10px}.rec-card{display:grid;grid-template-columns:60px 1fr auto;gap:12px;padding:12px;background:#fff;border:1px solid var(--border);border-radius:10px;align-items:center;box-shadow:0 1px 3px rgba(0,0,0,.06)}.rec-card img{width:60px;height:60px;object-fit:cover;border-radius:8px}.r-text{flex:1}.r-title{font-weight:700;font-size:14px;color:var(--ink);margin-bottom:3px}.r-msg{font-size:12px;color:var(--muted);margin-bottom:6px;line-height:1.3}.rec-dismiss{font-size:11px;color:#999;background:0 0;border:0;padding:0;cursor:pointer;text-decoration:underline}.rec-dismiss:hover{color:#666}.r-price{font-weight:800;font-size:14px;color:var(--cobalt);margin-bottom:6px;text-align:right}.rec-card .btn{padding:6px 12px;font-size:12px;white-space:nowrap}.cart-lines{display:flex;flex-direction:column;gap:0;padding-top:16px}.cart-item{display:flex;justify-content:space-between;align-items:flex-start;padding:24px 0;border-bottom:1px solid var(--border);gap:20px}.cart-item:last-child{border-bottom:none}.cart-item-info{flex:1;min-width:0}.cart-item-name{font-weight:800;font-size:16px;color:var(--ink);margin-bottom:6px;line-height:1.3}.cart-item-price{font-size:14px;color:var(--muted);margin-bottom:14px;font-weight:500}.cart-qty-controls{display:flex;align-items:center;gap:10px}.cart-qty-btn{width:32px;height:32px;border:2px solid var(--cobalt);background:#fff;color:var(--cobalt);border-radius:6px;cursor:pointer;font-size:18px;font-weight:800;display:flex;align-items:center;justify-content:center;transition:all .15s ease;padding:0;line-height:1}.cart-qty-btn:hover{background:var(--cobalt);color:#fff}.cart-qty-btn:active{transform:scale(.92)}.cart-qty-value{font-weight:700;color:var(--cobalt);min-width:20px;text-align:center;font-size:14px}.cart-item-right{display:flex;flex-direction:column;align-items:flex-end;gap:8px}.cart-item-total{font-weight:900;font-size:19px;color:var(--ink);white-space:nowrap;letter-spacing:-.5px}.cart-remove-btn{font-size:13px;font-weight:700;color:#dc3545;background:0 0;border:0;cursor:pointer;padding:6px 0;text-decoration:none;transition:all .15s ease;text-transform:uppercase;letter-spacing:.5px}.cart-remove-btn:hover{color:#c82333;text-decoration:underline}.cart-foot{border-top:1px solid var(--border);padding:16px;background:#f8f9fb;flex-shrink:0}@media (max-width:768px){.cart-foot{padding:12px;background:#fff;border-top:2px solid var(--border)}}.checkout-error{display:flex;justify-content:space-between;align-items:center;gap:8px;padding:10px 12px;background:#fee;border:1px solid #fcc;border-radius:8px;margin-bottom:12px;font-size:13px;color:#c33}.checkout-error[hidden]{display:none!important}.error-dismiss{appearance:none;border:0;background:0 0;font-size:20px;line-height:1;color:#c33;cursor:pointer;padding:0;width:20px;height:20px}.totals{margin-bottom:16px;padding-top:12px}@media (max-width:768px){.totals{margin-bottom:8px;padding-top:8px}.totals .kv{padding-top:4px!important;padding-bottom:4px!important}.totals .note{font-size:11px;margin-top:3px}.promo-section{margin-bottom:10px!important}.promo-section .inp{padding:10px 12px!important}#promoCode,.promo-section .inp{font-size:16px!important}.promo-section .btn{padding:10px 14px!important;font-size:13px!important}.promo-section .help{margin-top:4px!important;font-size:11px!important}}.kv,.kv strong{color:var(--ink)}.kv{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;font-size:15px;font-weight:600}.kv strong{font-weight:900;font-size:20px;letter-spacing:-.5px}.note{font-size:12px;color:var(--muted);margin-top:6px}.foot-actions{display:flex;gap:10px;margin-top:8px}.foot-actions .btn{font-weight:700;padding:14px 20px;font-size:15px;border-radius:8px}.foot-actions .btn-ghost{flex:0 0 auto;background:#fff;border:2px solid var(--border);color:var(--cobalt)}.foot-actions .btn-ghost:hover{border-color:var(--cobalt);background:#fff}.foot-actions .btn-primary{flex:1;font-weight:800;letter-spacing:.5px}@media (max-width:768px){.foot-actions{flex-direction:column;gap:8px;margin-top:6px}.foot-actions .btn{width:100%;padding:16px 20px;font-size:16px}.foot-actions .btn-ghost{order:2;padding:12px 20px;font-size:14px;border:1px solid var(--border)}.foot-actions .btn-primary{order:1}}.cart-empty{text-align:center;color:var(--muted);padding:40px 20px;font-size:14px}.backdrop{background:0 0;z-index:1000;display:none}.backdrop.show{display:block;pointer-events:auto}.backdrop,.modal,.modal::before{position:fixed;inset:0;pointer-events:none}.modal{z-index:9999;display:none;align-items:flex-start;justify-content:center;padding:20px;padding-bottom:max(20px,env(safe-area-inset-bottom));overflow-y:auto}.modal::before{content:\"\";background:rgba(0,0,0,.5);z-index:0;opacity:0;transition:opacity .28s ease}.modal-content,.modal.show{display:flex;pointer-events:auto}.modal.show::before{opacity:1;pointer-events:auto}.modal-content{position:relative;background:#fff;border-radius:16px;width:100%;max-width:520px;max-height:calc(100vh - 40px - env(safe-area-inset-bottom));margin:auto 0;flex-direction:column;transform:scale(.95);transition:transform .28s cubic-bezier(.4,0,.2,1);box-shadow:0 20px 60px rgba(0,0,0,.4);overflow:hidden;z-index:1}.modal.show .modal-content{transform:scale(1)}.modal .inp,.modal-content .inp,.modal-content textarea{padding:12px 14px;border:2px solid var(--border);border-radius:10px;font-size:15px;width:100%;box-sizing:border-box}.modal .inp:focus,.modal-content .inp:focus,.modal-content textarea:focus{outline:0;border-color:var(--azure);box-shadow:0 0 0 4px rgba(20,147,255,.06)}::-webkit-scrollbar{width:12px;height:12px}::-webkit-scrollbar-track{background:#1a1d23;border-radius:10px}::-webkit-scrollbar-thumb{background:#3a3f47;border-radius:10px;border:3px solid #1a1d23}::-webkit-scrollbar-thumb:hover{background:#4a505a}*{scrollbar-width:thin;scrollbar-color:#3a3f47 #1a1d23}.modal-header{padding:24px 20px 16px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}.modal-header h3{font-size:22px;font-weight:900;margin-bottom:6px}.close-btn,.modal-header p{font-size:14px;color:var(--muted);line-height:1.5}.close-btn{appearance:none;border:0;background:0 0;font-size:32px;line-height:1;cursor:pointer;padding:0;width:32px;height:32px;display:flex;align-items:center;justify-content:center;transition:color .15s ease}.close-btn:hover,.modal-header h3{color:var(--cobalt)}.modal-body{padding:20px;flex:1;overflow-y:auto;overflow-x:hidden;-webkit-overflow-scrolling:touch;position:relative}.modal-body::after{content:\"\";position:sticky;bottom:-20px;left:0;right:0;height:20px;background:linear-gradient(to bottom,transparent,rgba(255,255,255,.95));transition:opacity .2s}.modal-body.has-scroll::after{opacity:1}.modal-footer{padding:16px 20px;border-top:1px solid var(--border);display:flex;flex-direction:column;gap:10px;background:#fff;flex-shrink:0;position:sticky;bottom:0;z-index:10}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}.hidden{display:none!important}.h2s-loader{position:fixed;inset:0;z-index:99999;display:grid;place-items:center;background:rgba(255,255,255,.98);backdrop-filter:blur(8px);pointer-events:auto;opacity:1;transition:opacity .4s cubic-bezier(.4,0,.2,1)}.h2s-loader.hidden,.modal-body::after{opacity:0;pointer-events:none}.h2s-loader-stage{position:relative;width:min(72vw,520px);aspect-ratio:5/2}.h2s-loader-slices{position:absolute;inset:0}.h2s-loader-slice{position:absolute;top:0;bottom:0;overflow:hidden;opacity:0;transform:translateY(24px);will-change:transform,opacity;animation:h2s-split 2.2s cubic-bezier(.22,.8,.32,1) infinite;animation-delay:calc(var(--i)*.06s)}.h2s-loader-slice img{position:absolute;inset:0 auto 0 0;width:100%;height:100%;object-fit:contain}.skeleton{border-radius:8px}.skeleton-hero{height:280px;margin-bottom:24px}.skeleton-trust{height:80px;margin-bottom:32px}.skeleton-card{height:420px;border-radius:16px;margin-bottom:16px}.skeleton-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px;padding:0 16px;max-width:1200px;margin:0 auto}.content-reveal{opacity:0;transform:translateY(16px);animation:reveal-fade-in .6s cubic-bezier(.4,0,.2,1) forwards}.reveal-delay-1{animation-delay:.05s}.reveal-delay-2{animation-delay:.1s}.reveal-delay-3{animation-delay:.15s}.reveal-delay-4{animation-delay:.2s}#outlet{min-height:calc(100vh - 56px);overflow:visible}@media (prefers-reduced-motion:reduce){.content-reveal,.h2s-loader-slice,.skeleton{animation:none!important}.content-reveal{opacity:1;transform:none}.h2s-loader{transition:none}}@media (max-width:390px){.modal{padding:12px;padding-bottom:max(12px,env(safe-area-inset-bottom))}.modal-content{max-height:calc(100vh - 24px - env(safe-area-inset-bottom))}}@media (min-width:768px){.hero{padding:88px 32px 72px}.hero h1{font-size:42px}.hero p{font-size:19px}.trust-bar{padding:32px 24px}.section{padding:80px 24px}.section-header h2{font-size:36px}.section-header p{font-size:18px}.review-carousel{padding:64px 24px}.modal{padding:32px}.modal-content{border-radius:16px;max-width:600px;max-height:calc(100vh - 64px)}}.form,.inp{background:#fff}.form{max-width:480px;margin:80px auto 40px;padding:32px;border-radius:16px;border:1px solid var(--border);box-shadow:var(--shadow-md)}.form h2{text-align:center;color:var(--cobalt);margin:0 0 24px;font-weight:900;font-size:28px}.inp{display:block;width:100%;padding:14px 16px;margin-bottom:14px;font-size:16px;font-family:inherit;border:2px solid var(--border);border-radius:10px;color:var(--ink);transition:all .2s ease}.inp:focus{outline:0;border-color:var(--azure);box-shadow:0 0 0 3px rgba(20,147,255,.1)}.inp:disabled{background:#f5f5f5;color:var(--muted);cursor:not-allowed;border-color:#e0e0e0}.form .help{font-size:13px;color:var(--muted);margin:-6px 0 16px;text-align:center}.form>div[style*=\"display:flex\"]{justify-content:center;margin-top:20px}.pd-box{padding:16px;background:#fafcff;border:1px solid #e7eaf0;border-radius:10px;margin-bottom:16px}.details-grid{display:grid;gap:8px}.details-grid .row{display:grid;grid-template-columns:120px 1fr;gap:12px;padding:8px 0;border-bottom:1px solid #e7eaf0}.details-grid .row:last-child{border-bottom:none}.details-grid .k{font-weight:600;color:var(--muted);font-size:13px}.details-grid .v{font-weight:700;color:var(--cobalt);font-size:14px}.cal-embed{width:100%;height:680px;border:1px solid var(--border);border-radius:12px;overflow:hidden;margin:20px 0}.cal-embed iframe{width:100%;height:100%;border:0}@media (max-width:768px){.form{margin:20px;padding:20px}.details-grid .row{grid-template-columns:1fr;gap:4px}.cal-embed{height:600px}}#pageShell{opacity:1!important;visibility:visible!important}.skeleton{background:linear-gradient(90deg,#f0f0f0 25%,#e0e0e0 50%,#f0f0f0 75%);background-size:200% 100%;animation:loading 1.5s ease-in-out infinite}.bundle-skeleton{height:400px;border-radius:12px;margin-bottom:20px}\u003C/style>\n\n\u003C!-- Performance: Remove API preload - catalog now loads in background -->\n\n\u003C/head>\n\u003Cbody>\n\u003Cdiv id=\"pageShell\">\n\n\u003C!-- URGENCY BANNER -->\n\u003Cdiv class=\"urgency-banner\" id=\"urgencyBanner\">\n  \u003Cdiv class=\"urgency-text\">\n    \u003Cspan>\u003Cstrong id=\"urgencyMessage\">Loading...\u003C/strong>\u003C/span>\n    \u003Cspan class=\"urgency-separator\">|\u003C/span>\n    \u003Cspan>We're available 7 days/week\u003C/span>\n  \u003C/div>\n    \u003Cbutton class=\"urgency-close\" onclick=\"dismissUrgencyBanner()\" aria-label=\"Dismiss banner\">&times;\u003C/button>\n\u003C/div>\n\n\u003C!-- HEADER -->\n\u003Cheader class=\"header\">\n  \u003Cdiv class=\"header-inner\">\n    \u003Ca href=\"#\" class=\"logo\" aria-label=\"Home2Smart home\" onclick=\"navSet({view:'shop'}); return false;\">\n      \u003Cimg src=\"https://storage.googleapis.com/msgsndr/7Drmpw623JAkrfDKPdjG/media/68da0ce6f00445991d64a63f.png\" alt=\"Home2Smart\" class=\"logo-img\" width=\"36\" height=\"36\" fetchpriority=\"high\" decoding=\"async\">\n    \u003C/a>\n\n    \u003Cdiv class=\"header-actions\">\n      \u003Cbutton class=\"menu-btn\" onclick=\"toggleMenu()\" aria-label=\"Open menu\">\n        \u003Csvg class=\"icon\" viewBox=\"0 0 24 24\">\n          \u003Cline x1=\"3\" y1=\"12\" x2=\"21\" y2=\"12\">\u003C/line>\n          \u003Cline x1=\"3\" y1=\"6\" x2=\"21\" y2=\"6\">\u003C/line>\n          \u003Cline x1=\"3\" y1=\"18\" x2=\"21\" y2=\"18\">\u003C/line>\n        \u003C/svg>\n      \u003C/button>\n\n      \u003Cbutton id=\"accountBtn\" class=\"header-btn\" aria-label=\"Account\">\n        \u003Csvg class=\"icon\" viewBox=\"0 0 24 24\">\n          \u003Cpath d=\"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2\">\u003C/path>\n          \u003Ccircle cx=\"12\" cy=\"7\" r=\"4\">\u003C/circle>\n        \u003C/svg>\n      \u003C/button>\n\n      \u003Cbutton class=\"cart-btn\" onclick=\"toggleCart()\" aria-label=\"Open cart\">\n        \u003Csvg class=\"icon\" viewBox=\"0 0 24 24\">\n          \u003Cpath d=\"M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z\">\u003C/path>\n          \u003Cline x1=\"3\" y1=\"6\" x2=\"21\" y2=\"6\">\u003C/line>\n          \u003Cpath d=\"M16 10a4 4 0 0 1-8 0\">\u003C/path>\n        \u003C/svg>\n        \u003Cspan class=\"cart-badge\" id=\"cartCount\">0\u003C/span>\n      \u003C/button>\n    \u003C/div>\n  \u003C/div>\n\u003C/header>\n\n\u003C!-- Main Outlet for Dynamic Views -->\n\u003Cmain id=\"mainView\">\n\u003Cdiv id=\"outlet\">\n\u003C!-- HERO -->\n\u003Csection class=\"hero\">\n  \u003Cdiv class=\"hero-inner\">\n    \u003Ch1>Expert Installation.\u003Cbr>Done Right.\u003C/h1>\n    \u003Cp>TV Mounting & Security Cameras. Pick a package, we handle the rest. Simple pricing, instant booking.\u003C/p>\n    \u003Cdiv class=\"hero-ctas\">\n      \u003Cbutton class=\"btn btn-primary\" onclick=\"scrollToSection('tv')\">\n        Shop TV Packages\n      \u003C/button>\n      \u003Cbutton class=\"btn btn-ghost\" onclick=\"scrollToSection('security')\">\n        Shop Cameras\n      \u003C/button>\n    \u003C/div>\n    \n    \u003C!-- Hero Review Carousel -->\n    \u003Cdiv class=\"hero-reviews\" id=\"heroReviews\" style=\"min-height: 120px; contain: content;\">\n      \u003C!-- OPTIMIZATION: Placeholder matches final structure to prevent CLS -->\n      \u003Cdiv class=\"hero-review-slide active\">\n        \u003Cdiv class=\"hero-review-stars\">&#9733;&#9733;&#9733;&#9733;&#9733;\u003C/div>\n        \u003Cdiv class=\"hero-review-text\">\"Professional, on-time, and clean installation.\"\u003C/div>\n        \u003Cdiv class=\"hero-review-author\">&mdash; Recent Customer\u003C/div>\n      \u003C/div>\n      \u003Cdiv class=\"hero-review-dots\">\n        \u003Cdiv class=\"hero-review-dot active\">\u003C/div>\n        \u003Cdiv class=\"hero-review-dot\">\u003C/div>\n        \u003Cdiv class=\"hero-review-dot\">\u003C/div>\n        \u003Cdiv class=\"hero-review-dot\">\u003C/div>\n        \u003Cdiv class=\"hero-review-dot\">\u003C/div>\n      \u003C/div>\n    \u003C/div>\n  \u003C/div>\n\u003C/section>\n\n\u003C!-- TRUST BAR -->\n\u003Csection class=\"trust-bar content-reveal reveal-delay-1\">\n  \u003Cdiv class=\"trust-inner\">\n    \u003Cdiv class=\"trust-item\">\n      \u003Cstrong>500+\u003C/strong>\n      \u003Cspan>Homes Served\u003C/span>\n    \u003C/div>\n    \u003Cdiv class=\"trust-item\">\n      \u003Cstrong>4.9&#9733;\u003C/strong>\n      \u003Cspan>Average Rating\u003C/span>\n    \u003C/div>\n    \u003Cdiv class=\"trust-item\">\n      \u003Cstrong>Licensed\u003C/strong>\n      \u003Cspan>& Insured\u003C/span>\n    \u003C/div>\n    \u003Cdiv class=\"trust-item\">\n      \u003Cstrong>Instant\u003C/strong>\n      \u003Cspan>Booking Available\u003C/span>\n    \u003C/div>\n  \u003C/div>\n\u003C/section>\n\n\u003C!-- REVIEWS CAROUSEL -->\n\u003Csection class=\"review-carousel\" aria-label=\"Customer reviews\">\n  \u003Cdiv class=\"review-carousel-header\">\n    \u003Ch2>Customer reviews\u003C/h2>\n    \u003Cp>Real feedback from recent installations.\u003C/p>\n  \u003C/div>\n  \u003Cdiv class=\"review-track-container\">\n    \u003Cdiv class=\"review-track\" id=\"reviewTrack\" aria-live=\"polite\">\n      \u003Cdiv class=\"review-card\" data-index=\"0\">\n        \u003Cdiv class=\"review-header\">\n          \u003Cdiv class=\"review-avatar\">RC\u003C/div>\n          \u003Cdiv class=\"review-meta\">\n            \u003Cdiv class=\"review-name\">Recent Customer\u003C/div>\n            \u003Cdiv class=\"review-stars\">\u003C/div>\n          \u003C/div>\n        \u003C/div>\n        \u003Cp class=\"review-text\">Fast, professional installation. Everything looks clean and works perfectly.\u003C/p>\n        \u003Cdiv class=\"review-footer\">\n          \u003Cdiv class=\"review-service\">Smart Home Service\u003C/div>\n        \u003C/div>\n      \u003C/div>\n      \u003Cdiv class=\"review-card\" data-index=\"1\">\n        \u003Cdiv class=\"review-header\">\n          \u003Cdiv class=\"review-avatar\">RC\u003C/div>\n          \u003Cdiv class=\"review-meta\">\n            \u003Cdiv class=\"review-name\">Recent Customer\u003C/div>\n            \u003Cdiv class=\"review-stars\">\u003C/div>\n          \u003C/div>\n        \u003C/div>\n        \u003Cp class=\"review-text\">On time, clear communication, and the setup was done right the first time.\u003C/p>\n        \u003Cdiv class=\"review-footer\">\n          \u003Cdiv class=\"review-service\">Smart Home Service\u003C/div>\n        \u003C/div>\n      \u003C/div>\n      \u003Cdiv class=\"review-card\" data-index=\"2\">\n        \u003Cdiv class=\"review-header\">\n          \u003Cdiv class=\"review-avatar\">RC\u003C/div>\n          \u003Cdiv class=\"review-meta\">\n            \u003Cdiv class=\"review-name\">Recent Customer\u003C/div>\n            \u003Cdiv class=\"review-stars\">\u003C/div>\n          \u003C/div>\n        \u003C/div>\n        \u003Cp class=\"review-text\">Great experience from booking to completion. Highly recommend.\u003C/p>\n        \u003Cdiv class=\"review-footer\">\n          \u003Cdiv class=\"review-service\">Smart Home Service\u003C/div>\n        \u003C/div>\n      \u003C/div>\n    \u003C/div>\n  \u003C/div>\n  \u003Cdiv class=\"review-nav\" id=\"reviewNav\" aria-label=\"Review navigation\">\n    \u003Cdiv class=\"review-dot active\" aria-label=\"Go to page 1\">\u003C/div>\n  \u003C/div>\n\u003C/section>\n\n\u003C!-- TV MOUNTING SECTION -->\n\u003Csection class=\"section content-reveal reveal-delay-2\" id=\"tv\">\n  \u003Cdiv class=\"section-header\">\n    \u003Ch2>TVs: pick by TV count\u003C/h2>\n    \u003Cp>Clean installs, book instantly. First TV $249, each additional discounted.\u003C/p>\n  \u003C/div>\n\n  \u003Cdiv class=\"package-grid\">\n    \u003C!-- Single TV -->\n    \u003Carticle class=\"package\">\n      \u003Cdiv class=\"package-header\">\n        \u003Ch3 class=\"package-name\">1 TV\u003C/h3>\n        \u003Cdiv class=\"package-price\">$249\u003C/div>\n      \u003C/div>\n      \u003Cp class=\"package-promise\">One TV mounted clean and ready to watch tonight.\u003C/p>\n      \u003Cdiv class=\"package-includes\">\n        \u003Cstrong>What's Included\u003C/strong>\n        \u003Cul>\n          \u003Cli>TV securely mounted\u003C/li>\n          \u003Cli>Wire concealment (when feasible)\u003C/li>\n          \u003Cli>Streaming setup\u003C/li>\n          \u003Cli>Ready to go\u003C/li>\n        \u003C/ul>\n      \u003C/div>\n      \u003Cbutton class=\"btn btn-primary\" onclick=\"selectPackage('tv_single', '1 TV', 249)\">\n        Add to Cart\n      \u003C/button>\n    \u003C/article>\n\n    \u003C!-- 2-TV Package (FEATURED) -->\n    \u003Carticle class=\"package featured\">\n      \u003Cdiv class=\"package-header\">\n        \u003Ch3 class=\"package-name\">2 TVs (recommended)\u003C/h3>\n        \u003Cdiv class=\"package-price\">$428 \u003Csmall style=\"opacity:.6\">(save $70)\u003C/small>\u003C/div>\n      \u003C/div>\n      \u003Cp class=\"package-promise\">Two rooms, theater-ready. Same visit, better deal.\u003C/p>\n      \u003Cdiv class=\"package-includes\">\n        \u003Cstrong>What's Included\u003C/strong>\n        \u003Cul>\n          \u003Cli>Both TVs mounted\u003C/li>\n          \u003Cli>Wire concealment (when feasible)\u003C/li>\n          \u003Cli>Streaming on both\u003C/li>\n          \u003Cli>One appointment\u003C/li>\n        \u003C/ul>\n      \u003C/div>\n      \u003Cbutton class=\"btn btn-primary\" onclick=\"selectPackage('tv_2pack', '2 TVs (recommended)', 428)\">\n        Add to Cart\n      \u003C/button>\n    \u003C/article>\n\n    \u003C!-- Multi-Room -->\n    \u003Carticle class=\"package\">\n      \u003Cdiv class=\"package-header\">\n        \u003Ch3 class=\"package-name\">34 TVs\u003C/h3>\n        \u003Cdiv class=\"package-price\">From $699\u003C/div>\n      \u003C/div>\n      \u003Cp class=\"package-promise\">Whole-home entertainment in one visit.\u003C/p>\n      \u003Cdiv class=\"package-includes\">\n        \u003Cstrong>What's Included\u003C/strong>\n        \u003Cul>\n          \u003Cli>3-4 TVs mounted\u003C/li>\n          \u003Cli>Wire concealment (when feasible)\u003C/li>\n          \u003Cli>Streaming + soundbar\u003C/li>\n          \u003Cli>Universal remote\u003C/li>\n        \u003C/ul>\n      \u003C/div>\n      \u003Cbutton class=\"btn btn-primary\" onclick=\"selectPackage('tv_multi', '34 TVs', 699)\">\n        Add to Cart\n      \u003C/button>\n    \u003C/article>\n\n    \u003C!-- Custom -->\n    \u003Carticle class=\"package\">\n      \u003Cdiv class=\"package-header\">\n        \u003Ch3 class=\"package-name\">5+ TVs (quote)\u003C/h3>\n        \u003Cdiv class=\"package-price\">Request Quote\u003C/div>\n      \u003C/div>\n      \u003Cp class=\"package-promise\">Large properties or commercial setups&mdash;we'll design a plan.\u003C/p>\n      \u003Cdiv class=\"package-includes\">\n        \u003Cstrong>What's Included\u003C/strong>\n        \u003Cul>\n          \u003Cli>Site consultation\u003C/li>\n          \u003Cli>Custom wiring plan\u003C/li>\n          \u003Cli>Volume pricing\u003C/li>\n          \u003Cli>Project manager\u003C/li>\n        \u003C/ul>\n      \u003C/div>\n      \u003Cbutton class=\"btn btn-secondary\" onclick=\"safeRequestQuote('tv_custom')\">\n        Request Quote\n      \u003C/button>\n    \u003C/article>\n  \u003C/div>\n\u003C/section>\n\n\u003C!-- SECURITY CAMERAS SECTION -->\n\u003Csection class=\"section\" id=\"security\">\n  \u003Cdiv class=\"section-header\">\n    \u003Ch2>Cameras: pick by coverage level\u003C/h2>\n    \u003Cp>Choose coverage by outcome  faces at the door, plates in the driveway, or full perimeter protection.\u003C/p>\n  \u003C/div>\n\n  \u003Cdiv class=\"package-grid\">\n    \u003C!-- Front Door Only -->\n    \u003Carticle class=\"package\">\n      \u003Cdiv class=\"package-header\">\n        \u003Ch3 class=\"package-name\">Front Door Only\u003C/h3>\n        \u003Cdiv class=\"package-price\">$599\u003C/div>\n      \u003C/div>\n      \u003Cp class=\"package-promise\">See faces at the door with instant alerts.\u003C/p>\n      \u003Cdiv class=\"package-includes\">\n        \u003Cstrong>What's Included\u003C/strong>\n        \u003Cul>\n          \u003Cli>\u003Cstrong>Areas covered:\u003C/strong> Front door\u003C/li>\n          \u003Cli>\u003Cstrong>Visibility level:\u003C/strong> Faces at the door\u003C/li>\n          \u003Cli>\u003Cstrong>Install + setup included:\u003C/strong> App setup, alerts, zones\u003C/li>\n          \u003Cli>\u003Cstrong>Support level:\u003C/strong> Standard support\u003C/li>\n        \u003C/ul>\n      \u003C/div>\n      \u003Cbutton class=\"btn btn-primary\" onclick=\"selectPackage('cam_basic', 'Front Door Only', 599)\">\n        Add to Cart\n      \u003C/button>\n    \u003C/article>\n\n    \u003C!-- Standard Perimeter (FEATURED) -->\n    \u003Carticle class=\"package featured\">\n      \u003Cdiv class=\"package-header\">\n        \u003Ch3 class=\"package-name\">Standard Perimeter\u003C/h3>\n        \u003Cdiv class=\"package-price\">$1,199\u003C/div>\n      \u003C/div>\n      \u003Cp class=\"package-promise\">Front, driveway, backyard  practical coverage for most homes.\u003C/p>\n      \u003Cdiv class=\"package-includes\">\n        \u003Cstrong>What's Included\u003C/strong>\n        \u003Cul>\n          \u003Cli>\u003Cstrong>Areas covered:\u003C/strong> Front, driveway, backyard\u003C/li>\n          \u003Cli>\u003Cstrong>Visibility level:\u003C/strong> Faces at door + plates in driveway\u003C/li>\n          \u003Cli>\u003Cstrong>Install + setup included:\u003C/strong> App setup, alerts, zones\u003C/li>\n          \u003Cli>\u003Cstrong>Support level:\u003C/strong> Standard support\u003C/li>\n        \u003C/ul>\n      \u003C/div>\n      \u003Cbutton class=\"btn btn-primary\" onclick=\"selectPackage('cam_standard', 'Standard Perimeter', 1199)\">\n        Add to Cart\n      \u003C/button>\n    \u003C/article>\n\n    \u003C!-- Full Perimeter -->\n    \u003Carticle class=\"package\">\n      \u003Cdiv class=\"package-header\">\n        \u003Ch3 class=\"package-name\">Full Perimeter\u003C/h3>\n        \u003Cdiv class=\"package-price\">$2,199\u003C/div>\n      \u003C/div>\n      \u003Cp class=\"package-promise\">Full-property protection with visibility on faces and plates.\u003C/p>\n      \u003Cdiv class=\"package-includes\">\n        \u003Cstrong>What's Included\u003C/strong>\n        \u003Cul>\n          \u003Cli>\u003Cstrong>Areas covered:\u003C/strong> Full perimeter\u003C/li>\n          \u003Cli>\u003Cstrong>Visibility level:\u003C/strong> Full perimeter coverage (faces + plates)\u003C/li>\n          \u003Cli>\u003Cstrong>Install + setup included:\u003C/strong> App setup, alerts, zones\u003C/li>\n          \u003Cli>\u003Cstrong>Support level:\u003C/strong> Priority support\u003C/li>\n        \u003C/ul>\n      \u003C/div>\n      \u003Cbutton class=\"btn btn-primary\" onclick=\"selectPackage('cam_premium', 'Full Perimeter', 2199)\">\n        Add to Cart\n      \u003C/button>\n    \u003C/article>\n\n    \u003C!-- Custom -->\n    \u003Carticle class=\"package\">\n      \u003Cdiv class=\"package-header\">\n        \u003Ch3 class=\"package-name\">Custom (quote)\u003C/h3>\n        \u003Cdiv class=\"package-price\">Quote\u003C/div>\n      \u003C/div>\n      \u003Cp class=\"package-promise\">Unique property? Well design a coverage plan with you.\u003C/p>\n      \u003Cdiv class=\"package-includes\">\n        \u003Cstrong>What's Included\u003C/strong>\n        \u003Cul>\n          \u003Cli>\u003Cstrong>Areas covered:\u003C/strong> Custom camera plan\u003C/li>\n          \u003Cli>\u003Cstrong>Visibility level:\u003C/strong> Tailored to faces, plates, or both\u003C/li>\n          \u003Cli>\u003Cstrong>Install + setup included:\u003C/strong> App setup, alerts, zones\u003C/li>\n          \u003Cli>\u003Cstrong>Support level:\u003C/strong> Priority support\u003C/li>\n        \u003C/ul>\n      \u003C/div>\n      \u003Cbutton class=\"btn btn-secondary\" onclick=\"safeRequestQuote('cam_custom')\">\n        Request Quote\n      \u003C/button>\n    \u003C/article>\n  \u003C/div>\n\u003C/section>\n\u003C/div>\n\u003C!-- End Outlet -->\n\u003C/main>\n\n\u003C!-- Global Loader Overlay -->\n\u003Cdiv id=\"h2s-loader\" class=\"h2s-loader\" aria-hidden=\"true\" style=\"display:none\">\n  \u003Cdiv class=\"h2s-loader-stage\">\n    \u003Cdiv id=\"h2sLoaderSlices\" class=\"h2s-loader-slices\">\u003C/div>\n  \u003C/div>\n\u003C/div>\n\n\u003C!-- MENU DRAWER -->\n\u003Caside class=\"menu-drawer\" id=\"menuDrawer\" style=\"content-visibility: auto;\">\n  \u003Cdiv class=\"menu-header\">\n    \u003Ch3>Menu\u003C/h3>\n    \u003Cbutton class=\"btn-subtle\" onclick=\"toggleMenu()\" style=\"padding: 6px 10px; font-size: 13px;\">Close\u003C/button>\n  \u003C/div>\n  \u003Cnav class=\"menu-body\">\n    \u003Cdiv class=\"menu-nav\">\n      \u003Ca href=\"/\" class=\"menu-link\">Home\u003C/a>\n      \u003Cbutton class=\"menu-link\" onclick=\"scrollToSection('tv'); toggleMenu();\">TV Mounting\u003C/button>\n      \u003Cbutton class=\"menu-link\" onclick=\"scrollToSection('security'); toggleMenu();\">Security Cameras\u003C/button>\n      \u003Cbutton class=\"menu-link\" onclick=\"openBooking(); toggleMenu();\">Schedule Appointment\u003C/button>\n      \u003Ca href=\"tel:864-528-1475\" class=\"menu-link\">Call: 864-528-1475\u003C/a>\n    \u003C/div>\n  \u003C/nav>\n\u003C/aside>\n\n\u003C!-- CART DRAWER -->\n\u003Caside class=\"cart-drawer\" id=\"cartDrawer\" onclick=\"event.stopPropagation()\" style=\"content-visibility: auto;\">\n  \u003Cdiv class=\"cart-header\">\n    \u003Ch3 class=\"cart-title\">Your Cart\u003C/h3>\n    \u003Cbutton class=\"btn-subtle\" onclick=\"toggleCart()\" style=\"padding: 6px 10px; font-size: 13px;\">Close\u003C/button>\n  \u003C/div>\n  \n  \u003C!-- Scrollable body -->\n  \u003Cdiv class=\"cart-body\">\n    \u003C!-- AI Recommendations Panel -->\n    \u003Cdiv id=\"aiRecommendationsPanel\" class=\"ai-recs-panel\" style=\"display:none;min-height:80px\">\n      \u003Cdiv class=\"ai-recs-header\">\n        \u003Cdiv class=\"ai-icon\">&#10024;\u003C/div>\n        \u003Cdiv class=\"ai-title\">Recommended for you\u003C/div>\n      \u003C/div>\n      \u003Cdiv id=\"aiRecommendations\" class=\"ai-recs-list\">\u003C/div>\n    \u003C/div>\n    \n    \u003C!-- Bundle recommendations (smart swap suggestions) -->\n    \u003Cdiv id=\"bundlePanel\" class=\"bundle-panel\" style=\"display:none;min-height:60px\">\u003C/div>\n    \n    \u003C!-- Rule-based Recommendations -->\n    \u003Cdiv id=\"recsPanel\" class=\"recs-panel\" style=\"display:none;min-height:60px\">\u003C/div>\n    \n    \u003C!-- Empty state -->\n    \u003Cdiv id=\"cartEmpty\" class=\"cart-empty\" hidden>\n      \u003Cp>Your cart is empty\u003C/p>\n      \u003Cp style=\"font-size: 13px; margin-top: 8px;\">Pick a package to get started\u003C/p>\n    \u003C/div>\n    \n    \u003C!-- Cart items -->\n    \u003Cdiv id=\"cartItems\" class=\"cart-lines\">\n      \u003C!-- Items rendered by paintCart() -->\n    \u003C/div>\n  \u003C/div>\n  \n  \u003C!-- Footer -->\n  \u003Cdiv class=\"cart-foot\">\n    \u003C!-- Error display -->\n    \u003Cdiv id=\"checkoutError\" class=\"checkout-error\" role=\"alert\" aria-live=\"polite\" hidden>\n      \u003Cspan id=\"checkoutErrorMsg\">\u003C/span>\n      \u003Cbutton id=\"dismissError\" class=\"error-dismiss\" aria-label=\"Dismiss error\">&times;\u003C/button>\n    \u003C/div>\n\n    \u003C!-- Promo Code -->\n    \u003Cdiv class=\"promo-section\" style=\"margin-bottom: 16px;\">\n      \u003Cdiv style=\"display: flex; gap: 8px;\">\n        \u003Cinput type=\"text\" id=\"promoCode\" class=\"inp\" placeholder=\"Promo code\" style=\"padding: 8px 12px; flex: 1;\">\n        \u003Cbutton id=\"applyPromo\" class=\"btn ghost\" style=\"padding: 8px 14px; font-size: 13px; white-space: nowrap;\">Apply\u003C/button>\n      \u003C/div>\n      \u003Cdiv id=\"promoMsg\" class=\"help\" style=\"margin-top: 6px; font-size: 12px;\">\u003C/div>\n    \u003C/div>\n    \n    \u003C!-- Totals -->\n    \u003Cdiv class=\"totals\">\n      \u003Cdiv class=\"kv\" style=\"font-size: 14px; color: var(--muted);\">\n        \u003Cspan id=\"cartItemCount\">0 items\u003C/span>\n        \u003Cspan>\u003C/span>\n      \u003C/div>\n      \u003C!-- Subtotal (visible when no promo active) -->\n      \u003Cdiv id=\"cartSubtotalLine\" class=\"kv\" style=\"font-size: 14px; color: var(--ink); padding-top: 8px; border-top: 1px solid var(--border);\">\n        \u003Cspan>Subtotal\u003C/span>\n        \u003Cspan id=\"cartSubtotal\">$0.00\u003C/span>\n      \u003C/div>\n      \n      \u003C!-- Raw Subtotal (Visible when promo is active, replaces above) -->\n      \u003Cdiv id=\"rawSubtotalLine\" class=\"kv\" style=\"font-size: 14px; color: var(--ink); display: none;\">\n        \u003Cspan>Subtotal\u003C/span>\n        \u003Cspan id=\"rawSubtotalAmount\">$0.00\u003C/span>\n      \u003C/div>\n\n      \u003C!-- Promo Discount Line -->\n      \u003Cdiv id=\"promoLine\" class=\"kv\" style=\"font-size: 14px; color: #059669; display: none;\">\n        \u003Cspan id=\"promoLineLabel\">Promo\u003C/span>\n        \u003Cspan id=\"promoAmount\">-$0.00\u003C/span>\n      \u003C/div>\n\n      \u003C!-- Grand Total (shows final amount after discount) -->\n      \u003Cdiv class=\"kv\" style=\"font-size: 16px; font-weight: 700; padding-top: 12px; border-top: 1px solid var(--border);\">\n        \u003Cspan id=\"totalLabel\">Total\u003C/span>\n        \u003Cstrong id=\"grandTotal\">$0.00\u003C/strong>\n      \u003C/div>\n      \u003Cdiv class=\"note\">Flat-rate pricing. No hidden fees. Workmanship guaranteed.\u003C/div>\n    \u003C/div>\n    \n    \u003C!-- Actions -->\n    \u003Cdiv class=\"foot-actions\">\n      \u003Cbutton id=\"checkoutBtn\" class=\"btn btn-primary\">\n        Checkout\n      \u003C/button>\n    \u003C/div>\n  \u003C/div>\n\u003C/aside>\n\n\u003C!-- BACKDROP -->\n\u003Cdiv class=\"backdrop\" id=\"backdrop\">\u003C/div>\n\n\u003C!-- QUOTE REQUEST MODAL -->\n\u003Cdiv class=\"modal\" id=\"quoteModal\">\n  \u003Cdiv class=\"modal-content\" style=\"max-width: 520px;\">\n    \u003Cdiv class=\"modal-header\">\n      \u003Ch3 id=\"quoteModalTitle\">Request Custom Quote\u003C/h3>\n      \u003Cp id=\"quoteModalSubtitle\">Tell us what you need and we'll get back to you fast\u003C/p>\n    \u003C/div>\n    \u003Cdiv class=\"modal-body\" style=\"padding: 24px;\">\n      \u003C!-- Smart Fields for Dynamic Quote -->\n      \u003Cdiv style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;\">\n        \u003Cdiv>\n          \u003Clabel style=\"display: block; font-weight: 600; margin-bottom: 6px; font-size: 14px;\">Project Type\u003C/label>\n          \u003Cselect id=\"quoteType\" class=\"inp\" style=\"width: 100%;\" onchange=\"updateQuoteEstimate()\">\n            \u003Coption value=\"tv\">TV Mounting\u003C/option>\n            \u003Coption value=\"camera\">Security Cameras\u003C/option>\n            \u003Coption value=\"both\">Both / Other\u003C/option>\n          \u003C/select>\n        \u003C/div>\n        \u003Cdiv>\n          \u003Clabel style=\"display: block; font-weight: 600; margin-bottom: 6px; font-size: 14px;\">Quantity\u003C/label>\n          \u003Cinput type=\"number\" id=\"quoteQty\" class=\"inp\" value=\"1\" min=\"1\" max=\"50\" style=\"width: 100%;\" onchange=\"updateQuoteEstimate()\" oninput=\"updateQuoteEstimate()\">\n        \u003C/div>\n      \u003C/div>\n      \n      \u003Cdiv style=\"margin-bottom: 16px;\">\n        \u003Clabel style=\"display: block; font-weight: 600; margin-bottom: 6px; font-size: 14px;\">Surface / Wall Type\u003C/label>\n        \u003Cselect id=\"quoteSurface\" class=\"inp\" style=\"width: 100%;\" onchange=\"updateQuoteEstimate()\">\n          \u003Coption value=\"drywall\">Drywall (Standard)\u003C/option>\n          \u003Coption value=\"brick\">Brick / Stone / Concrete (+$50/item)\u003C/option>\n          \u003Coption value=\"commercial\">Commercial / High Ceiling\u003C/option>\n        \u003C/select>\n      \u003C/div>\n\n      \u003Cdiv style=\"background: #f0fdf4; border: 1px solid #bbf7d0; border-radius: 8px; padding: 12px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;\">\n        \u003Cspan style=\"font-weight: 600; color: #166534; font-size: 14px;\">Estimated Range:\u003C/span>\n        \u003Cspan id=\"quoteEstimateValue\" style=\"font-weight: 800; color: #15803d; font-size: 18px;\">$149 - $199\u003C/span>\n      \u003C/div>\n      \n      \u003Cdiv style=\"display: grid; gap: 16px;\">\n        \u003Cdiv>\n          \u003Clabel style=\"display: block; font-weight: 600; margin-bottom: 6px; font-size: 14px;\">Your Name *\u003C/label>\n          \u003Cinput type=\"text\" id=\"quoteName\" class=\"inp\" placeholder=\"John Smith\" style=\"width: 100%;\" required>\n        \u003C/div>\n        \n        \u003Cdiv>\n          \u003Clabel style=\"display: block; font-weight: 600; margin-bottom: 6px; font-size: 14px;\">Email *\u003C/label>\n          \u003Cinput type=\"email\" id=\"quoteEmail\" class=\"inp\" placeholder=\"john@example.com\" style=\"width: 100%;\" required>\n        \u003C/div>\n        \n        \u003Cdiv>\n          \u003Clabel style=\"display: block; font-weight: 600; margin-bottom: 6px; font-size: 14px;\">Phone *\u003C/label>\n          \u003Cinput type=\"tel\" id=\"quotePhone\" class=\"inp\" placeholder=\"(864) 528-1475\" style=\"width: 100%;\" required>\n        \u003C/div>\n        \n        \u003Cdiv>\n          \u003Clabel style=\"display: block; font-weight: 600; margin-bottom: 6px; font-size: 14px;\">Project Details\u003C/label>\n          \u003Ctextarea id=\"quoteDetails\" class=\"inp\" placeholder=\"Tell us about your project...\" style=\"width: 100%; min-height: 100px; resize: vertical; font-family: inherit;\">\u003C/textarea>\n        \u003C/div>\n        \n        \u003Cdiv id=\"quoteMessage\" class=\"help\" style=\"margin-top: 4px;\">\u003C/div>\n      \u003C/div>\n      \n      \u003Cdiv style=\"margin-top: 24px; padding-top: 20px; border-top: 1px solid var(--border);\">\n        \u003Cdiv style=\"font-size: 13px; font-weight: 600; color: var(--cobalt); margin-bottom: 12px;\"> Prefer to call?\u003C/div>\n        \u003Ca href=\"tel:864-528-1475\" style=\"display: flex; align-items: center; gap: 10px; padding: 12px 16px; background: #f5f9ff; border: 1px solid #d7eafc; border-radius: 8px; text-decoration: none; color: var(--cobalt); font-weight: 600; transition: all 0.2s;\">\n          \u003Csvg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n            \u003Cpath d=\"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z\">\u003C/path>\n          \u003C/svg>\n          \u003Cspan>(864) 528-1475\u003C/span>\n        \u003C/a>\n      \u003C/div>\n    \u003C/div>\n    \u003Cdiv class=\"modal-footer\" style=\"gap: 8px;\">\n      \u003Cbutton class=\"btn btn-primary\" id=\"submitQuoteBtn\" onclick=\"submitQuoteRequest()\" style=\"flex: 1;\">\n        Send Request\n      \u003C/button>\n      \u003Cbutton class=\"btn btn-subtle\" id=\"cancelQuoteBtn\" onclick=\"safeCloseQuoteModal()\">Cancel\u003C/button>\n    \u003C/div>\n  \u003C/div>\n\u003C/div>\n\n\u003C!-- MODAL -->\n\u003Cdiv class=\"modal\" id=\"modal\">\n  \u003Cdiv class=\"modal-content\">\n    \u003Cdiv class=\"modal-header\">\n      \u003Ch3 id=\"modalTitle\">Package Selected\u003C/h3>\n      \u003Cp id=\"modalSubtitle\">We'll finalize the details during your free consultation.\u003C/p>\n    \u003C/div>\n    \u003Cdiv class=\"modal-body\" id=\"modalBody\">\n      \u003C!-- Dynamic content -->\n    \u003C/div>\n    \u003Cdiv class=\"modal-footer\">\n      \u003Cbutton class=\"btn btn-primary\" id=\"modalPrimaryCTA\" onclick=\"addPackageToCart()\">Add to Cart\u003C/button>\n      \u003Cbutton class=\"btn btn-subtle\" onclick=\"closeModal()\">Cancel\u003C/button>\n    \u003C/div>\n  \u003C/div>\n\u003C/div>\n\n\u003C!-- SEO: Structured Data (JSON-LD) -->\n\u003Cscript type=\"application/ld+json\">\n{\n  \"@context\": \"https://schema.org\",\n  \"@type\": \"LocalBusiness\",\n  \"name\": \"Home2Smart\",\n  \"description\": \"Professional smart home installation services including TV mounting and security camera installation\",\n  \"url\": \"https://home2smart.com\",\n  \"telephone\": \"+1-864-528-1475\",\n  \"priceRange\": \"$$\",\n  \"aggregateRating\": {\n    \"@type\": \"AggregateRating\",\n    \"ratingValue\": \"4.9\",\n    \"reviewCount\": \"500\"\n  },\n  \"areaServed\": {\n    \"@type\": \"State\",\n    \"name\": \"South Carolina\"\n  },\n  \"hasOfferCatalog\": {\n    \"@type\": \"OfferCatalog\",\n    \"name\": \"Installation Services\",\n    \"itemListElement\": [\n      {\n        \"@type\": \"Offer\",\n        \"itemOffered\": {\n          \"@type\": \"Service\",\n          \"name\": \"TV Mounting Installation\",\n          \"description\": \"Professional TV mounting with wire concealment\"\n        },\n        \"price\": \"249\",\n        \"priceCurrency\": \"USD\"\n      },\n      {\n        \"@type\": \"Offer\",\n        \"itemOffered\": {\n          \"@type\": \"Service\",\n          \"name\": \"Security Camera Installation\",\n          \"description\": \"Complete security camera system installation\"\n        },\n        \"price\": \"599\",\n        \"priceCurrency\": \"USD\"\n      }\n    ]\n  }\n}\n\u003C/script>\n\n\u003C!-- Performance: Detect when Archivo font loads and apply it -->\n\u003C!-- Font loading handled by CSS font-display: swap -->\n\n\u003Cscript>\n(function(){\n  // TBT guard (selective): throttle ONLY the tel:-link tracking MutationObserver.\n  // This avoids changing MutationObserver semantics for other scripts.\n  if (window.__H2S_TBT_GUARDS__) return;\n  window.__H2S_TBT_GUARDS__ = true;\n\n  try {\n    if (window.MutationObserver) {\n      var NativeMutationObserver = window.MutationObserver;\n      var schedule = window.requestAnimationFrame\n        ? window.requestAnimationFrame.bind(window)\n        : function(fn){ return setTimeout(fn, 16); };\n\n      function shouldThrottleMutationObserverCallback(cb) {\n        if (typeof cb !== 'function') return false;\n        try {\n          var src = String(cb);\n          return src.indexOf('trackPhoneClick') !== -1 && src.indexOf('tel:') !== -1;\n        } catch (_) {\n          return false;\n        }\n      }\n\n      function makeThrottledCallback(originalCb) {\n        var queued = [];\n        var scheduled = false;\n        var lastObserver = null;\n        return function(mutations, observer) {\n          lastObserver = observer;\n          if (mutations && mutations.length) queued.push.apply(queued, mutations);\n          if (scheduled) return;\n          scheduled = true;\n          schedule(function(){\n            scheduled = false;\n            var batch = queued.length ? queued.splice(0, queued.length) : mutations;\n            try {\n              originalCb(batch, lastObserver);\n            } catch (e) {\n              setTimeout(function(){ throw e; });\n            }\n          });\n        };\n      }\n\n      function WrappedMutationObserver(callback) {\n        if (!(this instanceof WrappedMutationObserver)) return new WrappedMutationObserver(callback);\n        var cb = callback;\n        if (shouldThrottleMutationObserverCallback(callback)) {\n          cb = makeThrottledCallback(callback);\n        }\n        return new NativeMutationObserver(cb);\n      }\n\n      WrappedMutationObserver.prototype = NativeMutationObserver.prototype;\n      window.MutationObserver = WrappedMutationObserver;\n    }\n  } catch (_) {\n    // Fail open.\n  }\n\n  // TBT guard (selective): reduce Meta Pixel readiness polling overhead.\n  // Only targets the internal h2sTrack fbq polling interval.\n  try {\n    if (!window.__H2S_SI_PATCHED__ && window.setInterval && window.clearInterval) {\n      window.__H2S_SI_PATCHED__ = true;\n      var nativeSetInterval = window.setInterval.bind(window);\n      var nativeClearInterval = window.clearInterval.bind(window);\n\n      window.setInterval = function(cb, ms) {\n        try {\n          if (ms === 150 && typeof cb === 'function') {\n            var src = '';\n            try { src = String(cb); } catch (_) { src = ''; }\n            if (src && src.indexOf('fbq') !== -1 && src.indexOf('__H2S_FB_INIT__') !== -1) {\n              var runs = 0;\n              var id;\n              var wrapped = function(){\n                runs++;\n                if (runs > 8) {\n                  try { nativeClearInterval(id); } catch (_) {}\n                  return;\n                }\n                return cb.apply(this, arguments);\n              };\n              id = nativeSetInterval(wrapped, 500);\n              return id;\n            }\n          }\n        } catch (_) {\n          // fall through\n        }\n        return nativeSetInterval.apply(this, arguments);\n      };\n    }\n  } catch (_) {\n    // Fail open.\n  }\n})();\n\u003C/script>\n\n\u003Cscript defer>\"use strict\";const isDev=\"localhost\"===window.location.hostname||window.location.hostname.includes(\"127.0.0.1\")||window.location.hostname.includes(\"vercel.app\"),logger={log:isDev?console.log.bind(console):()=>{},warn:isDev?console.warn.bind(console):()=>{},error:console.error.bind(console)};function byId(id){return document.getElementById(id)}function money(cents){return\"number\"==typeof cents?\"$\"+cents.toFixed(2):\"$0.00\"}function escapeHtml(text){if(!text)return\"\";const div=document.createElement(\"div\");return div.textContent=text,div.innerHTML}logger.log(\"[BundlesJS] Script loaded and executing\");const BUNDLES_DATA_API=\"https://h2s-backend.vercel.app/api/bundles-data\",API=\"https://h2s-backend.vercel.app/api/shop\",APIV1=\"https://h2s-backend.vercel.app/api/schedule-appointment\",DASH_URL=\"https://h2s-backend.vercel.app/api/track\",CAL_FORM_URL=\"https://api.leadconnectorhq.com/widget/booking/RjwOQacM3FAjRNCfm6uU\",PIXEL_ID=\"2384221445259822\",TEST_EVENT_CODE=null,IS_LOCAL=\"127.0.0.1\"===location.hostname||\"localhost\"===location.hostname;window.H2S_TRACKING_ENDPOINT=DASH_URL,window.H2S_META_ENDPOINT=DASH_URL;const bundlesFetchPromise=IS_LOCAL?Promise.resolve(null):fetch(BUNDLES_DATA_API,{cache:\"default\",headers:{Accept:\"application/json\"},priority:\"high\",credentials:\"omit\"}).then(res=>res.ok?res.json():(logger.warn(\"[Bundles] API returned\",res.status,\"- using fallback\"),null)).catch(err=>(logger.warn(\"[Bundles] Aggregated fetch failed, will fallback:\",err),null));let SESSION_ID=localStorage.getItem(\"h2s_session_id\");function showTrackingDebugPanel(){const panel=document.createElement(\"div\");panel.id=\"trackingDebugPanel\",panel.style.cssText=\"position:fixed;bottom:16px;right:16px;background:#0a2a5a;color:#fff;padding:16px;border-radius:12px;font-family:monospace;font-size:12px;max-width:400px;max-height:500px;overflow:auto;z-index:99999;box-shadow:0 8px 24px rgba(0,0,0,0.3);\",panel.innerHTML=`\\n    \u003Cdiv style=\"display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;\">\\n      \u003Cstrong style=\"font-size:14px;\"> Tracking Monitor\u003C/strong>\\n      \u003Cbutton onclick=\"this.parentElement.parentElement.remove()\" style=\"background:rgba(255,255,255,0.2);border:none;color:#fff;padding:4px 8px;border-radius:4px;cursor:pointer;font-size:11px;\">Close\u003C/button>\\n    \u003C/div>\\n    \u003Cdiv style=\"margin-bottom:8px;\">\u003Cstrong>Session:\u003C/strong>\u003Cbr/>\u003Cspan style=\"font-size:10px;opacity:0.8;word-break:break-all;\">${SESSION_ID}\u003C/span>\u003C/div>\\n    \u003Cdiv style=\"margin-bottom:8px;\">\u003Cstrong>Meta Pixel:\u003C/strong> \u003Cspan id=\"pixelStatus\">Checking...\u003C/span>\u003C/div>\\n    \u003Cdiv style=\"margin-bottom:8px;\">\u003Cstrong>Backend API:\u003C/strong> \u003Cspan id=\"backendStatus\">Checking...\u003C/span>\u003C/div>\\n    \u003Cdiv style=\"margin-bottom:8px;\">\u003Cstrong>Events Sent:\u003C/strong> \u003Cspan id=\"eventCount\">0\u003C/span>\u003C/div>\\n    \u003Cdiv style=\"margin-top:12px;padding-top:12px;border-top:1px solid rgba(255,255,255,0.2);\">\\n      \u003Cbutton onclick=\"testH2STracking()\" style=\"width:100%;background:#1493ff;border:none;color:#fff;padding:8px;border-radius:6px;cursor:pointer;font-weight:600;font-size:12px;margin-bottom:8px;\"> Test Tracking\u003C/button>\\n      \u003Ca href=\"https://business.facebook.com/events_manager2/list/pixel/\" target=\"_blank\" style=\"display:block;text-align:center;padding:6px;background:rgba(255,255,255,0.1);border-radius:6px;color:#fff;text-decoration:none;font-size:11px;\">View Meta Events Manager \u003C/a>\\n    \u003C/div>\\n    \u003Cdiv id=\"recentEvents\" style=\"margin-top:12px;padding-top:12px;border-top:1px solid rgba(255,255,255,0.2);font-size:10px;max-height:200px;overflow:auto;\">\u003C/div>\\n  `,document.body.appendChild(panel);const pixelStatus=document.getElementById(\"pixelStatus\");\"undefined\"!=typeof fbq?pixelStatus.innerHTML='\u003Cspan style=\"color:#10b981;\"> Active\u003C/span>':pixelStatus.innerHTML='\u003Cspan style=\"color:#ef4444;\"> Not Loaded\u003C/span>';const backendStatus=document.getElementById(\"backendStatus\");fetch(\"https://h2s-backend.vercel.app/api/stats\",{credentials:\"omit\",cache:\"no-store\"}).then(res=>{backendStatus.innerHTML=res.ok?'\u003Cspan style=\"color:#10b981;\"> Online\u003C/span>':'\u003Cspan style=\"color:#f59e0b;\"> HTTP '+res.status+\"\u003C/span>\"}).catch(()=>{backendStatus.innerHTML='\u003Cspan style=\"color:#ef4444;\"> Offline\u003C/span>'}),window._trackingDebugCount=0;const originalH2STrack=window.h2sTrack||h2sTrack;window.h2sTrack=function(...args){window._trackingDebugCount++,document.getElementById(\"eventCount\").textContent=window._trackingDebugCount;const recentEvents=document.getElementById(\"recentEvents\"),eventDiv=document.createElement(\"div\");return eventDiv.style.cssText=\"padding:6px 8px;margin-bottom:4px;opacity:0.9;background:rgba(255,255,255,0.05);border-radius:4px;border-left:3px solid #10b981;\",eventDiv.innerHTML='\u003Cdiv style=\"font-weight:600;margin-bottom:2px;\">'+args[0]+'\u003C/div>\u003Cdiv style=\"opacity:0.7;font-size:9px;\">'+(new Date).toLocaleTimeString()+\"\u003C/div>\",recentEvents.insertBefore(eventDiv,recentEvents.firstChild),recentEvents.children.length>8&&recentEvents.lastChild.remove(),originalH2STrack.apply(this,args)}}function testH2STracking(){h2sTrack(\"DebugTest\",{source:\"debug_panel\",test:!0,timestamp:(new Date).toISOString(),page:\"bundles\"}),setTimeout(()=>{alert(' Test event fired!\\n\\n1. Open browser console (F12) to see detailed logs\\n2. Look for \" [H2S Track]\" and \" Backend response\"\\n3. Check your database/sheet for the event\\n\\nIf you see \" Backend unavailable\" in console, there\\'s a timing issue.')},500)}SESSION_ID||(SESSION_ID=crypto&&crypto.randomUUID?crypto.randomUUID():\"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g,function(c){const r=16*Math.random()|0;return(\"x\"===c?r:3&r|8).toString(16)}),localStorage.setItem(\"h2s_session_id\",SESSION_ID));let catalog={services:[],serviceOptions:[],priceTiers:[],bundles:[],bundleItems:[],recommendations:[],memberships:[],membershipPrices:[]},allReviews=[],heroReviews=[],reviewsLoadedFromAPI=!1,cart=loadCart(),user=loadUser(),lastSearch=\"\",lastCat=\"\",_bundlesDeferredPromise=null;function loadBundlesDeferred(){return _bundlesDeferredPromise||(_bundlesDeferredPromise=Promise.resolve(),_bundlesDeferredPromise)}function loadExtraDeferred(){return loadBundlesDeferred()}function queueRenderRecsPanel(){if(window._queuedRecs)return;window._queuedRecs=!0;const invoke=()=>loadExtraDeferred().then(()=>{window.renderRecsPanel&&window.renderRecsPanel(),window._queuedRecs=!1}).catch(err=>{console.warn(\"[Recommendations] Failed to load, skipping\"),window._queuedRecs=!1});\"requestIdleCallback\"in window?requestIdleCallback(invoke,{timeout:3e3}):setTimeout(invoke,1500)}function buildLoader(){const slices=byId(\"h2sLoaderSlices\");if(!slices)return;const c1=\"#1493ff\",c2=\"#0a2a5a\",c3=\"#6b778c\",colors=[c1,c2,c3,c1,c2,c3,c1,c2];slices.innerHTML=colors.map((col,i)=>`\u003Cdiv class=\"h2s-loader-slice\" style=\"background:${col};animation-delay:${.05*i}s\">\u003C/div>`).join(\"\")}function showLoader(){const el=byId(\"h2s-loader\");el&&(el.classList.remove(\"hidden\"),el.style.display=\"\")}function hideLoader(){const el=byId(\"h2s-loader\");el&&(el.classList.add(\"hidden\"),setTimeout(()=>{el.classList.contains(\"hidden\")&&(el.style.display=\"none\")},400))}function showSkeleton(){byId(\"outlet\").innerHTML='\\n    \u003Cdiv class=\"skeleton skeleton-hero\">\u003C/div>\\n    \u003Cdiv class=\"skeleton skeleton-trust\">\u003C/div>\\n    \u003Cdiv class=\"skeleton-grid\">\\n      \u003Cdiv class=\"skeleton skeleton-card\">\u003C/div>\\n      \u003Cdiv class=\"skeleton skeleton-card\">\u003C/div>\\n      \u003Cdiv class=\"skeleton skeleton-card\">\u003C/div>\\n      \u003Cdiv class=\"skeleton skeleton-card\">\u003C/div>\\n      \u003Cdiv class=\"skeleton skeleton-card\">\u003C/div>\\n      \u003Cdiv class=\"skeleton skeleton-card\">\u003C/div>\\n    \u003C/div>\\n  '}function h2sTrack(event,data={}){!function(){if(\"function\"==typeof fbq&&window.__H2S_FB_INIT__)try{const params=buildAdvancedParams(),eventData={...data};fbq(\"track\",event,eventData,params)}catch(e){console.warn(\" [Meta Pixel] send failed:\",e)}else{let tries=0;const maxTries=20,timer=setInterval(()=>{if(\"function\"==typeof fbq&&window.__H2S_FB_INIT__){clearInterval(timer);try{const params=buildAdvancedParams(),eventData={...data};fbq(\"track\",event,eventData,params)}catch(e){console.warn(\" [Meta Pixel] delayed send failed:\",e)}}else++tries>=maxTries&&(clearInterval(timer),console.warn(\" [Meta Pixel] fbq not loaded; skipping send:\",event))},150)}}(),function sendToBackend(attempt=1){if(window.h2sSendBackend&&\"function\"==typeof window.h2sSendBackend){const event_type=event.toLowerCase().replace(/([A-Z])/g,\"_$1\").replace(/^_/,\"\"),trackingData={...data,user_email:user?.email||\"\",timestamp:(new Date).toISOString()};try{const result=window.h2sSendBackend(event_type,trackingData);result&&\"function\"==typeof result.catch&&result.catch(()=>{})}catch(err){}}else attempt\u003C=5&&setTimeout(()=>sendToBackend(attempt+1),100*attempt)}()}async function sha256(text){if(!crypto||!crypto.subtle)return\"\";try{const data=(new TextEncoder).encode(text),hashBuffer=await crypto.subtle.digest(\"SHA-256\",data);return Array.from(new Uint8Array(hashBuffer)).map(b=>b.toString(16).padStart(2,\"0\")).join(\"\")}catch(_){return\"\"}}function buildAdvancedParams(){const params={};if(user&&user.email){if(sha256(user.email.trim().toLowerCase()).then(h=>{h&&(params.em=h)}),user.phone){sha256(user.phone.replace(/\\D/g,\"\")).then(h=>{h&&(params.ph=h)})}if(user.name){const parts=user.name.trim().toLowerCase().split(\" \");parts[0]&&sha256(parts[0]).then(h=>{h&&(params.fn=h)}),parts[parts.length-1]&&sha256(parts[parts.length-1]).then(h=>{h&&(params.ln=h)})}}return params}async function init(){const checkoutBtn=byId(\"checkoutBtn\");checkoutBtn?checkoutBtn.hasAttribute(\"data-listener-attached\")?logger.log(\"[Init] Checkout button listener already attached\"):(checkoutBtn.setAttribute(\"data-listener-attached\",\"true\"),checkoutBtn.addEventListener(\"click\",function(e){logger.log(\"[Checkout] Button clicked\"),e.preventDefault(),e.stopPropagation();try{checkout()}catch(err){logger.error(\"[Checkout] Critical error:\",err);try{showCheckoutModal()}catch(err2){logger.error(\"[Checkout] Fallback failed:\",err2),alert(\"Unable to open checkout. Please refresh the page or call (864) 528-1475 to complete your order.\")}}},{passive:!1}),logger.log(\"[Init] Checkout button event listener attached\")):logger.error(\"[Init] Checkout button not found!\"),function(){function trackPhoneClick(link){h2sTrack(\"PhoneClick\",{phone:link.href.replace(\"tel:\",\"\").trim(),click_location:link.closest(\"nav\")?\"menu\":link.closest(\"#cartDrawer\")?\"cart\":link.closest(\"#quoteModal\")?\"quote\":link.closest(\"header\")?\"header\":link.closest(\"footer\")?\"footer\":\"unknown\",page_url:window.location.href,page_path:window.location.pathname})}if(document.querySelectorAll('a[href^=\"tel:\"]').forEach(link=>{link.addEventListener(\"click\",function(e){trackPhoneClick(link)},{once:!1})}),window.MutationObserver){new MutationObserver(function(mutations){mutations.forEach(function(mutation){mutation.addedNodes.forEach(function(node){1===node.nodeType&&(\"A\"===node.tagName&&node.href&&node.href.startsWith(\"tel:\")&&node.addEventListener(\"click\",function(e){trackPhoneClick(node)}),node.querySelectorAll&&node.querySelectorAll('a[href^=\"tel:\"]').forEach(function(link){link.addEventListener(\"click\",function(e){trackPhoneClick(link)})}))})})}).observe(document.body,{childList:!0,subtree:!0})}}();try{performance.mark(\"phase1-start\"),document.body.classList.add(\"app-ready\");const outlet=byId(\"outlet\");outlet&&outlet.querySelector(\".hero\")&&(window.shopHTML=outlet.innerHTML),performance.mark(\"phase1-end\"),performance.measure(\"Phase 1: Critical Setup\",\"phase1-start\",\"phase1-end\"),requestAnimationFrame(()=>{wireCart(),\"requestIdleCallback\"in window?requestIdleCallback(()=>updateCartBadge(),{timeout:1e3}):setTimeout(()=>updateCartBadge(),250)});const view=getParam(\"view\"),isSpecialView=view&&\"shop\"!==view;route(),bundlesFetchPromise.then(data=>{if(data){if(data.catalog&&(catalog=data.catalog,isSpecialView&&route()),data.reviews&&(allReviews=data.reviews,reviewsLoadedFromAPI=!0,heroReviews=allReviews.slice(0,5).map(r=>({text:r.text&&r.text.trim()?r.text.trim():\"\",author:r.name||\"Customer\",stars:r.rating||5})).filter(r=>r.text.length>0),!isSpecialView)){try{initHeroReviews()}catch(e){logger.warn(\"initHeroReviews error\",e)}\"requestIdleCallback\"in window?requestIdleCallback(()=>{try{renderReviews()}catch(e){logger.warn(\"renderReviews error\",e)}},{timeout:2e3}):setTimeout(()=>{try{renderReviews()}catch(e){logger.warn(\"renderReviews error\",e)}},1500)}}else if(logger.warn(\"[Bundles] Aggregated data missing, using fallback\"),IS_LOCAL)try{initHeroReviews()}catch(e){logger.warn(\"initHeroReviews error\",e)}else{fetch(API+\"?action=catalog\").then(r=>r.json()).then(d=>{d.ok&&(catalog=d.catalog||catalog)});try{initHeroReviews()}catch(e){logger.warn(\"initHeroReviews error\",e)}}});const urlCart=getParam(\"cart\");if(urlCart){const decoded=decodeCartFromUrl(urlCart);decoded.length&&(cart=decoded,saveCart(),updateCartBadge(),paintCart())}const url=new URL(location.href);url.searchParams.has(\"cart\")&&(url.searchParams.delete(\"cart\"),history.replaceState({},\"\",url.toString())),\"tracking\"===url.searchParams.get(\"debug\")&&setTimeout(()=>showTrackingDebugPanel(),1e3),window.__H2S_ENABLE_AI_RECS&&user&&user.email&&requestIdleCallback(()=>loadAIRecommendations(),{timeout:3e3}),\"requestIdleCallback\"in window&&requestIdleCallback(()=>{},{timeout:8e3}),function(){const run=()=>{try{const srcs=Array.from(document.scripts).filter(s=>\"string\"==typeof s.src&&-1!==s.src.indexOf(\"connect.facebook.net\")&&-1!==s.src.indexOf(\"fbevents.js\")).map(s=>s.src);srcs.length>1&&console.warn(\"[Meta Pixel] Multiple fbevents.js scripts detected:\",srcs)}catch(_){}};\"requestIdleCallback\"in window?requestIdleCallback(run,{timeout:4e3}):setTimeout(run,4e3)}(),\"requestIdleCallback\"in window?requestIdleCallback(()=>h2sTrack(\"PageView\"),{timeout:4e3}):setTimeout(()=>h2sTrack(\"PageView\"),2500),performance.mark(\"init-end\"),performance.measure(\"Total Init Time\",\"init-start\",\"init-end\")}catch(err){document.body.classList.add(\"app-ready\")}window.innerWidth\u003C=768&&setupMobileInputHandling()}function setupMobileInputHandling(){document.querySelectorAll(\"input, textarea, select\").forEach(input=>{input.addEventListener(\"focus\",function(e){setTimeout(()=>{e.target.scrollIntoView({behavior:\"smooth\",block:\"center\"})},300)},{passive:!0}),input.addEventListener(\"blur\",function(){setTimeout(()=>{window.scrollTo({top:window.scrollY,behavior:\"smooth\"})},100)},{passive:!0})});let lastTouchEnd=0;document.addEventListener(\"touchend\",function(e){const now=Date.now();now-lastTouchEnd\u003C=300&&([\"INPUT\",\"TEXTAREA\",\"SELECT\"].includes(e.target.tagName)||e.preventDefault()),lastTouchEnd=now},{passive:!1}),logger.log(\"[Mobile] Input handling initialized\")}if(\"loading\"===document.readyState)document.addEventListener(\"DOMContentLoaded\",()=>{try{init()}catch(e){logger.error(\"[Init] Failed:\",e)}});else try{init()}catch(e){logger.error(\"[Init] Failed:\",e)}async function fetchCatalogFromAPI(cacheBust=!1){try{const url=API+\"?action=catalog\"+(cacheBust?\"&cb=\"+Date.now():\"\"),res=await fetch(url,{cache:\"no-store\"});if(!res.ok)return logger.warn(\"[Catalog] HTTP\",res.status),!1;const data=await res.json();return data&&data.ok&&data.catalog?(catalog=data.catalog,!0):(logger.warn(\"[Catalog] Unexpected response while fetching catalog\",data),!1)}catch(err){return logger.warn(\"[Catalog] Fetch failed:\",err),!1}}function route(){const view=getParam(\"view\");if(logger.log(\"[ROUTE] View parameter:\",view),\"shopsuccess\"===view){H2S_unlockScroll();const outlet=byId(\"outlet\");outlet&&(outlet.style.opacity=\"0\",outlet.style.visibility=\"hidden\"),logger.log(\"[ROUTE] Calling renderShopSuccess()...\");try{renderShopSuccess()}catch(err){logger.error(\"[ROUTE] renderShopSuccess failed critically:\",err),outlet&&(outlet.innerHTML='\\n          \u003Cdiv style=\"padding:60px 20px; text-align:center; max-width:600px; margin:0 auto;\">\\n            \u003Cdiv style=\"width:64px; height:64px; background:#10b981; border-radius:50%; display:flex; align-items:center; justify-content:center; margin:0 auto 24px;\">\\n              \u003Csvg width=\"32\" height=\"32\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#ffffff\" stroke-width=\"3\">\\n                \u003Cpolyline points=\"20 6 9 17 4 12\">\u003C/polyline>\\n              \u003C/svg>\\n            \u003C/div>\\n            \u003Ch2 style=\"margin:0 0 16px 0; font-weight:900; font-size:28px; color:#0a2a5a;\">Order Confirmed!\u003C/h2>\\n            \u003Cp style=\"margin:0 0 24px 0; color:#6b778c; font-size:16px;\">Your payment was successful. We\\'ll send confirmation details to your email shortly.\u003C/p>\\n            \u003Cp style=\"margin:0 0 24px 0; color:#6b778c; font-size:16px;\">Our team will contact you within 24 hours to schedule your installation.\u003C/p>\\n            \u003Ca href=\"tel:864-528-1475\" style=\"display:inline-block; padding:14px 28px; background:#1493ff; color:white; border-radius:10px; text-decoration:none; font-weight:700; font-size:16px;\">Call Us: (864) 528-1475\u003C/a>\\n            \u003Cdiv style=\"margin-top:24px;\">\\n              \u003Cbutton onclick=\"navSet({view:null})\" class=\"btn btn-ghost\">Back to Shop\u003C/button>\\n            \u003C/div>\\n          \u003C/div>\\n        ',outlet.style.opacity=\"1\",outlet.style.visibility=\"visible\")}return}if(closeAll(),\"signin\"===view)return void renderSignIn();if(\"signup\"===view)return void renderSignUp();if(\"account\"===view)return void renderAccount();if(\"forgot\"===view)return void renderForgot();if(\"reset\"===view)return void renderReset(getParam(\"token\"));if(\"calreturn\"===view||\"apptreturn\"===view)return void handleCalReturn();const outlet=byId(\"outlet\");if(!outlet)return;if(outlet.querySelector(\".hero\")){outlet.style.opacity=\"1\",outlet.style.transition=\"\",document.body.classList.add(\"app-ready\");const heroReviewsEl=document.getElementById(\"heroReviews\");heroReviewsEl&&heroReviewsEl.querySelector(\".hero-review-slide\")}else renderShop()}function renderShop(){const outlet=byId(\"outlet\");if(!outlet)return;if(outlet.querySelector(\".hero\"))return;const isFirstRender=!window.__shopRenderedOnce;let html=window.shopHTML||\"\";if(!html)return logger.warn(\"[Shop] Static HTML missing, reloading...\"),void location.reload();if(isFirstRender){outlet.style.opacity=\"\",outlet.style.transition=\"\",outlet.innerHTML=html,document.body.classList.add(\"app-ready\");try{initHeroReviews()}catch(e){logger.warn(\"initHeroReviews error\",e)}window.scrollTo(0,0),window.__shopRenderedOnce=!0,renderSigninState()}else outlet.style.opacity=\"0\",outlet.style.transition=\"opacity 0.3s ease\",setTimeout(()=>{outlet.innerHTML=html,requestAnimationFrame(()=>{outlet.style.opacity=\"1\",document.body.classList.add(\"app-ready\")});try{initHeroReviews()}catch(e){logger.warn(\"initHeroReviews error\",e)}renderSigninState(),window.scrollTo(0,0),window.__shopRenderedOnce=!0},300)}function navSet(params){const u=new URL(location.href);Object.entries(params||{}).forEach(([k,v])=>{null==v?u.searchParams.delete(k):u.searchParams.set(k,v)}),history.pushState({},\"\",u.toString()),route()}function getParam(k){return new URL(location.href).searchParams.get(k)}function wireCart(){const acctBtn=byId(\"accountBtn\");acctBtn&&(acctBtn.onclick=()=>{closeAll(),user&&user.email?navSet({view:\"account\"}):navSet({view:\"signin\"})});const bsi=byId(\"bannerSignIn\");bsi&&(bsi.onclick=()=>{closeAll(),navSet({view:user?.email?\"account\":\"signin\"})})}function renderSigninState(){const btn=byId(\"accountBtn\");btn&&(user&&user.email?btn.textContent=\"Account\":btn.textContent=\"Sign in\")}function scrollToSection(id){const el=document.getElementById(id);if(el){const headerHeight=56,offsetPosition=el.getBoundingClientRect().top+window.pageYOffset-headerHeight-16;window.scrollTo({top:offsetPosition,behavior:\"smooth\"})}}function toggleMenu(){const menu=document.getElementById(\"menuDrawer\"),backdrop=document.getElementById(\"backdrop\");if(!menu||!backdrop)return;menu.classList.contains(\"open\")||(menu.style.contentVisibility=\"visible\");menu.classList.contains(\"open\")?(menu.classList.remove(\"open\"),backdrop.classList.remove(\"show\"),document.documentElement.classList.remove(\"modal-open\"),document.body.classList.remove(\"modal-open\"),H2S_unlockScroll(),setTimeout(()=>{menu.classList.contains(\"open\")||(menu.style.contentVisibility=\"hidden\")},300)):(closeAll(),menu.classList.add(\"open\"),backdrop.classList.add(\"show\"),document.documentElement.classList.add(\"modal-open\"),document.body.classList.add(\"modal-open\"))}function toggleCart(){logger.log(\"[Cart] toggleCart() called\");const drawer=document.getElementById(\"cartDrawer\"),backdrop=document.getElementById(\"backdrop\");drawer.classList.contains(\"open\")||(drawer.style.contentVisibility=\"visible\");drawer.classList.contains(\"open\")?(drawer.classList.remove(\"open\"),backdrop.classList.remove(\"show\"),document.documentElement.classList.remove(\"modal-open\"),document.body.classList.remove(\"modal-open\"),H2S_unlockScroll(),setTimeout(()=>{drawer.classList.contains(\"open\")||(drawer.style.contentVisibility=\"hidden\")},300)):(closeAll(),drawer.classList.add(\"open\"),backdrop.classList.add(\"show\"),document.documentElement.classList.add(\"modal-open\"),document.body.classList.add(\"modal-open\"),H2S_lockScroll(),paintCart(),requestAnimationFrame(()=>{const cartBody=drawer.querySelector(\".cart-body\");cartBody&&(cartBody.scrollTop=0,cartBody.style.webkitOverflowScrolling=\"touch\",cartBody.style.overflowY=\"auto\")}))}function closeAll(){const menu=document.getElementById(\"menuDrawer\"),cart=document.getElementById(\"cartDrawer\");menu.classList.remove(\"open\"),cart.classList.remove(\"open\"),document.getElementById(\"backdrop\").classList.remove(\"show\"),H2S_unlockScroll(),setTimeout(()=>{menu.classList.contains(\"open\")||(menu.style.contentVisibility=\"hidden\"),cart.classList.contains(\"open\")||(cart.style.contentVisibility=\"hidden\")},300),closeModal(),safeCloseQuoteModal(),\"function\"==typeof closeTVSizeModal&&closeTVSizeModal(),document.documentElement.classList.remove(\"modal-open\"),document.body.classList.remove(\"modal-open\")}function showModal(){closeAll();byId(\"modal\").classList.add(\"show\"),document.documentElement.classList.add(\"modal-open\"),document.body.classList.add(\"modal-open\")}function closeModal(){const m=byId(\"modal\"),backdrop=byId(\"backdrop\");m.classList.remove(\"show\"),backdrop&&backdrop.classList.remove(\"show\"),byId(\"menuDrawer\")?.classList.contains(\"open\")||byId(\"cartDrawer\")?.classList.contains(\"open\")||(document.documentElement.classList.remove(\"modal-open\"),document.body.classList.remove(\"modal-open\"),H2S_unlockScroll())}function safeRequestQuote(p){\"function\"==typeof window.requestQuote&&window.requestQuote(p)}function safeCloseQuoteModal(){\"function\"==typeof window.closeQuoteModal&&window.closeQuoteModal()}document.addEventListener(\"DOMContentLoaded\",function(){setTimeout(function(){try{window.h2sFbTrack&&window.h2sFbTrack(\"ViewContent\",{content_name:\"Bundles Page\",content_category:\"product_catalog\"})}catch(err){logger.warn(\"[Pixel] ViewContent failed\",err)}},800)}),window.scrollToSection=scrollToSection,window.toggleMenu=toggleMenu,window.toggleCart=toggleCart;let currentPackage=null;function addPackageDirectToCart(id,name,price,metadata={}){const numPrice=Number(price),existing=cart.find(item=>\"package\"===item.type&&item.id===id);if(existing)existing.qty++,Object.keys(metadata).length>0&&(existing.metadata={...existing.metadata,...metadata});else{const newItem={type:\"package\",id:id,name:name,price:numPrice,qty:1,metadata:metadata};cart.push(newItem)}h2sTrack(\"AddToCart\",{product_id:id,product_name:name,quantity:1,price:numPrice,currency:\"USD\",...metadata}),saveCart();const drawer=byId(\"cartDrawer\");logger.log(\"[Cart] Opening cart drawer. Currently open:\",drawer?.classList.contains(\"open\")),drawer&&!drawer.classList.contains(\"open\")?(toggleCart(),logger.log(\"[Cart] Cart drawer toggled open\")):logger.log(\"[Cart] Cart drawer already open\")}function showTVSizeModal(packageId,packageName,packagePrice){let tvCountOptions=[],autoSelectCount=null,quantityLabel=\"How many TVs are you mounting?\";\"tv_single\"===packageId?autoSelectCount=1:\"tv_2pack\"===packageId?autoSelectCount=2:\"tv_multi\"===packageId?(tvCountOptions=[3,4],quantityLabel=\"How many TVs? (Multi-room: 3-4 TVs)\"):(tvCountOptions=[1,2,3,4,5,6,7,8,9,10],quantityLabel=\"How many TVs are you mounting?\");let modal=byId(\"tvSizeModal\");modal&&modal.remove(),modal=document.createElement(\"div\"),modal.id=\"tvSizeModal\",modal.className=\"modal\";const quantitySelectorHTML=autoSelectCount?\"\":`\\n    \\x3c!-- Number of TVs --\\x3e\\n    \u003Cdiv id=\"tvQuantitySelector\" style=\"margin-bottom:24px;\">\\n      \u003Clabel style=\"display:block;font-weight:700;margin-bottom:12px;color:var(--cobalt);font-size:15px;\">\\n        ${quantityLabel}\\n      \u003C/label>\\n      \u003Cdiv style=\"display:flex;gap:8px;flex-wrap:wrap;\">\\n        ${tvCountOptions.map(num=>`\\n          \u003Cbutton type=\"button\" class=\"tv-count-btn\" data-count=\"${num}\" onclick=\"setTVCount(${num})\" style=\"\\n            flex:${tvCountOptions.length\u003C=4?\"1\":\"0 0 calc(25% - 6px)\"};\\n            min-width:60px;\\n            padding:12px;\\n            border:2px solid #e5e7eb;\\n            border-radius:8px;\\n            background:#f9fafb;\\n            font-weight:700;\\n            font-size:16px;\\n            cursor:pointer;\\n            transition:all 0.2s;\\n          \">${num} TV${num>1?\"s\":\"\"}\u003C/button>\\n        `).join(\"\")}\\n      \u003C/div>\\n    \u003C/div>\\n  `;if(modal.innerHTML=`\\n    \u003Cdiv class=\"modal-content\" style=\"max-width: 600px;\">\\n      \u003Cdiv class=\"modal-header\">\\n        \u003Ch3 style=\"margin:0;font-size:20px;font-weight:800;\">Configure Your TV Installation\u003C/h3>\\n        \u003Cbutton class=\"close-btn\" onclick=\"closeTVSizeModal()\" aria-label=\"Close\">&times;\u003C/button>\\n      \u003C/div>\\n      \u003Cdiv class=\"modal-body\" style=\"padding: 32px 24px;\">\\n        \\n        \\x3c!-- STEP 1: Mount Provider Selection --\\x3e\\n        \u003Cdiv id=\"mountProviderSection\" style=\"margin-bottom:24px;\">\\n          \u003Clabel style=\"display:block;font-weight:700;margin-bottom:12px;color:var(--cobalt);font-size:15px;\">\\n            Do you already have TV mounts?\\n          \u003C/label>\\n          \u003Cdiv style=\"display:flex;gap:12px;margin-bottom:12px;\">\\n            \u003Cbutton type=\"button\" class=\"mount-provider-btn\" data-provider=\"h2s\" onclick=\"selectMountProvider('h2s')\" style=\"\\n              flex:1;\\n              padding:16px;\\n              border:2px solid #e5e7eb;\\n              border-radius:8px;\\n              background:#f9fafb;\\n              font-weight:600;\\n              font-size:15px;\\n              cursor:pointer;\\n              transition:all 0.2s;\\n              text-align:left;\\n            \">\\n              \u003Cdiv style=\"font-weight:700;margin-bottom:4px;\">We'll Provide Mounts\u003C/div>\\n              \u003Cdiv style=\"font-size:12px;color:#6b7280;\">Professional-grade mounts included\u003C/div>\\n            \u003C/button>\\n            \u003Cbutton type=\"button\" class=\"mount-provider-btn\" data-provider=\"customer\" onclick=\"selectMountProvider('customer')\" style=\"\\n              flex:1;\\n              padding:16px;\\n              border:2px solid #e5e7eb;\\n              border-radius:8px;\\n              background:#f9fafb;\\n              font-weight:600;\\n              font-size:15px;\\n              cursor:pointer;\\n              transition:all 0.2s;\\n              text-align:left;\\n            \">\\n              \u003Cdiv style=\"font-weight:700;margin-bottom:4px;\">I Have Mounts\u003C/div>\\n              \u003Cdiv style=\"font-size:12px;color:#6b7280;\">Save on mount costs\u003C/div>\\n            \u003C/button>\\n          \u003C/div>\\n          \u003Cdiv style=\"padding:10px;background:#fef3c7;border-left:3px solid #f59e0b;border-radius:4px;font-size:12px;color:#92400e;\">\\n            \u003Cstrong>Important:\u003C/strong> Customer-provided mounts must be compatible with your TV size and wall type. We recommend professional-grade mounts for safety.\\n          \u003C/div>\\n        \u003C/div>\\n        \\n        \\x3c!-- Mount Type Guide (shown only if H2S provides) --\\x3e\\n        \u003Cdiv id=\"mountGuideSection\" style=\"display:none;margin:0 0 16px 0;\">\\n          \u003Cbutton type=\"button\" onclick=\"toggleMountGuide()\" style=\"\\n            width:100%;\\n            padding:12px;\\n            background:#f0f9ff;\\n            border:1px solid #bfdbfe;\\n            border-radius:8px;\\n            font-size:13px;\\n            font-weight:600;\\n            color:#1e40af;\\n            cursor:pointer;\\n            text-align:left;\\n            display:flex;\\n            align-items:center;\\n            justify-content:space-between;\\n            transition:all 0.2s;\\n          \">\\n            \u003Cspan>Mount Selection Guide\u003C/span>\\n            \u003Cspan id=\"guideToggleIcon\" style=\"transition:transform 0.2s;\">\u003C/span>\\n          \u003C/button>\\n          \u003Cdiv id=\"mountGuideContent\" style=\"display:none;padding:12px 0 0 0;color:#4b5563;font-size:13px;line-height:1.6;\">\\n            \u003Cul style=\"margin:0;padding-left:20px;\">\\n              \u003Cli style=\"margin-bottom:6px;\">\u003Cstrong>Fixed/Flat:\u003C/strong> Bedrooms, kids' rooms - sleek, low-profile\u003C/li>\\n              \u003Cli style=\"margin-bottom:6px;\">\u003Cstrong>Tilt:\u003C/strong> Above eye level - reduces glare, neck strain\u003C/li>\\n              \u003Cli style=\"margin-bottom:6px;\">\u003Cstrong>Full Motion:\u003C/strong> Living rooms, open spaces - adjust viewing angle from anywhere\u003C/li>\\n            \u003C/ul>\\n          \u003C/div>\\n        \u003C/div>\\n        \\n        ${quantitySelectorHTML}\\n        \\n        \\x3c!-- TV Configurations Container --\\x3e\\n        \u003Cdiv id=\"tvConfigsContainer\" style=\"display:none;\">\\n          \\x3c!-- Dynamically populated --\\x3e\\n        \u003C/div>\\n      \u003C/div>\\n      \\n      \u003Cdiv class=\"modal-footer\">\\n        \u003Cbutton class=\"btn btn-primary\" id=\"confirmTVSizeBtn\" onclick=\"confirmTVSize()\" disabled style=\"\\n          width:100%;\\n          font-size:16px;\\n          padding:16px;\\n          font-weight:700;\\n          background:linear-gradient(135deg, var(--cobalt) 0%, #1e40af 100%);\\n          border:none;\\n          border-radius:12px;\\n          box-shadow:0 4px 12px rgba(37, 99, 235, 0.25);\\n          transition:all 0.2s ease;\\n        \">\\n          \u003Cspan id=\"confirmBtnText\">Add to Cart\u003C/span>\\n        \u003C/button>\\n      \u003C/div>\\n    \u003C/div>\\n  `,document.body.appendChild(modal),!document.getElementById(\"tvModalStyles\")){const style=document.createElement(\"style\");style.id=\"tvModalStyles\",style.textContent=\"\\n      .tv-count-btn.active {\\n        background: var(--cobalt) !important;\\n        color: white !important;\\n        border-color: var(--cobalt) !important;\\n      }\\n      .tv-count-btn:hover {\\n        border-color: var(--cobalt);\\n        background: #f3f4f6;\\n      }\\n      .mount-provider-btn.active {\\n        background: var(--cobalt) !important;\\n        color: white !important;\\n        border-color: var(--cobalt) !important;\\n      }\\n      .mount-provider-btn:hover {\\n        border-color: var(--cobalt);\\n        background: #f3f4f6;\\n      }\\n      .tv-config-card {\\n        background: #f9fafb;\\n        border: 2px solid #e5e7eb;\\n        border-radius: 12px;\\n        padding: 20px;\\n        margin-bottom: 16px;\\n      }\\n      .tv-config-card select {\\n        width: 100%;\\n        font-size: 14px;\\n        padding: 12px 14px;\\n        border: 2px solid #e5e7eb;\\n        border-radius: 8px;\\n        background: white;\\n        cursor: pointer;\\n        transition: all 0.2s ease;\\n        appearance: none;\\n        background-image: url('data:image/svg+xml;charset=UTF-8,%3csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 24 24%22 fill=%22none%22 stroke=%22%234b5563%22 stroke-width=%222%22 stroke-linecap=%22round%22 stroke-linejoin=%22round%22%3e%3cpolyline points=%226 9 12 15 18 9%22%3e%3c/polyline%3e%3c/svg%3e');\\n        background-repeat: no-repeat;\\n        background-position: right 12px center;\\n        background-size: 18px;\\n        padding-right: 40px;\\n      }\\n      .tv-config-card select:hover {\\n        border-color: var(--cobalt);\\n      }\\n      .tv-config-card select:focus {\\n        outline: none;\\n        border-color: var(--cobalt);\\n        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);\\n      }\\n      .mount-price-badge {\\n        display: inline-block;\\n        background: #22c96f;\\n        color: white;\\n        padding: 4px 12px;\\n        border-radius: 6px;\\n        font-size: 12px;\\n        font-weight: 700;\\n        margin-left: 8px;\\n      }\\n      #confirmTVSizeBtn:hover:not(:disabled) {\\n        transform: translateY(-2px);\\n        box-shadow: 0 6px 16px rgba(37, 99, 235, 0.35);\\n      }\\n      #confirmTVSizeBtn:active:not(:disabled) {\\n        transform: translateY(0);\\n      }\\n      #confirmTVSizeBtn:disabled {\\n        opacity: 0.5;\\n        cursor: not-allowed;\\n      }\\n    \",document.head.appendChild(style)}modal.dataset.packageId=packageId,modal.dataset.packageName=packageName,modal.dataset.packagePrice=packagePrice,modal.dataset.autoSelectCount=autoSelectCount||\"\",modal.tvConfigs=[],modal.tvCount=0,modal.mountProvider=null,modal.classList.add(\"show\");const scrollY=window.scrollY;document.documentElement.classList.add(\"modal-open\"),document.body.classList.add(\"modal-open\"),document.body.style.top=`-${scrollY}px`,modal._savedScrollY=scrollY;const quantitySelector=byId(\"tvQuantitySelector\"),configContainer=byId(\"tvConfigsContainer\");if(quantitySelector&&!autoSelectCount&&(quantitySelector.style.display=\"none\"),configContainer&&(configContainer.style.display=\"none\"),setTimeout(()=>checkModalScroll(),100),\"visualViewport\"in window){const adjustModalForKeyboard=()=>{const modalContent=modal.querySelector(\".modal-content\");if(modalContent){const viewportHeight=window.visualViewport.height;modalContent.style.maxHeight=.85*viewportHeight+\"px\"}};window.visualViewport.addEventListener(\"resize\",adjustModalForKeyboard),modal._keyboardHandler=adjustModalForKeyboard}const escHandler=e=>{\"Escape\"===e.key&&(closeTVSizeModal(),document.removeEventListener(\"keydown\",escHandler))};document.addEventListener(\"keydown\",escHandler);const backdropClickHandler=e=>{\"backdrop\"===e.target.id&&(closeTVSizeModal(),byId(\"backdrop\").removeEventListener(\"click\",backdropClickHandler))};byId(\"backdrop\").addEventListener(\"click\",backdropClickHandler)}window.selectPackage=function(id,name,price){id.includes(\"tv_\")||name.toLowerCase().includes(\"tv\")?showTVSizeModal(id,name,price):addPackageDirectToCart(id,name,price)},window.selectPackage=selectPackage;const MOUNT_PRICING={fixed:0,tilt:25,full_motion:75};function validateTVConfigs(){const modal=byId(\"tvSizeModal\"),confirmBtn=byId(\"confirmTVSizeBtn\"),btnText=byId(\"confirmBtnText\");if(!modal.tvConfigs||0===modal.tvConfigs.length)return confirmBtn.disabled=!0,void(btnText.textContent=\"Add to Cart\");const mountProvider=modal.mountProvider;if(!mountProvider)return confirmBtn.disabled=!0,void(btnText.textContent=\"Select Mount Provider First\");const allConfigured=modal.tvConfigs.every(config=>{const sizeValid=config.size&&\"\"!==config.size,mountValid=\"customer\"===mountProvider||config.mountType&&\"\"!==config.mountType;return sizeValid&&mountValid});if(confirmBtn.disabled=!allConfigured,allConfigured){const packageId=modal.dataset.packageId;let basePrice=parseFloat(modal.dataset.packagePrice);\"tv_multi\"===packageId&&(3===modal.tvConfigs.length?basePrice=699:4===modal.tvConfigs.length&&(basePrice=899));const totalPrice=basePrice+(\"h2s\"===mountProvider?modal.tvConfigs.reduce((sum,config)=>sum+(MOUNT_PRICING[config.mountType]||0),0):0);btnText.textContent=`Add to Cart - $${totalPrice}`}else btnText.textContent=\"Add to Cart\"}function closeTVSizeModal(){const modal=byId(\"tvSizeModal\");if(modal){modal.classList.remove(\"show\"),modal._keyboardHandler&&\"visualViewport\"in window&&window.visualViewport.removeEventListener(\"resize\",modal._keyboardHandler);const scrollY=modal._savedScrollY||0;document.documentElement.classList.remove(\"modal-open\"),document.body.classList.remove(\"modal-open\"),document.body.style.top=\"\",window.scrollTo(0,scrollY)}}function confirmTVSize(){const modal=byId(\"tvSizeModal\"),packageId=modal.dataset.packageId,packageName=modal.dataset.packageName;let basePrice=parseFloat(modal.dataset.packagePrice);const tvConfigs=modal.tvConfigs,mountProvider=modal.mountProvider;if(!mountProvider)return void alert(\"Please select whether you have mounts or need us to provide them\");if(!tvConfigs||0===tvConfigs.length)return void alert(\"Please select number of TVs\");if(!tvConfigs.every(c=>{const sizeValid=c.size&&\"\"!==c.size,mountValid=\"customer\"===mountProvider||c.mountType&&\"\"!==c.mountType;return sizeValid&&mountValid}))return void alert(\"Please configure all TVs (size\"+(\"h2s\"===mountProvider?\" and mount type\":\"\")+\")\");\"tv_multi\"===packageId&&(3===tvConfigs.length?basePrice=699:4===tvConfigs.length&&(basePrice=899));const mountUpcharges=\"h2s\"===mountProvider?tvConfigs.reduce((sum,config)=>sum+(MOUNT_PRICING[config.mountType]||0),0):0,totalPrice=basePrice+mountUpcharges,items=tvConfigs.map((config,idx)=>{let requiresTeam=!1,teamRecommended=!1,teamReason=\"\";\"75-85\"===config.size||\"86+\"===config.size?(requiresTeam=!0,teamReason=`Large TV (${config.size}) - safety requirement`):\"65-74\"===config.size&&(teamRecommended=!0,teamReason=`Heavy TV (${config.size}) - team recommended`);const perTVBase=basePrice/tvConfigs.length,mountUpcharge=\"h2s\"===mountProvider&&MOUNT_PRICING[config.mountType]||0,itemPrice=perTVBase+mountUpcharge;return{bundle_id:packageId,service_name:packageName,qty:1,unit_price:itemPrice,line_total:itemPrice,metadata:{tv_size:config.size,mount_type:config.mountType||\"customer_provided\",mount_provider:mountProvider,mount_upcharge:mountUpcharge,mounts_needed:\"h2s\"===mountProvider?1:0,requires_team:requiresTeam,team_recommended:teamRecommended,team_reason:teamReason,min_team_size:requiresTeam?2:1,tv_number:idx+1,total_tvs:tvConfigs.length}}}),metadata={tv_count:tvConfigs.length,mount_provider:mountProvider,items_json:items,total_mount_upcharges:mountUpcharges,original_price:basePrice,final_price:totalPrice};logger.log(\"[TV Modal] Confirming\",tvConfigs.length,\"TVs with mount provider:\",mountProvider),logger.log(\"[TV Modal] Configs:\",tvConfigs),logger.log(\"[TV Modal] Metadata:\",metadata),logger.log(\"[TV Modal] Items:\",items),closeTVSizeModal(),setTimeout(()=>{addPackageDirectToCart(packageId,packageName,totalPrice,metadata)},100)}function addPackageToCart(){if(!currentPackage)return;const curKey=currentPackage.id||currentPackage.bundle_id,existing=cart.find(item=>{const itemKey=item.id||item.bundle_id;return\"package\"===item.type&&itemKey===curKey});if(existing)existing.qty++;else{const normalized={...currentPackage};!normalized.id&&normalized.bundle_id&&(normalized.id=normalized.bundle_id),!normalized.stripe_price_id&&currentPackage.stripe_price_id&&(normalized.stripe_price_id=currentPackage.stripe_price_id),cart.push({type:\"package\",...normalized,qty:1})}h2sTrack(\"AddToCart\",{product_id:currentPackage.id,product_name:currentPackage.name,quantity:1,price:currentPackage.price,currency:\"USD\"}),saveCart(),closeModal(),toggleCart()}function saveCart(){logger.log(\"[Cart] Saving cart with\",cart.length,\"items:\",cart);try{localStorage.setItem(\"h2s_cart\",JSON.stringify(cart)),logger.log(\"[Cart] Successfully saved to localStorage\")}catch(err){logger.warn(\"Failed to save cart to localStorage (may be in private mode):\",err)}updateCartBadge(),paintCart(),syncCartToUrl()}function loadCart(){try{const raw=localStorage.getItem(\"h2s_cart\");if(logger.log(\"[Cart] Raw localStorage data:\",raw),!raw)return[];const loaded=JSON.parse(raw);if(logger.log(\"[Cart] Parsed cart data:\",loaded),!Array.isArray(loaded))return logger.warn(\"[Cart] Cart data is not an array, returning empty\"),[];const cleaned=loaded.filter(item=>{const hasValidQty=Number(item.qty||0)>0,hasId=!!(item.id||item.service_id||item.bundle_id);return!(!hasValidQty||!hasId)||(logger.warn(\"[Cart] Removing invalid item on load (bad qty or missing id):\",item),!1)});return cleaned.length!==loaded.length&&localStorage.setItem(\"h2s_cart\",JSON.stringify(cleaned)),cleaned}catch(_){return[]}}function updateQuantity(idx,delta){if(!cart[idx])return;const newQty=(Number(cart[idx].qty)||1)+delta;newQty\u003C=0?cart.splice(idx,1):cart[idx].qty=newQty,saveCart()}let heroReviewInterval;window.selectMountProvider=function(provider){const modal=byId(\"tvSizeModal\");modal.mountProvider=provider,document.querySelectorAll(\".mount-provider-btn\").forEach(btn=>{btn.classList.toggle(\"active\",btn.dataset.provider===provider)});const mountGuide=byId(\"mountGuideSection\"),quantitySelector=byId(\"tvQuantitySelector\");\"h2s\"===provider?mountGuide&&(mountGuide.style.display=\"block\"):mountGuide&&(mountGuide.style.display=\"none\");const autoSelectCount=modal.dataset.autoSelectCount;autoSelectCount?setTimeout(()=>setTVCount(parseInt(autoSelectCount)),100):quantitySelector&&(quantitySelector.style.display=\"block\")},window.setTVCount=function(count){const modal=byId(\"tvSizeModal\");modal.tvCount=count;const mountProvider=modal.mountProvider;if(!mountProvider)return void logger.error(\"[TV Modal] setTVCount called before mount provider selected\");modal.tvConfigs=Array(count).fill(null).map(()=>({size:\"\",mountType:\"h2s\"===mountProvider?\"\":\"customer_provided\"})),document.querySelectorAll(\".tv-count-btn\").forEach(btn=>{btn.classList.toggle(\"active\",parseInt(btn.dataset.count)===count)});const container=byId(\"tvConfigsContainer\");container.style.display=\"block\";const tvCards=[];for(let idx=0;idx\u003Ccount;idx++){const mountSection=\"h2s\"===mountProvider?`\u003Cdiv>\\n        \u003Clabel style=\"display:block; font-weight:600; margin-bottom:8px; font-size:13px; color:#374151;\">\\n          Mount Type \u003Cspan style=\"font-weight:400; color:#6b7280;\">(Choose based on room usage)\u003C/span>\\n        \u003C/label>\\n        \u003Cselect id=\"tvMount_${idx}\" onchange=\"updateTVConfig(${idx}, 'mountType', this.value)\">\\n          \u003Coption value=\"\">Select mount type...\u003C/option>\\n          \u003Coption value=\"fixed\">Fixed/Flat - Flush against wall (Bedrooms, kids' rooms)\u003C/option>\\n          \u003Coption value=\"tilt\">Tilt +$25 - Angle down to reduce glare (Above eye level)\u003C/option>\\n          \u003Coption value=\"full_motion\">Full Motion +$75 - Swivel & extend (Living room, open concept)\u003C/option>\\n        \u003C/select>\\n        \u003Cdiv style=\"margin-top:8px; padding:10px; background:#f0f9ff; border-left:3px solid var(--azure); border-radius:4px; font-size:12px; color:#1e40af;\">\\n          \u003Cstrong>Tip:\u003C/strong> Full motion mounts are perfect when you need to adjust viewing angles from different seating areas. Fixed/flat mounts work great for bedrooms where the TV faces one direction.\\n        \u003C/div>\\n      \u003C/div>`:'\u003Cdiv style=\"padding:12px; background:#d1fae5; border-left:3px solid #10b981; border-radius:4px; font-size:13px; color:#065f46;\">\\n        \u003Cstrong>Customer Providing Mount\u003C/strong> - Please ensure your mount is compatible with this TV size and rated for your wall type.\\n      \u003C/div>';tvCards.push(`\\n      \u003Cdiv class=\"tv-config-card\">\\n        \u003Cdiv style=\"font-weight:700; font-size:15px; color:var(--cobalt); margin-bottom:16px; display:flex; align-items:center; gap:8px;\">\\n          \u003Cspan>TV #${idx+1}\u003C/span>\\n          \u003Cspan style=\"font-weight:400; color:#6b7280; font-size:13px;\">(Which room is this TV in?)\u003C/span>\\n        \u003C/div>\\n        \\n        \u003Cdiv style=\"margin-bottom:${\"h2s\"===mountProvider?\"12px\":\"0\"};\">\\n          \u003Clabel style=\"display:block; font-weight:600; margin-bottom:8px; font-size:13px; color:#374151;\">\\n            Screen Size\\n          \u003C/label>\\n          \u003Cselect id=\"tvSize_${idx}\" onchange=\"updateTVConfig(${idx}, 'size', this.value)\">\\n            \u003Coption value=\"\">Select size...\u003C/option>\\n            \u003Coption value=\"32-43\">32\" - 43\"\u003C/option>\\n            \u003Coption value=\"44-54\">44\" - 54\"\u003C/option>\\n            \u003Coption value=\"55-64\">55\" - 64\"\u003C/option>\\n            \u003Coption value=\"65-74\">65\" - 74\"\u003C/option>\\n            \u003Coption value=\"75-85\">75\" - 85\"\u003C/option>\\n            \u003Coption value=\"86+\">86\" and larger\u003C/option>\\n          \u003C/select>\\n        \u003C/div>\\n        \\n        ${mountSection}\\n      \u003C/div>\\n    `)}container.innerHTML=`\\n    \u003Cdiv style=\"margin-top:24px; margin-bottom:24px;\">\\n      ${tvCards.join(\"\")}\\n    \u003C/div>\\n  `,validateTVConfigs(),setTimeout(()=>checkModalScroll(),50)},window.updateTVConfig=function(index,field,value){byId(\"tvSizeModal\").tvConfigs[index][field]=value,validateTVConfigs()},window.toggleMountGuide=function(){const content=byId(\"mountGuideContent\"),icon=byId(\"guideToggleIcon\");if(content&&icon){const isHidden=\"none\"===content.style.display;content.style.display=isHidden?\"block\":\"none\",icon.style.transform=isHidden?\"rotate(180deg)\":\"rotate(0deg)\"}},window.checkModalScroll=function(){const modalBody=document.querySelector(\"#tvSizeModal .modal-body\");if(modalBody){const hasScroll=modalBody.scrollHeight>modalBody.clientHeight;modalBody.classList.toggle(\"has-scroll\",hasScroll)}};let resizeTimeout,currentHeroReviewIndex=0;async function loadHeroReviews(){try{const reviewsUrl=API.replace(\"/shop\",\"/reviews\")+\"?limit=5&onlyVerified=true\",res=await fetch(reviewsUrl,{cache:\"default\"}),data=await res.json();if(data.ok&&data.reviews&&data.reviews.length>0){const newReviews=data.reviews.slice(0,5).map(r=>({text:r.text&&r.text.trim()?r.text.trim():\"\",author:r.name||\"Customer\",stars:r.rating||5})).filter(r=>r.text.length>0);newReviews.length>0&&(heroReviews=newReviews,renderHeroReviews())}}catch(err){}}function renderHeroReviews(){const container=byId(\"heroReviews\");if(!container||0===heroReviews.length)return;const reviewsHTML=heroReviews.map((review,index)=>{const hasText=review.text&&review.text.trim().length>0;return`\\n    \u003Cdiv class=\"hero-review-slide ${index===currentHeroReviewIndex?\"active\":\"\"}\" data-index=\"${index}\">\\n      \u003Cdiv class=\"hero-review-stars\">${\"&#9733;\".repeat(review.stars)}\u003C/div>\\n      ${hasText?`\u003Cdiv class=\"hero-review-text\">\"${review.text}\"\u003C/div>`:\"\"}\\n      \u003Cdiv class=\"hero-review-author\">&mdash; ${review.author}\u003C/div>\\n    \u003C/div>\\n  `}).join(\"\"),dotsHTML=heroReviews.map((_,index)=>`\\n    \u003Cdiv class=\"hero-review-dot ${index===currentHeroReviewIndex?\"active\":\"\"}\" data-index=\"${index}\" onclick=\"goToHeroReview(${index})\">\u003C/div>\\n  `).join(\"\");container.innerHTML=reviewsHTML+`\u003Cdiv class=\"hero-review-dots\">${dotsHTML}\u003C/div>`,container.onclick=()=>{window.location.href=\"https://home2smart.com/reviews\"}}function initHeroReviews(){const container=document.getElementById(\"heroReviews\");container&&container.querySelector(\".hero-review-slide.active\")||renderHeroReviews();const startRotation=()=>{heroReviewInterval&&clearInterval(heroReviewInterval),heroReviewInterval=setInterval(nextHeroReview,5e3)},interactionHandler=()=>{startRotation(),window.removeEventListener(\"pointerdown\",interactionHandler,{passive:!0})};window.addEventListener(\"pointerdown\",interactionHandler,{passive:!0,once:!0}),\"requestIdleCallback\"in window?requestIdleCallback(startRotation,{timeout:5e3}):setTimeout(startRotation,5e3),setTimeout(()=>loadHeroReviews(),6e3)}function nextHeroReview(){currentHeroReviewIndex=(currentHeroReviewIndex+1)%heroReviews.length,showHeroReview(currentHeroReviewIndex)}function goToHeroReview(index){event?.stopPropagation(),currentHeroReviewIndex=index,showHeroReview(index),heroReviewInterval&&clearInterval(heroReviewInterval),heroReviewInterval=setInterval(nextHeroReview,5e3)}function showHeroReview(index){const slides=document.querySelectorAll(\".hero-review-slide\"),dots=document.querySelectorAll(\".hero-review-dot\");slides.forEach((slide,i)=>{slide.classList.toggle(\"active\",i===index)}),dots.forEach((dot,i)=>{dot.classList.toggle(\"active\",i===index)})}function renderReviews(){const track=byId(\"reviewTrack\"),nav=byId(\"reviewNav\");if(!track||!nav)return;if(0===allReviews.length)return void(track.innerHTML='\u003Cp style=\"text-align: center; color: var(--muted); padding: 40px;\">No reviews available\u003C/p>');track.innerHTML=allReviews.map((review,index)=>{const displayName=review.display_name||\"Customer\",initials=displayName.split(\" \").map(n=>n[0]).join(\"\").toUpperCase().slice(0,2),rating=Number(review.rating||5),stars=\"?\".repeat(rating),greyStars=\"?\".repeat(5-rating),escapedName=displayName.replace(/\u003C/g,\"&lt;\").replace(/>/g,\"&gt;\"),escapedText=(review.review_text||\"\").replace(/\u003C/g,\"&lt;\").replace(/>/g,\"&gt;\"),escapedService=(review.services_selected?review.services_selected.split(\",\")[0].trim():\"Smart Home Service\").replace(/\u003C/g,\"&lt;\").replace(/>/g,\"&gt;\");let formattedDate=\"\";if(review.timestamp_iso)try{formattedDate=new Date(review.timestamp_iso).toLocaleDateString(void 0,{month:\"short\",day:\"numeric\",year:\"numeric\"})}catch(e){formattedDate=\"\"}return`\\n      \u003Cdiv class=\"review-card\" data-index=\"${index}\">\\n        \u003Cdiv class=\"review-header\">\\n          \u003Cdiv class=\"review-avatar\">${initials}\u003C/div>\\n          \u003Cdiv class=\"review-meta\">\\n            \u003Cdiv class=\"review-name\">${escapedName}\u003C/div>\\n            \u003Cdiv class=\"review-stars\">${stars}${greyStars}\u003C/div>\\n            ${formattedDate?`\u003Cdiv class=\"review-time\">${formattedDate}\u003C/div>`:\"\"}\\n          \u003C/div>\\n        \u003C/div>\\n        \u003Cp class=\"review-text\">${escapedText}\u003C/p>\\n        \u003Cdiv class=\"review-footer\">\\n          \u003Cdiv class=\"review-service\">${escapedService}\u003C/div>\\n          ${review.verified?'\u003Cdiv class=\"review-verified\">Verified Customer\u003C/div>':\"\"}\\n        \u003C/div>\\n      \u003C/div>\\n    `}).join(\"\");const slidesPerView=window.innerWidth>=1024?3:window.innerWidth>=768?2:1,totalPages=Math.ceil(allReviews.length/slidesPerView);nav.innerHTML=Array.from({length:totalPages},(_,i)=>`\u003Cdiv class=\"review-dot ${0===i?\"active\":\"\"}\" onclick=\"goToReview(${i})\" aria-label=\"Go to page ${i+1}\">\u003C/div>`).join(\"\")}function startCarousel(){reviewInterval&&clearInterval(reviewInterval);const slidesPerView=window.innerWidth>=1024?3:window.innerWidth>=768?2:1,totalPages=Math.ceil(allReviews.length/slidesPerView);if(totalPages\u003C=1)return;reviewInterval=setInterval(()=>{reviewIndex++,reviewIndex>=totalPages&&(reviewIndex=0),updateCarousel()},5e3);const carousel=document.querySelector(\".review-carousel\");carousel&&(carousel.addEventListener(\"mouseenter\",()=>{reviewInterval&&clearInterval(reviewInterval)}),carousel.addEventListener(\"mouseleave\",()=>{startCarousel()}))}function goToReview(pageIndex){reviewIndex=pageIndex,updateCarousel(),startCarousel()}function updateCarousel(){const track=byId(\"reviewTrack\");if(!track||0===allReviews.length)return;const vw=window.innerWidth,slidesPerView=vw>=1024?3:vw>=768?2:1,totalPages=Math.ceil(allReviews.length/slidesPerView),safeIndex=Math.min(reviewIndex,totalPages-1),offset=100*-safeIndex;requestAnimationFrame(()=>{track.style.transform=`translateX(${offset}%)`;document.querySelectorAll(\".review-dot\").forEach((dot,i)=>{const active=i===safeIndex;active!==dot.classList.contains(\"active\")&&dot.classList.toggle(\"active\",active)})})}function encodeCartToUrl(cartItems=cart){return cartItems&&cartItems.length?cartItems.map(item=>{if(\"package\"===item.type)return`pkg:${item.id}*${item.qty}`;return`${item.service_id||\"\"}${item.option_id?`:${item.option_id}`:\"\"}*${item.qty}`}).join(\",\"):\"\"}function decodeCartFromUrl(cartParam){if(!cartParam)return[];return String(cartParam).split(\",\").map(item=>{const parts=item.split(\"*\"),qty=Number(parts[1])||1,servicePart=parts[0];if(servicePart.startsWith(\"pkg:\")){const bundle_id=servicePart.replace(\"pkg:\",\"\"),bundle=catalog.bundles?.find(b=>b.bundle_id===bundle_id);return bundle?{type:\"package\",id:bundle_id,name:bundle.name||bundle_id,price:Number(bundle.bundle_price||0),qty:qty}:(logger.warn(\"[Cart] Bundle not found in catalog:\",bundle_id),null)}const[service_id,option_id]=servicePart.split(\":\");return{service_id:service_id,qty:qty,option_id:option_id||null}}).filter(item=>null!==item&&(item.service_id||item.id))}function syncCartToUrl(){}function saveUser(){try{localStorage.setItem(\"h2s_user\",JSON.stringify(user||{}))}catch(err){logger.warn(\"Failed to save user to localStorage:\",err)}renderSigninState()}function loadUser(){try{return JSON.parse(localStorage.getItem(\"h2s_user\")||\"{}\")}catch(_){return{}}}function updateCartBadge(){const count=cart.reduce((n,l)=>n+Number(l.qty||0),0);byId(\"cartCount\").textContent=count}function cartSubtotal(lines=cart){return lines.reduce((sum,ln)=>\"package\"===ln.type?sum+Number(ln.price||0)*Number(ln.qty||1):sum,0)}function paintCart(){const items=byId(\"cartItems\"),emptyState=byId(\"cartEmpty\"),subtotal=byId(\"cartSubtotal\"),itemCount=byId(\"cartItemCount\");if(!items||!emptyState||!subtotal)return;if(cart&&Array.isArray(cart)||(cart=[]),!cart.length){logger.log(\"[Cart] Cart is empty, showing empty state\"),emptyState.hidden=!1,items.innerHTML=\"\",subtotal.textContent=\"$0.00\";const grandTotal=byId(\"grandTotal\");grandTotal&&(grandTotal.textContent=\"$0.00\");const checkoutBtn=byId(\"checkoutBtn\");return checkoutBtn&&(checkoutBtn.disabled=!0),void(itemCount&&(itemCount.textContent=\"0 items\"))}logger.log(\"[Cart] Rendering\",cart.length,\"items\"),emptyState.hidden=!0;let cartSubtotalVal=0,totalQty=0;items.innerHTML=cart.map((item,idx)=>{const qty=Number(item.qty||1),itemPrice=Number(item.price||0),itemTotal=itemPrice*qty;logger.log(\"[Cart] Rendering item:\",item.name,\"qty:\",qty,\"price:\",itemPrice,\"total:\",itemTotal),cartSubtotalVal+=itemTotal,totalQty+=qty;const metadata=item.metadata||{};let metadataHTML=\"\";if(metadata.items_json&&Array.isArray(metadata.items_json)&&metadata.items_json.length>0){const tvCount=metadata.tv_count||metadata.items_json.length,mountProvider=metadata.items_json[0]?.metadata?.mount_provider||\"h2s\",totalUpcharges=metadata.total_mount_upcharges||0,basePrice=metadata.original_price||itemPrice-totalUpcharges;metadataHTML=`\\n        \u003Cdiv style=\"margin-top:12px;padding:12px;background:#f8f9fb;border-radius:8px;border-left:3px solid var(--cobalt);\">\\n          \u003Cdiv style=\"font-weight:700;color:var(--cobalt);margin-bottom:8px;display:flex;align-items:center;gap:8px;\">\\n            \u003Cspan>${tvCount} TV Installation${tvCount>1?\"s\":\"\"}\u003C/span>\\n            ${\"customer\"===mountProvider?'\u003Cspan style=\"background:#10b981;color:white;padding:2px 8px;border-radius:4px;font-size:11px;\">Customer Mounts\u003C/span>':\"\"}\\n          \u003C/div>\\n          \\n          ${metadata.items_json.map((tvItem,tvIdx)=>{const tvMeta=tvItem.metadata||{},tvSize=tvMeta.tv_size||\"Unknown\",mountType=tvMeta.mount_type||\"fixed\",mountUpcharge=tvMeta.mount_upcharge||0;return`\\n              \u003Cdiv style=\"padding:8px;background:white;border-radius:6px;margin-bottom:6px;border:1px solid #e5e7eb;\">\\n                \u003Cdiv style=\"display:flex;justify-content:space-between;align-items:start;\">\\n                  \u003Cdiv>\\n                    \u003Cdiv style=\"font-weight:600;font-size:13px;color:#111;\">TV #${tvMeta.tv_number||tvIdx+1}\u003C/div>\\n                    \u003Cdiv style=\"font-size:12px;color:#6b7280;margin-top:2px;\">Size: ${tvSize}\"\u003C/div>\\n                    ${\"h2s\"===mountProvider?`\u003Cdiv style=\"font-size:12px;color:#6b7280;\">Mount: ${{fixed:\"Fixed/Flat\",tilt:\"Tilt\",full_motion:\"Full Motion\"}[mountType]||mountType}\u003C/div>`:\"\"}\\n                  \u003C/div>\\n                  ${\"h2s\"===mountProvider&&mountUpcharge>0?`\\n                    \u003Cdiv style=\"text-align:right;\">\\n                      \u003Cdiv style=\"font-size:11px;color:#6b7280;\">Mount upgrade\u003C/div>\\n                      \u003Cdiv style=\"font-weight:600;color:var(--cobalt);font-size:13px;\">+$${mountUpcharge}\u003C/div>\\n                    \u003C/div>\\n                  `:\"\"}\\n                \u003C/div>\\n              \u003C/div>\\n            `}).join(\"\")}\\n          \\n          \u003Cdiv style=\"margin-top:12px;padding-top:10px;border-top:1px solid #e5e7eb;display:flex;justify-content:space-between;font-size:12px;\">\\n            \u003Cdiv style=\"color:#6b7280;\">\\n              ${\"h2s\"===mountProvider?`\\n                \u003Cdiv>Base Package: $${basePrice.toFixed(2)}\u003C/div>\\n                ${totalUpcharges>0?`\u003Cdiv>Mount Upgrades: +$${totalUpcharges.toFixed(2)}\u003C/div>`:\"\"}\\n              `:\"\u003Cdiv>Installation Only (customer mounts)\u003C/div>\"}\\n            \u003C/div>\\n            \u003Cdiv style=\"font-weight:700;color:var(--cobalt);\">Total: $${itemPrice.toFixed(2)}\u003C/div>\\n          \u003C/div>\\n        \u003C/div>\\n      `}else if(metadata.tv_size||metadata.mount_type||metadata.requires_team){if(metadataHTML='\u003Cdiv style=\"margin-top:8px;padding:10px;background:#f8f9fb;border-radius:6px;border-left:3px solid var(--azure);font-size:12px;\">',metadata.tv_size&&(metadataHTML+=`\u003Cdiv style=\"color:var(--cobalt);font-weight:600;margin-bottom:4px;\">TV Size: ${escapeHtml(metadata.tv_size)}\"\u003C/div>`),metadata.mount_type){const mountLabel={fixed:\"Fixed/Flat Mount\",tilt:\"Tilt Mount\",full_motion:\"Full Motion Mount\"}[metadata.mount_type]||metadata.mount_type,mountUpcharge=metadata.mount_upcharge||0;metadataHTML+=`\u003Cdiv style=\"color:#374151;font-weight:500;\">${mountLabel}${mountUpcharge>0?` \u003Cspan style=\"color:var(--cobalt);font-weight:700;\">(+$${mountUpcharge})\u003C/span>`:\"\"}\u003C/div>`}\"customer\"===metadata.mount_provider&&(metadataHTML+='\u003Cdiv style=\"color:#10b981;font-weight:600;margin-top:4px;\">Customer-provided mount\u003C/div>'),metadataHTML+=\"\u003C/div>\"}return`\\n      \u003Cdiv class=\"cart-item\">\\n        \u003Cdiv class=\"cart-item-info\">\\n          \u003Cdiv class=\"cart-item-name\">${escapeHtml(item.name||item.id||\"Item\")}\u003C/div>\\n          \u003Cdiv class=\"cart-item-price\">${money(itemPrice)} each\u003C/div>\\n          ${metadataHTML}\\n          \\n          \u003Cdiv class=\"cart-qty-controls\">\\n            \u003Cbutton \\n              class=\"cart-qty-btn\"\\n              onclick=\"updateQuantity(${idx}, -1)\"\\n              aria-label=\"Decrease quantity\"\\n            >&minus;\u003C/button>\\n            \\n            \u003Cspan class=\"cart-qty-value\">${qty}\u003C/span>\\n            \\n            \u003Cbutton \\n              class=\"cart-qty-btn\"\\n              onclick=\"updateQuantity(${idx}, 1)\"\\n              aria-label=\"Increase quantity\"\\n            >+\u003C/button>\\n          \u003C/div>\\n        \u003C/div>\\n        \\n        \u003Cdiv class=\"cart-item-right\">\\n          \u003Cdiv class=\"cart-item-total\">${money(itemTotal)}\u003C/div>\\n          \u003Cbutton \\n            class=\"cart-remove-btn\"\\n            onclick=\"removeFromCart(${idx})\"\\n          >Remove\u003C/button>\\n        \u003C/div>\\n      \u003C/div>\\n    `}).join(\"\"),subtotal.textContent=money(cartSubtotalVal),itemCount&&(itemCount.textContent=`${totalQty} item${1===totalQty?\"\":\"s\"}`);const rawLine=byId(\"rawSubtotalLine\"),promoLine=byId(\"promoLine\"),totalLabel=byId(\"totalLabel\"),cartSubtotalLine=byId(\"cartSubtotalLine\");cartSubtotalLine&&(cartSubtotalLine.style.display=\"flex\"),rawLine&&(rawLine.style.display=\"none\"),promoLine&&(promoLine.style.display=\"none\"),totalLabel&&(totalLabel.textContent=\"Total\");const grandTotal=byId(\"grandTotal\");grandTotal&&(grandTotal.textContent=money(cartSubtotalVal)),renderSigninState();try{const promoInput=byId(\"promoCode\"),promoBtn=byId(\"applyPromo\"),promoMsg=byId(\"promoMsg\");if(promoInput&&promoMsg){const saved=localStorage.getItem(\"h2s_promo_code\")||\"\";saved&&!promoInput.value&&(promoInput.value=saved,promoMsg.textContent=\"Saved code will be applied at checkout.\",promoMsg.style.color=\"#0b6e0b\")}promoBtn&&(promoBtn.onclick=async()=>{const code=(byId(\"promoCode\")?.value||\"\").trim();if(!code)return void(promoMsg&&(promoMsg.textContent=\"Enter a promo code\",promoMsg.style.color=\"#c33\"));const prev=promoBtn.textContent;promoBtn.disabled=!0,promoBtn.textContent=\"Checking\";try{const baseUrl=API.replace(\"/api/shop\",\"/api/promo_validate\")+\"?code=\"+encodeURIComponent(code);console.log(\" [PROMO] Validating code:\",code),console.log(\" [PROMO] Validation URL:\",baseUrl);const resp=await fetch(baseUrl),data=await resp.json();if(console.log(\" [PROMO] Validation response:\",data),data&&data.ok&&data.valid){if(localStorage.setItem(\"h2s_promo_code\",data.promo?.code||code),promoMsg){const c=data.promo?.coupon||{};let desc=\"\";c.percent_off?desc=`${c.percent_off}% off`:c.amount_off&&(desc=`${money((c.amount_off||0)/100)} off`),promoMsg.textContent=`? Code recognized${desc?`: ${desc}`:\"\"}. Checking cart`,promoMsg.style.color=\"#0b6e0b\"}await updatePromoEstimate()}else localStorage.removeItem(\"h2s_promo_code\"),promoMsg&&(promoMsg.textContent=\"Invalid or expired code\",promoMsg.style.color=\"#c33\")}catch(e){promoMsg&&(promoMsg.textContent=\"Could not validate code. Try again.\",promoMsg.style.color=\"#c33\")}finally{promoBtn.disabled=!1,promoBtn.textContent=prev}})}catch(_){}renderBundlePanel(),queueRenderRecsPanel(),Promise.resolve().then(()=>{try{updatePromoEstimate()}catch(_){}})}async function updatePromoEstimate(){try{const promoLine=byId(\"promoLine\"),promoAmount=byId(\"promoAmount\"),promoMsg=byId(\"promoMsg\"),totalLabel=(byId(\"cartSubtotal\"),byId(\"totalLabel\")),rawLine=byId(\"rawSubtotalLine\"),rawAmount=byId(\"rawSubtotalAmount\");if(!promoLine||!promoAmount)return;totalLabel&&(totalLabel.textContent=\"Subtotal\"),rawLine&&(rawLine.style.display=\"none\");const code=localStorage.getItem(\"h2s_promo_code\")||\"\";if(!code)return void(promoLine.style.display=\"none\");const line_items=(cart||[]).map(item=>{const bundle=\"package\"===item.type||\"bundle\"===item.type?(catalog?.bundles||[]).find(b=>b.bundle_id===(item.bundle_id||item.id)):null,priceId=bundle?.stripe_price_id||item.stripe_price_id||\"custom\";let unitAmount=0;const isDynamic=[\"tv_multi\",\"cam_basic\",\"cam_standard\",\"cam_premium\"].includes(item.id||item.bundle_id);return unitAmount=bundle&&!isDynamic&&void 0!==bundle.bundle_price&&null!==bundle.bundle_price?Math.round(100*Number(bundle.bundle_price)):Math.round(100*Number(item.price||0)),!unitAmount||unitAmount\u003C=0?null:{price:priceId,unit_amount:unitAmount,quantity:item.qty||1}}).filter(Boolean);if(!line_items.length)return void(promoLine.style.display=\"none\");console.log(\" [PROMO] Checking cart with code:\",code,\"line_items:\",line_items);const resp=await fetch(API,{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({__action:\"promo_check_cart\",promotion_code:code,line_items:line_items})}),data=await resp.json();if(console.log(\" [PROMO] Cart check response:\",data),data&&data.ok&&data.applicable&&data.estimate){const savingsCents=Number(data.estimate.savings_cents||0),totalCents=Number(data.estimate.total_cents||0),subtotalCents=Number(data.estimate.subtotal_cents||0);promoAmount.textContent=\"-\"+money(savingsCents/100);const label=byId(\"promoLineLabel\");label&&(label.textContent=`Promo (${(data.promotion_code||code).toUpperCase()})`),promoLine.style.display=\"flex\";const cartSubtotalLine=byId(\"cartSubtotalLine\");cartSubtotalLine&&(cartSubtotalLine.style.display=\"none\"),rawLine&&rawAmount&&(rawAmount.textContent=money(subtotalCents/100),rawLine.style.display=\"flex\");const grandTotal=byId(\"grandTotal\");grandTotal&&(grandTotal.textContent=money(totalCents/100),0===totalCents?(grandTotal.style.color=\"#10b981\",grandTotal.style.fontSize=\"20px\"):(grandTotal.style.color=\"\",grandTotal.style.fontSize=\"\")),totalLabel&&(totalLabel.textContent=\"Grand Total\"),promoMsg&&(promoMsg.textContent=\"Code will apply at checkout.\",promoMsg.style.color=\"#0b6e0b\")}else{const cartSubtotalLine=byId(\"cartSubtotalLine\");cartSubtotalLine&&(cartSubtotalLine.style.display=\"flex\"),promoLine.style.display=\"none\",rawLine&&(rawLine.style.display=\"none\");const cartSubtotal=byId(\"cartSubtotal\"),grandTotal=byId(\"grandTotal\");cartSubtotal&&grandTotal&&(grandTotal.textContent=cartSubtotal.textContent,grandTotal.style.color=\"\",grandTotal.style.fontSize=\"\"),totalLabel&&(totalLabel.textContent=\"Total\"),promoMsg&&(promoMsg.textContent=\"This code does not apply to your current items.\",promoMsg.style.color=\"#c33\")}}catch(_){const promoLine=byId(\"promoLine\");promoLine&&(promoLine.style.display=\"none\");const rawLine=byId(\"rawSubtotalLine\");rawLine&&(rawLine.style.display=\"none\")}}function removeFromCart(idx){logger.log(\"[Cart] Removing item at index:\",idx);try{cart.splice(idx,1),saveCart()}catch(e){logger.error(\"[Cart] Error removing item:\",e)}}async function loadAIRecommendations(){if(user&&user.email)try{const res=await fetch(`${API}?action=ai_sales&email=${encodeURIComponent(user.email)}&mode=recommendations`),data=await res.json();if(!data.success||!data.ai_analysis||!data.ai_analysis.recommendations)return;const recs=data.ai_analysis.recommendations.slice(0,3);if(0===recs.length)return;renderAIRecommendations(recs)}catch(err){logger.error(\"Failed to load AI recommendations:\",err)}}function renderAIRecommendations(recs){const panel=byId(\"aiRecommendationsPanel\"),container=byId(\"aiRecommendations\");if(!panel||!container)return;const html=recs.map(rec=>{const service=rec.service||rec.title||\"Recommended Service\",reason=rec.thought_spark||rec.reason||\"\",price=rec.price||0;return`\\n      \u003Cdiv class=\"ai-rec-card\">\\n        \u003Cdiv class=\"ai-rec-name\">${escapeHtml(service)}\u003C/div>\\n        \u003Cdiv class=\"ai-rec-reason\">\"${escapeHtml(reason)}\"\u003C/div>\\n        ${price>0?`\u003Cdiv class=\"ai-rec-price\" style=\"margin-top:8px;font-size:14px;color:var(--muted);\">Starting at ${money(price)}\u003C/div>`:\"\"}\\n      \u003C/div>\\n    `}).join(\"\");container.innerHTML=html,panel.style.display=\"block\"}function bundlesMatchingCart(){const rec=[],bundles=(catalog.bundles||[]).filter(b=>!1!==b.active);for(const b of bundles){const plan=calcBundlePlan(b);plan&&plan.savings>0&&rec.push(plan)}return rec.sort((a,b)=>b.savings-a.savings),rec}function calcBundlePlan(bundle){const recipe=(catalog.bundleItems||[]).filter(it=>String(it.bundle_id)===String(bundle.bundle_id));if(!recipe.length)return null;const use={};for(const item of recipe){const need=Number(item.required_qty||0),have=cart.find(l=>!l.type&&String(l.service_id)===String(item.service_id));if(!have||Number(have.qty||0)\u003Cneed)return null;use[item.service_id]=need}let requiredCost=0;for(const item of recipe){const tier=pickTier(item.service_id,Number(item.required_qty||0),null)||pickTier(item.service_id,1,null);requiredCost+=(tier?Number(tier.unit||0):0)*Number(item.required_qty||0)}const bundlePrice=Number(bundle.bundle_price||0),savings=Math.max(0,requiredCost-bundlePrice),serviceMap=indexBy(catalog.services||[],\"service_id\"),lineList=recipe.map(r=>{const s=serviceMap[r.service_id];return`${Number(r.required_qty||0)} ?&mdash; ${s&&s.name?s.name:r.service_id}`});return{bundle_id:bundle.bundle_id,name:bundle.name||bundle.bundle_id,image_url:bundle.image_url||\"\",savings:savings,requiredCost:requiredCost,bundlePrice:bundlePrice,use:use,recipeList:lineList}}function applyBundleSwap(bundle_id){const plan=bundlesMatchingCart().find(p=>p.bundle_id===bundle_id);if(!plan)return;Object.entries(plan.use).forEach(([sid,reqQty])=>{const ln=cart.find(l=>!l.type&&l.service_id===sid);ln&&(ln.qty=Math.max(0,Number(ln.qty||0)-Number(reqQty||0)))}),cart=cart.filter(l=>!(!l.type&&0===Number(l.qty||0)));const existing=cart.find(l=>\"bundle\"===l.type&&l.bundle_id===bundle_id);if(existing)existing.qty+=1;else{const bundleData=catalog.bundles?.find(b=>b.bundle_id===bundle_id);cart.push({type:\"bundle\",bundle_id:bundle_id,qty:1,name:bundleData?.title||bundleData?.name||bundle_id,price:bundleData?.price||0,stripe_price_id:bundleData?.stripe_price_id})}saveCart()}function renderBundlePanel(){const panel=byId(\"bundlePanel\");if(!panel)return;const suggestions=bundlesMatchingCart();if(!suggestions.length)return panel.style.display=\"none\",void(panel.innerHTML=\"\");panel.style.display=\"\",panel.innerHTML=suggestions.map(p=>`\\n    \u003Cdiv class=\"bundle-card\">\\n      \u003Cdiv class=\"b-head\">\\n        \u003Cdiv class=\"b-name\">${escapeHtml(p.name)}\u003C/div>\\n        \u003Cdiv class=\"b-save\">Save ${money(p.savings)}\u003C/div>\\n      \u003C/div>\\n      \u003Cdiv class=\"b-list\">${p.recipeList.map(escapeHtml).join(\" &bull; \")}\u003C/div>\\n      \u003Cdiv class=\"b-actions\">\\n        \u003Cbutton class=\"btn btn-primary\" data-apply=\"${p.bundle_id}\">Swap & Save\u003C/button>\\n      \u003C/div>\\n    \u003C/div>\\n  `).join(\"\"),panel.querySelectorAll(\"[data-apply]\").forEach(btn=>{btn.onclick=()=>applyBundleSwap(btn.getAttribute(\"data-apply\"))})}function showCheckoutError(msg){const errorDiv=byId(\"checkoutError\"),errorMsg=byId(\"checkoutErrorMsg\"),dismissBtn=byId(\"dismissError\");errorDiv&&errorMsg&&(errorMsg.textContent=msg,errorDiv.hidden=!1,dismissBtn&&(dismissBtn.onclick=()=>errorDiv.hidden=!0),setTimeout(()=>errorDiv.hidden=!0,8e3))}function escapeAttr(text){return text?String(text).replace(/\"/g,\"&quot;\").replace(/'/g,\"&#39;\"):\"\"}function showMsg(elId,txt,isError=!0){const el=document.getElementById(elId);el&&(el.textContent=txt,el.style.color=isError?\"#d32f2f\":\"#2e7d32\")}function showCheckoutModal(){const modal=document.getElementById(\"modal\"),backdrop=document.getElementById(\"backdrop\");if(!modal||!backdrop)return void logger.error(\"Modal elements missing!\");const cartDrawer=document.getElementById(\"cartDrawer\");cartDrawer&&cartDrawer.classList.contains(\"open\")&&cartDrawer.classList.remove(\"open\");const preName=user?.name||\"\",preEmail=user?.email||\"\",prePhone=user?.phone||\"\";let preAddress=\"\",preCity=\"\",preZip=\"\";try{const pending=JSON.parse(sessionStorage.getItem(\"h2s_pending_account\")||\"{}\");pending.address&&(preAddress=pending.address),pending.city&&(preCity=pending.city),pending.zip&&(preZip=pending.zip)}catch(e){}const html=`\\n    \u003Cdiv style=\"padding: 24px; max-width: 500px; margin: 0 auto;\">\\n      \u003Ch2 style=\"margin-top:0; color:var(--cobalt); font-weight:900; font-size:24px;\">Complete Your Order\u003C/h2>\\n      \u003Cp style=\"color:var(--muted); margin-bottom:20px; font-size:14px;\">Enter your details to finalize checkout and schedule installation.\u003C/p>\\n      \\n      \u003Cform id=\"checkoutForm\" onsubmit=\"handleCheckoutSubmit(event)\">\\n        \u003Cdiv style=\"margin-bottom:12px;\">\\n          \u003Clabel style=\"display:block; font-weight:600; font-size:14px; margin-bottom:4px; color:var(--ink);\">Full Name\u003C/label>\\n          \u003Cinput type=\"text\" id=\"coName\" class=\"inp\" required value=\"${escapeAttr(preName)}\" placeholder=\"Jane Doe\" style=\"width:100%\">\\n        \u003C/div>\\n        \\n        \u003Cdiv style=\"margin-bottom:12px;\">\\n          \u003Clabel style=\"display:block; font-weight:600; font-size:14px; margin-bottom:4px; color:var(--ink);\">Email Address\u003C/label>\\n          \u003Cinput type=\"email\" id=\"coEmail\" class=\"inp\" required value=\"${escapeAttr(preEmail)}\" placeholder=\"jane@example.com\" style=\"width:100%\">\\n        \u003C/div>\\n        \\n        \u003Cdiv style=\"margin-bottom:12px;\">\\n          \u003Clabel style=\"display:block; font-weight:600; font-size:14px; margin-bottom:4px; color:var(--ink);\">Phone Number\u003C/label>\\n          \u003Cinput type=\"tel\" id=\"coPhone\" class=\"inp\" required value=\"${escapeAttr(prePhone)}\" placeholder=\"(864) 528-1475\" style=\"width:100%\">\\n        \u003C/div>\\n        \\n        \u003Cdiv style=\"margin-bottom:12px;\">\\n          \u003Clabel style=\"display:block; font-weight:600; font-size:14px; margin-bottom:4px; color:var(--ink);\">Service Address\u003C/label>\\n          \u003Cinput type=\"text\" id=\"coAddress\" class=\"inp\" required value=\"${escapeAttr(preAddress)}\" placeholder=\"123 Main St\" style=\"width:100%\">\\n        \u003C/div>\\n        \\n        \u003Cdiv style=\"display:grid; grid-template-columns: 2fr 1fr; gap:12px; margin-bottom:20px;\">\\n          \u003Cdiv>\\n            \u003Clabel style=\"display:block; font-weight:600; font-size:14px; margin-bottom:4px; color:var(--ink);\">City\u003C/label>\\n            \u003Cinput type=\"text\" id=\"coCity\" class=\"inp\" required value=\"${escapeAttr(preCity)}\" placeholder=\"Greenville\" style=\"width:100%\">\\n          \u003C/div>\\n          \u003Cdiv>\\n            \u003Clabel style=\"display:block; font-weight:600; font-size:14px; margin-bottom:4px; color:var(--ink);\">Zip\u003C/label>\\n            \u003Cinput type=\"text\" id=\"coZip\" class=\"inp\" required value=\"${escapeAttr(preZip)}\" placeholder=\"29601\" style=\"width:100%\">\\n          \u003C/div>\\n        \u003C/div>\\n\\n        \u003Cdiv id=\"coError\" style=\"color:#d32f2f; font-size:14px; margin-bottom:12px; display:none; background:#fee; padding:8px; border-radius:4px;\">\u003C/div>\\n\\n        \u003Cdiv style=\"display:flex; gap:10px;\">\\n          \u003Cbutton type=\"button\" class=\"btn btn-ghost\" onclick=\"closeModal()\" style=\"flex:1;\">Cancel\u003C/button>\\n          \u003Cbutton type=\"submit\" class=\"btn btn-primary\" id=\"coSubmitBtn\" style=\"flex:2;\">Proceed to Payment\u003C/button>\\n        \u003C/div>\\n      \u003C/form>\\n    \u003C/div>\\n  `,modalContent=modal.querySelector(\".modal-content\");modalContent?modalContent.innerHTML=html:modal.innerHTML=`\u003Cdiv class=\"modal-content\">${html}\u003C/div>`,modal.classList.add(\"show\"),backdrop.classList.add(\"show\"),document.documentElement.classList.add(\"modal-open\"),document.body.classList.add(\"modal-open\"),H2S_lockScroll(),setTimeout(()=>{document.getElementById(\"coName\").value?document.getElementById(\"coAddress\").value||document.getElementById(\"coAddress\").focus():document.getElementById(\"coName\").focus()},100)}function showCheckoutError(msg){const el=document.getElementById(\"cartMsg\"),btn=document.getElementById(\"checkoutBtn\");el&&(el.textContent=msg,el.style.color=\"#d32f2f\"),btn&&(btn.disabled=!1,btn.textContent=\"Checkout\"),alert(msg)}async function loadOrders(){const box=byId(\"ordersBox\");if(box)try{const res=await fetch(API+\"?action=orders&email=\"+encodeURIComponent(user.email)),data=await res.json(),orders=Array.isArray(data.orders)?data.orders:[];if(!orders.length)return void(box.innerHTML='\u003Cdiv class=\"help\">No orders yet.\u003C/div>');orders.sort((a,b)=>new Date(b.created_at||0)-new Date(a.created_at||0)),box.innerHTML=orders.map(o=>{const oid=o.order_id||o.stripe_session_id||\"\";let itemsHTML=\"\";try{let itemsData=null;if(o.items)if(Array.isArray(o.items))itemsData=o.items;else if(\"string\"==typeof o.items)try{itemsData=JSON.parse(o.items)}catch(e){}if(!itemsData&&o.order_summary&&\"string\"==typeof o.order_summary&&o.order_summary.trim().startsWith(\"[\"))try{itemsData=JSON.parse(o.order_summary)}catch(e){}Array.isArray(itemsData)&&itemsData.length>0?itemsHTML=itemsData.map(item=>{const name=item.service_name||item.name||item.description||item.bundle_id||item.service_id||\"Service\",qty=item.qty||item.quantity||1,price=item.unit_price||item.price||0;return`${qty} ${escapeHtml(name)}  ${money(price)}`}).join(\"\u003Cbr>\"):!o.order_summary||\"string\"==typeof o.order_summary&&o.order_summary.trim().startsWith(\"[\")||(itemsHTML=escapeHtml(o.order_summary))}catch(e){console.error(\"Error rendering items:\",e)}itemsHTML||(itemsHTML=\"Items unavailable\");let dateHTML=\"\";if(o.install_at||o.delivery_date||o.service_date){const dateValue=o.install_at||o.delivery_date||o.service_date;try{const dt=new Date(dateValue);if(isNaN(dt.getTime()))dateHTML=escapeHtml(String(dateValue));else{const options={month:\"short\",day:\"numeric\",year:\"numeric\"};dateHTML=dt.toLocaleDateString(\"en-US\",options),o.delivery_time&&(dateHTML+=`  ${escapeHtml(o.delivery_time)}`)}}catch(e){dateHTML=escapeHtml(String(dateValue))}}let actionHTML=\"\";dateHTML?actionHTML=`\u003Cbutton class=\"btn btn-sm ghost\" onclick=\"rescheduleOrder('${escapeHtml(oid)}', '${escapeHtml(o.delivery_date||\"\")}', '${escapeHtml(o.delivery_time||\"\")}')\">Reschedule\u003C/button>`:(actionHTML=`\u003Cbutton class=\"btn btn-sm azure\" onclick=\"scheduleOrder('${escapeHtml(oid)}')\">Schedule Now\u003C/button>`,dateHTML='\u003Cspan style=\"color:#94a3b8\">Not scheduled\u003C/span>');const total=Number(o.order_total)||0;return`\\n        \u003Cdiv class=\"pd-box\" style=\"margin-bottom:10px\">\\n          \u003Cdiv class=\"details-grid\">\\n            \u003Cdiv class=\"row\">\u003Cdiv class=\"k\">Order ID\u003C/div>\u003Cdiv class=\"v\">${escapeHtml(String(oid))}\u003C/div>\u003C/div>\\n            \u003Cdiv class=\"row\">\u003Cdiv class=\"k\">Total\u003C/div>\u003Cdiv class=\"v\">${money(total)}\u003C/div>\u003C/div>\\n            \u003Cdiv class=\"row\">\u003Cdiv class=\"k\">Items\u003C/div>\u003Cdiv class=\"v\">${itemsHTML}\u003C/div>\u003C/div>\\n            \u003Cdiv class=\"row\">\u003Cdiv class=\"k\">Service date\u003C/div>\u003Cdiv class=\"v\">${dateHTML}\u003C/div>\u003C/div>\\n            \u003Cdiv class=\"row\">\u003Cdiv class=\"k\">Actions\u003C/div>\u003Cdiv class=\"v\">${actionHTML}\u003C/div>\u003C/div>\\n          \u003C/div>\\n        \u003C/div>\\n      `}).join(\"\")}catch(e){box.innerHTML='\u003Cdiv class=\"help\">Could not load orders.\u003C/div>'}}heroReviews=[{text:\"Professional, on-time, and clean installation.\",author:\"Recent Customer\",stars:5},{text:\"Had 4 cameras installed. The app setup was seamless and now I have total peace of mind.\",author:\"Mike T.\",stars:5},{text:\"Quick, clean, professional. They hid all the wires perfectly. Looks like it came with the house!\",author:\"Jennifer L.\",stars:5},{text:\"Same-day service saved me! TV mounted and streaming setup done in under an hour.\",author:\"David R.\",stars:5},{text:\"The whole-home security package was a game changer. Professional install, great support.\",author:\"Amanda K.\",stars:5}],window.addEventListener(\"resize\",()=>{clearTimeout(resizeTimeout),resizeTimeout=setTimeout(()=>{allReviews.length>0&&updateCarousel()},100)}),window.checkout=function(){if(logger.log(\"[Checkout] Starting checkout flow...\"),!cart||0===cart.length)return void alert(\"Your cart is empty.\");const cartValue=cart.reduce((sum,item)=>sum+(item.price||0)*(item.qty||1),0),cartItems=cart.map(item=>({product_id:item.id||item.service_id||item.bundle_id,product_name:item.name||item.service_name,quantity:item.qty||1,price:item.price||item.unit_price||0}));h2sTrack(\"InitiateCheckout\",{value:cartValue,currency:\"USD\",num_items:cart.length,items:cartItems,customer_email:user?.email||null,customer_phone:user?.phone||null}),showCheckoutModal()},window.handleCheckoutSubmit=async function(e){e.preventDefault();const btn=document.getElementById(\"coSubmitBtn\"),errEl=document.getElementById(\"coError\"),name=document.getElementById(\"coName\").value.trim(),email=document.getElementById(\"coEmail\").value.trim(),phone=document.getElementById(\"coPhone\").value.trim(),address=document.getElementById(\"coAddress\").value.trim(),city=document.getElementById(\"coCity\").value.trim(),zip=document.getElementById(\"coZip\").value.trim();if(!(name&&email&&phone&&address&&city&&zip))return void(errEl&&(errEl.textContent=\"Please fill in all fields.\",errEl.style.display=\"block\"));if(!/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(email))return void(errEl&&(errEl.textContent=\"Please enter a valid email address.\",errEl.style.display=\"block\"));if(!cart||0===cart.length)return void(errEl&&(errEl.textContent=\"Your cart is empty. Please add items first.\",errEl.style.display=\"block\"));btn&&(btn.disabled=!0,btn.innerHTML='\u003Cspan class=\"spinner\">\u003C/span> Processing...'),errEl&&(errEl.style.display=\"none\");let attempt=0;for(;attempt\u003C3;){attempt++,logger.log(`[Checkout] Attempt ${attempt}/3`);try{const promoCode=localStorage.getItem(\"h2s_promo_code\"),cart_items=cart.map(item=>({name:item.name||item.service_name||item.id,qty:item.qty||1,price:Math.round(100*(item.price||item.unit_price||0)),metadata:item.metadata||{}})),payload={__action:\"create_checkout_session\",customer:{name:name,email:email,phone:phone},cart:cart,source:\"shop_rebuilt\",success_url:\"https://home2smart.com/bundles?view=shopsuccess&session_id={CHECKOUT_SESSION_ID}\",cancel_url:window.location.href,metadata:{customer_name:name,customer_phone:phone,customer_email:email,service_address:address,service_city:city,service_zip:zip,source:\"shop_rebuilt\",cart_items:JSON.stringify(cart_items)}};promoCode&&(payload.promotion_code=promoCode),logger.log(\"[Checkout] Sending payload:\",payload);const controller=new AbortController,timeoutId=setTimeout(()=>controller.abort(),15e3),res=await fetch(API,{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify(payload),signal:controller.signal});let data;clearTimeout(timeoutId);const contentType=res.headers.get(\"content-type\");if(!contentType||!contentType.includes(\"application/json\")){const text=await res.text();throw new Error(`Server returned non-JSON response: ${text.substring(0,100)}`)}if(data=await res.json(),!res.ok||!data.ok)throw new Error(data.error||data.message||`Server error: ${res.status}`);if(!data.pay||!data.pay.session_url)throw new Error(\"No Stripe session URL in response\");try{localStorage.setItem(\"h2s_guest_checkout\",JSON.stringify({name:name,email:email,phone:phone,address:address,city:city,zip:zip})),user.email||(user={name:name,email:email,phone:phone},saveUser())}catch(e){logger.warn(\"[Checkout] Could not save user data:\",e)}try{window.h2sTrack&&h2sTrack(\"InitiateCheckout\",{value:cart.reduce((sum,item)=>sum+item.price*item.qty,0),currency:\"USD\",num_items:cart.length})}catch(e){logger.warn(\"[Checkout] Tracking failed (non-blocking):\",e)}try{const checkoutData={session_id:data.pay.session_id||data.pay.session_url.split(\"session_id=\")[1]||\"\",timestamp:Date.now(),cart_count:cart.length,customer_email:email};localStorage.setItem(\"h2s_last_checkout\",JSON.stringify(checkoutData)),logger.log(\"[Checkout] Session persisted for recovery\")}catch(e){logger.warn(\"[Checkout] Could not persist session (non-blocking):\",e)}H2S_unlockScroll(),document.documentElement.classList.remove(\"modal-open\"),document.body.classList.remove(\"modal-open\"),logger.log(\"[Checkout]  Success! Redirecting to:\",data.pay.session_url);try{window.location.href=data.pay.session_url}catch(e){window.location.assign(data.pay.session_url)}return}catch(err){if(logger.error(`[Checkout] Attempt ${attempt} failed:`,err),console.error(\" [CHECKOUT DEBUG]  Checkout attempt\",attempt,\"failed\"),console.error(\" [CHECKOUT DEBUG] Error:\",err),console.error(\" [CHECKOUT DEBUG] Error name:\",err.name),console.error(\" [CHECKOUT DEBUG] Error message:\",err.message),err.stack&&console.error(\" [CHECKOUT DEBUG] Error stack:\",err.stack),attempt>=3){const errorMsg=\"AbortError\"===err.name?\"Request timed out. Please check your connection and try again.\":`Checkout failed: ${err.message}`;return errEl&&(errEl.textContent=errorMsg,errEl.style.display=\"block\"),btn&&(btn.disabled=!1,btn.textContent=\"Proceed to Payment\"),void alert(\"Unable to process checkout. Please try again or contact support at (864) 528-1475.\")}const delay=1e3*Math.pow(2,attempt-1);logger.log(`[Checkout] Retrying in ${delay}ms...`),btn&&(btn.innerHTML='\u003Cspan class=\"spinner\">\u003C/span> Retrying...'),await new Promise(resolve=>setTimeout(resolve,delay))}}},window.__runDiagnoseCheckout=async function(){const errEl=document.getElementById(\"coError\")||document.getElementById(\"cartMsg\"),showErr=msg=>{errEl&&(errEl.textContent=msg,errEl.style.display=\"block\"),logger.error(\"[Diagnose] \"+msg)};if(!Array.isArray(cart)||0===cart.length)return showErr(\"Cart is empty. Add at least one item.\");try{const line_items=cart.map(item=>{let priceId=item.stripe_price_id;if(!priceId&&(\"package\"===item.type||\"bundle\"===item.type)){const id=item.id||item.bundle_id,b=catalog?.bundles?.find(x=>x.bundle_id===id);b&&(priceId=b.stripe_price_id)}if(!priceId&&item.service_id&&catalog?.priceTiers){const qty=Number(item.qty||1),tier=catalog.priceTiers.filter(t=>t.service_id===item.service_id).find(t=>{const min=Number(t.min_qty||0),max=\"\"===t.max_qty||null==t.max_qty?1/0:Number(t.max_qty);return qty>=min&&qty\u003C=max});tier&&(priceId=tier.stripe_price_id)}return priceId?{price:priceId,quantity:item.qty||1}:(logger.warn(\"[Diagnose] Missing price ID for item:\",item),null)}).filter(Boolean);if(0===line_items.length)return showErr(\"No valid Stripe price IDs found for cart items.\");const payload={__action:\"create_checkout_session\",line_items:line_items,customer_email:user?.email||\"guest@example.com\",success_url:\"https://home2smart.com/bundles?view=shopsuccess&session_id={CHECKOUT_SESSION_ID}\",cancel_url:window.location.href,metadata:{source:\"shop_rebuilt_diagnose\"},diagnose:!0};logger.log(\"[Diagnose] Payload preview:\",payload);const res=await fetch(API,{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify(payload)}),text=await res.text();let data={};try{data=JSON.parse(text)}catch(e){logger.warn(\"[Diagnose] Non-JSON response:\",text)}if(logger.log(\"[Diagnose] Response status:\",res.status),logger.log(\"[Diagnose] Response body:\",data.ok?data:text),!res.ok)return showErr(\"Backend HTTP error \"+res.status+\". Body: \"+(text||\"\"));if(!data.ok)return showErr(\"Backend returned error: \"+(data.error||\"Unknown error\"));if(!data.pay||!data.pay.session_url)return showErr(\"No session_url from backend. Check Stripe session creation.\");logger.log(\"? Diagnose OK. session_url:\",data.pay.session_url),errEl&&(errEl.style.display=\"none\")}catch(err){showErr(\"Diagnose failed: \"+err.message)}},window.renderShopSuccess=async function(){try{logger.log(\"[renderShopSuccess] Function called\");const isMobile=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)||window.innerWidth\u003C=768;logger.log(\"[renderShopSuccess] Mobile detected:\",isMobile),isMobile&&(logger.log(\"[renderShopSuccess] Preparing mobile viewport...\"),window.scrollTo(0,0),document.body.style.overflow=\"auto\",document.body.style.height=\"auto\",document.documentElement.style.overflow=\"auto\",document.body.style.position=\"\",document.body.style.width=\"\",document.body.style.top=\"\");const params=new URL(location.href).searchParams,sessionId=params.get(\"session_id\")||params.get(\"stripe_session_id\")||\"\";if(logger.log(\"[renderShopSuccess] Session ID:\",sessionId),cart&&cart.length>0&&(logger.log(\"[renderShopSuccess] Clearing cart immediately (had\",cart.length,\"items)\"),cart=[],saveCart(),localStorage.removeItem(\"h2s_checkout_snapshot\")),!sessionId){logger.warn(\"[renderShopSuccess] No session_id in URL. Checking for recent checkout...\");try{const recentCheckout=JSON.parse(localStorage.getItem(\"h2s_last_checkout\")||\"{}\");if(Date.now()-(recentCheckout.timestamp||0)\u003C3e5&&recentCheckout.session_id)return logger.log(\"[renderShopSuccess] Recovered session from localStorage:\",recentCheckout.session_id),void(window.location.href=`${window.location.origin}${window.location.pathname}?view=shopsuccess&session_id=${recentCheckout.session_id}`)}catch(e){logger.warn(\"[renderShopSuccess] Could not recover session:\",e)}logger.warn(\"[renderShopSuccess] No session ID available. Showing generic success page.\")}let order={order_id:params.get(\"order_id\")||sessionId||\"N/A\",stripe_session_id:sessionId,order_total:params.get(\"order_total\")||\"\",order_currency:params.get(\"order_currency\")||\"USD\",order_item_count:params.get(\"order_item_count\")||\"\",order_summary:params.get(\"order_summary\")||\"\",order_discount_code:params.get(\"order_discount_code\")||\"\"};const displayOrderId=order.order_id,shortOrderId=displayOrderId.length>20?displayOrderId.substring(0,20)+\"...\":displayOrderId,prettyTotal=order.order_total?money(Number(order.order_total)):\"Loading...\",outlet=byId(\"outlet\");outlet.innerHTML=`\\n    \u003Csection class=\"form\" style=\"max-width: 720px; margin: 60px auto 40px;\">\\n      \\x3c!-- Success Header --\\x3e\\n      \u003Cdiv style=\"text-align: center; margin-bottom: 32px;\">\\n        \u003Cdiv style=\"width: 64px; height: 64px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 16px; box-shadow: 0 4px 16px rgba(16, 185, 129, 0.3);\">\\n          \u003Csvg width=\"32\" height=\"32\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#ffffff\" stroke-width=\"3\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\\n            \u003Cpolyline points=\"20 6 9 17 4 12\">\u003C/polyline>\\n          \u003C/svg>\\n        \u003C/div>\\n        \u003Ch2 style=\"margin: 0 0 8px 0; font-weight: 900; font-size: 28px; color: var(--cobalt);\">Order Confirmed!\u003C/h2>\\n        \u003Cp style=\"margin: 0; color: var(--muted); font-size: 15px;\">Thank you for choosing Home2Smart\u003C/p>\\n      \u003C/div>\\n\\n      \\x3c!-- Order Details Card --\\x3e\\n      \u003Cdiv style=\"background: #f8f9fb; border: 1px solid var(--border); border-radius: 12px; padding: 24px; margin-bottom: 24px;\">\\n        \u003Ch3 style=\"margin: 0 0 16px 0; font-size: 16px; font-weight: 800; color: var(--cobalt); text-transform: uppercase; letter-spacing: 0.5px;\">Order Details\u003C/h3>\\n        \\n        \u003Cdiv class=\"details-grid\" style=\"display: grid; gap: 12px;\">\\n          \u003Cdiv style=\"display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #e5e7eb;\">\\n            \u003Cspan style=\"font-weight: 600; color: var(--muted); font-size: 14px;\">Order ID\u003C/span>\\n            \u003Cspan id=\"successOrderId\" style=\"font-family: monospace; font-size: 13px; color: var(--cobalt); font-weight: 700; word-break: break-all; max-width: 60%; text-align: right;\" title=\"${escapeHtml(displayOrderId)}\">${escapeHtml(shortOrderId)}\u003C/span>\\n          \u003C/div>\\n          \\n          \u003Cdiv style=\"display: flex; flex-direction: column; gap: 6px; padding: 12px 0; border-bottom: 1px solid #e5e7eb;\">\\n            \u003Cspan style=\"font-weight: 600; color: var(--muted); font-size: 14px;\">Items\u003C/span>\\n            \u003Cspan id=\"successOrderItems\" style=\"font-weight: 700; color: var(--ink); font-size: 14px; line-height: 1.5; text-align: left;\">${order.order_summary?escapeHtml(order.order_summary):\"Loading details...\"}\u003C/span>\\n          \u003C/div>\\n          \\n          \u003Cdiv id=\"successPromoRow\" style=\"display: ${order.order_discount_code?\"flex\":\"none\"}; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #e5e7eb;\">\\n            \u003Cspan style=\"font-weight: 600; color: var(--muted); font-size: 14px;\">Promo Applied\u003C/span>\\n            \u003Cspan id=\"successPromoCode\" style=\"font-weight: 700; color: #059669; font-size: 14px; font-family: monospace;\">${escapeHtml(order.order_discount_code)}\u003C/span>\\n          \u003C/div>\\n\\n          \u003Cdiv id=\"successTaxRow\" style=\"display: none; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #e5e7eb;\">\\n            \u003Cspan style=\"font-weight: 600; color: var(--muted); font-size: 14px;\">Sales Tax\u003C/span>\\n            \u003Cspan id=\"successTaxAmount\" style=\"font-weight: 700; color: var(--ink); font-size: 14px;\">$0.00\u003C/span>\\n          \u003C/div>\\n          \\n          \u003Cdiv style=\"display: flex; justify-content: space-between; align-items: center; padding: 16px 0 0 0;\">\\n            \u003Cspan style=\"font-weight: 800; color: var(--ink); font-size: 16px;\">Total Paid\u003C/span>\\n            \u003Cspan id=\"successOrderTotal\" style=\"font-weight: 900; color: var(--cobalt); font-size: 22px;\">${escapeHtml(prettyTotal)} \u003Cspan style=\"font-size: 14px; font-weight: 600; color: var(--muted);\">${escapeHtml(order.order_currency)}\u003C/span>\u003C/span>\\n          \u003C/div>\\n        \u003C/div>\\n      \u003C/div>\\n\\n      \\x3c!-- Next Step: Native Scheduling --\\x3e\\n      \u003Cdiv class=\"schedule-container\" style=\"background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); border: 2px solid #93c5fd; border-radius: 12px; margin-bottom: 24px; box-sizing: border-box; overflow: hidden;\">\\n        \u003Cdiv style=\"display: flex; align-items: center; gap: 12px; margin-bottom: 12px;\">\\n          \u003Cdiv style=\"width: 32px; height: 32px; background: var(--cobalt); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;\">\\n            \u003Csvg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#ffffff\" stroke-width=\"2.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\\n              \u003Crect x=\"3\" y=\"4\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\">\u003C/rect>\\n              \u003Cline x1=\"16\" y1=\"2\" x2=\"16\" y2=\"6\">\u003C/line>\\n              \u003Cline x1=\"8\" y1=\"2\" x2=\"8\" y2=\"6\">\u003C/line>\\n              \u003Cline x1=\"3\" y1=\"10\" x2=\"21\" y2=\"10\">\u003C/line>\\n            \u003C/svg>\\n          \u003C/div>\\n          \u003Ch3 style=\"margin: 0; font-size: 17px; font-weight: 800; color: var(--cobalt);\">Schedule Your Installation\u003C/h3>\\n        \u003C/div>\\n        \u003Cp style=\"margin: 0; color: #1e3a8a; font-size: 14px; line-height: 1.6;\">Pick a date from the calendar, then choose your preferred time window.\u003C/p>\\n        \\n        \\x3c!-- Calendar Grid --\\x3e\\n        \u003Cdiv id=\"calendarWidget\" class=\"calendar-widget\" style=\"background: white; border-radius: 8px; margin: 16px auto 0; max-width: 100%; width: 100%; box-sizing: border-box; overflow-x: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.08);\">\\n          \u003Cdiv style=\"padding: 20px; text-align: center; color: var(--muted);\">Loading calendar...\u003C/div>\\n        \u003C/div>\\n        \\n        \\x3c!-- Time Window Selection (appears after date selected) --\\x3e\\n        \u003Cdiv id=\"timeWindowSection\" style=\"display:none; margin-top:16px;\">\\n          \u003Clabel style=\"display:block; font-weight:600; font-size:14px; margin-bottom:8px; color:var(--ink);\">Select Time Window\u003C/label>\\n          \u003Cdiv style=\"display:grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap:8px; max-width: 100%; overflow: hidden;\">\\n            \u003Cbutton class=\"time-slot-btn\" data-window=\"9:00 AM - 12:00 PM\" style=\"padding:10px 8px; border:2px solid var(--border); border-radius:8px; background:white; cursor:pointer; font-weight:600; font-size:13px; transition: all 0.2s; min-width:0; box-sizing:border-box;\">9AM - 12PM\u003C/button>\\n            \u003Cbutton class=\"time-slot-btn\" data-window=\"12:00 PM - 3:00 PM\" style=\"padding:10px 8px; border:2px solid var(--border); border-radius:8px; background:white; cursor:pointer; font-weight:600; font-size:13px; transition: all 0.2s; min-width:0; box-sizing:border-box;\">12PM - 3PM\u003C/button>\\n            \u003Cbutton class=\"time-slot-btn\" data-window=\"3:00 PM - 6:00 PM\" style=\"padding:10px 8px; border:2px solid var(--border); border-radius:8px; background:white; cursor:pointer; font-weight:600; font-size:13px; transition: all 0.2s; min-width:0; box-sizing:border-box;\">3PM - 6PM\u003C/button>\\n          \u003C/div>\\n        \u003C/div>\\n        \\n        \u003Cdiv style=\"display:flex; gap:12px; margin-top:16px; justify-content: center;\">\\n          \u003Cbutton class=\"btn btn-primary\" id=\"confirmApptBtn\" style=\"width: 100%; max-width: 300px; opacity: 0.5; pointer-events: none;\">Confirm Appointment\u003C/button>\\n        \u003C/div>\\n        \u003Cdiv id=\"schedMsg\" class=\"help\" style=\"margin-top:8px;\">\u003C/div>\\n      \u003C/div>\\n\\n      \\x3c!-- Footer Actions --\\x3e\\n      \u003Cdiv style=\"display: flex; gap: 12px; flex-wrap: wrap; justify-content: center;\">\\n        \u003Cbutton class=\"btn btn-ghost\" id=\"backToShop\" style=\"min-width: 160px;\">Return to Shop\u003C/button>\\n        \u003Ca href=\"tel:864-528-1475\" class=\"btn btn-secondary\" style=\"min-width: 160px; text-decoration: none; display: inline-flex; align-items: center; justify-content: center;\">Call Support\u003C/a>\\n      \u003C/div>\\n    \u003C/section>\\n  `,outlet.style.opacity=\"1\",outlet.style.visibility=\"visible\",outlet.style.display=\"block\",isMobile&&(logger.log(\"[renderShopSuccess] Forcing mobile visibility immediately\"),requestAnimationFrame(()=>{outlet.style.transform=\"none\",window.scrollTo(0,0)})),logger.log(\"[renderShopSuccess]  Success page visible\"),byId(\"backToShop\").onclick=()=>navSet({view:null});let selectedDate=null,selectedWindow=null,availabilityData=null;async function loadAvailability(){try{const resp=await fetch(\"https://h2s-backend.vercel.app/api/get-availability\"),data=await resp.json();data.ok?(availabilityData=data.availability,window._availMap=new Map(availabilityData.map(d=>[d.date,d])),logger.log(\"[Calendar] Loaded availability:\",availabilityData.length,\"days\")):logger.warn(\"[Calendar] Failed to load availability:\",data.error)}catch(err){logger.error(\"[Calendar] Availability fetch error:\",err)}renderCalendar()}function renderCalendar(){const cal=byId(\"calendarWidget\");if(cal)try{const now=new Date,currentMonth=now.getMonth(),currentYear=now.getFullYear(),firstDay=new Date(currentYear,currentMonth,1).getDay(),daysInMonth=new Date(currentYear,currentMonth+1,0).getDate(),today=now.getDate();let html=`\\n      \u003Cdiv style=\"display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;\">\\n        \u003Ch4 style=\"margin:0; font-size:16px; font-weight:800; color:var(--cobalt);\">${[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"][currentMonth]} ${currentYear}\u003C/h4>\\n      \u003C/div>\\n      \u003Cdiv style=\"display:grid; grid-template-columns: repeat(7, minmax(0, 1fr)); gap:2px; text-align:center; max-width:100%; overflow:hidden;\">\\n        \u003Cdiv style=\"font-size:12px; font-weight:700; color:var(--muted); padding:8px 0; min-width:0;\">Sun\u003C/div>\\n        \u003Cdiv style=\"font-size:12px; font-weight:700; color:var(--muted); padding:8px 0; min-width:0;\">Mon\u003C/div>\\n        \u003Cdiv style=\"font-size:12px; font-weight:700; color:var(--muted); padding:8px 0; min-width:0;\">Tue\u003C/div>\\n        \u003Cdiv style=\"font-size:12px; font-weight:700; color:var(--muted); padding:8px 0; min-width:0;\">Wed\u003C/div>\\n        \u003Cdiv style=\"font-size:12px; font-weight:700; color:var(--muted); padding:8px 0; min-width:0;\">Thu\u003C/div>\\n        \u003Cdiv style=\"font-size:12px; font-weight:700; color:var(--muted); padding:8px 0; min-width:0;\">Fri\u003C/div>\\n        \u003Cdiv style=\"font-size:12px; font-weight:700; color:var(--muted); padding:8px 0; min-width:0;\">Sat\u003C/div>\\n    `;for(let i=0;i\u003CfirstDay;i++)html+=\"\u003Cdiv>\u003C/div>\";for(let day=1;day\u003C=daysInMonth;day++){const isPast=day\u003Ctoday,isToday=day===today,dateStr=`${currentYear}-${String(currentMonth+1).padStart(2,\"0\")}-${String(day).padStart(2,\"0\")}`,dayAvail=window._availMap?window._availMap.get(dateStr):availabilityData?availabilityData.find(d=>d.date===dateStr):null;if(isPast)html+=`\u003Cdiv style=\"padding:12px; color:#ccc; font-size:14px; min-width:0;\">${day}\u003C/div>`;else if(!(!1!==dayAvail?.available)&&availabilityData)html+=`\u003Cdiv style=\"padding:12px; color:#ccc; font-size:14px; min-width:0; text-decoration:line-through;\" title=\"No availability\">${day}\u003C/div>`;else{html+=`\u003Cdiv class=\"cal-day\" data-date=\"${dateStr}\" style=\"${isToday?\"border:2px solid var(--cobalt); border-radius:8px; cursor:pointer; font-weight:700; font-size:14px; color:var(--cobalt); transition: all 0.2s; min-width:0;\":\"border:2px solid transparent; border-radius:8px; cursor:pointer; font-size:14px; transition: all 0.2s; hover:border-color:var(--azure); min-width:0;\"}\">${day}\u003C/div>`}}html+=\"\u003C/div>\",cal.innerHTML=html,document.querySelectorAll(\".cal-day\").forEach(dayEl=>{dayEl.onclick=()=>{selectedDate=dayEl.getAttribute(\"data-date\"),document.querySelectorAll(\".cal-day\").forEach(d=>{d.classList.remove(\"selected\"),d.style.background=\"white\",d.style.borderColor=\"transparent\",d.style.color=\"inherit\"}),dayEl.classList.add(\"selected\"),dayEl.style.background=\"var(--azure)\",dayEl.style.borderColor=\"var(--azure)\",dayEl.style.color=\"white\",byId(\"timeWindowSection\").style.display=\"block\",selectedWindow=null,updateTimeSlots(selectedDate),byId(\"confirmApptBtn\").style.opacity=\"0.5\",byId(\"confirmApptBtn\").style.pointerEvents=\"none\"}})}catch(err){logger.error(\"[Calendar] Render failed:\",err),cal.innerHTML='\\n        \u003Cdiv style=\"padding:20px; text-align:center; color:var(--muted);\">\\n          \u003Cp style=\"margin:0 0 12px 0;\">Calendar temporarily unavailable. Please call to schedule:\u003C/p>\\n          \u003Ca href=\"tel:864-528-1475\" style=\"display:inline-block; padding:12px 24px; background:var(--cobalt); color:white; border-radius:8px; text-decoration:none; font-weight:700;\">Call (864) 528-1475\u003C/a>\\n        \u003C/div>\\n      '}else logger.warn(\"[Calendar] Widget not found in DOM\")}function updateTimeSlots(dateStr){const dayAvail=availabilityData?.find(d=>d.date===dateStr),slots=dayAvail?.slots||[];document.querySelectorAll(\".time-slot-btn\").forEach(btn=>{const window=btn.getAttribute(\"data-window\"),slotAvail=slots.find(s=>s.time===window);btn.style.borderColor=\"var(--border)\",btn.style.background=\"white\",btn.style.color=\"inherit\",btn.disabled=!1,btn.style.cursor=\"pointer\",btn.style.opacity=\"1\",slotAvail&&!slotAvail.available?(btn.disabled=!0,btn.style.background=\"#f3f4f6\",btn.style.color=\"#9ca3af\",btn.style.cursor=\"not-allowed\",btn.style.opacity=\"0.5\",btn.title=\"Fully booked\"):slotAvail&&slotAvail.spots_remaining&&(btn.title=`${slotAvail.spots_remaining} spot${slotAvail.spots_remaining>1?\"s\":\"\"} available`)})}loadAvailability().catch(err=>{logger.error(\"[Calendar] Failed to load, showing fallback:\",err);const cal=byId(\"calendarWidget\");cal&&(cal.innerHTML='\\n        \u003Cdiv style=\"padding:20px; text-align:center; color:var(--muted);\">\\n          \u003Cp style=\"margin:0 0 12px 0;\">Unable to load calendar. Please call us to schedule:\u003C/p>\\n          \u003Ca href=\"tel:864-528-1475\" style=\"display:inline-block; padding:12px 24px; background:var(--cobalt); color:white; border-radius:8px; text-decoration:none; font-weight:700;\">Call (864) 528-1475\u003C/a>\\n        \u003C/div>\\n      ')}).finally(()=>{isMobile&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{logger.log(\"[renderShopSuccess] Applying mobile optimizations...\");const outlet=document.getElementById(\"outlet\");outlet?(outlet.style.overflow=\"visible\",outlet.style.minHeight=\"auto\",logger.log(\"[renderShopSuccess]  Outlet optimized\")):logger.warn(\"[renderShopSuccess]  Outlet not found\");const calendar=document.getElementById(\"calendarWidget\");calendar?(calendar.style.webkitOverflowScrolling=\"touch\",calendar.style.overflowX=\"auto\",logger.log(\"[renderShopSuccess]  Calendar optimized\")):logger.warn(\"[renderShopSuccess]  Calendar widget not found\"),document.body.style.overflow=\"auto\",document.body.style.height=\"auto\",logger.log(\"[renderShopSuccess]  Mobile optimizations complete\")})})}),sessionId&&(fetch(API,{method:\"POST\",body:JSON.stringify({__action:\"mark_session\",session_id:sessionId,status:\"success_redirect\",note:\"User returned from Stripe at \"+(new Date).toISOString()})}).catch(e=>logger.error(\"Failed to mark session:\",e)),fetch(`${API}?action=orderpack&session_id=${sessionId}`).then(res=>res.json()).then(data=>{if(data.ok&&data.summary){logger.log(\"? Fetched order pack:\",data.summary.order_id);const finalOrderId=data.summary.order_id||sessionId,finalShortId=finalOrderId.length>20?finalOrderId.substring(0,20)+\"...\":finalOrderId,idEl=byId(\"successOrderId\");idEl&&(idEl.textContent=finalShortId,idEl.title=finalOrderId);const total=\"number\"==typeof data.summary.total?data.summary.total:0,tax=\"number\"==typeof data.summary.tax?data.summary.tax:0,currency=data.summary.currency||\"USD\",totalEl=byId(\"successOrderTotal\");totalEl&&(totalEl.innerHTML=`${money(total)} \u003Cspan style=\"font-size: 14px; font-weight: 600; color: var(--muted);\">${currency}\u003C/span>`);const taxRow=byId(\"successTaxRow\"),taxEl=byId(\"successTaxAmount\");taxRow&&taxEl&&(tax>0?(taxRow.style.display=\"flex\",taxEl.textContent=money(tax)):taxRow.style.display=\"none\");const itemsEl=byId(\"successOrderItems\");if(itemsEl&&data.lines&&data.lines.length>0){const parts=[];data.lines.forEach(l=>{const name=l.service_name||l.name||l.bundle_id||l.service_id||(\"bundle\"===l.line_type?\"Bundle\":\"Service\");parts.push(`\u003Cdiv style=\"margin-bottom:4px;\"> ${Number(l.qty||1)}x ${escapeHtml(name)}\u003C/div>`)}),itemsEl.innerHTML=parts.join(\"\")}else itemsEl&&(itemsEl.textContent=\"Order details loaded\");if(data.summary.discount_code){const promoRow=byId(\"successPromoRow\"),promoCode=byId(\"successPromoCode\");promoRow&&promoCode&&(promoRow.style.display=\"flex\",promoCode.textContent=data.summary.discount_code)}h2sTrack(\"Purchase\",{order_id:finalOrderId,value:String(total),currency:currency,num_items:String(data.lines?.length||0),customer_email:user?.email||data.customer?.email||null,customer_phone:user?.phone||data.customer?.phone||null,revenue_amount:parseFloat(total)||0})}}).catch(err=>logger.error(\"Failed to fetch order pack:\",err))),document.querySelectorAll(\".time-slot-btn\").forEach(btn=>{btn.onclick=()=>{if(btn.disabled)return;selectedWindow=btn.getAttribute(\"data-window\"),document.querySelectorAll(\".time-slot-btn\").forEach(b=>{b.style.borderColor=\"var(--border)\",b.style.background=\"white\",b.style.color=\"inherit\"}),btn.style.borderColor=\"var(--azure)\",btn.style.background=\"var(--azure)\",btn.style.color=\"white\";const confirmBtn=byId(\"confirmApptBtn\");confirmBtn.style.opacity=\"1\",confirmBtn.style.pointerEvents=\"auto\"}});const confirmBtn=byId(\"confirmApptBtn\"),schedMsg=byId(\"schedMsg\");confirmBtn&&(confirmBtn.onclick=async()=>{if(!selectedDate||!selectedWindow)return void(schedMsg&&(schedMsg.style.color=\"#c33\",schedMsg.textContent=\"Select a date and time window.\"));confirmBtn.disabled=!0;const prev=confirmBtn.textContent;confirmBtn.textContent=\"Saving...\";try{const tz=Intl.DateTimeFormat().resolvedOptions().timeZone||\"America/New_York\",params=new URL(location.href).searchParams,stableId=params.get(\"session_id\")||params.get(\"stripe_session_id\")||\"\"||displayOrderId,[startLabel,endLabel]=selectedWindow.split(\" - \"),toIso=label=>{const match=label.trim().match(/(\\d{1,2}):(\\d{2})\\s*(AM|PM)/i);if(!match)throw new Error(\"Invalid time format\");let hours=parseInt(match[1],10);const minutes=parseInt(match[2],10),isPM=\"PM\"===match[3].toUpperCase();isPM&&12!==hours&&(hours+=12),isPM||12!==hours||(hours=0);const isoDate=`${selectedDate}T${String(hours).padStart(2,\"0\")}:${String(minutes).padStart(2,\"0\")}:00`;return new Date(isoDate).toISOString()},startIso=toIso(startLabel),endIso=toIso(endLabel);logger.log(\"[Schedule] Sending payload\",{order_id:stableId,delivery_date:selectedDate,delivery_time:selectedWindow});const resp=await fetch(APIV1,{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({order_id:stableId,delivery_date:selectedDate,delivery_time:selectedWindow,start_iso:startIso,end_iso:endIso,timezone:tz})}),data=await resp.json();if(!resp.ok||!data.ok){const errorMsg=data.error||`HTTP ${resp.status}`;if(\"slot_full\"===data.error_code)throw new Error(`${errorMsg}\\n\\nTip: Try selecting a different time window or date.`);throw new Error(errorMsg)}schedMsg&&(schedMsg.style.color=\"#0b6e0b\",schedMsg.textContent=\"Appointment scheduled. Check your email for confirmation.\"),confirmBtn.textContent=\"Scheduled\",confirmBtn.style.background=\"linear-gradient(135deg, #10b981 0%, #059669 100%)\",confirmBtn.disabled=!0}catch(err){schedMsg&&(schedMsg.style.color=\"#c33\",schedMsg.textContent=\"Failed to schedule: \"+err.message),logger.error(\"[Schedule] Failed to schedule\",err)}finally{confirmBtn.disabled=!1,confirmBtn.textContent=prev}})}catch(err){console.error(\"[renderShopSuccess] Critical Error:\",err);const outlet=document.getElementById(\"outlet\");if(outlet)try{const recentCheckout=JSON.parse(localStorage.getItem(\"h2s_last_checkout\")||\"{}\"),cartTotal=cart&&cart.length>0?cart.reduce((sum,item)=>sum+item.price*item.qty,0):0;outlet.innerHTML=`\\n          \u003Csection class=\"form\" style=\"max-width: 720px; margin: 60px auto 40px; padding: 20px;\">\\n            \u003Cdiv style=\"text-align: center; margin-bottom: 32px;\">\\n              \u003Cdiv style=\"width: 64px; height: 64px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 16px; box-shadow: 0 4px 16px rgba(16, 185, 129, 0.3);\">\\n                \u003Csvg width=\"32\" height=\"32\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#ffffff\" stroke-width=\"3\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\\n                  \u003Cpolyline points=\"20 6 9 17 4 12\">\u003C/polyline>\\n                \u003C/svg>\\n              \u003C/div>\\n              \u003Ch2 style=\"margin: 0 0 8px 0; font-weight: 900; font-size: 28px; color: var(--cobalt);\">Order Confirmed!\u003C/h2>\\n              \u003Cp style=\"margin: 0; color: var(--muted); font-size: 15px;\">Your payment has been processed successfully\u003C/p>\\n            \u003C/div>\\n            \\n            \u003Cdiv style=\"background: #f8f9fb; border: 1px solid var(--border); border-radius: 12px; padding: 24px; margin-bottom: 24px;\">\\n              \u003Ch3 style=\"margin: 0 0 16px 0; font-size: 16px; font-weight: 800; color: var(--cobalt);\">ORDER DETAILS\u003C/h3>\\n              \u003Cdiv style=\"display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #e5e7eb;\">\\n                \u003Cspan style=\"font-weight: 600; color: var(--muted);\">Order ID\u003C/span>\\n                \u003Cspan style=\"font-family: monospace; color: var(--cobalt); font-weight: 700;\">${recentCheckout.session_id?recentCheckout.session_id.substring(0,20)+\"...\":\"Processing...\"}\u003C/span>\\n              \u003C/div>\\n              \u003Cdiv style=\"display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #e5e7eb;\">\\n                \u003Cspan style=\"font-weight: 600; color: var(--muted);\">Items\u003C/span>\\n                \u003Cspan style=\"font-weight: 700; color: var(--ink);\">${recentCheckout.cart_count||cart?.length||\"Multiple\"} item${1!==(recentCheckout.cart_count||cart?.length)?\"s\":\"\"}\u003C/span>\\n              \u003C/div>\\n              \u003Cdiv style=\"display: flex; justify-content: space-between; padding: 16px 0 0 0;\">\\n                \u003Cspan style=\"font-weight: 800; color: var(--ink); font-size: 16px;\">Total Paid\u003C/span>\\n                \u003Cspan style=\"font-weight: 900; color: var(--cobalt); font-size: 22px;\">${cartTotal?money(cartTotal):\"Paid\"}\u003C/span>\\n              \u003C/div>\\n            \u003C/div>\\n            \\n            \u003Cdiv style=\"background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); border: 2px solid #93c5fd; border-radius: 12px; padding: 20px; margin-bottom: 24px;\">\\n              \u003Ch3 style=\"margin: 0 0 12px 0; font-size: 17px; font-weight: 800; color: var(--cobalt);\">What's Next?\u003C/h3>\\n              \u003Cp style=\"margin: 0 0 16px 0; color: #1e3a8a; font-size: 14px;\">Our team will contact you within 24 hours to schedule your installation. You'll receive a confirmation email at \u003Cstrong>${recentCheckout.customer_email||\"your email address\"}\u003C/strong>.\u003C/p>\\n              \u003Ca href=\"tel:864-528-1475\" style=\"display: inline-block; padding: 12px 24px; background: var(--cobalt); color: white; border-radius: 8px; text-decoration: none; font-weight: 700; font-size: 14px;\">Call Us: (864) 528-1475\u003C/a>\\n            \u003C/div>\\n            \\n            \u003Cdiv style=\"text-align: center; padding: 20px; color: var(--muted); font-size: 13px;\">\\n              \u003Cp style=\"margin: 0;\">Questions? Call us at \u003Ca href=\"tel:864-528-1475\" style=\"color: var(--cobalt); font-weight: 600;\">(864) 528-1475\u003C/a>\u003C/p>\\n            \u003C/div>\\n            \\n            ${err.message.includes(\"network\")||err.message.includes(\"fetch\")?'\u003Cdiv style=\"background: #fee; border: 1px solid #fca5a5; border-radius: 8px; padding: 12px; margin-top: 16px; text-align: center; font-size: 13px; color: #991b1b;\"> Unable to load full order details. Your payment was successful and we\\'ll send confirmation via email.\u003C/div>':\"\"}\\n          \u003C/section>\\n        `;try{cart=[],localStorage.setItem(\"h2s_cart\",\"[]\"),window.updateCartBadge&&updateCartBadge()}catch(e){logger.warn(\"[renderShopSuccess] Could not clear cart:\",e)}}catch(fallbackErr){outlet.innerHTML='\\n          \u003Cdiv style=\"padding:40px;text-align:center;font-family:sans-serif;\">\\n            \u003Cdiv style=\"width:64px;height:64px;background:#10b981;border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 16px;\">\\n              \u003Csvg width=\"32\" height=\"32\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#ffffff\" stroke-width=\"3\">\\n                \u003Cpolyline points=\"20 6 9 17 4 12\">\u003C/polyline>\\n              \u003C/svg>\\n            \u003C/div>\\n            \u003Ch2 style=\"margin:0 0 8px 0;font-weight:900;font-size:28px;color:#1e3a8a;\">Payment Successful!\u003C/h2>\\n            \u003Cp style=\"margin:0 0 20px 0;color:#64748b;\">Your order has been received. We\\'ll send confirmation via email.\u003C/p>\\n            \u003Ca href=\"tel:864-528-1475\" style=\"display:inline-block;padding:12px 24px;background:#2563eb;color:white;border-radius:8px;text-decoration:none;font-weight:700;\">Call (864) 528-1475\u003C/a>\\n          \u003C/div>\\n        '}}},window.handleCalReturn=async function(){const order_id=getParam(\"order_id\")||\"\",startIso=getParam(\"start\")||\"\";byId(\"outlet\").innerHTML='\\n    \u003Csection class=\"form\">\\n      \u003Ch2 style=\"margin:0 0 10px 0;font-weight:900\">Saving your appointment...\u003C/h2>\\n      \u003Cdiv class=\"help\">Just a moment.\u003C/div>\\n    \u003C/section>\\n  ';try{let email=user?.email||getParam(\"email\")||\"\";if(!email)try{email=JSON.parse(localStorage.getItem(\"h2s_guest_checkout\")||\"{}\").email||\"\"}catch(e){}if(!email)throw new Error(\"Missing customer email. Please sign in or complete checkout.\");if(!startIso)throw new Error(\"Missing appointment time.\");const apptDate=new Date(startIso),today=new Date;if(apptDate.setHours(0,0,0,0),today.setHours(0,0,0,0),apptDate\u003C=today)throw new Error(\"Appointments must be scheduled at least 1 day in advance. Please choose a later date.\");const res=await fetch(APIV1,{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({order_id:order_id||\"\",email:email,install_at:startIso||\"\",install_end_at:getParam(\"end\")||\"\",timezone:getParam(\"tz\")||\"\"})}),data=await res.json();if(!data.ok)throw new Error(data.error||\"Failed to save appointment\");logger.log(\"Appointment saved, job creation triggered\"),logger.log(\"Job ID:\",data.job_id),localStorage.removeItem(\"h2s_guest_checkout\"),byId(\"outlet\").innerHTML='\\n      \u003Csection class=\"form\" style=\"text-align: center;\">\\n        \u003Cdiv style=\"width: 64px; height: 64px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 16px; box-shadow: 0 4px 16px rgba(16, 185, 129, 0.3);\">\\n          \u003Csvg width=\"32\" height=\"32\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#ffffff\" stroke-width=\"3\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\\n            \u003Cpolyline points=\"20 6 9 17 4 12\">\u003C/polyline>\\n          \u003C/svg>\\n        \u003C/div>\\n        \u003Ch2 style=\"margin:0 0 10px 0;font-weight:900; color: var(--cobalt);\">All Set!\u003C/h2>\\n        \u003Cp class=\"help\" style=\"color: var(--muted);\">Your appointment has been confirmed. We\\'ll send you a reminder before your scheduled time.\u003C/p>\\n        \u003Cbutton class=\"btn btn-primary\" onclick=\"navSet({view:null})\" style=\"margin-top: 24px;\">Back to Shop\u003C/button>\\n      \u003C/section>\\n    '}catch(err){logger.error(\"Appointment save failed:\",err);const orderId=getParam(\"order_id\")||getParam(\"session_id\"),retryBtn=orderId?`\u003Cbutton class=\"btn btn-primary\" onclick=\"navSet({view:'shopsuccess', order_id:'${escapeAttr(orderId)}'})\" style=\"margin-top: 24px;\">Pick a Different Date\u003C/button>`:'\u003Cbutton class=\"btn btn-primary\" onclick=\"navSet({view:null})\" style=\"margin-top: 24px;\">Back to Shop\u003C/button>';byId(\"outlet\").innerHTML=`\\n      \u003Csection class=\"form\" style=\"text-align: center;\">\\n        \u003Ch2 style=\"margin:0 0 10px 0;font-weight:900; color: #d32f2f;\">Booking Failed\u003C/h2>\\n        \u003Cp class=\"help\" style=\"color: var(--muted);\">${escapeHtml(err.message)}\u003C/p>\\n        ${retryBtn}\\n      \u003C/section>\\n    `}},window.renderSignIn=function(){const outlet=byId(\"outlet\");outlet.innerHTML=`\\n    \u003Csection class=\"form\">\\n      \u003Cdiv style=\"text-align:center; margin-bottom:24px;\">\\n        \u003Ca href=\"#\" onclick=\"navSet({view:'shop'}); return false;\" class=\"link-btn\" style=\"font-size:14px; color:var(--azure); font-weight:600;\">\\n          Back to shop\\n        \u003C/a>\\n      \u003C/div>\\n      \u003Ch2>Sign in to your account\u003C/h2>\\n      \u003Cp class=\"help\" style=\"text-align:center; color:var(--text-muted); margin-bottom:20px;\">Access your dashboard, track orders, and manage your account.\u003C/p>\\n      \u003Cinput class=\"inp\" id=\"siEmail\" type=\"email\" placeholder=\"Email address\" value=\"${escapeAttr(user?.email||\"\")}\" autocomplete=\"email\">\\n      \u003Cinput class=\"inp\" id=\"siPass\"  type=\"password\" placeholder=\"Password\" autocomplete=\"current-password\">\\n      \u003Cdiv style=\"display:flex; gap:12px; margin-top:24px; flex-direction:column;\">\\n        \u003Cbutton class=\"btn btn-primary\" id=\"signin\" style=\"width:100%;\">Sign in\u003C/button>\\n        \u003Cbutton class=\"btn btn-ghost\" id=\"toSignup\" style=\"width:100%;\">Create account\u003C/button>\\n        \u003Cbutton class=\"btn btn-subtle\" id=\"toForgot\" style=\"padding:10px; margin-top:8px;\">Forgot password?\u003C/button>\\n      \u003C/div>\\n      \u003Cdiv id=\"siMsg\" class=\"help\" style=\"margin-top:16px; color:#d32f2f;\">\u003C/div>\\n    \u003C/section>\\n  `,outlet.style.opacity=\"1\",outlet.style.transition=\"\",document.body.classList.add(\"app-ready\"),byId(\"toSignup\").onclick=()=>navSet({view:\"signup\"}),byId(\"toForgot\").onclick=()=>navSet({view:\"forgot\"}),byId(\"signin\").onclick=async()=>{const email=byId(\"siEmail\").value.trim(),pass=byId(\"siPass\").value;if(!email)return showMsg(\"siMsg\",\"Enter your email.\");if(!pass)return showMsg(\"siMsg\",\"Enter your password.\");showLoader();try{const resp=await fetch(API,{method:\"POST\",body:JSON.stringify({__action:\"signin\",email:email,password:pass})}),text=await resp.text();if(!resp.ok)return void showMsg(\"siMsg\",text||\"Error \"+resp.status);const data=JSON.parse(text);if(!data.ok)return void showMsg(\"siMsg\",data.error||\"Sign in failed\");user={name:data.user.name||\"\",email:data.user.email,phone:data.user.phone||\"\",referral_code:data.user.referral_code||\"\",credits:data.user.credits||0,total_spent:data.user.total_spent||0},saveUser(),window.__H2S_ENABLE_AI_RECS&&loadAIRecommendations(),h2sTrack(\"Login\",{user_email:user.email}),navSet({view:\"account\"})}catch(err){showMsg(\"siMsg\",String(err))}finally{hideLoader()}}},window.renderSignUp=function(){const seed=user||{},outlet=byId(\"outlet\");outlet.innerHTML=`\\n    \u003Csection class=\"form\">\\n      \u003Cdiv style=\"text-align:center; margin-bottom:24px;\">\\n        \u003Ca href=\"#\" onclick=\"navSet({view:'shop'}); return false;\" class=\"link-btn\" style=\"font-size:14px; color:var(--azure); font-weight:600;\">\\n          Back to shop\\n        \u003C/a>\\n      \u003C/div>\\n      \u003Ch2>Create your account\u003C/h2>\\n      \u003Cp class=\"help\" style=\"text-align:center; color:var(--text-muted); margin-bottom:20px;\">Get exclusive discounts, earn credits, and track your installations.\u003C/p>\\n      \u003Cinput class=\"inp\" id=\"suName\"  type=\"text\"  placeholder=\"Full name\" value=\"${escapeAttr(seed.name||\"\")}\" autocomplete=\"name\">\\n      \u003Cinput class=\"inp\" id=\"suEmail\" type=\"email\" placeholder=\"Email address\" value=\"${escapeAttr(seed.email||\"\")}\" autocomplete=\"email\">\\n      \u003Cinput class=\"inp\" id=\"suPhone\" type=\"tel\"   placeholder=\"Phone number\" value=\"${escapeAttr(seed.phone||\"\")}\" autocomplete=\"tel\">\\n      \u003Cinput class=\"inp\" id=\"suPass\"  type=\"password\" placeholder=\"Password (min 8 characters)\" autocomplete=\"new-password\">\\n      \u003Cinput class=\"inp\" id=\"suPass2\" type=\"password\" placeholder=\"Confirm password\" autocomplete=\"new-password\">\\n      \u003Cdiv class=\"help\" style=\"text-align:center; color:var(--text-muted); margin-top:8px;\">Secure checkout, order tracking, and rewards\u003C/div>\\n      \u003Cdiv style=\"display:flex; gap:12px; margin-top:24px; flex-direction:column;\">\\n        \u003Cbutton class=\"btn btn-primary\" id=\"createAcct\" style=\"width:100%;\">Create account\u003C/button>\\n        \u003Cbutton class=\"btn btn-ghost\" id=\"toSignin\" style=\"width:100%;\">Already have an account? Sign in\u003C/button>\\n      \u003C/div>\\n      \u003Cdiv id=\"suMsg\" class=\"help\" style=\"margin-top:16px;\">\u003C/div>\\n    \u003C/section>\\n  `,outlet.style.opacity=\"1\",outlet.style.transition=\"\",document.body.classList.add(\"app-ready\"),byId(\"toSignin\").onclick=()=>navSet({view:\"signin\"}),byId(\"createAcct\").onclick=async()=>{const name=byId(\"suName\").value.trim(),email=byId(\"suEmail\").value.trim(),phone=byId(\"suPhone\").value.trim(),pw1=byId(\"suPass\").value,pw2=byId(\"suPass2\").value,msg=byId(\"suMsg\"),btn=byId(\"createAcct\");if(!email)return showMsg(\"suMsg\",\"Enter your email.\");if(pw1.length\u003C8)return showMsg(\"suMsg\",\"Password must be at least 8 characters.\");if(pw1!==pw2)return showMsg(\"suMsg\",\"Passwords do not match.\");showLoader();try{const resp=await fetch(API,{method:\"POST\",body:JSON.stringify({__action:\"create_user\",user:{name:name,email:email,phone:phone,password:pw1}})}),text=await resp.text();if(!resp.ok)return void showMsg(\"suMsg\",text||\"Error \"+resp.status);const data=JSON.parse(text);if(!data.ok)return void showMsg(\"suMsg\",data.error||\"Create failed\");user={name:data.user.name||\"\",email:data.user.email,phone:data.user.phone||\"\",referral_code:data.user.referral_code||\"\",credits:data.user.credits||0,total_spent:data.user.total_spent||0},saveUser(),window.__H2S_ENABLE_AI_RECS&&loadAIRecommendations(),h2sTrack(\"CompleteRegistration\",{user_email:user.email,user_name:user.name}),msg&&btn&&(msg.style.color=\"#2e7d32\",msg.textContent=\"Account created! Welcome to Home2Smart.\",btn.textContent=\"Success!\",btn.disabled=!0),setTimeout(()=>{navSet({view:\"account\"})},1200)}catch(err){showMsg(\"suMsg\",String(err))}finally{hideLoader()}}},window.renderForgot=function(){const outlet=byId(\"outlet\");outlet.innerHTML='\\n    \u003Csection class=\"form\">\\n      \u003Cdiv style=\"text-align:center; margin-bottom:24px;\">\\n        \u003Ca href=\"#\" onclick=\"navSet({view:\\'shop\\'}); return false;\" class=\"link-btn\" style=\"font-size:14px; color:var(--azure); font-weight:600;\">\\n          Back to shop\\n        \u003C/a>\\n      \u003C/div>\\n      \u003Ch2>Forgot password\u003C/h2>\\n      \u003Cp class=\"help\" style=\"text-align:center; color:var(--text-muted); margin-bottom:20px;\">Enter your email and we\\'ll send you a reset link.\u003C/p>\\n      \u003Cinput class=\"inp\" id=\"fpEmail\" type=\"email\" placeholder=\"Email address\" autocomplete=\"email\">\\n      \u003Cdiv style=\"display:flex; gap:12px; margin-top:24px; flex-direction:column;\">\\n        \u003Cbutton class=\"btn btn-primary\" id=\"fpSend\" style=\"width:100%;\">Send reset link\u003C/button>\\n        \u003Cbutton class=\"btn btn-ghost\" id=\"fpBack\" style=\"width:100%;\">Back to sign in\u003C/button>\\n      \u003C/div>\\n      \u003Cdiv id=\"fpMsg\" class=\"help\" style=\"margin-top:16px; color:#d32f2f;\">\u003C/div>\\n    \u003C/section>\\n  ',outlet.style.opacity=\"1\",outlet.style.transition=\"\",document.body.classList.add(\"app-ready\"),byId(\"fpBack\").onclick=()=>navSet({view:\"signin\"}),byId(\"fpSend\").onclick=async()=>{const email=byId(\"fpEmail\").value.trim();if(!email)return showMsg(\"fpMsg\",\"Enter your email.\");showLoader();try{const resp=await fetch(API,{method:\"POST\",body:JSON.stringify({__action:\"request_password_reset\",email:email})}),txt=await resp.text();if(!resp.ok)return void showMsg(\"fpMsg\",txt||\"Error \"+resp.status);showMsg(\"fpMsg\",\"If that email has an account, a reset link has been sent. Check your inbox.\")}catch(err){showMsg(\"fpMsg\",String(err))}finally{hideLoader()}}},window.renderReset=function(token){const outlet=byId(\"outlet\");outlet.innerHTML=`\\n    \u003Csection class=\"form\">\\n      \u003Ch2 style=\"margin:0 0 10px 0;font-weight:900\">Reset password\u003C/h2>\\n      \u003Cinput class=\"inp\" id=\"rpToken\" type=\"text\" placeholder=\"Reset token\" value=\"${escapeAttr(token||\"\")}\">\\n      \u003Cinput class=\"inp\" id=\"rpNew1\" type=\"password\" placeholder=\"New password (min 8)\">\\n      \u003Cinput class=\"inp\" id=\"rpNew2\" type=\"password\" placeholder=\"Confirm new password\">\\n      \u003Cdiv style=\"display:flex; gap:10px; margin-top:6px; flex-wrap:wrap\">\\n        \u003Cbutton class=\"btn azure\" id=\"rpDo\">Set new password\u003C/button>\\n        \u003Cbutton class=\"btn ghost\" id=\"rpBack\">Back to sign in\u003C/button>\\n      \u003C/div>\\n      \u003Cdiv id=\"rpMsg\" class=\"help\">\u003C/div>\\n    \u003C/section>\\n  `,outlet.style.opacity=\"1\",outlet.style.transition=\"\",document.body.classList.add(\"app-ready\"),byId(\"rpBack\").onclick=()=>navSet({view:\"signin\"}),byId(\"rpDo\").onclick=async()=>{const tok=byId(\"rpToken\").value.trim(),p1=byId(\"rpNew1\").value,p2=byId(\"rpNew2\").value;if(!tok)return showMsg(\"rpMsg\",\"Missing reset token.\");if(p1.length\u003C8)return showMsg(\"rpMsg\",\"Password must be at least 8 characters.\");if(p1!==p2)return showMsg(\"rpMsg\",\"Passwords do not match.\");showLoader();try{const resp=await fetch(API,{method:\"POST\",body:JSON.stringify({__action:\"reset_password\",token:tok,new_password:p1})}),txt=await resp.text();if(!resp.ok)return void showMsg(\"rpMsg\",txt||\"Error \"+resp.status);const data=JSON.parse(txt);if(!data.ok)return void showMsg(\"rpMsg\",data.error||\"Could not reset password\");showMsg(\"rpMsg\",\"Password updated. You can now sign in.\"),setTimeout(()=>navSet({view:\"signin\"}),800)}catch(err){showMsg(\"rpMsg\",String(err))}finally{hideLoader()}}},window.renderAccount=function(){if(!user||!user.email)return void navSet({view:\"signin\"});user.referral_code||window._userRefreshing||(window._userRefreshing=!0,fetch(API+\"?action=user&email=\"+encodeURIComponent(user.email)).then(r=>r.json()).then(d=>{window._userRefreshing=!1,d.ok&&d.user&&(user={...user,...d.user},saveUser(),renderAccount())}).catch(()=>window._userRefreshing=!1));const outlet=byId(\"outlet\");outlet.innerHTML=`\\n    \u003Csection class=\"form\">\\n      \u003Cdiv style=\"text-align:center; margin-bottom:24px;\">\\n        \u003Ca href=\"#\" onclick=\"navSet({view:null}); return false;\" class=\"link-btn\" style=\"font-size:14px; color:var(--azure); font-weight:600;\">\\n          Back to shop\\n        \u003C/a>\\n      \u003C/div>\\n      \u003Ch2 style=\"margin:0 0 10px 0;font-weight:900\">Your account\u003C/h2>\\n      \u003Cp class=\"help\" style=\"text-align:center; color:var(--text-muted); margin-bottom:20px;\">Manage your profile, view orders, and track your rewards.\u003C/p>\\n      \u003Cinput class=\"inp\" id=\"acName\"  type=\"text\"  placeholder=\"Full name\" value=\"${escapeAttr(user.name||\"\")}\">\\n      \u003Cinput class=\"inp\" id=\"acEmail\" type=\"email\" placeholder=\"Email\" value=\"${escapeAttr(user.email||\"\")}\" disabled>\\n      \u003Cinput class=\"inp\" id=\"acPhone\" type=\"tel\"   placeholder=\"Phone\" value=\"${escapeAttr(user.phone||\"\")}\">\\n      \u003Cdiv style=\"display:flex; gap:12px; margin-top:24px; flex-direction:column;\">\\n        \u003Cbutton class=\"btn btn-primary\" id=\"saveAcct\" style=\"width:100%;\">Save changes\u003C/button>\\n        \u003Cdiv style=\"display:flex; gap:8px;\">\\n          \u003Cbutton class=\"btn btn-ghost\" id=\"signOut\" style=\"flex:1;\">Sign out\u003C/button>\\n        \u003C/div>\\n      \u003C/div>\\n      \u003Cdiv id=\"acMsg\" class=\"help\" style=\"margin-top:16px;\">\u003C/div>\\n    \u003C/section>\\n\\n    \u003Csection class=\"form\" style=\"margin-top:24px\">\\n      \u003Ch3 style=\"margin:0 0 10px 0;font-weight:900\">Rewards & Credits\u003C/h3>\\n      \u003Cdiv class=\"pd-box\" style=\"background:#f0f9ff; border-color:#bae6fd;\">\\n        \u003Cdiv style=\"display:flex; justify-content:space-between; align-items:center; margin-bottom:8px\">\\n          \u003Cdiv style=\"font-weight:800; color:#0284c7;\">Available Credits\u003C/div>\\n          \u003Cdiv style=\"font-weight:900; font-size:18px; color:#0284c7;\">${money(user.credits||0)}\u003C/div>\\n        \u003C/div>\\n        \u003Cdiv style=\"margin-top:12px; padding-top:12px; border-top:1px solid #bae6fd;\">\\n          \u003Cdiv style=\"font-weight:800; color:#0284c7; margin-bottom:4px;\">Your Referral Code\u003C/div>\\n          \u003Cdiv style=\"display:flex; gap:8px; align-items:center;\">\\n            \u003Cdiv style=\"font-family:monospace; font-weight:900; font-size:18px; letter-spacing:1px; background:#fff; padding:8px 12px; border-radius:6px; border:1px dashed #0284c7; color:#0284c7;\">\\n              ${escapeHtml(user.referral_code||\"Loading...\")}\\n            \u003C/div>\\n            \u003Cbutton class=\"btn btn-primary\" style=\"padding:8px 16px; font-size:13px;\" onclick=\"navigator.clipboard.writeText('${escapeHtml(user.referral_code||\"\")}').then(()=>this.textContent='Copied!')\">Copy Code\u003C/button>\\n          \u003C/div>\\n          \u003Cdiv style=\"font-size:13px; color:#0369a1; margin-top:8px;\">Share this code. Friends get discount, you get credit.\u003C/div>\\n        \u003C/div>\\n      \u003C/div>\\n    \u003C/section>\\n\\n    \u003Csection class=\"form\" style=\"margin-top:24px\">\\n      \u003Cbutton class=\"btn ghost\" id=\"cpToggle\" aria-expanded=\"false\">Change password\u003C/button>\\n      \u003Cdiv id=\"cpPanel\" class=\"pd-box\" style=\"display:none; margin-top:10px\">\\n        \u003Ch3 style=\"margin:0 0 10px 0;font-weight:900\">Change password\u003C/h3>\\n        \u003Cinput class=\"inp\" id=\"cpOld\" type=\"password\" placeholder=\"Current password\">\\n        \u003Cinput class=\"inp\" id=\"cpNew1\" type=\"password\" placeholder=\"New password (min 8)\">\\n        \u003Cinput class=\"inp\" id=\"cpNew2\" type=\"password\" placeholder=\"Confirm new password\">\\n        \u003Cdiv style=\"display:flex; gap:10px; margin-top:6px; flex-wrap:wrap\">\\n          \u003Cbutton class=\"btn azure\" id=\"cpDo\">Update password\u003C/button>\\n        \u003C/div>\\n        \u003Cdiv id=\"cpMsg\" class=\"help\">\u003C/div>\\n      \u003C/div>\\n    \u003C/section>\\n\\n    \u003Csection class=\"form\" style=\"margin-top:24px\">\\n      \u003Ch3 style=\"margin:0 0 10px 0;font-weight:900\">Previous orders\u003C/h3>\\n      \u003Cdiv id=\"ordersBox\" class=\"pd-box\">\u003Cdiv class=\"help\">Loading\u003C/div>\u003C/div>\\n    \u003C/section>\\n  `,byId(\"saveAcct\").onclick=async()=>{const name=byId(\"acName\").value.trim(),phone=byId(\"acPhone\").value.trim();showLoader();try{const resp=await fetch(API,{method:\"POST\",body:JSON.stringify({__action:\"upsert_user\",user:{name:name,phone:phone,email:user.email}})}),text=await resp.text();if(!resp.ok)return void showMsg(\"acMsg\",text||\"Error \"+resp.status);const data=JSON.parse(text);if(!data.ok)return void showMsg(\"acMsg\",data.error||\"Save failed\");user={...user,...data.user},saveUser(),showMsg(\"acMsg\",\"Saved successfully.\")}catch(err){showMsg(\"acMsg\",String(err))}finally{hideLoader()}},byId(\"signOut\").onclick=()=>{user={},saveUser(),navSet({view:null})},outlet.style.opacity=\"1\",outlet.style.transition=\"\",document.body.classList.add(\"app-ready\");const cpToggle=byId(\"cpToggle\"),cpPanel=byId(\"cpPanel\");cpToggle&&cpPanel&&(cpToggle.onclick=()=>{const open=\"none\"!==cpPanel.style.display;cpPanel.style.display=open?\"none\":\"\",cpToggle.setAttribute(\"aria-expanded\",String(!open))});const cpDo=byId(\"cpDo\");cpDo&&(cpDo.onclick=async()=>{const oldp=byId(\"cpOld\").value,p1=byId(\"cpNew1\").value,p2=byId(\"cpNew2\").value;if(!oldp)return showMsg(\"cpMsg\",\"Enter your current password.\");if(p1.length\u003C8)return showMsg(\"cpMsg\",\"New password must be at least 8 characters.\");if(p1!==p2)return showMsg(\"cpMsg\",\"Passwords do not match.\");showLoader();try{const resp=await fetch(API,{method:\"POST\",body:JSON.stringify({__action:\"change_password\",email:user.email,old_password:oldp,new_password:p1})}),txt=await resp.text();if(!resp.ok)return void showMsg(\"cpMsg\",txt||\"Error \"+resp.status);const data=JSON.parse(txt);if(!data.ok)return void showMsg(\"cpMsg\",data.error||\"Could not change password\");showMsg(\"cpMsg\",\"Password updated.\"),byId(\"cpOld\").value=byId(\"cpNew1\").value=byId(\"cpNew2\").value=\"\"}catch(err){showMsg(\"cpMsg\",String(err))}finally{hideLoader()}}),loadOrders()},window.updateQuoteEstimate=function(){const type=document.getElementById(\"quoteType\")?.value||\"tv\",qty=parseInt(document.getElementById(\"quoteQty\")?.value)||1,surface=document.getElementById(\"quoteSurface\")?.value||\"standard\",estimateBox=document.getElementById(\"quoteEstimateValue\");if(!estimateBox)return;if(\"commercial\"===surface)return void(estimateBox.innerText=\"Custom Quote\");let basePrice=0,perItem=0;\"tv\"===type?(basePrice=149,perItem=183):\"camera\"===type?(basePrice=0,perItem=250):(basePrice=199,perItem=200);let totalLow=basePrice+perItem*qty;\"brick\"===surface&&(totalLow+=50*qty);let totalHigh=Math.round(1.15*totalLow);estimateBox.innerText=`$${totalLow} - $${totalHigh}`},window.requestQuote=function(packageId){const modal=document.getElementById(\"quoteModal\"),backdrop=document.getElementById(\"backdrop\"),titleEl=document.getElementById(\"quoteModalTitle\");if(!modal||!backdrop)return;const typeSelect=document.getElementById(\"quoteType\");if(typeSelect){if(Array.from(typeSelect.options).forEach(opt=>opt.disabled=!1),\"tv_custom\"===packageId){typeSelect.value=\"tv\";const camOpt=Array.from(typeSelect.options).find(o=>\"camera\"===o.value);camOpt&&(camOpt.disabled=!0)}else if(\"cam_custom\"===packageId){typeSelect.value=\"camera\";const tvOpt=Array.from(typeSelect.options).find(o=>\"tv\"===o.value);tvOpt&&(tvOpt.disabled=!0)}else typeSelect.value=\"both\";\"function\"==typeof window.updateQuoteEstimate&&window.updateQuoteEstimate()}titleEl.textContent=\"tv_custom\"===packageId?\"Custom TV Mounting Quote\":\"cam_custom\"===packageId?\"Custom Security Camera Quote\":\"Request Custom Quote\";const detailsField=document.getElementById(\"quoteDetails\");if(detailsField){const projectType=\"tv_custom\"===packageId?\"TV mounting\":\"security camera installation\";detailsField.placeholder=`Describe any specific needs for your ${projectType}...`}modal.dataset.packageId=packageId;try{modal.dataset.prevFocus=document.activeElement?.id||\"\"}catch(e){modal.dataset.prevFocus=\"\"}modal.classList.add(\"show\"),backdrop.classList.add(\"show\"),H2S_lockScroll(),setTimeout(()=>{const nameInput=document.getElementById(\"quoteName\");nameInput&&nameInput.focus()},100)},window.closeQuoteModal=function(){const modal=document.getElementById(\"quoteModal\"),backdrop=document.getElementById(\"backdrop\");modal&&modal.classList.remove(\"show\");const menuOpen=document.getElementById(\"menuDrawer\")?.classList.contains(\"open\"),cartOpen=document.getElementById(\"cartDrawer\")?.classList.contains(\"open\"),mainModalOpen=document.getElementById(\"modal\")?.classList.contains(\"show\");menuOpen||cartOpen||mainModalOpen||!backdrop||backdrop.classList.remove(\"show\"),H2S_unlockScroll(),[\"quoteName\",\"quoteEmail\",\"quotePhone\",\"quoteDetails\"].forEach(id=>{const el=document.getElementById(id);el&&(el.value=\"\")});const msg=document.getElementById(\"quoteMessage\");msg&&(msg.textContent=\"\");try{const prevId=modal?.dataset?.prevFocus;if(prevId){const prevEl=document.getElementById(prevId);prevEl&&\"function\"==typeof prevEl.focus&&prevEl.focus()}else{const outlet=document.getElementById(\"outlet\");outlet&&\"function\"==typeof outlet.focus&&outlet.focus()}modal&&modal.dataset&&(modal.dataset.prevFocus=\"\")}catch(e){}},window.submitQuoteRequest=async function(){const name=document.getElementById(\"quoteName\")?.value.trim()||\"\",email=document.getElementById(\"quoteEmail\")?.value.trim()||\"\",phone=document.getElementById(\"quotePhone\")?.value.trim()||\"\",details=document.getElementById(\"quoteDetails\")?.value.trim()||\"\",type=document.getElementById(\"quoteType\")?.value||\"N/A\",qty=document.getElementById(\"quoteQty\")?.value||\"N/A\",surface=document.getElementById(\"quoteSurface\")?.value||\"N/A\",estimate=document.getElementById(\"quoteEstimateValue\")?.innerText||\"N/A\",msg=document.getElementById(\"quoteMessage\"),btn=document.getElementById(\"submitQuoteBtn\"),modal=document.getElementById(\"quoteModal\"),packageId=modal?.dataset.packageId||\"unknown\";if(msg&&btn){if(!name)return msg.style.color=\"#d32f2f\",void(msg.textContent=\"Please enter your name\");if(!email||!email.includes(\"@\"))return msg.style.color=\"#d32f2f\",void(msg.textContent=\"Please enter a valid email address\");if(!phone)return msg.style.color=\"#d32f2f\",void(msg.textContent=\"Please enter your phone number\");btn.disabled=!0,btn.textContent=\"Sending...\",msg.textContent=\"\";try{const quoteEndpoint=API.replace(\"/api/shop\",\"/api/quote\"),smartDetails=`\\n[Smart Quote Data]\\nType: ${type}\\nQuantity: ${qty}\\nSurface: ${surface}\\nEst. Range: ${estimate}\\n------------------\\n${details}\\n    `.trim();if(btn.disabled)return;btn.disabled=!0,btn.textContent=\"Sending...\";const response=await fetch(quoteEndpoint,{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({name:name,email:email,phone:phone,details:smartDetails,package_type:packageId,source:\"/shop\",timestamp:(new Date).toISOString()})}),data=await response.json();if(!response.ok||!data.ok)throw new Error(data.error||\"Server error\");msg.style.color=\"#2e7d32\",msg.textContent=\"Request sent! We'll contact you within 1 hour.\",h2sTrack(\"QuoteRequested\",{package_type:packageId,email:email,name:name,phone:phone,customer_email:email,quote_id:data.quote_id}),setTimeout(()=>{closeQuoteModal()},2e3)}catch(error){logger.error(\"Quote request failed:\",error),msg.style.color=\"#d32f2f\",msg.textContent=\"Failed to send. Please call us at (864) 528-1475\",btn.disabled=!1,btn.textContent=\"Send Request\"}}},window.scheduleOrder=function(orderId){navSet({view:\"shopsuccess\",order_id:orderId})},window.rescheduleOrder=async function(orderId,currentDate,currentTime){const newDate=prompt(`Reschedule appointment\\n\\nCurrent: ${currentDate} at ${currentTime}\\n\\nEnter new date (YYYY-MM-DD):`,currentDate);if(!newDate)return;const newTime=prompt('Enter new time (e.g., \"9:00 AM - 11:00 AM\"):',currentTime||\"9:00 AM - 11:00 AM\");if(!newTime)return;if(!/^\\d{4}-\\d{2}-\\d{2}$/.test(newDate))return void alert(\"Invalid date format. Please use YYYY-MM-DD (e.g., 2025-12-15)\");const reason=prompt(\"Reason for reschedule (optional):\",\"\")||\"Customer request\";showLoader();try{const response=await fetch(API,{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({__action:\"reschedule_appointment\",order_id:orderId,delivery_date:newDate,delivery_time:newTime,reason:reason})}),data=await response.json();if(!response.ok||!data.ok)throw new Error(data.error||\"Reschedule failed\");alert(\" Appointment rescheduled successfully!\\n\\nNew date: \"+newDate+\"\\nNew time: \"+newTime),loadOrders()}catch(error){console.error(\"Reschedule error:\",error),alert(\"Failed to reschedule: \"+error.message+\"\\n\\nPlease call us at (864) 528-1475\")}finally{hideLoader()}},logger.log(\"? Deferred logic loaded\");\u003C/script>\n\n\u003Cscript>\n(function () {\n  // Capture the giant inline deferred app script and run it just-after-first-paint.\n  // This avoids JS compilation/parse work during initial render.\n  try {\n    if (window.__H2S_MONOLITH_CAPTURED__) return;\n\n    // If the monolith is already stored as an inert node, do not capture.\n    try {\n      var existing = document.getElementById('__H2S_APP_MONOLITH__');\n      if (existing && existing.tagName === 'SCRIPT') {\n        window.__H2S_MONOLITH_CAPTURED__ = true;\n        return;\n      }\n    } catch (_) {}\n\n    // If the app already booted (monolith already executed), do not capture/remove it.\n    // This prevents accidental double-exec via the runner.\n    if (typeof window.checkout === 'function') return;\n\n    var prev = document.currentScript && document.currentScript.previousElementSibling;\n    if (!prev || prev.tagName !== 'SCRIPT') return;\n    // Heuristic: the monolith always starts with this prefix.\n    var code = (prev.text || prev.textContent || '');\n    if (code.indexOf('\"use strict\";const isDev=') !== 0) return;\n\n    // Store code in an inert node for the runner.\n    window.__H2S_MONOLITH_CAPTURED__ = true;\n    try {\n      var inert = document.createElement('script');\n      inert.type = 'text/plain';\n      inert.id = '__H2S_APP_MONOLITH__';\n      inert.text = code;\n      prev.parentNode.insertBefore(inert, prev);\n    } catch (_) {}\n\n    // Neutralize the original deferred script in-place (do not remove it).\n    // This avoids any edge case where a removed deferred script still executes.\n    try { prev.type = 'text/plain'; } catch (_) {}\n    try { prev.removeAttribute && prev.removeAttribute('defer'); } catch (_) {}\n    try { prev.text = ''; } catch (_) {}\n    try { prev.textContent = ''; } catch (_) {}\n  } catch (_) {\n    // Fail open (page still works as before).\n  }\n})();\n\u003C/script>\n\n\u003Cscript>\n(function () {\n  function getCode() {\n    try {\n      var node = document.getElementById('__H2S_APP_MONOLITH__');\n      if (node && (node.text || node.textContent)) return node.text || node.textContent;\n    } catch (_) {}\n    return '';\n  }\n\n  function flushQueue() {\n    try {\n      var q = window.__H2S_CALL_QUEUE__;\n      if (!q || !q.length) return;\n      var next = [];\n      for (var i = 0; i \u003C q.length; i++) {\n        var item = q[i];\n        var fn = window[item && item.name];\n        if (typeof fn === 'function') {\n          try { fn.apply(window, item.args || []); } catch (_) {}\n        } else {\n          next.push(item);\n        }\n      }\n      window.__H2S_CALL_QUEUE__ = next;\n    } catch (_) {}\n  }\n\n  function run() {\n    try {\n      if (window.__H2S_MONOLITH_RAN__) return;\n\n      // If the monolith already executed (inline script ran during parsing),\n      // do NOT execute it again; just drain any queued early calls.\n      if (typeof window.checkout === 'function') {\n        window.__H2S_MONOLITH_RAN__ = true;\n        var triesBooted = 0;\n        var bootedTimer = setInterval(function () {\n          triesBooted++;\n          flushQueue();\n          if (!window.__H2S_CALL_QUEUE__ || window.__H2S_CALL_QUEUE__.length === 0 || triesBooted > 60) {\n            clearInterval(bootedTimer);\n          }\n        }, 50);\n        return;\n      }\n\n      window.__H2S_MONOLITH_RAN__ = true;\n\n      var code = getCode();\n      if (!code) return;\n\n      var s = document.createElement('script');\n      s.text = code;\n      document.head.appendChild(s);\n\n      var tries = 0;\n      var timer = setInterval(function () {\n        tries++;\n        flushQueue();\n        if (!window.__H2S_CALL_QUEUE__ || window.__H2S_CALL_QUEUE__.length === 0 || tries > 60) {\n          clearInterval(timer);\n        }\n      }, 50);\n    } catch (_) {}\n  }\n\n  // Schedule for after first paint (rAF -> next paint; setTimeout -> after paint work).\n  if (typeof requestAnimationFrame === 'function') {\n    requestAnimationFrame(function () { setTimeout(run, 0); });\n  } else {\n    setTimeout(run, 0);\n  }\n})();\n\u003C/script>\n\n\u003C!-- Performance metrics moved to deferred module to avoid main-thread work affecting LCP -->\n\u003C/div>\u003C!-- /#pageShell -->\n\u003Cdiv id=\"modalRoot\">\u003C/div>\n\u003Cscript>\n(function() {\n  // Portal Pattern: Move modal root to body to escape GHL stacking contexts\n  function moveModalsToBody() {\n    var root = document.getElementById('modalRoot');\n    if (!root) {\n      root = document.createElement('div');\n      root.id = 'modalRoot';\n      document.body.appendChild(root);\n    } else {\n      document.body.appendChild(root);\n    }\n    \n    // Move known fixed elements\n    var ids = ['quoteModal', 'modal', 'tvSizeModal', 'menuDrawer', 'cartDrawer', 'backdrop', 'urgencyBanner'];\n    ids.forEach(function(id) {\n      var el = document.getElementById(id);\n      if (el) root.appendChild(el);\n    });\n  }\n  \n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', moveModalsToBody);\n  } else {\n    moveModalsToBody();\n  }\n})();\n\n// === CHARACTER SANITIZER (Bundles Page) ===\n// Goal: ensure no mojibake/replacement characters leak into user-visible UI.\n(function(){\n  try {\n    if (window.__H2S_CHAR_SANITIZER__) return;\n    window.__H2S_CHAR_SANITIZER__ = true;\n\n    var pairs = [\n      // Common mojibake from UTF-8 -> Latin1\n      ['', ''],\n      ['', ''],\n      ['', ''],\n      ['', ''],\n      ['', ''],\n      ['', ''],\n      ['', ''],\n      ['', ''],\n      ['', ''],\n      // Replacement char sequences (keep intent: ellipsis)\n      ['', ''],\n      // Emoji mojibake in debug-only strings (remove rather than show garbage)\n      ['', ''],\n      ['', ''],\n      ['', ''],\n      ['', ''],\n    ];\n\n    function sanitizeString(s) {\n      if (!s || typeof s !== 'string') return s;\n      var out = s;\n      for (var i = 0; i \u003C pairs.length; i++) {\n        var from = pairs[i][0];\n        var to = pairs[i][1];\n        if (out.indexOf(from) !== -1) out = out.split(from).join(to);\n      }\n      // Final fallback: actual replacement character.\n      if (out.indexOf('\\uFFFD') !== -1) out = out.split('\\uFFFD').join('');\n      return out;\n    }\n\n    function sanitizeAttributes(el) {\n      try {\n        if (!el || el.nodeType !== 1) return;\n        var attrs = ['title', 'aria-label', 'placeholder'];\n        for (var i = 0; i \u003C attrs.length; i++) {\n          var k = attrs[i];\n          var v = el.getAttribute && el.getAttribute(k);\n          if (v && typeof v === 'string') {\n            var fixed = sanitizeString(v);\n            if (fixed !== v) el.setAttribute(k, fixed);\n          }\n        }\n      } catch (_) {}\n    }\n\n    function sanitizeSubtree(root) {\n      try {\n        if (!root) return;\n        if (root.nodeType === 3) {\n          var v = root.nodeValue;\n          var fixedText = sanitizeString(v);\n          if (fixedText !== v) root.nodeValue = fixedText;\n          return;\n        }\n        if (root.nodeType !== 1 && root.nodeType !== 9 && root.nodeType !== 11) return;\n\n        if (root.nodeType === 1) sanitizeAttributes(root);\n\n        var walker = document.createTreeWalker(root, NodeFilter.SHOW_TEXT, null);\n        var node;\n        while ((node = walker.nextNode())) {\n          var txt = node.nodeValue;\n          var fixed = sanitizeString(txt);\n          if (fixed !== txt) node.nodeValue = fixed;\n        }\n\n        if (root.querySelectorAll) {\n          root.querySelectorAll('[title],[aria-label],[placeholder]').forEach(function(el){\n            sanitizeAttributes(el);\n          });\n        }\n      } catch (_) {}\n    }\n\n    function runOnce() {\n      sanitizeSubtree(document.body || document.documentElement);\n      // Explicitly fix the Mount Selection Guide caret if present.\n      try {\n        var icon = document.getElementById('guideToggleIcon');\n        if (icon && typeof icon.textContent === 'string') {\n          var fixed = sanitizeString(icon.textContent);\n          if (fixed !== icon.textContent) icon.textContent = fixed;\n        }\n      } catch (_) {}\n    }\n\n    // Initial pass\n    if (document.readyState === 'loading') {\n      document.addEventListener('DOMContentLoaded', function(){\n        setTimeout(runOnce, 0);\n      }, { once: true });\n    } else {\n      setTimeout(runOnce, 0);\n    }\n\n    // Keep it clean for dynamically injected HTML (modals, orders, promo messages).\n    if (window.MutationObserver) {\n      var pending = [];\n      var scheduled = false;\n      var flush = function(){\n        scheduled = false;\n        for (var i = 0; i \u003C pending.length; i++) sanitizeSubtree(pending[i]);\n        pending = [];\n      };\n      var obs = new MutationObserver(function(muts){\n        for (var i = 0; i \u003C muts.length; i++) {\n          var m = muts[i];\n          if (m && m.addedNodes && m.addedNodes.length) {\n            for (var j = 0; j \u003C m.addedNodes.length; j++) {\n              var n = m.addedNodes[j];\n              if (n) pending.push(n);\n            }\n          }\n          if (m && m.type === 'characterData' && m.target) pending.push(m.target);\n        }\n        if (!scheduled) {\n          scheduled = true;\n          if (typeof queueMicrotask === 'function') queueMicrotask(flush);\n          else if (typeof Promise !== 'undefined') Promise.resolve().then(flush);\n          else if (typeof requestAnimationFrame === 'function') requestAnimationFrame(flush);\n          else setTimeout(flush, 0);\n        }\n      });\n      obs.observe(document.documentElement, { subtree: true, childList: true, characterData: true });\n    }\n  } catch (_) {}\n})();\n\n// === TEXT / GLYPH FIXES (Bundles Page) ===\n// Fixes a legacy encoding artifact where '?&mdash;' renders literally.\n(function(){\n  try {\n    if (typeof window.escapeHtml === 'function' && !window.escapeHtml.__h2s_textfix) {\n      var origEscapeHtml = window.escapeHtml;\n      var patched = function(text) {\n        try {\n          if (typeof text === 'string') {\n            // Replace any accidental literal HTML entity text with a real em dash.\n            text = text\n              .replace(/\\?\\s*&mdash;/g, ' ')\n              .replace(/\\?&mdash;/g, '')\n              .replace(/&mdash;/g, '');\n          }\n        } catch (_) {}\n        return origEscapeHtml(text);\n      };\n      patched.__h2s_textfix = true;\n      window.escapeHtml = patched;\n    }\n\n    if (typeof window.renderHeroReviews === 'function' && !window.renderHeroReviews.__h2s_textfix) {\n      var origRenderHeroReviews = window.renderHeroReviews;\n      window.renderHeroReviews = function(){\n        var res = origRenderHeroReviews.apply(this, arguments);\n        try {\n          document.querySelectorAll('.hero-review-text').forEach(function(el){\n            if (el && typeof el.textContent === 'string') {\n              el.textContent = el.textContent.replace('Same-day service saved me!', 'Instant booking saved me!');\n            }\n          });\n        } catch (_) {}\n        return res;\n      };\n      window.renderHeroReviews.__h2s_textfix = true;\n    }\n  } catch (_) {}\n})();\n\n// === UX / SMOOTHNESS PATCHES (Bundles Page) ===\n// Goal: improve click/close behavior + animation consistency without editing minified app code.\n(function(){\n  if (window.__H2S_BUNDLES_UX_PATCH__) return;\n  window.__H2S_BUNDLES_UX_PATCH__ = true;\n\n  function getView(){\n    try { return new URL(location.href).searchParams.get('view'); } catch (_) { return null; }\n  }\n\n  function safeCloseAll(){\n    try {\n      if (typeof window.closeAll === 'function') return window.closeAll();\n    } catch (_) {}\n    try {\n      document.getElementById('menuDrawer')?.classList.remove('open');\n      document.getElementById('cartDrawer')?.classList.remove('open');\n      document.getElementById('backdrop')?.classList.remove('show');\n      document.getElementById('modal')?.classList.remove('show');\n      document.getElementById('quoteModal')?.classList.remove('show');\n      document.getElementById('tvSizeModal')?.classList.remove('show');\n      document.documentElement.classList.remove('modal-open');\n      document.body.classList.remove('modal-open');\n      if (typeof window.H2S_unlockScroll === 'function') window.H2S_unlockScroll();\n    } catch (_) {}\n  }\n\n  function anyOverlayOpen(){\n    try {\n      return !!(\n        document.getElementById('menuDrawer')?.classList.contains('open') ||\n        document.getElementById('cartDrawer')?.classList.contains('open') ||\n        document.getElementById('modal')?.classList.contains('show') ||\n        document.getElementById('quoteModal')?.classList.contains('show') ||\n        document.getElementById('tvSizeModal')?.classList.contains('show')\n      );\n    } catch (_) {\n      return false;\n    }\n  }\n\n  // Backdrop click should consistently close overlays.\n  try {\n    var bd = document.getElementById('backdrop');\n    if (bd && !bd.__h2sUxBound) {\n      bd.addEventListener('click', function(e){\n        if (e && e.target && e.target.id === 'backdrop' && anyOverlayOpen()) safeCloseAll();\n      });\n      bd.__h2sUxBound = true;\n    }\n  } catch (_) {}\n\n  // ESC should consistently close overlays (menu/cart/modals).\n  try {\n    document.addEventListener('keydown', function(e){\n      if (e && e.key === 'Escape' && anyOverlayOpen()) {\n        e.preventDefault();\n        safeCloseAll();\n      }\n    }, { passive: false });\n  } catch (_) {}\n\n  // Ensure menu open uses the same scroll-lock behavior as cart.\n  try {\n    if (typeof window.toggleMenu === 'function' && !window.toggleMenu.__h2sUxWrapped) {\n      var origToggleMenu = window.toggleMenu;\n      window.toggleMenu = function(){\n        var wasOpen = !!document.getElementById('menuDrawer')?.classList.contains('open');\n        var res = origToggleMenu.apply(this, arguments);\n        var isOpen = !!document.getElementById('menuDrawer')?.classList.contains('open');\n        if (!wasOpen && isOpen && typeof window.H2S_lockScroll === 'function') {\n          window.H2S_lockScroll();\n        }\n        if (wasOpen && !isOpen) {\n          // Only unlock if nothing else is open.\n          if (!anyOverlayOpen() && typeof window.H2S_unlockScroll === 'function') window.H2S_unlockScroll();\n        }\n        return res;\n      };\n      window.toggleMenu.__h2sUxWrapped = true;\n    }\n  } catch (_) {}\n\n  // Success view: show loader during render and avoid pushing phone calls as the default next step.\n  function patchSuccessView(){\n    if (getView() !== 'shopsuccess') return;\n    try { if (typeof window.showLoader === 'function') window.showLoader(); } catch (_) {}\n\n    function formatMoneyMaybe(n){\n      try {\n        var v = Number(n);\n        if (!isFinite(v)) return '$0.00';\n        return (typeof window.money === 'function') ? window.money(v) : ('$' + v.toFixed(2));\n      } catch (_) {\n        return '$0.00';\n      }\n    }\n\n    function readCheckoutSnapshot(){\n      try {\n        var raw = localStorage.getItem('h2s_checkout_snapshot');\n        if (!raw) return null;\n        return JSON.parse(raw);\n      } catch (_) {\n        return null;\n      }\n    }\n\n    function parseSessionIdFromUrl(){\n      try {\n        var params = new URL(window.location.href).searchParams;\n        return params.get('session_id') || params.get('stripe_session_id') || '';\n      } catch (_) {\n        return '';\n      }\n    }\n\n    function ensureOrderValueRow(){\n      try {\n        if (document.getElementById('successOrderValue')) return;\n        var totalEl = document.getElementById('successOrderTotal');\n        if (!totalEl) return;\n        // Find the containing grid/card\n        var grid = null;\n        try { grid = totalEl.closest('.details-grid'); } catch (_) { grid = null; }\n        if (!grid) return;\n\n        // Insert a row before the total row.\n        var totalRow = null;\n        try { totalRow = totalEl.parentElement && totalEl.parentElement.parentElement ? totalEl.parentElement.parentElement : totalEl.parentElement; } catch (_) { totalRow = null; }\n        if (!totalRow || !totalRow.insertAdjacentHTML) return;\n\n        totalRow.insertAdjacentHTML('beforebegin',\n          '\u003Cdiv id=\"successOrderValueRow\" style=\"display:flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #e5e7eb;\">' +\n            '\u003Cspan style=\"font-weight: 600; color: var(--muted); font-size: 14px;\">Order Value\u003C/span>' +\n            '\u003Cspan id=\"successOrderValue\" style=\"font-weight: 800; color: var(--ink); font-size: 14px;\">Loading\u003C/span>' +\n          '\u003C/div>'\n        );\n\n        // Relabel the existing row from Total Paid -> Paid Today (so we can show value + paid).\n        try {\n          var labelSpan = totalRow.querySelector && totalRow.querySelector('span');\n          if (labelSpan && /total\\s*paid/i.test(labelSpan.textContent || '')) labelSpan.textContent = 'Paid Today';\n        } catch (_) {}\n      } catch (_) {}\n    }\n\n    async function hydrateSuccessAmountsAndItems(){\n      try {\n        if (window.__H2S_SUCCESS_HYDRATE_ONCE__) return;\n        window.__H2S_SUCCESS_HYDRATE_ONCE__ = true;\n      } catch (_) {}\n\n      ensureOrderValueRow();\n\n      var sessionId = parseSessionIdFromUrl();\n      if (!sessionId) return;\n\n      // Fast paint: use snapshot (captured pre-redirect) if available.\n      var snap = readCheckoutSnapshot();\n      try {\n        var valueElFast = document.getElementById('successOrderValue');\n        if (valueElFast && snap && typeof snap.order_value_cents === 'number') {\n          valueElFast.textContent = formatMoneyMaybe(snap.order_value_cents / 100);\n        }\n        var paidElFast = document.getElementById('successOrderTotal');\n        if (paidElFast && snap && typeof snap.expected_paid_cents === 'number') {\n          paidElFast.innerHTML = formatMoneyMaybe(snap.expected_paid_cents / 100) + ' \u003Cspan style=\"font-size: 14px; font-weight: 600; color: var(--muted);\">USD\u003C/span>';\n        }\n      } catch (_) {}\n\n      // Authoritative: order details from backend (deployment-safe endpoint).\n      // The checkout deployment supports: GET /api/get-order-details?session_id=...\n      // Retry once for transient errors, then replace infinite-loading with a customer-safe message.\n      try {\n        var endpoint = 'https://h2s-backend.vercel.app/api/get-order-details?session_id=' + encodeURIComponent(sessionId);\n\n        async function doFetch(){\n          var r = await fetch(endpoint, { method: 'GET', headers: { 'Accept': 'application/json' }, cache: 'no-store' });\n          var txt = '';\n          try { txt = await r.text(); } catch (_) { txt = ''; }\n          var parsed = null;\n          try { parsed = txt ? JSON.parse(txt) : null; } catch (_) { parsed = null; }\n          return { res: r, data: parsed, text: txt };\n        }\n\n        var attempt1 = await doFetch();\n        var r1 = attempt1.res;\n        var data1 = attempt1.data;\n\n        // Quick retry for transient/network-ish issues.\n        if (!r1.ok && (r1.status === 500 || r1.status === 502 || r1.status === 503 || r1.status === 504)) {\n          await new Promise(function(resolve){ setTimeout(resolve, 800); });\n          attempt1 = await doFetch();\n          r1 = attempt1.res;\n          data1 = attempt1.data;\n        }\n\n        if (!r1.ok || !data1 || !data1.ok || !data1.order) {\n          // Stop infinite loading.\n          try {\n            var itemsElFail = document.getElementById('successOrderItems');\n            if (itemsElFail) {\n              var shownId = sessionId;\n              var msg = \"Were confirming your order. If this doesnt update in a moment, contact support with your Order ID.\";\n              itemsElFail.innerHTML = '\u003Cdiv style=\"color: var(--muted); font-weight: 700;\">' + msg + '\u003C/div>' +\n                '\u003Cdiv style=\"margin-top:6px; font-family: monospace; font-size: 12px; color: var(--cobalt); word-break: break-all;\">' + (typeof window.escapeHtml === 'function' ? window.escapeHtml(shownId) : String(shownId)) + '\u003C/div>';\n            }\n            var valueElFail = document.getElementById('successOrderValue');\n            if (valueElFail && (valueElFail.textContent || '').indexOf('Loading') >= 0) valueElFail.textContent = '';\n            var paidElFail = document.getElementById('successOrderTotal');\n            if (paidElFail && (paidElFail.textContent || '').indexOf('Loading') >= 0) paidElFail.textContent = '';\n          } catch (_) {}\n          return;\n        }\n\n        ensureOrderValueRow();\n\n        var order = data1.order;\n\n        // Order ID display: prefer stored order_id, fallback to Stripe session id.\n        try {\n          var finalOrderId = String(order.order_id || order.stripe_session_id || sessionId || '');\n          var idEl = document.getElementById('successOrderId');\n          if (idEl && finalOrderId) {\n            var shortId = finalOrderId.length > 20 ? finalOrderId.substring(0, 20) + '...' : finalOrderId;\n            idEl.textContent = shortId;\n            idEl.title = finalOrderId;\n          }\n        } catch (_) {}\n\n        // Compute order value (pre-discount) from snapshot first, else from items' price fields.\n        var orderValue = 0;\n        try {\n          if (snap && typeof snap.order_value_cents === 'number') {\n            orderValue = snap.order_value_cents / 100;\n          }\n        } catch (_) {}\n        if (!orderValue && order && Array.isArray(order.items)) {\n          try {\n            orderValue = order.items.reduce(function(sum, it){\n              var q = Number(it.qty || it.quantity || 1) || 1;\n              var pc = Number(it.price_cents || it.price || it.unit_price_cents || 0) || 0;\n              // If pc looks like dollars, it will be \u003C 1000 typically; assume dollars only if non-integer cents provided.\n              var dollars = pc;\n              if (pc > 0 && pc > 1000) dollars = pc / 100;\n              return sum + (dollars * q);\n            }, 0);\n          } catch (_) {}\n        }\n\n        // Paid Today: prefer backend amount_total, else snapshot expected_paid.\n        var paidToday = 0;\n        try {\n          paidToday = Number(order.amount_total || order.total || 0) || 0;\n        } catch (_) { paidToday = 0; }\n        if ((!paidToday || !isFinite(paidToday)) && snap && typeof snap.expected_paid_cents === 'number') {\n          paidToday = snap.expected_paid_cents / 100;\n        }\n\n        var currency = String(order.currency || 'USD');\n\n        try {\n          var valueEl = document.getElementById('successOrderValue');\n          if (valueEl && orderValue) valueEl.textContent = formatMoneyMaybe(orderValue);\n        } catch (_) {}\n\n        try {\n          var paidEl = document.getElementById('successOrderTotal');\n          if (paidEl) {\n            paidEl.innerHTML = formatMoneyMaybe(paidToday) + ' \u003Cspan style=\"font-size: 14px; font-weight: 600; color: var(--muted);\">' + (typeof window.escapeHtml === 'function' ? window.escapeHtml(currency) : currency) + '\u003C/span>';\n          }\n        } catch (_) {}\n\n        // Items list.\n        try {\n          var itemsEl = document.getElementById('successOrderItems');\n          if (itemsEl && Array.isArray(order.items) && order.items.length) {\n            var parts = [];\n            order.items.forEach(function(it){\n              var nm = String(it.name || it.service_name || it.id || it.service_id || 'Item');\n              var q3 = Number(it.qty || it.quantity || 1) || 1;\n              parts.push('\u003Cdiv style=\"margin-bottom:4px;\"> ' + q3 + 'x ' + (typeof window.escapeHtml === 'function' ? window.escapeHtml(nm) : nm) + '\u003C/div>');\n            });\n            itemsEl.innerHTML = parts.join('');\n          }\n        } catch (_) {}\n      } catch (_) {}\n    }\n\n    // Post-process the outlet once it renders.\n    var tries = 0;\n    var t = setInterval(function(){\n      tries++;\n      var outlet = document.getElementById('outlet');\n      if (outlet) {\n        try {\n          // Keep calling as an optional secondary path (do not remove).\n          // Demote any prominent tel CTA on success (covers \"Call Us\", \"Call Support\", \"Call (864)...\", etc).\n          outlet.querySelectorAll('a[href^=\"tel:\"]').forEach(function(a){\n            if (!a) return;\n            var txt = ((a.textContent || '') + '').trim();\n            var txtLower = txt.toLowerCase();\n\n            // Heuristic: only demote links that look like primary CTAs.\n            // (If it's just inline text like \"Questions? Call...\", leave it alone.)\n            var looksButton = false;\n            try {\n              looksButton = a.classList.contains('btn') ||\n                a.classList.contains('btn-primary') ||\n                a.classList.contains('btn-secondary');\n            } catch (_) {}\n            try {\n              if (!looksButton) {\n                var bg = (a.style && a.style.background) ? String(a.style.background) : '';\n                if (bg && bg !== 'transparent' && bg !== 'none') looksButton = true;\n              }\n            } catch (_) {}\n\n            if (!looksButton) return;\n\n            // If it smells like a call CTA, demote it.\n            if (txtLower.includes('call') || txtLower.includes('support') || txtLower.includes('phone') || txtLower.includes('(864)') || txtLower.includes('864')) {\n              a.textContent = 'Prefer to call?';\n              try {\n                a.classList.remove('btn-primary');\n                a.classList.remove('btn-secondary');\n                a.classList.add('btn-ghost');\n              } catch (_) {}\n              try {\n                a.style.background = '';\n                a.style.color = '';\n                a.style.borderRadius = '';\n                a.style.fontSize = '14px';\n                a.style.opacity = '0.9';\n                a.style.marginTop = '12px';\n                a.style.padding = '';\n                a.style.display = '';\n              } catch (_) {}\n            }\n          });\n\n          // Normalize legacy fallback copy if it appears.\n          outlet.querySelectorAll('p').forEach(function(p){\n            if (!p || typeof p.textContent !== 'string') return;\n            p.textContent = p.textContent\n              .replace('Our team will contact you within 24 hours to schedule your installation.', 'Next: pick an installation time (subject to availability).');\n          });\n        } catch (_) {}\n      }\n\n      // Hide loader when success UI is present, or time out.\n      var ready = !!document.getElementById('successOrderId') || !!document.getElementById('scheduleEmbed') || (outlet && outlet.querySelector && outlet.querySelector('.schedule-container'));\n      if (ready || tries >= 40) {\n        clearInterval(t);\n        try { hydrateSuccessAmountsAndItems(); } catch (_) {}\n        try { if (typeof window.hideLoader === 'function') window.hideLoader(); } catch (_) {}\n      }\n    }, 150);\n  }\n\n  // Detect SPA-like navigation changes.\n  try {\n    var _ps = history.pushState;\n    history.pushState = function(){\n      var r = _ps.apply(this, arguments);\n      try { patchSuccessView(); } catch (_) {}\n      return r;\n    };\n    var _rs = history.replaceState;\n    history.replaceState = function(){\n      var r2 = _rs.apply(this, arguments);\n      try { patchSuccessView(); } catch (_) {}\n      return r2;\n    };\n    window.addEventListener('popstate', function(){\n      try { patchSuccessView(); } catch (_) {}\n    });\n  } catch (_) {}\n\n  try {\n    if (document.readyState === 'loading') {\n      document.addEventListener('DOMContentLoaded', patchSuccessView);\n    } else {\n      patchSuccessView();\n    }\n  } catch (_) {}\n})();\n\n// === TRACKING DEDUPE (Bundles Page) ===\n// Goal: avoid duplicate PageView/ViewContent fires from multiple layers (global header + bundles inline code).\n(function(){\n  if (window.__H2S_BUNDLES_TRACK_DEDUPE__) return;\n  window.__H2S_BUNDLES_TRACK_DEDUPE__ = true;\n\n  // Bundles page relies on the global header for PageView.\n  window.__H2S_EVENT_ONCE__ = window.__H2S_EVENT_ONCE__ || {};\n  window.__H2S_EVENT_ONCE__.pageview = true;\n\n  function norm(ev){\n    return String(ev || '').replace(/\\s+/g,'').toLowerCase();\n  }\n\n  function wrapTrackFn(key){\n    var fn = window[key];\n    if (typeof fn !== 'function' || fn.__h2s_deduped) return;\n    window[key] = function(eventName, data){\n      var k = norm(eventName);\n      if (k === 'pageview' || k === 'page_view') {\n        return;\n      }\n      if (k === 'viewcontent' || k === 'view_content') {\n        if (window.__H2S_EVENT_ONCE__.viewcontent) return;\n        window.__H2S_EVENT_ONCE__.viewcontent = true;\n      }\n      return fn.apply(this, arguments);\n    };\n    window[key].__h2s_deduped = true;\n  }\n\n  function apply(){\n    wrapTrackFn('h2sTrack');\n    wrapTrackFn('h2sFbTrack');\n  }\n\n  apply();\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', apply);\n  } else {\n    setTimeout(apply, 0);\n  }\n})();\n\n// === REVIEWS / CAROUSEL HARDENING (Bundles Page) ===\n// Goal: keep the reviews carousel rendering even if API schemas drift or reviews fail to load.\n(function(){\n  if (window.__H2S_BUNDLES_REVIEWS_PATCH__) return;\n  window.__H2S_BUNDLES_REVIEWS_PATCH__ = true;\n\n  function isDebugHost(){\n    try {\n      var h = String(location.hostname || '');\n      return h === 'localhost' || h.indexOf('127.0.0.1') >= 0 || h.indexOf('vercel.app') >= 0;\n    } catch (_) {\n      return false;\n    }\n  }\n\n  function isDebugEnabled(){\n    try {\n      if (isDebugHost()) return true;\n      try {\n        if (location && location.search && String(location.search).indexOf('debugReviews=1') >= 0) return true;\n      } catch (_) {}\n      try {\n        if (window.localStorage && localStorage.getItem('h2s_debug_reviews') === '1') return true;\n      } catch (_) {}\n    } catch (_) {}\n    return false;\n  }\n\n  function logOnce(key, level, msg){\n    try {\n      var k = '__h2s_reviews_log_' + key;\n      if (window[k]) return;\n      window[k] = true;\n      if (!isDebugEnabled()) return;\n      (console && console[level] ? console[level] : console.log).call(console, msg);\n    } catch (_) {}\n  }\n\n  function logDebug(level, msg){\n    try {\n      if (!isDebugEnabled()) return;\n      (console && console[level] ? console[level] : console.log).call(console, msg);\n    } catch (_) {}\n  }\n\n  function safeArray(x){\n    return Array.isArray(x) ? x : [];\n  }\n\n  // === UI TEXT SANITIZER (mojibake cleanup) ===\n  function h2sFixText(s){\n    if (s == null) return s;\n    s = String(s);\n\n    // Common replacement char sequence rendered as \n    s = s.replace(/\\u00EF\\u00BF\\u00BD/g, '');\n\n    // Emoji mojibake prefixes (UTF-8 bytes shown as Latin1/Windows-1252)\n    s = s.replace(/\\u00F0\\u0178\\u201C\\u0160/g, ''); // \n    s = s.replace(/\\u00F0\\u0178\\u00A7\\u00AA/g, ''); // \n    s = s.replace(/\\u00F0\\u0178\\u016A\\u00AB/g, ''); // \n\n    // Common arrows/dashes/bullets\n    s = s.replace(/\\u00E2\\u2020\\u2014/g, ''); // \n    s = s.replace(/\\u00E2\\u20AC\\u201C/g, ''); // \n    s = s.replace(/\\u00E2\\u20AC\\u201D/g, ''); // \n    s = s.replace(/\\u00E2\\u20AC\\u00A2/g, ''); // \n\n    // Checkmark/cross\n    s = s.replace(/\\u00E2\\u009C\\u0085/g, ''); // \n    s = s.replace(/\\u00E2\\u009D\\u008C/g, ''); // \n\n    // Multiplication\n    s = s.replace(/\\u00C3\\u0097/g, ''); // \n\n    // Fix stray leading question-mark in some promo copy\n    s = s.replace(/^\\?\\s+(Code recognized)/, '$1');\n\n    return s;\n  }\n\n  function h2sSanitizeTree(root){\n    if (!root) return;\n    try {\n      var walker = document.createTreeWalker(root, NodeFilter.SHOW_TEXT, null);\n      var node;\n      while ((node = walker.nextNode())) {\n        var fixed = h2sFixText(node.nodeValue);\n        if (fixed !== node.nodeValue) node.nodeValue = fixed;\n      }\n    } catch (_) {}\n  }\n\n  function installMojibakeObserver(){\n    if (window.__H2S_MOJIBAKE_OBS__) return;\n    window.__H2S_MOJIBAKE_OBS__ = true;\n\n    try { h2sSanitizeTree(document.body); } catch (_) {}\n\n    try {\n      var obs = new MutationObserver(function(muts){\n        for (var i = 0; i \u003C muts.length; i++) {\n          var m = muts[i];\n          if (m.type === 'characterData') {\n            var t = m.target;\n            if (t && t.nodeValue) {\n              var fixed = h2sFixText(t.nodeValue);\n              if (fixed !== t.nodeValue) t.nodeValue = fixed;\n            }\n          } else if (m.addedNodes && m.addedNodes.length) {\n            for (var j = 0; j \u003C m.addedNodes.length; j++) {\n              var n = m.addedNodes[j];\n              if (!n) continue;\n              if (n.nodeType === 3) {\n                var fixed2 = h2sFixText(n.nodeValue);\n                if (fixed2 !== n.nodeValue) n.nodeValue = fixed2;\n              } else if (n.nodeType === 1) {\n                h2sSanitizeTree(n);\n              }\n            }\n          }\n        }\n      });\n      obs.observe(document.documentElement || document.body, { subtree: true, childList: true, characterData: true });\n    } catch (_) {}\n  }\n\n  // === PROMO ESTIMATE: prevent flicker (stale responses) ===\n  function installPromoEstimateOverride(){\n    // IMPORTANT: This page bootstraps the main app via a deferred monolith runner.\n    // This installer must be safe to call multiple times until the app functions exist.\n    try {\n      if (!window.__H2S_PROMO_EST_STATE__) window.__H2S_PROMO_EST_STATE__ = { didOverrideUpdate: false, didWrapPaint: false };\n    } catch (_) {}\n\n    async function ensureCatalogPopulated(){\n      try {\n        if (typeof catalog !== 'undefined' && catalog && Array.isArray(catalog.bundles) && catalog.bundles.length > 0) return true;\n      } catch (_) {}\n      try {\n        // bundles-data is currently returning an empty catalog; the app has a fallback\n        // fetchCatalogFromAPI() that hits /api/shop?action=catalog.\n        if (typeof window.fetchCatalogFromAPI === 'function') {\n          var ok = await window.fetchCatalogFromAPI(true);\n          try {\n            if (ok && typeof catalog !== 'undefined' && catalog && Array.isArray(catalog.bundles) && catalog.bundles.length > 0) return true;\n          } catch (_) {}\n        }\n      } catch (_) {}\n      return false;\n    }\n\n    function buildLineItems(){\n      var out = [];\n      try {\n        (cart || []).forEach(function(item){\n          var isPkg = item && (item.type === 'package' || item.type === 'bundle');\n          var bundle = null;\n          try {\n            if (isPkg) {\n              var id = item.bundle_id || item.id;\n              bundle = (catalog && catalog.bundles ? catalog.bundles : []).find(function(b){ return b.bundle_id === id; });\n            }\n          } catch (_) {}\n\n          var priceId = (bundle && bundle.stripe_price_id) || item.stripe_price_id || 'custom';\n          var isDynamic = ['tv_multi','cam_basic','cam_standard','cam_premium'].indexOf(item.id || item.bundle_id) >= 0;\n          var unitAmount = 0;\n\n          if (bundle && !isDynamic && bundle.bundle_price !== undefined && bundle.bundle_price !== null) {\n            unitAmount = Math.round(100 * Number(bundle.bundle_price));\n          } else {\n            unitAmount = Math.round(100 * Number(item.price || 0));\n          }\n\n          if (!unitAmount || unitAmount \u003C= 0) return;\n          out.push({ price: priceId, unit_amount: unitAmount, quantity: item.qty || 1 });\n        });\n      } catch (_) {}\n      return out;\n    }\n\n    function applyEstimateToUI(code, promotionCode, savingsCents, subtotalCents, totalCents){\n      try {\n        var promoLine = document.getElementById('promoLine');\n        var promoAmount = document.getElementById('promoAmount');\n        var promoMsg = document.getElementById('promoMsg');\n        var totalLabel = document.getElementById('totalLabel');\n        var rawLine = document.getElementById('rawSubtotalLine');\n        var rawAmount = document.getElementById('rawSubtotalAmount');\n        var cartSubtotalLine = document.getElementById('cartSubtotalLine');\n        var grandTotal = document.getElementById('grandTotal');\n        var label = document.getElementById('promoLineLabel');\n\n        if (!promoLine || !promoAmount) return;\n\n        promoAmount.textContent = '-' + money(Number(savingsCents || 0) / 100);\n        if (label) label.textContent = 'Promo (' + String((promotionCode || code || '')).toUpperCase() + ')';\n        promoLine.style.display = 'flex';\n\n        if (cartSubtotalLine) cartSubtotalLine.style.display = 'none';\n        if (rawLine && rawAmount) {\n          rawAmount.textContent = money(Number(subtotalCents || 0) / 100);\n          rawLine.style.display = 'flex';\n        }\n\n        if (grandTotal) {\n          grandTotal.textContent = money(Number(totalCents || 0) / 100);\n          if (Number(totalCents || 0) === 0) { grandTotal.style.color = '#10b981'; grandTotal.style.fontSize = '20px'; }\n          else { grandTotal.style.color = ''; grandTotal.style.fontSize = ''; }\n        }\n\n        if (totalLabel) totalLabel.textContent = 'Grand Total';\n        if (promoMsg) { promoMsg.textContent = 'Code will apply at checkout.'; promoMsg.style.color = '#0b6e0b'; }\n      } catch (_) {}\n    }\n\n    async function patchedUpdatePromoEstimate(){\n      try {\n        var promoLine = document.getElementById('promoLine');\n        var promoAmount = document.getElementById('promoAmount');\n        var promoMsg = document.getElementById('promoMsg');\n        var totalLabel = document.getElementById('totalLabel');\n        var rawLine = document.getElementById('rawSubtotalLine');\n        var rawAmount = document.getElementById('rawSubtotalAmount');\n        if (!promoLine || !promoAmount) return;\n\n        if (totalLabel) totalLabel.textContent = 'Subtotal';\n        if (rawLine) rawLine.style.display = 'none';\n\n        var code = '';\n        try { code = localStorage.getItem('h2s_promo_code') || ''; } catch (_) { code = ''; }\n        if (!code) { promoLine.style.display = 'none'; return; }\n\n        var line_items = buildLineItems();\n        if (!line_items.length) { promoLine.style.display = 'none'; return; }\n\n        // If catalog is empty, buildLineItems() often falls back to price:'custom', which\n        // can cause promo_check_cart to report non-applicable even for valid codes.\n        // Force-load the fallback catalog and retry once.\n        var needsCatalog = false;\n        try {\n          needsCatalog = line_items.some(function(li){ return !li || !li.price || li.price === 'custom'; });\n        } catch (_) { needsCatalog = false; }\n        if (needsCatalog) {\n          await ensureCatalogPopulated();\n          line_items = buildLineItems();\n          try {\n            needsCatalog = line_items.some(function(li){ return !li || !li.price || li.price === 'custom'; });\n          } catch (_) { needsCatalog = false; }\n        }\n\n        // If we still cant construct real Stripe prices, dont flip the UI to not applicable\n        // (thats misleading). Keep last-good UI if available.\n        if (needsCatalog) {\n          if (promoMsg) { promoMsg.textContent = 'Checking cart'; promoMsg.style.color = '#666'; }\n          if (rawLine) rawLine.style.display = 'none';\n          return;\n        }\n\n        var cartSig = code + '|' + line_items.map(function(li){ return li.price + ':' + li.unit_amount + 'x' + li.quantity; }).join(',');\n        var rid = window.__H2S_PROMO_REQ_ID__ = (window.__H2S_PROMO_REQ_ID__ || 0) + 1;\n\n        var resp = await fetch(API, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({ __action: 'promo_check_cart', promotion_code: code, line_items: line_items })\n        });\n\n        var data = await resp.json();\n        if (rid !== window.__H2S_PROMO_REQ_ID__) return;\n\n        // If a stale non-applicable response comes back after an applicable one for the same cart, keep the good UI.\n        if (!(data && data.ok && data.applicable && data.estimate)) {\n          if (window.__H2S_PROMO_LAST_GOOD_SIG__ === cartSig && window.__H2S_PROMO_LAST_GOOD_CODE__ === code && window.__H2S_PROMO_LAST_GOOD_EST__) {\n            var last = window.__H2S_PROMO_LAST_GOOD_EST__;\n            applyEstimateToUI(code, last.promotion_code || code, last.savings_cents, last.subtotal_cents, last.total_cents);\n            return;\n          }\n        }\n\n        if (data && data.ok && data.applicable && data.estimate) {\n          window.__H2S_PROMO_LAST_GOOD_SIG__ = cartSig;\n          window.__H2S_PROMO_LAST_GOOD_CODE__ = code;\n\n          var savingsCents = Number(data.estimate.savings_cents || 0);\n          var totalCents = Number(data.estimate.total_cents || 0);\n          var subtotalCents = Number(data.estimate.subtotal_cents || 0);\n\n          window.__H2S_PROMO_LAST_GOOD_EST__ = {\n            promotion_code: data.promotion_code || code,\n            savings_cents: savingsCents,\n            subtotal_cents: subtotalCents,\n            total_cents: totalCents\n          };\n\n          applyEstimateToUI(code, data.promotion_code || code, savingsCents, subtotalCents, totalCents);\n          return;\n        }\n\n        // Not applicable\n        var cartSubtotalLine2 = document.getElementById('cartSubtotalLine');\n        if (cartSubtotalLine2) cartSubtotalLine2.style.display = 'flex';\n        promoLine.style.display = 'none';\n        if (rawLine) rawLine.style.display = 'none';\n\n        var cartSubtotal = document.getElementById('cartSubtotal');\n        var grandTotal2 = document.getElementById('grandTotal');\n        if (cartSubtotal && grandTotal2) { grandTotal2.textContent = cartSubtotal.textContent; grandTotal2.style.color = ''; grandTotal2.style.fontSize = ''; }\n        if (totalLabel) totalLabel.textContent = 'Total';\n        if (promoMsg) { promoMsg.textContent = 'This code does not apply to your current items.'; promoMsg.style.color = '#c33'; }\n      } catch (_) {\n        try {\n          var promoLine2 = document.getElementById('promoLine');\n          if (promoLine2) promoLine2.style.display = 'none';\n          var rawLine2 = document.getElementById('rawSubtotalLine');\n          if (rawLine2) rawLine2.style.display = 'none';\n        } catch (_) {}\n      }\n    }\n\n    try {\n      if (window.__H2S_PROMO_EST_STATE__) {\n        if (!window.__H2S_PROMO_EST_STATE__.didOverrideUpdate) {\n          // Only override after the app defines updatePromoEstimate, otherwise the deferred\n          // monolith can overwrite us.\n          if (typeof window.updatePromoEstimate === 'function' || typeof updatePromoEstimate === 'function') {\n            window.updatePromoEstimate = patchedUpdatePromoEstimate;\n            try { updatePromoEstimate = patchedUpdatePromoEstimate; } catch (_) {}\n            window.__H2S_PROMO_EST_STATE__.didOverrideUpdate = true;\n          }\n        }\n      } else {\n        window.updatePromoEstimate = patchedUpdatePromoEstimate;\n        try { updatePromoEstimate = patchedUpdatePromoEstimate; } catch (_) {}\n      }\n    } catch (_) {}\n\n    // paintCart() currently resets totals/promo UI on every render and then\n    // asynchronously calls updatePromoEstimate(), causing visible flicker.\n    // Wrap it so the last-good estimate is immediately re-applied after render.\n    try {\n      var origPaint = window.paintCart;\n      if (typeof origPaint === 'function' && !origPaint.__h2s_promo_wrapped) {\n        window.paintCart = function(){\n          var r = origPaint.apply(this, arguments);\n          try {\n            var code = '';\n            try { code = localStorage.getItem('h2s_promo_code') || ''; } catch (_) { code = ''; }\n            if (!code) return r;\n\n            var line_items = buildLineItems();\n            if (!line_items || !line_items.length) return r;\n            // If prices are still unresolved, try to populate the fallback catalog in the background.\n            try {\n              var needsCatalog = line_items.some(function(li){ return !li || !li.price || li.price === 'custom'; });\n              if (needsCatalog) {\n                ensureCatalogPopulated().then(function(){\n                  try { patchedUpdatePromoEstimate(); } catch (_) {}\n                });\n                return r;\n              }\n            } catch (_) {}\n            var cartSig = code + '|' + line_items.map(function(li){ return li.price + ':' + li.unit_amount + 'x' + li.quantity; }).join(',');\n\n            if (window.__H2S_PROMO_LAST_GOOD_SIG__ === cartSig && window.__H2S_PROMO_LAST_GOOD_CODE__ === code && window.__H2S_PROMO_LAST_GOOD_EST__) {\n              var last = window.__H2S_PROMO_LAST_GOOD_EST__;\n              applyEstimateToUI(code, last.promotion_code || code, last.savings_cents, last.subtotal_cents, last.total_cents);\n            }\n\n            // Refresh estimate in background (will be ignored if stale)\n            setTimeout(function(){\n              try { patchedUpdatePromoEstimate(); } catch (_) {}\n            }, 0);\n          } catch (_) {}\n          return r;\n        };\n        window.paintCart.__h2s_promo_wrapped = true;\n        try { if (window.__H2S_PROMO_EST_STATE__) window.__H2S_PROMO_EST_STATE__.didWrapPaint = true; } catch (_) {}\n      }\n    } catch (_) {}\n  }\n\n  // === REVIEWS: replace '?' stars based on rating ===\n  function installReviewsStarsFix(){\n    // Safe to call repeatedly until renderReviews exists (deferred monolith boot).\n    try {\n      if (!window.__H2S_REVIEWS_STAR_STATE__) window.__H2S_REVIEWS_STAR_STATE__ = { didWrapRender: false };\n    } catch (_) {}\n\n    function fixStars(){\n      try {\n        var track = document.getElementById('reviewTrack');\n        if (!track || !track.querySelectorAll) return;\n        var cards = track.querySelectorAll('.review-card');\n        for (var i = 0; i \u003C cards.length; i++) {\n          var card = cards[i];\n          var idx = Number(card.getAttribute('data-index') || 0);\n          var rating = 5;\n          try {\n            if (typeof allReviews !== 'undefined' && Array.isArray(allReviews) && allReviews[idx]) {\n              rating = Number(allReviews[idx].rating || allReviews[idx].stars || 5);\n            }\n          } catch (_) {}\n          rating = Math.max(1, Math.min(5, Math.round(rating)));\n          var el = card.querySelector('.review-stars');\n          if (el) el.textContent = ''.repeat(rating) + ''.repeat(5 - rating);\n        }\n      } catch (_) {}\n    }\n\n    try {\n      var orig = window.renderReviews;\n      if (typeof orig === 'function' && !orig.__h2s_wrapped) {\n        window.renderReviews = function(){\n          try {\n            // Keep the initial hardcoded placeholder review cards visible\n            // until real reviews are actually loaded.\n            if (typeof allReviews !== 'undefined' && Array.isArray(allReviews) && allReviews.length === 0) {\n              var track = document.getElementById('reviewTrack');\n              if (track && track.querySelector && track.querySelector('.review-card')) {\n                return;\n              }\n            }\n          } catch (_) {}\n\n          var r = orig.apply(this, arguments);\n          fixStars();\n          return r;\n        };\n        window.renderReviews.__h2s_wrapped = true;\n        try { if (window.__H2S_REVIEWS_STAR_STATE__) window.__H2S_REVIEWS_STAR_STATE__.didWrapRender = true; } catch (_) {}\n      }\n    } catch (_) {}\n\n    try { setTimeout(fixStars, 300); } catch (_) {}\n  }\n\n  // Post-boot patch scheduler: the main app JS is deferred, so we re-attempt\n  // these wrappers until the corresponding functions exist.\n  (function schedulePostBootPatches(){\n    try {\n      if (window.__H2S_POSTBOOT_PATCH_SCHED__) return;\n      window.__H2S_POSTBOOT_PATCH_SCHED__ = true;\n    } catch (_) {}\n\n    try { installMojibakeObserver(); } catch (_) {}\n\n    var startedAt = Date.now();\n    var intId = null;\n\n    function tick(){\n      try { installPromoEstimateOverride(); } catch (_) {}\n      try { installReviewsStarsFix(); } catch (_) {}\n\n      // If bundles-data seeded an empty catalog, kick the fallback catalog fetch once.\n      try {\n        if (!window.__H2S_CATALOG_REFILL_ONCE__) {\n          if (typeof catalog !== 'undefined' && catalog && Array.isArray(catalog.bundles) && catalog.bundles.length === 0 && typeof window.fetchCatalogFromAPI === 'function') {\n            window.__H2S_CATALOG_REFILL_ONCE__ = true;\n            window.fetchCatalogFromAPI(true).catch(function(){});\n          }\n        }\n      } catch (_) {}\n\n      var promoDone = false;\n      var reviewsDone = false;\n      try { promoDone = !!(window.__H2S_PROMO_EST_STATE__ && window.__H2S_PROMO_EST_STATE__.didOverrideUpdate && window.__H2S_PROMO_EST_STATE__.didWrapPaint); } catch (_) { promoDone = false; }\n      try { reviewsDone = !!(window.__H2S_REVIEWS_STAR_STATE__ && window.__H2S_REVIEWS_STAR_STATE__.didWrapRender); } catch (_) { reviewsDone = false; }\n\n      if ((promoDone && reviewsDone) || (Date.now() - startedAt) > 15000) {\n        try { clearInterval(intId); } catch (_) {}\n      }\n    }\n\n    try { tick(); } catch (_) {}\n    try { intId = setInterval(tick, 50); } catch (_) {}\n  })();\n\n  function normalizeReview(r){\n    if (!r || typeof r !== 'object') return null;\n\n    var displayName = (r.display_name || r.name || r.author || r.customer_name || 'Customer');\n    if (typeof displayName !== 'string') displayName = String(displayName || 'Customer');\n    displayName = displayName.trim() || 'Customer';\n\n    var text = (r.review_text || r.text || r.review || r.body || '');\n    if (typeof text !== 'string') text = String(text || '');\n    text = text.trim();\n    if (!text) return null;\n\n    var rating = r.rating;\n    if (rating == null) rating = r.stars;\n    rating = Number(rating || 5);\n    if (!isFinite(rating)) rating = 5;\n    rating = Math.max(1, Math.min(5, Math.round(rating)));\n\n    var verified = !!(r.verified || r.is_verified || r.verified_customer);\n    var services = r.services_selected || r.service || r.service_name || r.services || '';\n    if (services && typeof services !== 'string') services = String(services);\n\n    var ts = r.timestamp_iso || r.timestamp || r.created_at || r.createdAt || '';\n    if (ts && typeof ts !== 'string') ts = String(ts);\n\n    return {\n      rating: rating,\n      review_text: text,\n      display_name: displayName,\n      verified: verified,\n      services_selected: services,\n      timestamp_iso: ts,\n      // Keep alias fields for the hero widget.\n      text: text,\n      name: displayName,\n      stars: rating\n    };\n  }\n\n  function normalizeReviewsList(list){\n    var out = [];\n    safeArray(list).forEach(function(r){\n      var n = normalizeReview(r);\n      if (n) out.push(n);\n    });\n    return out;\n  }\n\n  function ensureReviewsData(){\n    try {\n      if (typeof allReviews !== 'undefined') {\n        allReviews = normalizeReviewsList(allReviews);\n      }\n    } catch (_) {}\n\n    // If heroReviews still contains placeholder testimonials (not real customers), clear it.\n    // Real reviews will repopulate via aggregated data or /api/reviews.\n    try {\n      var hasRealFromApi = (typeof reviewsLoadedFromAPI !== 'undefined' && reviewsLoadedFromAPI);\n      if (!hasRealFromApi && typeof heroReviews !== 'undefined' && Array.isArray(heroReviews) && heroReviews.length) {\n        var looksPlaceholder = heroReviews.some(function(r){\n          var a = (r && (r.author || r.name)) ? String(r.author || r.name) : '';\n          var t = (r && r.text) ? String(r.text) : '';\n          return a === 'Recent Customer' || a === 'Mike T.' || a === 'Jennifer L.' || a === 'David R.' || a === 'Amanda K.' || t.indexOf('Professional, on-time') >= 0;\n        });\n        if (looksPlaceholder) {\n          heroReviews = [];\n        }\n      }\n    } catch (_) {}\n\n    // Hero reviews widget is intentionally disabled (we keep only the main carousel).\n  }\n\n  function disableHeroReviews(){\n    try {\n      var hero = document.getElementById('heroReviews');\n      if (hero) {\n        hero.style.display = 'none';\n        hero.innerHTML = '';\n      }\n    } catch (_) {}\n\n    try {\n      if (typeof heroReviewInterval !== 'undefined' && heroReviewInterval) {\n        clearInterval(heroReviewInterval);\n        heroReviewInterval = null;\n      }\n    } catch (_) {}\n\n    try { if (typeof heroReviews !== 'undefined') heroReviews = []; } catch (_) {}\n\n    try { if (typeof window.renderHeroReviews === 'function') window.renderHeroReviews = function(){}; } catch (_) {}\n    try { if (typeof window.loadHeroReviews === 'function') window.loadHeroReviews = function(){ return Promise.resolve(); }; } catch (_) {}\n    try { if (typeof window.initHeroReviews === 'function') window.initHeroReviews = function(){}; } catch (_) {}\n    try { if (typeof window.nextHeroReview === 'function') window.nextHeroReview = function(){}; } catch (_) {}\n    try { if (typeof window.goToHeroReview === 'function') window.goToHeroReview = function(){}; } catch (_) {}\n  }\n\n  function seedPlaceholderCarouselReviews(){\n    try {\n      if (typeof allReviews === 'undefined') return;\n      try {\n        if (typeof reviewsLoadedFromAPI !== 'undefined' && reviewsLoadedFromAPI) return;\n      } catch (_) {}\n      if (Array.isArray(allReviews) && allReviews.length > 0) return;\n      allReviews = normalizeReviewsList([\n        { display_name: 'Recent Customer', rating: 5, review_text: 'Fast, professional installation. Everything looks clean and works perfectly.' },\n        { display_name: 'Recent Customer', rating: 5, review_text: 'On time, clear communication, and the setup was done right the first time.' },\n        { display_name: 'Recent Customer', rating: 5, review_text: 'Great experience from booking to completion. Highly recommend.' }\n      ]);\n      window.__h2sReviewsArePlaceholders = true;\n      logOnce('placeholders', 'info', '[Reviews] Showing placeholders; fetching real reviews');\n    } catch (_) {}\n  }\n\n  function ensurePlaceholderDOM(){\n    try {\n      var track = document.getElementById('reviewTrack');\n      var nav = document.getElementById('reviewNav');\n      if (!track || !nav) return;\n\n      var hasCards = track.querySelector && track.querySelector('.review-card');\n      var isNoReviewsMsg = (track.textContent || '').indexOf('No reviews available') >= 0;\n      if (hasCards && !isNoReviewsMsg) return;\n\n      // If the app rendered the empty message, restore placeholders immediately.\n      track.innerHTML = [\n        '\u003Cdiv class=\"review-card\" data-index=\"0\">',\n        '  \u003Cdiv class=\"review-header\">',\n        '    \u003Cdiv class=\"review-avatar\">RC\u003C/div>',\n        '    \u003Cdiv class=\"review-meta\">',\n        '      \u003Cdiv class=\"review-name\">Recent Customer\u003C/div>',\n        '      \u003Cdiv class=\"review-stars\">\u003C/div>',\n        '    \u003C/div>',\n        '  \u003C/div>',\n        '  \u003Cp class=\"review-text\">Fast, professional installation. Everything looks clean and works perfectly.\u003C/p>',\n        '  \u003Cdiv class=\"review-footer\">\u003Cdiv class=\"review-service\">Smart Home Service\u003C/div>\u003C/div>',\n        '\u003C/div>',\n        '\u003Cdiv class=\"review-card\" data-index=\"1\">',\n        '  \u003Cdiv class=\"review-header\">',\n        '    \u003Cdiv class=\"review-avatar\">RC\u003C/div>',\n        '    \u003Cdiv class=\"review-meta\">',\n        '      \u003Cdiv class=\"review-name\">Recent Customer\u003C/div>',\n        '      \u003Cdiv class=\"review-stars\">\u003C/div>',\n        '    \u003C/div>',\n        '  \u003C/div>',\n        '  \u003Cp class=\"review-text\">On time, clear communication, and the setup was done right the first time.\u003C/p>',\n        '  \u003Cdiv class=\"review-footer\">\u003Cdiv class=\"review-service\">Smart Home Service\u003C/div>\u003C/div>',\n        '\u003C/div>',\n        '\u003Cdiv class=\"review-card\" data-index=\"2\">',\n        '  \u003Cdiv class=\"review-header\">',\n        '    \u003Cdiv class=\"review-avatar\">RC\u003C/div>',\n        '    \u003Cdiv class=\"review-meta\">',\n        '      \u003Cdiv class=\"review-name\">Recent Customer\u003C/div>',\n        '      \u003Cdiv class=\"review-stars\">\u003C/div>',\n        '    \u003C/div>',\n        '  \u003C/div>',\n        '  \u003Cp class=\"review-text\">Great experience from booking to completion. Highly recommend.\u003C/p>',\n        '  \u003Cdiv class=\"review-footer\">\u003Cdiv class=\"review-service\">Smart Home Service\u003C/div>\u003C/div>',\n        '\u003C/div>'\n      ].join('\\n');\n\n      if (!nav.querySelector || !nav.querySelector('.review-dot')) {\n        nav.innerHTML = '\u003Cdiv class=\"review-dot active\" aria-label=\"Go to page 1\">\u003C/div>';\n      }\n\n      try { track.style.transform = 'translateX(0%)'; } catch (_) {}\n    } catch (_) {}\n  }\n\n  function markReviewsVisible(mode){\n    try {\n      var root = document.documentElement;\n      if (!root) return;\n      if (mode === 'loaded') {\n        root.classList.add('h2s-reviews-loaded');\n        root.classList.remove('h2s-reviews-show-placeholders');\n      } else if (mode === 'placeholders') {\n        root.classList.add('h2s-reviews-show-placeholders');\n      }\n    } catch (_) {}\n  }\n\n  function schedulePlaceholderFallback(){\n    try {\n      if (window.__h2sReviewsPlaceholderTimer) return;\n    } catch (_) {}\n\n    try {\n      window.__h2sReviewsPlaceholderTimer = setTimeout(function(){\n        try { window.__h2sReviewsPlaceholderTimer = null; } catch (_) {}\n\n        // If real reviews are already available, show them.\n        try {\n          if (typeof reviewsLoadedFromAPI !== 'undefined' && reviewsLoadedFromAPI) {\n            markReviewsVisible('loaded');\n            return;\n          }\n        } catch (_) {}\n\n        // If we have non-placeholder reviews in memory, prefer them.\n        try {\n          if (typeof allReviews !== 'undefined' && Array.isArray(allReviews) && allReviews.length > 0 && !window.__h2sReviewsArePlaceholders) {\n            markReviewsVisible('loaded');\n            return;\n          }\n        } catch (_) {}\n\n        // Otherwise, allow placeholders to render.\n        markReviewsVisible('placeholders');\n        try { ensurePlaceholderDOM(); } catch (_) {}\n        try { seedPlaceholderCarouselReviews(); } catch (_) {}\n        try { ensureCarouselPages(); } catch (_) {}\n        try { if (typeof renderReviews === 'function') renderReviews(); } catch (_) {}\n        try { if (typeof updateCarousel === 'function') updateCarousel(); } catch (_) {}\n        try { if (typeof startCarousel === 'function') startCarousel(); } catch (_) {}\n      }, 650);\n    } catch (_) {}\n  }\n\n  function ensureCarouselPages(){\n    try {\n      if (typeof allReviews === 'undefined' || !Array.isArray(allReviews)) return;\n      if (allReviews.length \u003C 2) return;\n\n      // Never duplicate placeholder reviews (avoid the 4th card peeking and the carousel looking stuck).\n      try {\n        if (window.__h2sReviewsArePlaceholders) return;\n      } catch (_) {}\n\n      var slidesPerView = window.innerWidth >= 1024 ? 3 : (window.innerWidth >= 768 ? 2 : 1);\n      var totalPages = Math.ceil(allReviews.length / slidesPerView);\n\n      // If we're exactly at a single page (e.g., 3 reviews on desktop), duplicate to allow motion.\n      if (totalPages \u003C= 1) {\n        var maxLen = Math.min(12, allReviews.length * 3);\n        while (allReviews.length \u003C Math.min(maxLen, slidesPerView + 1)) {\n          allReviews = allReviews.concat(allReviews);\n        }\n      }\n    } catch (_) {}\n  }\n\n  function fetchRealReviewsForCarousel(){\n    // NOTE: placeholders seed `allReviews` so length>0 is not sufficient.\n    // We still need to fetch when placeholders are showing.\n    try {\n      var alreadyLoaded = false;\n      try { alreadyLoaded = (typeof reviewsLoadedFromAPI !== 'undefined' && !!reviewsLoadedFromAPI); } catch (_) { alreadyLoaded = false; }\n      if (alreadyLoaded) return;\n\n      var hasAny = (typeof allReviews !== 'undefined' && Array.isArray(allReviews) && allReviews.length > 0);\n      var placeholders = false;\n      try { placeholders = !!window.__h2sReviewsArePlaceholders; } catch (_) { placeholders = false; }\n      if (hasAny && !placeholders) return;\n    } catch (_) {}\n\n    try {\n      var now = Date.now();\n      if (window.__h2sReviewsFetchInFlight) return;\n      // Only throttle successful fetches; if we failed (alias 404 / bad JSON), allow quick retry.\n      if (window.__h2sReviewsLastFetchOk && window.__h2sReviewsLastFetch && (now - window.__h2sReviewsLastFetch) \u003C 15000) return;\n      window.__h2sReviewsFetchInFlight = true;\n    } catch (_) {}\n\n    var base = null;\n    try {\n      if (typeof API !== 'undefined') base = String(API);\n    } catch (_) {}\n    if (!base) base = 'https://h2s-backend.vercel.app/api/shop';\n\n    var qs = '?limit=12&onlyVerified=true';\n    var primary = String(base).replace('/shop', '/reviews') + qs;\n    // Congruent fallback: same path on the currently-live shop deployment.\n    var SHOP_ORIGIN = 'https://h2s-backend-5o9147lik-tabari-ropers-projects-6f2e090b.vercel.app';\n    var fallback = SHOP_ORIGIN + '/api/reviews' + qs;\n\n    function pickReviews(data){\n      try {\n        if (!data) return null;\n        if (Array.isArray(data.reviews)) return data.reviews;\n        if (data.data && Array.isArray(data.data.reviews)) return data.data.reviews;\n        if (data.result && Array.isArray(data.result.reviews)) return data.result.reviews;\n        if (Array.isArray(data.data)) return data.data;\n      } catch (_) {}\n      return null;\n    }\n\n    function tryParseJson(res){\n      var ct = '';\n      try { ct = (res.headers && res.headers.get) ? (res.headers.get('content-type') || '') : ''; } catch (_) {}\n      if (ct.indexOf('application/json') >= 0) return res.json();\n      return res.text().then(function(t){\n        try { return JSON.parse(t); } catch (_) { return null; }\n      });\n    }\n\n    function attempt(url){\n      logDebug('log', '[Reviews] Fetching: ' + url);\n      return fetch(url, { cache: 'default' }).then(function(res){\n        try { logDebug('log', '[Reviews] Response ' + (res ? res.status : 'ERR') + ' for ' + url); } catch (_) {}\n        if (!res || !res.ok) throw new Error('HTTP ' + (res ? res.status : 'ERR'));\n        return tryParseJson(res);\n      });\n    }\n\n    attempt(primary)\n      .catch(function(){\n        // If the alias host is drifting/404, retry directly to the known live origin.\n        return attempt(fallback);\n      })\n      .then(function(data){\n        try {\n          var list = pickReviews(data);\n          if (!list || !list.length) throw new Error('no reviews');\n          try { window.reviewsLoadedFromAPI = true; } catch (_) {}\n          try {\n            allReviews = normalizeReviewsList(list);\n            window.__h2sReviewsArePlaceholders = false;\n            markReviewsVisible('loaded');\n            ensureCarouselPages();\n          } catch (_) {}\n          logOnce('loaded', 'info', '[Reviews] Loaded real reviews; starting carousel.');\n          try { logDebug('log', '[Reviews] Loaded count=' + (Array.isArray(allReviews) ? allReviews.length : 0)); } catch (_) {}\n          try {\n            window.__h2sReviewsLastFetchOk = true;\n            window.__h2sReviewsLastFetch = Date.now();\n          } catch (_) {}\n          try {\n            // Reset to first page and restart interval after swapping in real reviews.\n            try { if (typeof reviewInterval !== 'undefined' && reviewInterval) { clearInterval(reviewInterval); reviewInterval = null; } } catch (_) {}\n            try { if (typeof reviewIndex !== 'undefined') reviewIndex = 0; } catch (_) {}\n\n            if (typeof renderReviews === 'function') renderReviews();\n            try { if (typeof updateCarousel === 'function') updateCarousel(); } catch (_) {}\n            if (typeof startCarousel === 'function') startCarousel();\n          } catch (_) {}\n        } catch (_) {\n          try { window.__h2sReviewsLastFetchOk = false; } catch (_) {}\n        }\n      })\n      .catch(function(){\n        logOnce('failed', 'warn', '[Reviews] Failed to load real reviews (showing placeholders).');\n        try { logDebug('warn', '[Reviews] Fetch failed for both primary + fallback.'); } catch (_) {}\n        try { window.__h2sReviewsLastFetchOk = false; } catch (_) {}\n      })\n      .finally(function(){\n        try { window.__h2sReviewsFetchInFlight = false; } catch (_) {}\n      });\n  }\n\n  function fixStarsInDOM(){\n    try {\n      document.querySelectorAll('.review-card .review-stars').forEach(function(el){\n        var card = el.closest('.review-card');\n        if (!card) return;\n        var idx = Number(card.getAttribute('data-index'));\n        if (!isFinite(idx)) return;\n        try {\n          if (typeof allReviews !== 'undefined' && Array.isArray(allReviews) && allReviews[idx]) {\n            var r = Number(allReviews[idx].rating || allReviews[idx].stars || 5);\n            if (!isFinite(r)) r = 5;\n            r = Math.max(1, Math.min(5, Math.round(r)));\n            el.textContent = ''.repeat(r) + ''.repeat(5 - r);\n          }\n        } catch (_) {}\n      });\n    } catch (_) {}\n  }\n\n  function safeKickCarousel(){\n    try { if (typeof updateCarousel === 'function') updateCarousel(); } catch (_) {}\n    // Avoid repeatedly restarting the interval (core startCarousel re-binds hover listeners each call).\n    try {\n      // Allow mobile to auto-advance even while placeholders are showing.\n      // Desktop stays conservative to avoid visible swapping/jank.\n      try {\n        var isMobile = window.innerWidth \u003C 768;\n        if (window.__h2sReviewsArePlaceholders && !isMobile) return;\n      } catch (_) {}\n      var hasInterval = (typeof reviewInterval !== 'undefined' && !!reviewInterval);\n      if (!hasInterval && typeof startCarousel === 'function') startCarousel();\n    } catch (_) {}\n  }\n\n  function wrapOnce(obj, key, wrapperKey, wrapFn){\n    try {\n      var fn = obj[key];\n      if (typeof fn !== 'function' || fn[wrapperKey]) return;\n      var wrapped = wrapFn(fn);\n      wrapped[wrapperKey] = true;\n      obj[key] = wrapped;\n    } catch (_) {}\n  }\n\n  function apply(){\n    ensureReviewsData();\n    disableHeroReviews();\n\n    // Always ensure there are cards present immediately.\n    ensurePlaceholderDOM();\n    seedPlaceholderCarouselReviews();\n\n    // If the core app already loaded real reviews, show them immediately.\n    try {\n      if (typeof reviewsLoadedFromAPI !== 'undefined' && reviewsLoadedFromAPI) {\n        markReviewsVisible('loaded');\n      }\n    } catch (_) {}\n\n    try {\n      if (typeof allReviews !== 'undefined' && Array.isArray(allReviews) && allReviews.length > 0 && !window.__h2sReviewsArePlaceholders) {\n        markReviewsVisible('loaded');\n      }\n    } catch (_) {}\n\n    ensureCarouselPages();\n    fetchRealReviewsForCarousel();\n\n    // If the HTML placeholders rendered before JS, the nav may have only 1 dot.\n    // Re-render once with the placeholder data so totalPages/dots match and the carousel can advance.\n    try {\n      if (window.__h2sReviewsArePlaceholders && !window.__h2sPlaceholderNavSynced && typeof renderReviews === 'function') {\n        window.__h2sPlaceholderNavSynced = true;\n        requestAnimationFrame(function(){\n          try { renderReviews(); } catch (_) {}\n        });\n      }\n    } catch (_) {}\n\n    // Keep the main carousel visible; it will populate once /api/reviews loads.\n    try {\n      var main = document.querySelector('.review-carousel');\n      if (main && main.style.display === 'none') main.style.display = '';\n      var hero = document.getElementById('heroReviews');\n      if (hero) hero.style.display = 'none';\n    } catch (_) {}\n\n    // Wrap renderReviews to normalize input + start carousel.\n    wrapOnce(window, 'renderReviews', '__h2sReviewsWrapped', function(orig){\n      return function(){\n        ensureReviewsData();\n\n        // If we have real reviews, ensure the UI is visible (prevents being stuck hidden by the first-paint guard).\n        try {\n          var loaded = false;\n          try { loaded = (typeof reviewsLoadedFromAPI !== 'undefined' && !!reviewsLoadedFromAPI); } catch (_) { loaded = false; }\n          if (!loaded) {\n            try {\n              loaded = (typeof allReviews !== 'undefined' && Array.isArray(allReviews) && allReviews.length > 0 && !window.__h2sReviewsArePlaceholders);\n            } catch (_) { loaded = false; }\n          }\n          if (loaded) markReviewsVisible('loaded');\n        } catch (_) {}\n\n        if (typeof allReviews !== 'undefined' && Array.isArray(allReviews) && allReviews.length === 0) {\n          seedPlaceholderCarouselReviews();\n          ensureCarouselPages();\n        }\n        fetchRealReviewsForCarousel();\n        var res = orig.apply(this, arguments);\n\n        // Desktop-only: rebuild dots as starting indices (scroll-by-1, hard-stop at len-3).\n        // This prevents an \"incomplete last page\" and keeps dots consistent with allowed range.\n        try {\n          var vwDots = window.innerWidth || 0;\n          if (vwDots >= 1024) {\n            var nav = document.getElementById('reviewNav');\n            var track = document.getElementById('reviewTrack');\n            var len = 0;\n            try {\n              if (typeof allReviews !== 'undefined' && Array.isArray(allReviews)) len = allReviews.length;\n            } catch (_) { len = 0; }\n            if (!len && track) {\n              try { len = track.querySelectorAll('.review-card').length; } catch (_) { len = 0; }\n            }\n\n            if (nav && len) {\n              var maxStart = Math.max(0, len - 3);\n              var idx = 0;\n              try { idx = (typeof reviewIndex === 'number' && isFinite(reviewIndex)) ? reviewIndex : 0; } catch (_) { idx = 0; }\n              if (idx > maxStart) { idx = maxStart; try { reviewIndex = idx; } catch (_) {} }\n              nav.innerHTML = Array.from({ length: (maxStart + 1) || 1 }, function(_, i){\n                return '\u003Cdiv class=\"review-dot ' + (i === idx ? 'active' : '') + '\" onclick=\"goToReview(' + i + ')\" aria-label=\"Go to position ' + (i + 1) + '\">\u003C/div>';\n              }).join('');\n            }\n          }\n        } catch (_) {}\n\n        try { fixStarsInDOM(); } catch (_) {}\n        try { safeKickCarousel(); } catch (_) {}\n        return res;\n      };\n    });\n\n    // Wrap startCarousel to avoid rebinding hover listeners on every call.\n    // Rebinding can lead to multiple intervals (\"double speed\") after mouseleave.\n    wrapOnce(window, 'startCarousel', '__h2sStartCarouselWrapped', function(orig){\n      return function(){\n        try {\n          var carousel = document.querySelector('.review-carousel');\n\n          // Desktop-only: scroll by 1 card; clamp to maxStart=len-3; loop within range.\n          if ((window.innerWidth || 0) >= 1024) {\n            try { if (typeof reviewInterval !== 'undefined' && reviewInterval) { clearInterval(reviewInterval); reviewInterval = null; } } catch (_) {}\n\n            var len = 0;\n            try {\n              if (typeof allReviews !== 'undefined' && Array.isArray(allReviews)) len = allReviews.length;\n            } catch (_) { len = 0; }\n            if (!len) {\n              try { len = carousel ? carousel.querySelectorAll('.review-card').length : 0; } catch (_) { len = 0; }\n            }\n            var maxStart = Math.max(0, len - 3);\n            if (!len || maxStart \u003C= 0) return;\n\n            // Bind hover pause/resume once.\n            if (carousel && !carousel.__h2sHoverBound) {\n              try {\n                carousel.addEventListener('mouseenter', function(){\n                  try { if (typeof reviewInterval !== 'undefined' && reviewInterval) { clearInterval(reviewInterval); reviewInterval = null; } } catch (_) {}\n                });\n                carousel.addEventListener('mouseleave', function(){\n                  try { if (typeof startCarousel === 'function') startCarousel(); } catch (_) {}\n                });\n              } catch (_) {}\n              try { carousel.__h2sHoverBound = true; } catch (_) {}\n            }\n\n            // Clamp current index into allowed range.\n            try {\n              var idx = (typeof reviewIndex === 'number' && isFinite(reviewIndex)) ? reviewIndex : 0;\n              if (idx \u003C 0) idx = 0;\n              if (idx > maxStart) idx = maxStart;\n              reviewIndex = idx;\n            } catch (_) {}\n\n            try {\n              reviewInterval = setInterval(function(){\n                try {\n                  var idx2 = (typeof reviewIndex === 'number' && isFinite(reviewIndex)) ? reviewIndex : 0;\n                  idx2 = idx2 + 1;\n                  if (idx2 > maxStart) idx2 = 0;\n                  reviewIndex = idx2;\n                  if (typeof updateCarousel === 'function') updateCarousel();\n                } catch (_) {}\n              }, 5000);\n            } catch (_) {}\n\n            return;\n          }\n\n          if (carousel && carousel.__h2sHoverBound) {\n            try { if (typeof reviewInterval !== 'undefined' && reviewInterval) clearInterval(reviewInterval); } catch (_) {}\n\n            var slidesPerView = window.innerWidth >= 1024 ? 3 : (window.innerWidth >= 768 ? 2 : 1);\n            var len = (typeof allReviews !== 'undefined' && Array.isArray(allReviews)) ? allReviews.length : 0;\n            var totalPages = Math.ceil(len / slidesPerView);\n            if (totalPages \u003C= 1) return;\n\n            try {\n              reviewInterval = setInterval(function(){\n                try {\n                  reviewIndex++;\n                  if (reviewIndex >= totalPages) reviewIndex = 0;\n                  if (typeof updateCarousel === 'function') updateCarousel();\n                } catch (_) {}\n              }, 5000);\n            } catch (_) {}\n            return;\n          }\n\n          var res = orig.apply(this, arguments);\n          try { if (carousel) carousel.__h2sHoverBound = true; } catch (_) {}\n          return res;\n        } catch (_) {\n          return orig.apply(this, arguments);\n        }\n      };\n    });\n\n    // Wrap hero reviews loader to fail-open (do not clobber existing heroReviews on bad responses).\n    wrapOnce(window, 'loadHeroReviews', '__h2sHeroReviewsWrapped', function(orig){\n      return async function(){\n        // Hero reviews are disabled; do not fetch.\n        return;\n      };\n    });\n\n    // Wrap updateCarousel to use pixel-based stepping.\n    // The core code uses translateX(-100% * page), but % is relative to the track width,\n    // which breaks when we render true full-width cards on mobile.\n    wrapOnce(window, 'updateCarousel', '__h2sUpdateCarouselWrapped', function(orig){\n      return function(){\n        try {\n          var track = document.getElementById('reviewTrack');\n          if (!track) return orig.apply(this, arguments);\n\n          var vw = window.innerWidth || 0;\n          var slidesPerView = vw >= 1024 ? 3 : (vw >= 768 ? 2 : 1);\n          var len = 0;\n          try {\n            if (typeof allReviews !== 'undefined' && Array.isArray(allReviews)) len = allReviews.length;\n          } catch (_) {}\n          if (!len) {\n            try { len = track.querySelectorAll('.review-card').length; } catch (_) { len = 0; }\n          }\n          if (!len) return;\n\n          var totalPages = Math.ceil(len / slidesPerView);\n          if (!totalPages || totalPages \u003C= 0) return;\n\n          var idx = 0;\n          try { idx = (typeof reviewIndex === 'number' && isFinite(reviewIndex)) ? reviewIndex : 0; } catch (_) { idx = 0; }\n          var safeIndex = Math.min(Math.max(0, idx), totalPages - 1);\n\n          var firstCard = track.querySelector('.review-card');\n          if (!firstCard) return orig.apply(this, arguments);\n\n          // Mobile: step by the viewport width to guarantee perfect centering and avoid fractional-pixel drift.\n          // Our CSS makes each slide occupy exactly one viewport-width page (basis + margins == 100%).\n          if (vw \u003C 768 && slidesPerView === 1) {\n            var viewport = document.querySelector('.review-track-container');\n            var viewportW = 0;\n            try { viewportW = viewport ? (viewport.getBoundingClientRect().width || viewport.clientWidth || 0) : 0; } catch (_) { viewportW = 0; }\n            if (viewportW && isFinite(viewportW)) {\n              var xMobile = -safeIndex * viewportW;\n              track.style.transform = 'translateX(' + xMobile + 'px)';\n              try {\n                document.querySelectorAll('.review-dot').forEach(function(dot, i){\n                  var active = (i === safeIndex);\n                  if (dot.classList.contains('active') !== active) dot.classList.toggle('active', active);\n                });\n              } catch (_) {}\n              return;\n            }\n          }\n\n          var cardW = 0;\n          try { cardW = firstCard.getBoundingClientRect().width || firstCard.offsetWidth || 0; } catch (_) { cardW = 0; }\n          if (!cardW) return orig.apply(this, arguments);\n\n          var gap = 0;\n          try {\n            var cs = window.getComputedStyle(track);\n            gap = parseFloat(cs.gap || cs.columnGap || '0') || 0;\n          } catch (_) { gap = 0; }\n\n          // Account for spacing created by margins on the cards (the base CSS uses margins, not flex gap).\n          var mL = 0, mR = 0;\n          try {\n            var csCard = window.getComputedStyle(firstCard);\n            mL = parseFloat(csCard.marginLeft || '0') || 0;\n            mR = parseFloat(csCard.marginRight || '0') || 0;\n          } catch (_) { mL = 0; mR = 0; }\n\n          // Desktop-only: treat reviewIndex as a starting card index (scroll-by-1), hard-stop at len-3.\n          // This guarantees exactly 3 full cards and prevents any partial 4th/5th peeking.\n          if (vw >= 1024) {\n            var maxStart = Math.max(0, len - 3);\n            var startIdx = 0;\n            try { startIdx = (typeof reviewIndex === 'number' && isFinite(reviewIndex)) ? reviewIndex : 0; } catch (_) { startIdx = 0; }\n            startIdx = Math.min(Math.max(0, startIdx), maxStart);\n            try { reviewIndex = startIdx; } catch (_) {}\n\n            var stepOne = (cardW + gap + mL + mR);\n            var xDesk = -startIdx * stepOne;\n            track.style.transform = 'translateX(' + xDesk + 'px)';\n\n            try {\n              document.querySelectorAll('.review-dot').forEach(function(dot, i){\n                var active = (i === startIdx);\n                if (dot.classList.contains('active') !== active) dot.classList.toggle('active', active);\n              });\n            } catch (_) {}\n            return;\n          }\n\n          var step = (cardW + gap + mL + mR) * slidesPerView;\n          var x = -safeIndex * step;\n          track.style.transform = 'translateX(' + x + 'px)';\n\n          try {\n            document.querySelectorAll('.review-dot').forEach(function(dot, i){\n              var active = (i === safeIndex);\n              if (dot.classList.contains('active') !== active) dot.classList.toggle('active', active);\n            });\n          } catch (_) {}\n\n          return;\n        } catch (_) {\n          return orig.apply(this, arguments);\n        }\n      };\n    });\n  }\n\n  // Apply now + after SPA-ish rerenders.\n  function scheduleApply(){\n    try {\n      if (window.__h2sReviewsApplyScheduled) return;\n      window.__h2sReviewsApplyScheduled = true;\n    } catch (_) {}\n\n    var run = function(){\n      try { window.__h2sReviewsApplyScheduled = false; } catch (_) {}\n      try { apply(); } catch (_) {}\n    };\n\n    // Run quickly to restore placeholders, then run again after the deferred/minified script has\n    // definitely created globals like `allReviews`/`renderReviews`.\n    try { setTimeout(run, 0); } catch (_) {}\n    try { setTimeout(run, 1500); } catch (_) {}\n  }\n\n  scheduleApply();\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', function(){\n      scheduleApply();\n      // In case nothing calls renderReviews (API down), try once after paint.\n      setTimeout(function(){\n        try {\n          var track = document.getElementById('reviewTrack');\n          if (track && track.children && track.children.length === 0 && typeof renderReviews === 'function') renderReviews();\n        } catch (_) {}\n      }, 1500);\n    });\n  } else {\n    setTimeout(function(){\n      try {\n        var track = document.getElementById('reviewTrack');\n        if (track && track.children && track.children.length === 0 && typeof renderReviews === 'function') renderReviews();\n      } catch (_) {}\n    }, 1500);\n  }\n})();\n\n// === TRACKING CONGRUENCE ===\n// Fire ViewContent after 3s delay (Engaged Browser)\nsetTimeout(function() {\n  if (typeof h2sTrack === 'function') {\n    h2sTrack('ViewContent', {\n      content_name: 'Bundles Shop',\n      content_type: 'product_group',\n      page: '/bundles',\n      currency: 'USD'\n    });\n  } else {\n    console.warn('h2sTrack not found for ViewContent');\n  }\n}, 3000);\n\u003C/script>\n\n\u003Cscript>\n(function(){\n  if (typeof window.showSkeleton !== 'function') return;\n  var originalShowSkeleton = window.showSkeleton;\n  window.showSkeleton = function(){\n    try {\n      var outlet = document.getElementById('outlet');\n      if (outlet && outlet.children && outlet.children.length > 0) {\n        if (!outlet.querySelector || !outlet.querySelector('.skeleton')) {\n          return;\n        }\n      }\n    } catch (e) {}\n    return originalShowSkeleton.apply(this, arguments);\n  };\n})();\n\u003C/script>\n\n\u003Cscript defer>\n(function(){\n  try{\n    if(window.__H2S_EMPTY_CART_RESET_PATCH__) return;\n    window.__H2S_EMPTY_CART_RESET_PATCH__=!0;\n    const originalPaintCart=window.paintCart;\n    if(\"function\"!=typeof originalPaintCart) return;\n    window.paintCart=function(){\n      const result=originalPaintCart.apply(this,arguments);\n      try{\n        if(!Array.isArray(cart)||cart.length) return result;\n        const subtotal=document.getElementById(\"cartSubtotal\");\n        subtotal&&(subtotal.textContent=\"$0.00\");\n        const grandTotal=document.getElementById(\"grandTotal\");\n        grandTotal&&(grandTotal.textContent=\"$0.00\",grandTotal.style.color=\"\",grandTotal.style.fontSize=\"\");\n        const cartSubtotalLine=document.getElementById(\"cartSubtotalLine\");\n        cartSubtotalLine&&(cartSubtotalLine.style.display=\"flex\");\n        const rawLine=document.getElementById(\"rawSubtotalLine\");\n        rawLine&&(rawLine.style.display=\"none\");\n        const promoLine=document.getElementById(\"promoLine\");\n        promoLine&&(promoLine.style.display=\"none\");\n        const totalLabel=document.getElementById(\"totalLabel\");\n        totalLabel&&(totalLabel.textContent=\"Total\");\n        const promoMsg=document.getElementById(\"promoMsg\");\n        promoMsg&&(promoMsg.textContent=\"\",promoMsg.style.color=\"\");\n      }catch(_){\n        // fail open\n      }\n      return result;\n    };\n  }catch(_){\n    // fail open\n  }\n})();\n\u003C/script>\n\n\u003Cscript>\n(function(){\n  // Patch goal: ensure bundles checkout collects State and sends `service_state`.\n  // This avoids editing the huge inlined script block above.\n\n  function safeJsonParse(raw){\n    try { return JSON.parse(raw); } catch (_) { return null; }\n  }\n\n  function getPrefillState(){\n    const saved = safeJsonParse(localStorage.getItem('h2s_guest_checkout') || '{}') || {};\n    if (saved.state) return String(saved.state).trim().toUpperCase();\n    const pending = safeJsonParse(sessionStorage.getItem('h2s_pending_account') || '{}') || {};\n    const st = pending.state || pending.service_state || '';\n    return String(st || '').trim().toUpperCase();\n  }\n\n  function ensureStateField(){\n    const cityEl = document.getElementById('coCity');\n    const zipEl = document.getElementById('coZip');\n    if (!cityEl || !zipEl) return;\n    if (document.getElementById('coState')) return;\n\n    const zipContainer = zipEl.closest('div');\n    const grid = zipContainer && zipContainer.parentElement;\n    if (!grid) return;\n\n    try { grid.style.gridTemplateColumns = '2fr 1fr 1fr'; } catch (_) {}\n\n    const stateContainer = document.createElement('div');\n    stateContainer.innerHTML = [\n      '\u003Clabel style=\"display:block; font-weight:600; font-size:14px; margin-bottom:4px; color:var(--ink);\">State\u003C/label>',\n      '\u003Cinput type=\"text\" id=\"coState\" class=\"inp\" required placeholder=\"SC\" maxlength=\"2\" style=\"width:100%; text-transform:uppercase\">'\n    ].join('');\n\n    grid.insertBefore(stateContainer, zipContainer);\n\n    const st = getPrefillState();\n    const stEl = document.getElementById('coState');\n    if (stEl && st) stEl.value = st;\n  }\n\n  // Observe DOM changes so we can inject state field when checkout modal is rendered.\n  try {\n    const obs = new MutationObserver(function(){ ensureStateField(); });\n    obs.observe(document.body, { childList: true, subtree: true });\n  } catch (_) {}\n\n  // Override checkout submit handler to include state in Stripe metadata.\n  window.handleCheckoutSubmit = async function(e){\n    if (e && typeof e.preventDefault === 'function') e.preventDefault();\n    ensureStateField();\n\n    function safeJsonParse(value, fallback){\n      try { return JSON.parse(value); } catch (_) { return fallback; }\n    }\n\n    const btn = document.getElementById('coSubmitBtn');\n    const errEl = document.getElementById('coError');\n\n    function showErr(msg){\n      if (errEl) { errEl.textContent = msg; errEl.style.display = 'block'; }\n      try { alert(msg); } catch (_) {}\n    }\n\n    const name = (document.getElementById('coName')?.value || '').trim();\n    const email = (document.getElementById('coEmail')?.value || '').trim();\n    const phone = (document.getElementById('coPhone')?.value || '').trim();\n    const address = (document.getElementById('coAddress')?.value || '').trim();\n    const city = (document.getElementById('coCity')?.value || '').trim();\n    const state = (document.getElementById('coState')?.value || '').trim().toUpperCase();\n    const zip = (document.getElementById('coZip')?.value || '').trim();\n\n    if (!name || !email || !phone || !address || !city || !state || !zip) return showErr('Please fill in all fields.');\n    if (!/^[A-Z]{2}$/.test(state)) return showErr('Please enter a valid 2-letter state code (e.g., SC).');\n    if (!/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(email)) return showErr('Please enter a valid email address.');\n\n    const cart = safeJsonParse(localStorage.getItem('h2s_cart') || '[]', []);\n    if (!Array.isArray(cart) || cart.length === 0) return showErr('Your cart is empty. Please add items first.');\n\n    if (btn) { btn.disabled = true; btn.innerHTML = '\u003Cspan class=\"spinner\">\u003C/span> Processing...'; }\n    if (errEl) errEl.style.display = 'none';\n\n    const API = 'https://h2s-backend.vercel.app/api/shop';\n    const promoCode = localStorage.getItem('h2s_promo_code');\n\n    async function ensureCatalog(){\n      try {\n        if (typeof catalog !== 'undefined' && catalog && Array.isArray(catalog.bundles) && catalog.bundles.length > 0) return true;\n      } catch (_) {}\n      try {\n        if (typeof window.fetchCatalogFromAPI === 'function') {\n          const ok = await window.fetchCatalogFromAPI(true);\n          try {\n            if (ok && typeof catalog !== 'undefined' && catalog && Array.isArray(catalog.bundles) && catalog.bundles.length > 0) return true;\n          } catch (_) {}\n        }\n      } catch (_) {}\n      return false;\n    }\n\n    function resolveStripePriceId(item){\n      try {\n        if (!item) return '';\n        if (item.stripe_price_id) return String(item.stripe_price_id);\n        if (item.price_id) return String(item.price_id);\n\n        // Bundles/packages\n        const bundleId = item.bundle_id || item.id;\n        if (bundleId && typeof catalog !== 'undefined' && catalog && Array.isArray(catalog.bundles)) {\n          const b = catalog.bundles.find(function(x){ return x && x.bundle_id === bundleId; });\n          if (b && b.stripe_price_id) return String(b.stripe_price_id);\n        }\n\n        // Services with tiers\n        const serviceId = item.service_id;\n        const qty = Number(item.qty || item.quantity || 1) || 1;\n        if (serviceId && typeof catalog !== 'undefined' && catalog) {\n          if (Array.isArray(catalog.priceTiers)) {\n            const tiers = catalog.priceTiers.filter(function(t){ return t && t.service_id === serviceId; });\n            const tier = tiers.find(function(t){\n              const min = Number(t.min_qty || 0);\n              const max = (t.max_qty === '' || t.max_qty == null) ? Infinity : Number(t.max_qty);\n              return qty >= min && qty \u003C= max;\n            });\n            if (tier && tier.stripe_price_id) return String(tier.stripe_price_id);\n          }\n          if (Array.isArray(catalog.services)) {\n            const s = catalog.services.find(function(x){ return x && x.service_id === serviceId; });\n            if (s && s.stripe_price_id) return String(s.stripe_price_id);\n          }\n        }\n      } catch (_) {}\n      return '';\n    }\n\n    function buildStripeLineItems(cartRows){\n      const out = [];\n      try {\n        (cartRows || []).forEach(function(item){\n          const quantity = Number(item.qty || item.quantity || 1) || 1;\n          const priceId = resolveStripePriceId(item);\n          if (priceId) {\n            out.push({ price: priceId, quantity: quantity });\n            return;\n          }\n\n          // Fallback: dynamic price_data (only if we have a positive numeric unit price)\n          const unit = Number(item.price ?? item.unit_price ?? 0);\n          if (!isFinite(unit) || unit \u003C= 0) return;\n          out.push({\n            price_data: {\n              currency: 'usd',\n              product_data: {\n                name: String(item.name || item.service_name || item.id || item.bundle_id || 'Service').slice(0, 120)\n              },\n              unit_amount: Math.round(unit * 100)\n            },\n            quantity: quantity\n          });\n        });\n      } catch (_) {}\n      return out;\n    }\n    function truncateStripeMetaValue(value, maxLen){\n      try {\n        var s = (value == null) ? '' : (typeof value === 'string' ? value : JSON.stringify(value));\n        s = String(s);\n        var max = Number(maxLen || 450);\n        if (!isFinite(max) || max \u003C= 0) max = 450;\n        if (s.length \u003C= max) return s;\n        return s.slice(0, max);\n      } catch (_) {\n        return '';\n      }\n    }\n\n    function sanitizeCartForBackend(rawCart){\n      const out = [];\n      const dropped = [];\n\n      function toIntQty(v){\n        const n = Number(v);\n        if (!isFinite(n) || n \u003C= 0) return 1;\n        return Math.max(1, Math.round(n));\n      }\n\n      try {\n        (rawCart || []).forEach(function(item){\n          if (!item || typeof item !== 'object') { dropped.push(item); return; }\n\n          const type = String(item.type || '').toLowerCase();\n          const id = item.id || item.bundle_id || item.service_id || item.serviceId || item.service || '';\n          const qty = toIntQty(item.qty || item.quantity || 1);\n          const metadata = (item.metadata && typeof item.metadata === 'object') ? item.metadata : {};\n          const name = item.name || item.service_name || item.serviceName || '';\n\n          // 1) Bundles/packages: backend accepts item.type === 'bundle'|'package'\n          //    and uses bundle_id (or id) to look up a Stripe price ID.\n          if (type === 'bundle' || type === 'package' || item.bundle_id || String(item.bundle_id || '').length) {\n            const bundleId = item.bundle_id || item.id;\n            if (!bundleId) { dropped.push(item); return; }\n            out.push({\n              type: 'bundle',\n              id: bundleId,\n              bundle_id: bundleId,\n              qty: qty,\n              name: name || bundleId,\n              metadata: metadata\n            });\n            return;\n          }\n\n          // 2) Services: backend requires service_id (it does NOT treat id as service_id).\n          const serviceId = item.service_id || item.serviceId || (type === 'service' ? item.id : null) || null;\n          if (serviceId) {\n            out.push({\n              type: 'service',\n              service_id: serviceId,\n              qty: qty,\n              option_id: item.option_id || item.optionId || item.option || undefined,\n              name: name || serviceId,\n              metadata: metadata\n            });\n            return;\n          }\n\n          // 3) Known dynamic bundle IDs (tv_multi / cams) are handled by backend via item.id\n          //    even before it checks type/service_id. Preserve them.\n          if (item.id && ['tv_multi','cam_basic','cam_standard','cam_premium'].indexOf(String(item.id)) >= 0) {\n            out.push({ type: 'bundle', id: item.id, bundle_id: item.id, qty: qty, name: name || item.id, metadata: metadata });\n            return;\n          }\n\n          dropped.push(item);\n        });\n      } catch (_) {}\n\n      try {\n        if (dropped.length) console.warn('[Checkout] Dropped invalid cart rows (would 400):', dropped);\n      } catch (_) {}\n\n      return out;\n    }\n\n    // Use var to avoid any temporal-dead-zone issues if this block gets reordered\n    // by future edits or overwritten by deferred scripts.\n    var cartForCheckout = null;\n    cartForCheckout = sanitizeCartForBackend(cart);\n    if (!Array.isArray(cartForCheckout) || cartForCheckout.length === 0) {\n      if (btn) { btn.disabled = false; btn.textContent = 'Proceed to Payment'; }\n      return showErr('Checkout failed: cart items could not be prepared for checkout. Please refresh and try again.');\n    }\n\n    // Stripe metadata values must be \u003C= 500 chars. The cart can contain nested config\n    // (e.g., tv mount items_json) that can easily exceed that. Only send a compact\n    // summary in Stripe metadata; the full cart is still sent in the request body.\n    const cart_items_meta_obj = (cartForCheckout || []).map(function(item){\n      var id = item && (item.bundle_id || item.service_id || item.id) || '';\n      return {\n        id: id,\n        type: item && item.type || '',\n        name: item && (item.name || item.service_name || item.service_id || item.bundle_id || item.id) || '',\n        qty: item && (item.qty || item.quantity || 1) || 1,\n        // dollars -> cents\n        price_cents: Math.round((Number(item && (item.price || item.unit_price || 0)) || 0) * 100)\n      };\n    });\n    const cart_items_meta = truncateStripeMetaValue(cart_items_meta_obj, 450);\n\n    // Ensure we can build price IDs for checkout (for the newer shop handler).\n    try {\n      await ensureCatalog();\n    } catch (e) {\n      if (btn) { btn.disabled = false; btn.textContent = 'Proceed to Payment'; }\n      return showErr('Checkout failed: unable to load pricing. Please refresh and try again.');\n    }\n    const line_items = buildStripeLineItems(cartForCheckout);\n\n    const payload = {\n      __action: 'create_checkout_session',\n      customer: { name: name, email: email, phone: phone },\n      customer_email: email,\n      line_items: line_items,\n      cart: cartForCheckout,\n      source: 'shop_rebuilt',\n      success_url: 'https://home2smart.com/bundles?view=shopsuccess&session_id={CHECKOUT_SESSION_ID}',\n      cancel_url: window.location.href,\n      metadata: {\n        customer_name: name,\n        customer_phone: phone,\n        customer_email: email,\n        service_address: address,\n        service_city: city,\n        service_state: state,\n        service_zip: zip,\n        state: state,\n        source: 'shop_rebuilt',\n        cart_items: cart_items_meta\n      }\n    };\n    if (promoCode) payload.promotion_code = promoCode;\n\n    try {\n      const res = await fetch(API, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });\n      const contentType = res.headers.get('content-type') || '';\n      const data = contentType.includes('application/json') ? await res.json() : safeJsonParse(await res.text());\n      if (!res.ok || !data || !data.ok) throw new Error((data && (data.error || data.message)) || ('HTTP ' + res.status));\n      if (!data.pay || !data.pay.session_url) throw new Error('No Stripe session URL in response');\n\n      // Snapshot for success page fast rendering (keep small; avoid Stripe metadata limits).\n      try {\n        var rawCart = safeJsonParse(localStorage.getItem('h2s_cart') || '[]', []);\n        var orderValueCents = 0;\n        if (Array.isArray(rawCart)) {\n          rawCart.forEach(function(it){\n            var q = Number(it && (it.qty || it.quantity || 1)) || 1;\n            var p = Number(it && (it.price || it.unit_price || 0)) || 0;\n            if (isFinite(p) && p > 0) orderValueCents += Math.round(p * 100) * q;\n          });\n        }\n\n        var expectedPaidCents = null;\n        try {\n          // If we have a last-known promo estimate (from the cart UI), use it.\n          if (window.__H2S_PROMO_LAST_GOOD_EST__ && typeof window.__H2S_PROMO_LAST_GOOD_EST__.total_cents === 'number') {\n            expectedPaidCents = window.__H2S_PROMO_LAST_GOOD_EST__.total_cents;\n          }\n        } catch (_) {}\n\n        localStorage.setItem('h2s_checkout_snapshot', JSON.stringify({\n          session_id: data.pay.session_id || '',\n          ts: Date.now(),\n          order_value_cents: orderValueCents,\n          expected_paid_cents: expectedPaidCents,\n          promo_code: promoCode || null\n        }));\n      } catch (_) {}\n\n      try {\n        localStorage.setItem('h2s_guest_checkout', JSON.stringify({ name: name, email: email, phone: phone, address: address, city: city, state: state, zip: zip }));\n      } catch (_) {}\n\n      try {\n        document.documentElement.classList.remove('modal-open');\n        document.body.classList.remove('modal-open');\n      } catch (_) {}\n\n      window.location.href = data.pay.session_url;\n    } catch (err) {\n      showErr('Checkout failed: ' + (err && err.message ? err.message : String(err)));\n      if (btn) { btn.disabled = false; btn.textContent = 'Proceed to Payment'; }\n    }\n  };\n\n  // The main bundles app JS is deferred and may re-define handleCheckoutSubmit.\n  // Re-apply our handler for a short window so checkout stays stable.\n  try {\n    window.handleCheckoutSubmit.__h2s_checkout_override = true;\n  } catch (_) {}\n\n  try {\n    if (!window.__H2S_CHECKOUT_OVERRIDE_SCHED__) {\n      window.__H2S_CHECKOUT_OVERRIDE_SCHED__ = true;\n      const start = Date.now();\n      const overrideRef = window.handleCheckoutSubmit;\n      const id = setInterval(function(){\n        try {\n          // If overridden, restore\n          if (!window.handleCheckoutSubmit || !window.handleCheckoutSubmit.__h2s_checkout_override) {\n            window.handleCheckoutSubmit = overrideRef;\n            try { window.handleCheckoutSubmit.__h2s_checkout_override = true; } catch (_) {}\n          }\n          if ((Date.now() - start) > 15000) clearInterval(id);\n        } catch (_) { try { clearInterval(id); } catch (_) {} }\n      }, 50);\n    }\n  } catch (_) {}\n})();\n\u003C/script>\n\n\u003Cscript>\n// Runtime endpoint shim (safe, additive): rewrites stale backend alias requests to live deployments.\n(function () {\n  var OLD_ORIGIN = 'https://h2s-backend.vercel.app';\n  // NOTE: checkout + promo + bundles-data must all live on the same deployment.\n  // The production alias can lag behind; this pins calls to the known-good deployment.\n  var SHOP_ORIGIN = 'https://h2s-backend-robgbyphx-tabari-ropers-projects-6f2e090b.vercel.app';\n  var SCHED_ORIGIN = 'https://h2s-backend-robgbyphx-tabari-ropers-projects-6f2e090b.vercel.app';\n\n  if (!window.fetch || window.__H2S_FETCH_SHIM__) return;\n  window.__H2S_FETCH_SHIM__ = true;\n\n  function rewriteUrl(input) {\n    try {\n      var raw = typeof input === 'string' ? input : (input && input.url ? input.url : String(input));\n      var url = new URL(raw, window.location.href);\n\n      if (url.origin === OLD_ORIGIN) {\n        if (url.pathname.indexOf('/api/shop') === 0 || url.pathname.indexOf('/api/reviews') === 0) {\n          url = new URL(url.toString());\n          url.host = new URL(SHOP_ORIGIN).host;\n          url.protocol = 'https:';\n        } else if (url.pathname.indexOf('/api/quote') === 0 || url.pathname.indexOf('/api/promo_validate') === 0) {\n          // Quote + promo validation are shop-adjacent and are served from the shop deployment.\n          url = new URL(url.toString());\n          url.host = new URL(SHOP_ORIGIN).host;\n          url.protocol = 'https:';\n        } else if (url.pathname.indexOf('/api/bundles-data') === 0) {\n          // bundles-data is currently served from the scheduling deployment.\n          url = new URL(url.toString());\n          url.host = new URL(SCHED_ORIGIN).host;\n          url.protocol = 'https:';\n        } else if (url.pathname.indexOf('/api/schedule-appointment') === 0 || url.pathname.indexOf('/api/get-availability') === 0) {\n          url = new URL(url.toString());\n          url.host = new URL(SCHED_ORIGIN).host;\n          url.protocol = 'https:';\n        } else if (url.pathname === '/api/stats') {\n          url.pathname = '/api/v1';\n          url.searchParams.set('action', 'stats');\n        }\n      }\n\n      return url.toString();\n    } catch (_) {\n      return input;\n    }\n  }\n\n  var originalFetch = window.fetch.bind(window);\n  window.fetch = function (input, init) {\n    var rewritten = rewriteUrl(input);\n\n    // Lighthouse/perf: avoid marking bundles-data as high priority; let LCP resources win.\n    try {\n      var u = new URL(typeof rewritten === 'string' ? rewritten : (rewritten && rewritten.url) || '', window.location.href);\n      if (u.pathname.indexOf('/api/bundles-data') === 0 && init && typeof init === 'object') {\n        init = Object.assign({}, init);\n        if ('priority' in init) init.priority = 'low';\n      }\n    } catch (_) {}\n\n    var fetchInput = input;\n    try {\n      if (input instanceof Request) {\n        var baseReq = init ? new Request(input, init) : input;\n        fetchInput = new Request(rewritten, baseReq);\n        init = undefined;\n      } else {\n        fetchInput = rewritten;\n      }\n    } catch (_) {\n      fetchInput = rewritten;\n    }\n\n    return originalFetch(fetchInput, init).then(function (res) {\n      try {\n        var u = new URL(typeof rewritten === 'string' ? rewritten : (fetchInput && fetchInput.url) || '', window.location.href);\n        if (u.pathname.indexOf('/api/reviews') === 0) {\n          res.clone().json().then(function (data) {\n            try {\n              if (!data || !data.ok || !Array.isArray(data.reviews)) return;\n              if (typeof allReviews === 'undefined') return;\n              if (Array.isArray(allReviews) && allReviews.length > 0) return;\n\n              allReviews = data.reviews.map(function (r) {\n                return Object.assign({}, r, {\n                  display_name: r.display_name || r.name || 'Customer',\n                  review_text: r.review_text || r.text || '',\n                  rating: r.rating || 5\n                });\n              });\n\n              if (typeof reviewsLoadedFromAPI !== 'undefined') reviewsLoadedFromAPI = true;\n              try { typeof renderReviews === 'function' && renderReviews(); } catch (_) {}\n              try { typeof startCarousel === 'function' && startCarousel(); } catch (_) {}\n            } catch (_) {}\n          }).catch(function () {});\n        }\n      } catch (_) {}\n\n      return res;\n    });\n  };\n})();\n\u003C/script>\n\n\u003Cstyle id=\"h2s-reviews-ui-patch\">\n  /* Keep only the main (bigger) reviews carousel */\n  #heroReviews { display: none !important; }\n\n  /* Prevent hover-lift shadows from being clipped and avoid pseudo-element overlays */\n  .review-carousel { overflow-x: hidden !important; overflow-y: visible !important; }\n  .review-carousel-header { position: relative; z-index: 30; margin-bottom: 72px !important; }\n  .review-track-container { overflow-x: hidden !important; overflow-y: visible !important; position: relative; z-index: 20; padding-top: 12px !important; }\n  .review-track { position: relative; z-index: 20; }\n  .review-nav { position: relative; z-index: 20; }\n  .review-carousel::before,\n  .review-carousel::after { z-index: 5 !important; }\n\n  .review-card { z-index: 1; }\n  .review-card:hover { z-index: 25; }\n\n  /* Mobile: exactly one card visible per page (no peek/bleed). */\n  @media (max-width: 767.98px) {\n    html, body { overflow-x: hidden !important; }\n\n    /* Reduce the large vertical gaps on mobile */\n    .review-carousel { padding-top: 48px !important; padding-bottom: 24px !important; overflow: hidden !important; }\n    .review-carousel-header { margin-bottom: 28px !important; }\n\n    /* Critical: the clipping viewport must NOT add horizontal padding.\n       If the viewport has padding, the next slide becomes visible inside the padding area. */\n    .review-track-container { overflow: hidden !important; padding-left: 0 !important; padding-right: 0 !important; box-sizing: border-box; }\n    .review-track { gap: 0 !important; padding-left: 0 !important; padding-right: 0 !important; width: 100% !important; box-sizing: border-box; }\n\n    /* One slide per view: (basis + margins) == 100% so no peek is possible.\n       Provide breathing room via margins on the card itself. */\n    .review-card {\n      flex: 0 0 calc(100% - 32px) !important;\n      max-width: calc(100% - 32px) !important;\n      width: auto !important;\n      margin-left: 16px !important;\n      margin-right: 16px !important;\n      box-sizing: border-box !important;\n      min-width: 0 !important;\n    }\n\n    .review-track { padding-bottom: 16px !important; }\n    .review-nav { margin-top: 10px !important; }\n  }\n\u003C/style>\n\n\u003C/body>\n\u003C/html>\n\n\n\n\n\n\n",{"value":168},[],"ccustom-code-F7m1yuu79Z","custom-code","c-custom-code",{},[],"https://fonts.googleapis.com/css?family=Inter:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i&display=swap",[],{"title":55,"description":55,"author":55,"imageUrl":55,"isPreviewUrl":51},"home2smart.com","/bundles","rGpymHM0feZ2U2PoBVC5","Bundles","7Drmpw623JAkrfDKPdjG","\u003C!-- ========================================\n     HOME2SMART GLOBAL TRACKING CONFIG (FIXED)\n     Paste this into GoHighLevel Header Tracking\n     ======================================== -->\n\n\u003C!-- Meta Pixel Base Code (guarded, immediate load in \u003Chead>) -->\n\u003Cscript>\n  (function(){\n    if (window.__H2S_FB_INIT__) return; // guard\n    // Standard Meta Pixel loader\n    !function(f,b,e,v,n,t,s){\n      if(f.fbq) return; n=f.fbq=function(){ n.callMethod?\n      n.callMethod.apply(n,arguments):n.queue.push(arguments) };\n      if(!f._fbq) f._fbq=n; n.push=n; n.loaded=!0; n.version='2.0'; n.queue=[];\n      t=b.createElement(e); t.async=!0; t.src=v; s=b.getElementsByTagName(e)[0];\n      s.parentNode.insertBefore(t,s)\n    }(window, document, 'script', 'https://connect.facebook.net/en_US/fbevents.js');\n\n    // Initialize and track PageView once\n    try {\n      fbq('init','2384221445259822');\n      fbq('track','PageView');\n      window.__H2S_FB_INIT__ = true;\n    } catch(e) { console.warn('[Meta Pixel] init failed', e); }\n  })();\n\u003C/script>\n\n\u003C!-- Noscript fallback -->\n\u003Cnoscript>\n  \u003Cimg height=\"1\" width=\"1\" style=\"display:none\" \n       src=\"https://www.facebook.com/tr?id=2384221445259822&ev=PageView&noscript=1\" \n       alt=\"\"/>\n\u003C/noscript>\n\n\u003C!-- H2S Visitor/Session Enforcement & Backend Tracking (FIXED) -->\n\u003Cscript>\n(function(){\n  var ls = window.localStorage;\n  \n  // FIXED: Proper UUID v4 fallback (matches bundles.html)\n  function uuidv4Fallback() {\n    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n      var r = Math.random() * 16 | 0;\n      var v = c === 'x' ? r : (r & 0x3 | 0x8);\n      return v.toString(16);\n    });\n  }\n  \n  // IMPROVED: Error handling for localStorage\n  function getOrCreateVisitorId() {\n    try {\n      var vid = ls.getItem('h2s_visitor_id');\n      if (!vid) {\n        vid = (self.crypto && self.crypto.randomUUID) \n          ? self.crypto.randomUUID() \n          : uuidv4Fallback();\n        try {\n          ls.setItem('h2s_visitor_id', vid);\n        } catch(e) {\n          console.warn('[H2S Tracking] localStorage write failed, using in-memory ID');\n          window.__H2S_VISITOR_ID__ = vid;\n          return vid;\n        }\n      }\n      return vid;\n    } catch(e) {\n      console.error('[H2S Tracking] localStorage access failed', e);\n      if (!window.__H2S_VISITOR_ID__) {\n        window.__H2S_VISITOR_ID__ = 'temp_' + Date.now() + '_' + Math.random().toString(36).slice(2);\n      }\n      return window.__H2S_VISITOR_ID__;\n    }\n  }\n  \n  function getOrCreateSessionId() {\n    try {\n      var sid = ls.getItem('h2s_session_id');\n      if (!sid) {\n        sid = (self.crypto && self.crypto.randomUUID) \n          ? self.crypto.randomUUID() \n          : uuidv4Fallback();\n        try {\n          ls.setItem('h2s_session_id', sid);\n        } catch(e) {\n          console.warn('[H2S Tracking] localStorage write failed, using in-memory ID');\n          window.__H2S_SESSION_ID__ = sid;\n          return sid;\n        }\n      }\n      return sid;\n    } catch(e) {\n      console.error('[H2S Tracking] localStorage access failed', e);\n      if (!window.__H2S_SESSION_ID__) {\n        window.__H2S_SESSION_ID__ = 'temp_' + Date.now() + '_' + Math.random().toString(36).slice(2);\n      }\n      return window.__H2S_SESSION_ID__;\n    }\n  }\n  \n  // ADDED: Extract UTM parameters\n  function getUTMParams() {\n    try {\n      var urlParams = new URLSearchParams(window.location.search);\n      return {\n        utm_source: urlParams.get('utm_source') || null,\n        utm_medium: urlParams.get('utm_medium') || null,\n        utm_campaign: urlParams.get('utm_campaign') || null,\n        utm_term: urlParams.get('utm_term') || null,\n        utm_content: urlParams.get('utm_content') || null\n      };\n    } catch(e) {\n      return {\n        utm_source: null,\n        utm_medium: null,\n        utm_campaign: null,\n        utm_term: null,\n        utm_content: null\n      };\n    }\n  }\n  \n  // IMPROVED: Backend tracking helper with UTM and timestamp\n  window.h2sSendBackend = function(event_type, params) {\n    params = params || {};\n    var visitor_id = getOrCreateVisitorId();\n    var session_id = getOrCreateSessionId();\n    var utmParams = getUTMParams();\n    \n    var payload = {\n      event_type: event_type,\n      occurred_at: new Date().toISOString(), // ADDED: Explicit timestamp\n      page_url: location.href,\n      page_path: location.pathname,\n      referrer: document.referrer || '(direct)',\n      user_agent: navigator.userAgent,\n      visitor_id: visitor_id,\n      session_id: session_id,\n      utm_source: utmParams.utm_source,      // ADDED: UTM tracking\n      utm_medium: utmParams.utm_medium,\n      utm_campaign: utmParams.utm_campaign,\n      utm_term: utmParams.utm_term,\n      utm_content: utmParams.utm_content\n    };\n    \n    // Merge custom params (override UTM if explicitly provided)\n    for (var k in params) { \n      if (params.hasOwnProperty(k)) {\n        payload[k] = params[k]; \n      }\n    }\n    \n    try {\n      fetch('https://h2s-backend.vercel.app/api/track', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(payload)\n      }).then(function(res){\n        if (!res.ok) {\n          // Get error details from response\n          res.json().then(function(data) {\n            console.error('[Track] Database error:', data);\n            // Don't break the page - just log the error\n          }).catch(function() {\n            console.warn('[H2S Backend] Error', { \n              status: res.status, \n              event_type: event_type,\n              visitor_id: visitor_id.substring(0, 13) + '...'\n            });\n          });\n        }\n      }).catch(function(err){\n        console.error('[H2S Backend] Fetch failed', err);\n      });\n    } catch(e) {\n      console.error('[H2S Backend] Exception', e);\n    }\n  };\n  \n  // ADDED: Auto-send page_view to backend (debounced)\n  (function autoPageView() {\n    if (document.readyState === 'complete') {\n      setTimeout(function() {\n        window.h2sSendBackend('page_view');\n      }, 100);\n    } else {\n      var loadHandler = function() {\n        setTimeout(function() {\n          window.h2sSendBackend('page_view');\n        }, 100);\n        window.removeEventListener('load', loadHandler);\n      };\n      window.addEventListener('load', loadHandler);\n    }\n  })();\n})();\n\u003C/script>\n\n\u003C!-- Helper: standardized page event wrapper -->\n\u003Cscript>\n  window.h2sFbTrack = function(eventName, params){\n    try{\n      var extra = {\n        page_path: location.pathname,\n        page_url: location.href,\n        page_title: document.title\n      };\n      fbq('track', eventName, Object.assign(extra, params||{}));\n    } catch(e){ console.warn('[Meta Pixel] track failed', e); }\n  };\n\u003C/script>\n\n\u003C!-- Initialization Complete -->\n\u003Cscript>\n  console.log('[Global Tracking] Initialized: Meta Pixel + Backend Tracking (Fixed)');\n\u003C/script>\n\n",[184],{"id":185,"elements":186,"activeElementId":185},"hl_main_popup-WiEb801Qgf",[187],{"extra":188,"class":204,"styles":210,"wrapper":226,"customCss":227,"id":185,"child":228,"meta":229,"title":230,"tag":55},{"bgImage":189,"overlayColor":191,"left":193,"popupDisabled":195,"popupHide":196,"minWidth":197,"showPopupOnMouseOut":199,"customClass":201,"position":203},{"value":190},{"mediaType":54,"url":55,"opacity":56,"options":57,"svgCode":55,"videoUrl":55,"videoThumbnail":55,"videoLoop":58},{"value":192},"var(--overlay)",{"value":194,"unit":100},50,{"value":51},{"value":51},{"value":198},"medium-page",{"value":200,"delay":157},"exit",{"value":202},[],{"value":142},{"borders":205,"borderRadius":207,"radiusEdge":209},{"value":206},"borderFull",{"value":208},"radius2",{"value":22},{"boxShadow":211,"paddingTop":212,"paddingBottom":213,"paddingLeft":214,"paddingRight":215,"marginTop":216,"borderColor":217,"borderWidth":219,"borderStyle":221,"backgroundColor":222,"width":224},{"value":22},{"unit":26,"value":30},{"unit":26,"value":30},{"unit":26,"value":30},{"value":30,"unit":26},{"unit":26,"value":27},{"value":218},"var(--gray)",{"value":220,"unit":26},"10",{"value":45},{"value":223},"var(--white)",{"value":225,"unit":26},"720",{},[],[],"hl_main_popup","Popup","https://stcdn.leadconnectorhq.com/funnel/icon/favicon.ico","pRqon5YCr9Hd0P0moigi","Home2Smart","43f16364-8acd-4745-ab0b-8c3c851e85a8",[],["Reactive",237],{"$snuxt-delay-hydration-mode":238,"$snuxt-i18n-meta":239,"$spreviewState":240,"$smetaPixelOptions":575},"manual",{},{"defaultSettings":241,"mobileDevice":51,"funnelId":232,"funnelDomain":177,"stepId":234,"locationId":181,"funnelPageId":179,"locationCode":323,"funnelNextStep":324,"fingerprint":55,"funnelNextPageId":325,"stripePublishableKey":326,"enablePaymentElement":58,"merchantLoginId":55,"paypalPublishableKey":55,"merchantAccountId":-1,"stripeAccountId":327,"isLivePaymentMode":58,"version":328,"funnelSteps":329,"cartItems":559,"funnelName":233,"orderFormVersion":149,"currency":560,"blogSlug":55,"domain":177,"pageUrl":178,"pageName":180,"affiliateId":-1,"videoExistsInPage":51,"pageType":561,"contactId":-1,"email":-1,"phone":-1,"categoryId":55,"blogSearchTerm":55,"categoryUrlSlug":55,"authorSlug":55,"tagSlug":55,"authorId":55,"defaultPaymentProvider":55,"productCollections":562,"ecomSelectedCollection":55,"imageOptimizationEnabled":58,"nmiMerchantGatewayId":55,"squareMerchantGatewayId":55,"fontsToLoad":563,"ecomProductId":55,"isGdprCompliant":51,"isOptimisePageLoad":58,"ecommercePage":157,"isBlogActive":51,"blogData":564,"blogPaths":-1,"blogId":232,"allowedCookies":565,"paymentProviderDetails":-1,"events":566,"searchTerm":55,"countryList":567,"pixelToInit":235,"formAction":55,"ecomProduct":568,"requireCreditCard":58,"haveBlogWidget":51,"isFacebookIAB":51,"userAgent":55,"companyId":569,"customerLoginToken":55,"cookieConsentList":570,"cookieConsentExpiry":571,"mediaFormats":572,"adyenMerchantGatewayId":55,"webinarProperties":574,"webinarSession":574,"userWebinarSession":574},{"typography":242,"background":262,"percentWidth":266,"offsetColor":300,"progressBarSize":313},{"fonts":243,"colors":254},{"headlineFont":244,"contentFont":250},{"id":245,"text":246,"value":247},"headlinefont","Headline Font",{"text":248,"value":249},"Inter","var(--inter)",{"id":251,"text":252,"value":253},"contentfont","Content Font",{"text":248,"value":249},{"textColor":255,"linkColor":258},{"value":256},{"label":41,"value":257},"#000000",{"value":259},{"label":260,"value":261},"var(--blue)","#188bf6",{"bgImage":263,"backgroundColor":265},{"value":264},{"url":55,"options":57},{"value":223},[267,270,273,276,279,282,285,288,291,294,297],{"text":268,"value":269},"0 Percent","progress0",{"text":271,"value":272},"10 Percent","progress10",{"text":274,"value":275},"20 Percent","progress20",{"text":277,"value":278},"30 Percent","progress30",{"text":280,"value":281},"40 Percent","progress40",{"text":283,"value":284},"50 Percent","progress50",{"text":286,"value":287},"60 Percent","progress60",{"text":289,"value":290},"70 Percent","progress70",{"text":292,"value":293},"80 Percent","progress80",{"text":295,"value":296},"90 Percent","progress90",{"text":298,"value":299},"100 Percent","progress100",[301,304,307,310],{"text":302,"value":303},"White","progressbarOffsetWhite",{"text":305,"value":306},"Transparent White","progressbarOffsetTransparentWhite",{"text":308,"value":309},"Black","progressbarOffsetBlack",{"text":311,"value":312},"Transparent Black","progressbarOffsetTransparentBlack",[314,317,320],{"text":315,"value":316},"Small","progressbarSmall",{"text":318,"value":319},"Medium","progressbarMedium",{"text":321,"value":322},"Large","progressbarLarge","US","/success","rbOtqzWiq4rB4BxBxU4u","pk_live_MtxwO3obi7pfD7UZlGkfR2yj","acct_1KgfHxLuMP6aPhGZ",4,[330,335,340,346,351,356,362,368,374,380,385,391,397,403,409,415,421,427,433,439,444,449,454,460,466,472,477,483,488,493,499,505,511,517,523,529,535,541,547,549,553],{"url":331,"value":332,"type":333,"sequence":157,"id":334,"name":233,"split":51},"/home","b73c9e82-0fa5-4256-a17f-d10c5c936bac","optin_funnel_page","9nOE3xWZARRJFgr9rdtc",{"url":336,"value":337,"type":333,"sequence":149,"id":338,"name":339,"split":51},"/careers","65575ffd-b4ae-4a07-8e66-6f4492270363","bRmHv8wuZJRIW9qno3nx","Careers",{"url":341,"value":342,"type":333,"sequence":343,"id":344,"name":345,"split":51},"/employee-portal","fea7be9e-36d1-4fe4-8794-cc255780c833",3,"pXszVV5Q3GOPtv2tZONM","Portal",{"url":347,"value":348,"type":333,"sequence":328,"id":349,"name":350,"split":51},"/tvmount","10754331-27fa-4044-934b-e328ee4ce691","EadJe83HMVYdkLC6UV4d","tv mounting",{"url":352,"value":353,"type":333,"sequence":82,"id":354,"name":355,"split":51},"/smart","6e2a97f8-da85-4337-af1a-4c1fe7ff1e5b","27aPY1JDQSWgWe4qAWjK","smart integrations",{"url":357,"value":358,"type":333,"sequence":359,"id":360,"name":361,"split":51},"/wholehome","e85a08bb-b35c-4c51-9f2c-bb933e20d52b",6,"KcqNAH8KO6leEnVQroTA","Whole Home Integration",{"url":363,"value":364,"type":333,"sequence":365,"id":366,"name":367,"split":51},"/lighting","ef41cd79-483b-4c80-ab24-5a8b53bed53b",7,"wLz2pNKbuV5xyj2slISm","Lighting",{"url":369,"value":370,"type":333,"sequence":371,"id":372,"name":373,"split":51},"/automation","d17c0a47-cd3f-4d75-9dc3-27c847836e99",8,"osskY9aQQ3lqOQEl5Nxm","Smart Automations",{"url":375,"value":376,"type":333,"sequence":377,"id":378,"name":379,"split":51},"/speakers","8142b941-6c02-47da-804d-02c14f4c43eb",9,"05pXaBCzUppTmtoS4HJY","Speakers/Hubs",{"url":381,"value":382,"type":333,"sequence":85,"id":383,"name":384,"split":51},"/thermostats","89c42da1-a5ef-477e-ad1b-cc22b203b4d7","7nwbYNqipoNxJ9uZUchJ","Thermostats",{"url":386,"value":387,"type":333,"sequence":388,"id":389,"name":390,"split":51},"/cameras","7972d03d-e36c-404c-b028-1973f6b44826",11,"2Xlzy3AyoYLkE1Xd4sg6","Cameras",{"url":392,"value":393,"type":333,"sequence":394,"id":395,"name":396,"split":51},"/locks","6fa60c11-def3-4991-be82-f01b2f88530f",12,"SuJ4rAQB8wmHvvcKW2X0","locks",{"url":398,"value":399,"type":333,"sequence":400,"id":401,"name":402,"split":51},"/doorbells","0885ee6c-aab2-4773-a170-59c48b15f2cf",13,"l93kVVynGtvl8fC0kv77","doorbells",{"url":404,"value":405,"type":333,"sequence":406,"id":407,"name":408,"split":51},"/securityproducts","4ede6476-289a-4455-90cf-963e2e9543c1",14,"tHHxU7XoSx5hupy3W32I","security products",{"url":410,"value":411,"type":333,"sequence":412,"id":413,"name":414,"split":51},"/more","a0f7ab90-8ca2-4f15-84e4-a79af17e0104",15,"VW9CMnwxLuBSmZOnAafE","more",{"url":416,"value":417,"type":333,"sequence":418,"id":419,"name":420,"split":51},"/compare","01af6319-1c7b-4c9e-bfdd-278d40f22446",16,"7CDGUL48ONCxORXoqB5c","Compare",{"url":422,"value":423,"type":333,"sequence":424,"id":425,"name":426,"split":51},"/charlotte-tv-mounting","008bd66c-4f50-4ae5-a7e5-2a89fedee210",17,"eEemZMdmnAT28qVAbHEz","CLT Mounting",{"url":428,"value":429,"type":333,"sequence":430,"id":431,"name":432,"split":51},"/greenville-sc/tv-mounting","1fccc1f2-4006-4e14-a342-e9ce48316ea6",18,"8jVtz7OYE4FiJXSLKcgq","Greenville tv",{"url":434,"value":435,"type":333,"sequence":436,"id":437,"name":438,"split":51},"/compare/geek-squad-alternative","b6f7fd17-d54d-415c-bc3f-f77fc3dc0c38",19,"CUEkO2xF8ivqOrX754o5","Geek Squad alternative",{"url":440,"value":441,"type":333,"sequence":30,"id":442,"name":443,"split":51},"/compare/hellotech-alternative","e730267a-11c8-46b8-8878-14e9d489178d","jVXOwIkrsifvdRO8TSV3","compare/hellotech-alternative",{"url":445,"value":446,"type":333,"sequence":447,"id":448,"name":445,"split":51},"/security/charlotte","426acaec-fb42-4b74-9ea6-286a323cbe77",21,"AGrQOMub8xnjnJEWDm2z",{"url":450,"value":451,"type":333,"sequence":452,"id":453,"name":450,"split":51},"/security/greenville-sc","329339d1-4f23-4cd2-b85f-dab49653c220",22,"0gfhPHKYX9xZxwssn5FU",{"url":455,"value":456,"type":333,"sequence":457,"id":458,"name":459,"split":51},"/taskrabbit-vs-pro-tv-mounting","aa4c123c-b21f-4c12-866b-b9c14bea30f4",23,"dQcK8M04OwaJ66hgRz66","taskrabbit-vs-pro-tv-mounting",{"url":461,"value":462,"type":333,"sequence":463,"id":464,"name":465,"split":51},"/smart/charlotte","284c0458-7f3b-4a0c-ba8f-ed47aa18bf5b",24,"VhAbw2dNZAzvW6JkfsFq","smart/charlotte",{"url":467,"value":468,"type":333,"sequence":469,"id":470,"name":471,"split":51},"/smart/greenville-sc","96327f77-3485-4615-97ee-57b96a22aec0",25,"2i1qO0I5sG1j7CcxupBj","smart/greenville-sc",{"url":473,"value":474,"type":333,"sequence":475,"id":476,"name":473,"split":51},"/charlotte/tv-mounting","5ddbe190-51f0-420e-8f37-cc4f1d914060",26,"aC4pqkien6sxNxnkQibF",{"url":478,"value":479,"type":333,"sequence":480,"id":481,"name":482,"split":51},"/greenville-sc/tv-mounting-1302","db34fd63-98e9-496c-a148-838c9fcfec77",27,"I034PrjSmY0GbS3yEb5j","greenville-sc/tv-mounting",{"url":484,"value":485,"type":333,"sequence":486,"id":487,"name":484,"split":51},"/tvmount/pricing","29487081-999b-4a78-a0c4-781d8bc29397",28,"l11D0uo298iBHyYUkcgy",{"url":489,"value":490,"type":333,"sequence":491,"id":492,"name":489,"split":51},"/security/pricing","f68b1f2f-2ffd-446e-996f-42de0a38cea8",29,"HIGEtTXfSGlytcxOcMeT",{"url":494,"value":495,"type":333,"sequence":496,"id":497,"name":498,"split":51},"/tvmountsuccess","58068bea-e2bf-4142-9c01-272fea733d19",30,"KUU7YuVUm2Rmz2Pwao8J","TV mount payment done",{"url":500,"value":501,"type":333,"sequence":502,"id":503,"name":504,"split":51},"/privacy-policy","823f5998-8e67-4c32-bd6f-47d1e4ed605c",31,"kJ3xlM93diO1xDEj3Jub","Privacy Policy",{"url":506,"value":507,"type":333,"sequence":508,"id":509,"name":510,"split":51},"/terms","274ad3eb-6102-491f-9e1b-9d12b90be553",32,"dxU5baGYFfTHGjRxuhow","Terms",{"url":512,"value":513,"type":333,"sequence":514,"id":515,"name":516,"split":51},"/shop","5703507d-3f97-4016-8441-dbe799b4b991",33,"NFOvle4hv8HiddBiqoHI","Shop",{"url":518,"value":519,"type":333,"sequence":520,"id":521,"name":522,"split":51},"/pros","58f5b986-6473-417c-a35c-d52e40d8f26a",34,"PeIEsY3XzE47iXn2CP7X","Pros",{"url":524,"value":525,"type":333,"sequence":526,"id":527,"name":528,"split":51},"/portal","41ea6163-d98a-4d15-b6e1-7c95989f778b",35,"vjSgD2zSgFNFUKLKkBR4","pro portal",{"url":530,"value":531,"type":333,"sequence":532,"id":533,"name":534,"split":51},"/reviews","fe0d1420-2035-435e-b728-634ecc753520",36,"hj9d2PRcKHQsUPzLz6vP","Reviews",{"url":536,"value":537,"type":333,"sequence":538,"id":539,"name":540,"split":51},"/404","2ab8e8a2-24c1-4e67-beb9-9a116ec08933",37,"3WZeO8r63MsHQdompAUB","404",{"url":542,"value":543,"type":333,"sequence":544,"id":545,"name":546,"split":51},"/security","53136f6f-4ee6-421d-b61b-62f9cf0ba7e3",38,"k4lZ9sz2eN85YatTDGYA","Security Installations",{"url":178,"value":234,"type":333,"sequence":548,"id":179,"name":180,"split":51},39,{"url":324,"value":550,"type":333,"sequence":551,"id":325,"name":552,"split":51},"ce126425-8090-43e7-96e3-d547c440a715",40,"success",{"url":554,"value":555,"type":333,"sequence":556,"id":557,"name":558,"split":51},"/test","3e34f5a3-adc6-4382-b11a-7bc9f4948447",41,"Wx3PU0DELV50n1rgFE9x","test",[],"USD","website",[],[248],{},[],[],[],{},"GjKbZqsiOlDdOgzA7zJH",[],["Date","2025-12-28T23:39:04.674Z"],{"formats":573},[],null,{"pixelID":574,"disabled":51,"track":576,"version":577,"isEnabled":58,"pixelLoaded":51,"manualMode":58,"userData":574,"eventsQueue":578},"PageView","2.0",[],["Set"],["ShallowReactive",581],{"pageData":574}]</script>
<script>window.__NUXT__={};window.__NUXT__.config={public:{baseUrl:"https://apisystem.tech",newBaseURL:"https://backend.leadconnectorhq.com/appengine",serverBaseUrl:"https://apisystem.tech",NODE_ENV:"production",REVIEW_WIDGET_URL:"https://backend.leadconnectorhq.com/appengine/reviews/get_widget/",REST_API_URLS:"https://backend.leadconnectorhq.com",STATS_API_URL:"https://backend.leadconnectorhq.com",OLD_STORAGE_API_URL1_CDN:"https://cdn.msgsndr.com",OLD_STORAGE_API_URL2_CDN:"https://assets.cdn.msgsndr.com",STORAGE_API_URL1_CDN:"https://cdn.filesafe.space",STORAGE_API_URL2_CDN:"https://assets.cdn.filesafe.space",paymentsServiceUrl:"https://backend.leadconnectorhq.com",HLS_URL:"https://content.apisystem.tech",IMAGE_CDN:"https://images.leadconnectorhq.com",IMAGE_CDN_WHITELIST:["assets.cdn.msgsndr.com","cdn.msgsndr.com","cdn.filesafe.space","assets.cdn.filesafe.space","storage.googleapis.com","firebasestorage.googleapis.com"],authorizeAcceptJsUrlTestMode:"https://jstest.authorize.net/v1/Accept.js",authorizeAcceptJsUrlLiveMode:"https://js.authorize.net/v1/Accept.js",nmiPaymentProviderScriptUrl:"https://secure.safewebservices.com/token/Collect.js",FORMS_SERVICE_URL:"https://backend.leadconnectorhq.com",SURVEYS_SERVICE_URL:"https://backend.leadconnectorhq.com",QR_CODE_SERVICE_URL:"https://backend.leadconnectorhq.com",GOOGLE_API_SERVICE_URL:"https://services.leadconnectorhq.com/common-google",ECOMMERCE_SERVICE_URL:"https://backend.leadconnectorhq.com/ecommerce",HL_HOMEPAGE_STEPID:"6dcfb06b-9734-44bd-bbcc-8bd4b7fec976",STRIPE_BNPL_CONFIGURATION_TEST:"pmc_1OaAR1FpU9DlKp7RH0HHU4xH",STRIPE_BNPL_CONFIGURATION_LIVE:"pmc_1OlnyOFpU9DlKp7R4tTHuihw",STRIPE_PMC_KEY_TEST:"pmc_1Ps2bTFpU9DlKp7RmgTzmJUL",STRIPE_PMC_KEY_LIVE:"pmc_1PzYYpFpU9DlKp7RcgxVmcvS",STRIPE_DEFAULT_CONFIGURATION_TEST:"pmc_1M95aRFpU9DlKp7ReIqqY0PP",STRIPE_DEFAULT_CONFIGURATION_LIVE:"pmc_1NYilsFpU9DlKp7RkMiUNrKE",STRIPE_DEFAULT_CONFIGURATION_TEST_SURVEY:"pmc_1QrvB7FpU9DlKp7RcL9L2idV",STRIPE_DEFAULT_CONFIGURATION_LIVE_SURVEY:"pmc_1Qwds7FpU9DlKp7RMCBlclQ0",STRIPE_DEFAULT_CONFIGURATION_TEST_FORM:"pmc_1Qodu1FpU9DlKp7RoWHB8Txx",STRIPE_DEFAULT_CONFIGURATION_LIVE_FORM:"pmc_1QwcV0FpU9DlKp7RORUHPK8B",STRIPE_CARD_ONLY_TEST_PMC:"pmc_1PVvmcFpU9DlKp7RFsjX5G7G",STRIPE_CARD_ONLY_LIVE_PMC:"pmc_1PVvogFpU9DlKp7Rj8F0ITLV",ENTERPRISE_RECAPTCHA_SITE_KEY:"6LeDBFwpAAAAAJe8ux9-imrqZ2ueRsEtdiWoDDpX",STRIPE_ONE_STEP_PMC_ID_TEST:"pmc_1QodqYFpU9DlKp7R8EIapiwE",STRIPE_TWO_STEP_PMC_ID_TEST:"pmc_1QodsEFpU9DlKp7RHRyay2KC",STRIPE_ONE_STEP_PMC_ID_LIVE:"pmc_1QwcLrFpU9DlKp7Rl9zb07x1",STRIPE_TWO_STEP_PMC_ID_LIVE:"pmc_1QwcP4FpU9DlKp7R4L0ytWkJ",RECAPTCHA_SITE_KEY:"6Lfjxx4sAAAAAIsnmlR5mKNS7QwIWqDjABW2SUu7",i18n:{baseUrl:"",defaultLocale:"en",defaultDirection:"ltr",strategy:"no_prefix",lazy:true,rootRedirect:"",routesNameSeparator:"___",defaultLocaleRouteNameSuffix:"default",skipSettingLocaleOnNavigate:false,differentDomains:false,trailingSlash:false,detectBrowserLanguage:{alwaysRedirect:false,cookieCrossOrigin:false,cookieDomain:"",cookieKey:"i18n_redirected",cookieSecure:false,fallbackLocale:"",redirectOn:"root",useCookie:false},experimental:{localeDetector:"",switchLocalePathLinkSSR:false,autoImportTranslationFunctions:false,typedPages:true,typedOptionsAndMessages:false,generatedLocaleFilePathFormat:"absolute"},multiDomainLocales:false}},app:{baseURL:"/",buildId:"00726252-36ae-4956-b50c-1a96dd83c17e",buildAssetsDir:"/_preview/",cdnURL:"https://stcdn.leadconnectorhq.com/"}}</script><script> (function() { const w = window; w._$delayHydration = (function() { if (!('requestIdleCallback' in w) || !('requestAnimationFrame' in w)) { return new Promise(resolve => resolve('not supported')) } function eventListeners(){const c=new AbortController;const p=new Promise(resolve=>{const hydrateOnEvents="mousemove,scroll,keydown,click,touchstart,wheel".split(",");function handler(e){hydrateOnEvents.forEach(e=>w.removeEventListener(e,handler));requestAnimationFrame(()=>resolve(e))}hydrateOnEvents.forEach(e=>{w.addEventListener(e,handler,{capture:true,once:true,passive:true,signal:c.signal})})});return{c:()=>c.abort(),p:p}}function idleListener(){let id;const p=new Promise(resolve=>{const isMobile=w.innerWidth<640;const timeout=isMobile?Number.parseInt("5000"):Number.parseInt("4500");const timeoutDelay=()=>setTimeout(()=>requestAnimationFrame(()=>resolve("timeout")),timeout);id=w.requestIdleCallback(timeoutDelay,{timeout:Number.parseInt("2000")})});return{c:()=>window.cancelIdleCallback(id),p:p}}const triggers=[idleListener(),eventListeners()];const hydrationPromise=Promise.race(triggers.map(t=>t.p)).finally(()=>{triggers.forEach(t=>t.c())}); return hydrationPromise; })(); ;(()=>{w._$delayHydration.then(e=>{if(e instanceof PointerEvent||e instanceof MouseEvent&&e.type==="click"||window.TouchEvent&&e instanceof TouchEvent){setTimeout(()=>w.requestIdleCallback(()=>setTimeout(()=>e.target&&e.target.click(),500)),50)}})})(); })(); </script></body></html>